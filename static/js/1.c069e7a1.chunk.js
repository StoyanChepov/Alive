(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"a",function(){return o}),n.d(e,"e",function(){return a}),n.d(e,"b",function(){return u}),n.d(e,"d",function(){return s}),n.d(e,"f",function(){return c});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function u(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{s(r.next(t))}catch(e){o(e)}}function u(t){try{s(r.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,u)}s((r=r.apply(t,e||[])).next())})}function s(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(u){o=[6,u],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function c(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,u=o.length;a<u;a++,i++)r[i]=o[a];return r}},function(t,e,n){"use strict";(function(t,r,i,o){n.d(e,"a",function(){return xt}),n.d(e,"b",function(){return Ot}),n.d(e,"c",function(){return ss}),n.d(e,"d",function(){return mc}),n.d(e,"e",function(){return Ju}),n.d(e,"f",function(){return oh}),n.d(e,"g",function(){return mu}),n.d(e,"h",function(){return Tn}),n.d(e,"i",function(){return Ys}),n.d(e,"j",function(){return Zs}),n.d(e,"k",function(){return hs}),n.d(e,"l",function(){return wu}),n.d(e,"m",function(){return Jn}),n.d(e,"n",function(){return En}),n.d(e,"o",function(){return Ml}),n.d(e,"p",function(){return nh}),n.d(e,"q",function(){return oc}),n.d(e,"r",function(){return Ac}),n.d(e,"s",function(){return vc}),n.d(e,"t",function(){return ks}),n.d(e,"u",function(){return Su}),n.d(e,"v",function(){return nr}),n.d(e,"w",function(){return Vc}),n.d(e,"x",function(){return fr}),n.d(e,"y",function(){return mn}),n.d(e,"z",function(){return nc}),n.d(e,"A",function(){return Ru}),n.d(e,"B",function(){return wc}),n.d(e,"C",function(){return Ec}),n.d(e,"D",function(){return Lr}),n.d(e,"E",function(){return pr}),n.d(e,"F",function(){return Ts}),n.d(e,"G",function(){return pn}),n.d(e,"H",function(){return gn}),n.d(e,"I",function(){return yn}),n.d(e,"J",function(){return bn}),n.d(e,"K",function(){return wn}),n.d(e,"L",function(){return qe}),n.d(e,"M",function(){return vr}),n.d(e,"N",function(){return Wc}),n.d(e,"O",function(){return gr}),n.d(e,"P",function(){return kn});var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function u(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})}function c(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}var l=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e,n,r=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(n,e[0],e[1]),e.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(e){var n=e.split(":"),r=n[0],i=n[1];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,i)})}},t}();function f(){return h}var h=null,d=new Map,p=new Map;function v(t,e){var n=b(t,e);return d.get(n)}function m(t){for(var e=d.entries(),n=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var a=o[0],u=o[1];a.split("_")[0]===t&&n.push(u)}return n}function g(t){var e=t.kernelName,n=t.backendName,r=b(e,n);if(d.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");d.set(r,t)}function y(t){var e=t.kernelName;p.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),p.set(e,t)}function b(t,e){return e+"_"+t}function w(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function x(t,e,n){return Math.max(t,Math.min(e,n))}function k(t){return t%2==0?t:t+1}function E(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function C(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function _(t,e,n){void 0===n&&(n=""),C(I(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function S(t){C(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function T(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||W(t)&&!n)for(var r=0;r<t.length;++r)T(t[r],e,n);else e.push(t);return e}function O(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function I(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function R(t){return t%1==0}function A(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function D(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function N(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function P(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,i){var o=0;!function a(){if(t())r();else{var u=e(++o);null!=n&&o>=n?i():setTimeout(a,u)}}()})}function M(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(-1===t[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(t[i]<0)throw Error("Shapes can not be < 0. Found "+t[i]+" at dim "+i);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var o=t.slice();return o[r]=e/n,o}function F(t,e){var n=e.length;return C((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),C(t.every(function(t){return R(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?n+t:t})}function L(t,e){for(var n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||i?null:F(e,t).sort(),a=0,u=0;u<t.length;++u){if(null!=o){if(o[a]===u&&1!==t[u])throw new Error("Can't squeeze axis "+u+" since its dim '"+t[u]+"' is not 1");(null==o[a]||o[a]>u)&&1===t[u]&&(n.push(t[u]),r.push(u)),o[a]<=u&&a++}1!==t[u]&&(n.push(t[u]),r.push(u))}return{newShape:n,keptDims:r}}function j(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function B(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function V(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function U(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function z(t,e){return"complex64"!==e&&("float32"!==e||"complex64"===t)&&("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)}function W(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function G(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function H(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=t.length}),e}function q(t){return"string"==typeof t||t instanceof String}function K(t){return"boolean"==typeof t}function X(t){return"number"==typeof t}function Y(t){return Array.isArray(t)?Y(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":X(t)?"float32":q(t)?"string":K(t)?"bool":"float32"}function Q(t){return!!(t&&t.constructor&&t.call&&t.apply)}function $(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function J(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Z(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=T(t)),n&&V(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),i=0;i<r.length;++i)0!==Math.round(t[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function tt(t,e){if(0===t.length)return e[0];var n=t.reduce(function(t,e){return t*e});if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var i=new Array;if(1===n.length)for(var o=n[0],a=0;a<o;a++)i[a]=r[e+a];else{o=n[0];var u=n.slice(1),s=u.reduce(function(t,e){return t*e});for(a=0;a<o;a++)i[a]=t(e+a*s,u,r)}return i}(0,t,e)}function et(t,e){for(var n=nt(t,e),r=0;r<n.length;r++)n[r]=1;return n}function nt(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function rt(){return f().platform.now()}function it(t){t.forEach(function(e){C(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function ot(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",f().platform.encode(t,e)}function at(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",f().platform.decode(t,e)}function ut(t,e,n){if(0===e)return 0;if(1===e)return t[0];for(var r=t[t.length-1],i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function st(t,e,n){if(0===e)return[];if(1===e)return[t];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}Object.freeze({shuffle:w,clamp:x,nearestLargerEven:k,sum:E,randUniform:function(t,e){var n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var i=Number(t[r])-Number(e[r]);n+=i*i}return n},assert:C,assertShapesMatch:_,assertNonNull:S,flatten:T,sizeFromShape:O,isScalarShape:function(t){return 0===t.length},arraysEqual:I,isInt:R,tanh:A,sizeToSquarishShape:D,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return w(e),e},rightPad:N,repeatedTry:P,inferFromImplicitShape:M,parseAxisParam:F,squeezeShape:L,getTypedArrayFromDType:j,getArrayFromDType:B,checkConversionForErrors:V,isValidDtype:U,hasEncodingLoss:z,isTypedArray:W,bytesPerElement:G,bytesFromStringArray:H,isString:q,isBoolean:K,isNumber:X,inferDtype:Y,isFunction:Q,nearestDivisor:$,computeStrides:J,toTypedArray:Z,toNestedArray:tt,makeOnesTypedArray:et,makeZerosTypedArray:nt,now:rt,assertNonNegativeIntegerDimensions:it,fetch:function(t,e){return f().platform.fetch(t,e)},encodeString:ot,decodeString:at,locToIndex:ut,indexToLoc:st});var ct=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new lt)}return t.prototype.profileKernel=function(t,e,n){var r,i=this,o=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(t,e,n){if("float32"!==e)return!1;for(var r=0;r<t.length;r++){var i=t[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,t),o.then(function(o){var a="";null!=o.getExtraProfileInfo&&(a=o.getExtraProfileInfo()),i.logger.logKernelProfile(t,n,r,o.kernelMs,e,a)})})}),r},t}(),lt=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,i,o){var a="number"==typeof r?N(r+"ms",9):r.error,u=N(t,25),s=e.rank,c=e.size,l=N(e.shape.toString(),14),f="";for(var h in i){var d=i[h].shape||e.shape,p=d.length;f+=h+": "+p+"D "+(p>0?d:"")+" "}console.log("%c"+u+"\t%c"+a+"\t%c"+s+"D "+l+"\t%c"+c+"\t%c"+f+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),ft=20,ht=3,dt=7;function pt(t,e,n){return N(Array.isArray(t)?parseFloat(t[0].toFixed(dt))+" + "+parseFloat(t[1].toFixed(dt))+"j":q(t)?"'"+t+"'":"bool"===n?vt(t):parseFloat(t.toFixed(dt)).toString(),e)}function vt(t){return 0===t?"false":"true"}function mt(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var gt=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=O(t),null!=n){var i=n.length;C(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||B(e,this.size),this.strides=J(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),C(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(n);this.values[i]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,i=t;r<i.length;r++){var o=i[r];if(o<0||o>=this.shape[n]){var a="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(a)}n++}for(var u=t[t.length-1],s=0;s<t.length-1;++s)u+=this.strides[s]*t[s];return this.values[u]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return yt().makeTensor(this.values,this.shape,this.dtype)},t}(),yt=null,bt=null,wt=null,xt=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=O(t),this.strides=J(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),C(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,i){return this.throwIfDisposed(),this.reshape([t,e,n,r,i])},t.prototype.asType=function(t){return this.throwIfDisposed(),bt.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,bt.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return bt.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,tt(this.shape,t)]}})})},t.prototype.arraySync=function(){return tt(this.shape,this.dataSync())},t.prototype.data=function(){return s(this,void 0,void 0,function(){var t,e;return c(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=yt().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map(function(t){return at(t)})]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var t=yt().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(t){return at(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,yt().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(yt().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),bt.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),bt.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),bt.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),bt.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),bt.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),bt.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),bt.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var i=J(e),o=function(t,e,n,r){var i=O(e),o=r[r.length-1],a=new Array(o).fill(0),u=e.length,s="complex64"===n?mt(t):t;if(u>1)for(var c=0;c<i/o;c++)for(var l=c*o,f=0;f<o;f++)a[f]=Math.max(a[f],pt(s[l+f],0,n).length);return a}(t,e,n,i),a=e.length,u=function t(e,n,r,i,o,a){void 0===a&&(a=!0);var u="complex64"===r?2:1,s=n[0],c=n.length;if(0===c)return"complex64"===r?[pt(mt(e)[0],0,r)]:"bool"===r?[vt(e[0])]:[e[0].toString()];if(1===c){if(s>ft){var l=ht*u,f=Array.from(e.slice(0,l)),h=Array.from(e.slice((s-ht)*u,s*u));return"complex64"===r&&(f=mt(f),h=mt(h)),["["+f.map(function(t,e){return pt(t,o[e],r)}).join(", ")+", ..., "+h.map(function(t,e){return pt(t,o[s-ht+e],r)}).join(", ")+"]"]}return["["+("complex64"===r?mt(e):Array.from(e)).map(function(t,e){return pt(t,o[e],r)}).join(", ")+"]"]}var d=n.slice(1),p=i.slice(1),v=i[0]*u,m=[];if(s>ft){for(var g=0;g<ht;g++){var y=(b=g*v)+v;m.push.apply(m,t(e.slice(b,y),d,r,p,o,!1))}for(m.push("..."),g=s-ht;g<s;g++)y=(b=g*v)+v,m.push.apply(m,t(e.slice(b,y),d,r,p,o,g===s-1))}else for(g=0;g<s;g++){var b;y=(b=g*v)+v,m.push.apply(m,t(e.slice(b,y),d,r,p,o,g===s-1))}var w=2===c?",":"";for(m[0]="["+m[0]+w,g=1;g<m.length-1;g++)m[g]=" "+m[g]+w;var x=",\n";for(g=2;g<c;g++)x+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":x),m}(t,e,n,i,o),s=["Tensor"];return r&&(s.push("  dtype: "+n),s.push("  rank: "+a),s.push("  shape: ["+e+"]"),s.push("  values:")),s.push(u.map(function(t){return"    "+t}).join("\n")),s.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),bt.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),bt.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),bt.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),bt.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),bt.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),bt.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),bt.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),bt.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),bt.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),bt.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),bt.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),bt.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,i){return void 0===n&&(n=.001),wt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,i,r,n)},t.prototype.batchNorm=function(t,e,n,r,i){return void 0===i&&(i=.001),this.throwIfDisposed(),bt.batchNorm(this,t,e,n,r,i)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),bt.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),bt.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),bt.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),bt.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),bt.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),bt.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),bt.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),bt.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),bt.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),bt.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),bt.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),bt.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),bt.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),bt.div(this,t)},t.prototype.divNoNan=function(t){return this.throwIfDisposed(),bt.divNoNan(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),bt.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),bt.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),bt.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),bt.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),bt.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),bt.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),bt.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),bt.modStrict(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),bt.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),bt.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),bt.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),bt.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),bt.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),bt.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),bt.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),bt.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),bt.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),bt.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),bt.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),bt.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),bt.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),bt.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),bt.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),bt.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),bt.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),bt.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),bt.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),bt.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),bt.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),bt.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),bt.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),bt.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),bt.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),bt.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),bt.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),bt.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),bt.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),bt.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),bt.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),bt.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),bt.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),bt.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),bt.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),bt.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),bt.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),bt.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),bt.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),bt.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),bt.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),bt.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),bt.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),bt.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),bt.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),bt.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),bt.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),bt.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),bt.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),bt.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),bt.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),bt.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),bt.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),bt.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),bt.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),bt.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),bt.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),bt.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),bt.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),bt.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),bt.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),bt.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),bt.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),bt.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),bt.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),bt.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,i,o){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),bt.conv1d(this,t,e,n,r,i,o)},t.prototype.conv2d=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),bt.conv2d(this,t,e,n,r,i,o)},t.prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),bt.conv2dTranspose(this,t,e,n,r,i)},t.prototype.depthwiseConv2D=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),bt.depthwiseConv2d(this,t,e,n,r,i,o)},t.prototype.separableConv2d=function(t,e,n,r,i,o){return void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),bt.separableConv2d(this,t,e,n,r,i,o)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),bt.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),bt.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),bt.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,i){return this.throwIfDisposed(),bt.pool(this,t,e,n,r,i)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),yt().makeVariable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),bt.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),bt.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),bt.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),bt.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,i,o,a,u){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=0),this.throwIfDisposed(),bt.stridedSlice(this,t,e,n,r,i,o,a,u)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),bt.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),bt.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),bt.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),bt.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),bt.spectral.irfft(this)},t}();Object.defineProperty(xt,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var kt,Et,Ct,_t,St,Tt,Ot=function(t){function e(e,n,r,i){var o=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return o.trainable=n,o.name=r,o}return u(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!I(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");yt().disposeTensor(this),this.dataId=t.dataId,yt().incRef(this,null)},e.prototype.dispose=function(){yt().disposeVariable(this),this.isDisposedInternal=!0},e}(xt);Object.defineProperty(Ot,Symbol.hasInstance,{value:function(t){return t instanceof xt&&null!=t.assign&&t.assign instanceof Function}}),(Tt=kt||(kt={})).R0="R0",Tt.R1="R1",Tt.R2="R2",Tt.R3="R3",Tt.R4="R4",Tt.R5="R5",Tt.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Et||(Et={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ct||(Ct={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(_t||(_t={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(St||(St={}));var It={float32:_t,int32:Et,bool:Ct,complex64:St};function Rt(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return It[t][e]}function At(t){return Rt(t,"int32")}function Dt(t,e){if(t.dtype===e.dtype)return[t,e];var n=Rt(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Nt(t,e){C(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function Pt(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof xt)n.push(e);else if(i=e,Array.isArray(i)||"object"==typeof i){var i,o=e;for(var a in o){var u=o[a];r.has(u)||(r.add(u),t(u,n,r))}}}(t,e,new Set),e}Object.freeze({makeTypesMatch:Dt,assertTypesMatch:Nt,isTensorInList:function(t,e){return e.some(function(e){return e.id===t.id})},getTensorsInContainer:Pt});var Mt,Ft=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),Lt=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ft}return t.prototype.ready=function(){return s(this,void 0,void 0,function(){var t,e,n;return c(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return s(this,void 0,void 0,function(){var e,n,r;return c(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ct(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var t=this;m(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)})},t.prototype.disposeRegisteredKernels=function(t){var e=this;m(t).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])})},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,o=r.then(function(n){return!(i<e.pendingBackendInitId)&&(e.registry[t]=n,e.pendingBackendInit=null,!0)}).catch(function(n){return!(i<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),i=r.success,o=r.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return r.startScope(i)},function(){return r.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],function(t){return{x:function(){return t.toFloat()}}},[]),e},t.prototype.runKernel=function(t,e,n,r,i){return this.runKernelFunc(null,e,null,t,n,r,i)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),i=0;n.forEach(function(t){i+="complex64"===t.dtype?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-i-o;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,n,r,i,o,a){var u,s=this;void 0===o&&(o=[]),void 0===a&&(a=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,h=function(t){l&&(c=t.map(function(t){return s.keep(s.clone(t))}))},d=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=v(r,this.backendName);return f=null!=g?function(){var t=s.backend.numDataIds();m=g.kernelFunc({inputs:e,attrs:i,backend:s.backend});var n=Array.isArray(m)?m:[m];s.shouldCheckForMemLeaks()&&s.checkKernelForMemLeak(r,t,n);var u=n.map(function(t){var e=t.dataId,n=t.shape,r=t.dtype;return s.makeTensorFromDataId(e,n,r)}),c=u.filter(function(t,e){return a[e]});return h((o||[]).slice().concat(c)),u}:function(){var e=s.backend.numDataIds();m=s.tidy(function(){return t(s.backend,h)});var n=Array.isArray(m)?m:[m];return s.shouldCheckForMemLeaks()&&s.checkKernelForMemLeak(r,e,n),n},this.scopedRun(function(){return s.state.kernelDepth++},function(){return s.state.kernelDepth--},function(){u=s.ENV.getBool("DEBUG")?s.profiler.profileKernel(r,e,function(){return f()}):f()}),l&&this.addTapeNode(r,e,u,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShapes:u.map(function(t){return t.shape})}),Array.isArray(m)?u:u[0]},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=t;"string"===n&&q(t[0])&&(i=t.map(function(t){return ot(t)}));var o=r.write(i,e,n),a=new xt(e,n,o,this.nextTensorId());if(this.incRef(a,r),"string"===n){var u=this.state.tensorInfo.get(o),s=H(i);this.state.numBytes+=s-u.bytes,u.bytes=s}return a},t.prototype.makeTensorFromDataId=function(t,e,n,r){var i=new xt(e,n=n||"float32",t,this.nextTensorId());return this.incRef(i,r),i},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.asType(r));var i=new Ot(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*G(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Ot||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return s(this,void 0,void 0,function(){var e,n;return c(this,function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,i){var o=this,a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},u=function(t){return p.get(t)}(t);null!=u&&(r=u.gradFunc),null!=r&&(a.gradient=function(t){return t=t.map(function(t,e){if(null==t){var r=n[e],i=nt(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return t}),r(t.length>1?t:t[0],i)}),this.state.activeTape.push(a)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=Pt(t),r=new Set(n.map(function(t){return t.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];o.kept||r.has(o.id)||o.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(t){t.kept||t.scopeId!==a.id||e.track(t)})},t.prototype.gradients=function(t,e,n,r){var i=this;if(void 0===r&&(r=!1),C(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});C(o instanceof xt,function(){return"The result y returned by f() must be a tensor."});var a=function(t,e,n){for(var r={},i={},o=0;o<e.length;o++)r[e[o].id]=!0;for(o=0;o<t.length;o++){var a=(p=t[o]).inputs;for(var u in a){for(var s=a[u],c=!1,l=0;l<e.length;l++)if(r[s.id]){p.outputs.forEach(function(t){return r[t.id]=!0}),c=!0,i[p.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var h={};for(o=t.length-1;o>=0;o--)for(a=(p=t[o]).inputs,l=0;l<p.outputs.length;l++)if(f[p.outputs[l].id]){for(var u in a)f[a[u].id]=!0,h[p.id]=!0;break}var d=[];for(o=0;o<t.length;o++){var p;if(i[(p=t[o]).id]&&h[p.id]){var v={};for(var u in p.inputs){var m=p.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,d.push(g)}}return d}(this.state.activeTape,e,o);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var t,r,u={};u[o.id]=null==n?(r=et(O(t=o.shape),"float32"),jt.makeTensor(r,t,"float32")):n,function(t,e,n){for(var r=function(r){var i=e[r],o=[];if(i.outputs.forEach(function(e){var n=t[e.id];null!=n?o.push(n):o.push(null)}),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var a=i.gradient(o),u=function(e){if(!(e in a))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(a)+".");var r=n(function(){return a[e]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+r.dtype+"'");var o=i.inputs[e];if(!I(r.shape,o.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+e+"' has shape '"+r.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==t[o.id])t[o.id]=r;else{var u=t[o.id];t[o.id]=u.add(r),u.dispose()}};for(var s in i.inputs)u(s)},i=e.length-1;i>=0;i--)r(i)}(u,a,function(t){return i.tidy(t)});var s=e.map(function(t){return u[t.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(t){for(var e=0,n=t.saved;e<n.length;e++)n[e].dispose()}),i.state.activeTape=null),{value:o,grads:s}})},t.prototype.customGrad=function(t){var e=this;return C(Q(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];C(r.every(function(t){return t instanceof xt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return r.forEach(function(t,e){o[e]=t}),e.runKernelFunc(function(e,i){return C((n=t.apply(void 0,r.concat([i]))).value instanceof xt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),C(Q(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},o,function(t,e){var i=n.gradFunc(t,e),o=Array.isArray(i)?i:[i];C(o.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),C(o.every(function(t){return t instanceof xt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return o.forEach(function(t,e){a[e]=function(){return t}}),a})}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.time=function(t){return s(this,void 0,void 0,function(){var e,n;return c(this,function(r){switch(r.label){case 0:return e=rt(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=rt()-e,[2,n]}})})},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ft,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),jt=function(){var e=function(){if(null==Mt){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof t)e=t;else if("undefined"!=typeof r)e=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Mt=e}return Mt}();if(null==e._tfengine){var n=new l(e);e._tfengine=new Lt(n)}return function(t){h=t}(e._tfengine.ENV),yt=function(){return e._tfengine},e._tfengine}();function Bt(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Vt=f();Vt.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Vt.registerFlag("IS_BROWSER",function(){return Bt()}),Vt.registerFlag("IS_NODE",function(){return"undefined"!=typeof r&&void 0!==r.versions&&void 0!==r.versions.node}),Vt.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Vt.registerFlag("PROD",function(){return!1}),Vt.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Vt.getBool("DEBUG")}),Vt.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Vt.registerFlag("IS_TEST",function(){return!1});var Ut,zt,Wt,Gt={},Ht={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qt(t,e){Gt[t]=e}function Kt(t){t in Gt||(Gt[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete Gt[t]},!1),1===t?e.getContext("webgl",Ht)||e.getContext("experimental-webgl",Ht):e.getContext("webgl2",Ht)}(t));var e=Gt[t];return e.isContextLost()?(delete Gt[t],Kt(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Gt[t])}function Xt(t,e){return[e,t]}function Yt(t){var e=O(t);return D(Math.ceil(e/4))}function Qt(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function $t(t,e){var n,r,i,o,a,u,s,c,l,h=t;return 2===f().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,u=4,s=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=t.RGBA,r=t.RGBA,i=t.RGBA,o=h.RGBA,a=t.RGBA,u=4,s=4,c=null!=e?e.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:s,textureTypeHalfFloat:c,textureTypeFloat:l}}function Jt(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+ne(t,e))}(t),r}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(Ut||(Ut={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(zt||(zt={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Wt||(Wt={}));var Zt=5.96e-8,te=65504;function ee(t){return!!(f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||Zt<Math.abs(t)&&Math.abs(t)<te)}function ne(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function re(t,e,n){return Se(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function ie(t,e,n){var r=Se(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Jt(t,e,function(){return t.shaderSource(r,n)}),Jt(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function oe(t,e,n){var r=Se(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Jt(t,e,function(){return t.shaderSource(r,n)}),Jt(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=se.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],i=t.split("\n"),o=i.length.toString().length+2,a=i.map(function(t,e){return N((e+1).toString(),o)+t}),u=0,s=0;s<a.length;s++)u=Math.max(a[s].length,u);var c=a.slice(0,r-1),l=a.slice(r-1,r),f=a.slice(r);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+N(l[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var ae,ue,se=/ERROR: [0-9]+:([0-9]+):/g;function ce(t,e){return Se(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function le(t,e,n){if(Jt(t,e,function(){return t.linkProgram(n)}),!1===t.getProgramParameter(n,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function fe(t,e,n){if(Jt(t,e,function(){return t.validateProgram(n)}),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function he(t,e,n){var r=Se(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Jt(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Jt(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function de(t,e,n){var r=Se(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Jt(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),Jt(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function pe(t,e){return Se(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function ve(t,e){var n=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function me(t,e){return Se(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function ge(t,e,n,r,i,o,a,u){var s=t.getAttribLocation(n,r);return-1!==s&&(Jt(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,i)}),Jt(t,e,function(){return t.vertexAttribPointer(s,o,t.FLOAT,!1,a,u)}),Jt(t,e,function(){return t.enableVertexAttribArray(s)}),!0)}function ye(t,e,n,r){Te(t,r),Jt(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),Jt(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function be(t,e,n,r){return Se(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function we(t,e,n){return t.getUniformLocation(e,n)}function xe(t,e,n,r,i,o){Jt(t,e,function(){return ye(t,e,r,o)}),Jt(t,e,function(){return t.uniform1i(i,o)})}function ke(t,e,n,r){Jt(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),Jt(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function Ee(t,e,n){Jt(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),Jt(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function Ce(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+_e(t,e))}function _e(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Se(t,e,n,r){var i=Jt(t,e,function(){return n()});if(null==i)throw new Error(r);return i}function Te(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Oe(t,e){return void 0===e&&(e=2),O(t.slice(0,t.length-e))}function Ie(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Re(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[Oe(t)].concat(Ie(t))),e}function Ae(t,e){var n;void 0===e&&(e=!1);var r=f().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map(function(e,n){return n>=t.length-2?k(t[n]):t[n]})).length&&(t=[2,t[0]])),2!==t.length){var i=L(t);t=i.newShape}var o=O(t);if(t.length<=1&&o<=r)return[1,o];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=Oe(t),u=2,s=2;return t.length&&(u=(n=Ie(t))[0],s=n[1]),D(o=a*(u/2)*(s/2)).map(function(t){return 2*t})}return D(o)}function De(t){return t%2==0}function Ne(t,e){if(I(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(De(n)&&De(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&De(t[0])&&De(e[0])}function Pe(t){if(null==ae){var e=Kt(t);ae=e.getParameter(e.MAX_TEXTURE_SIZE)}return ae}function Me(t){if(null==ue){var e=Kt(t);ue=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ue)}function Fe(t){if(0===t)return 0;var e=Kt(t);return Le(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:Le(e,"EXT_disjoint_timer_query")?1:0}function Le(t,e){return null!=t.getExtension(e)}function je(t){try{if(null!=Kt(t))return!0}catch(t){return!1}return!1}function Be(t){if(0===t)return!1;var e=Kt(t);if(1===t){if(!Le(e,"OES_texture_float"))return!1}else if(!Le(e,"EXT_color_buffer_float"))return!1;return Ue(e)}function Ve(t){if(0===t)return!1;var e=Kt(t);if(1!==t){if(Le(e,"EXT_color_buffer_float"))return Ue(e);if(Le(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var n=$t(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(i),o}(e,n)}return!1}return!!Le(e,"OES_texture_float")&&!!Le(e,"WEBGL_color_buffer_float")&&Ue(e)}function Ue(t){var e=$t(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function ze(t){return 2===t&&null!=Kt(t).fenceSync}var We=Object.freeze({callAndCheck:Jt,canBeRepresented:ee,getWebGLErrorMessage:ne,getExtensionOrThrow:re,createVertexShader:ie,createFragmentShader:oe,createProgram:ce,linkProgram:le,validateProgram:fe,createStaticVertexBuffer:he,createStaticIndexBuffer:de,getNumChannels:function(){return 2===f().getNumber("WEBGL_VERSION")?1:4},createTexture:pe,validateTextureSize:ve,createFramebuffer:me,bindVertexBufferToProgramAttribute:ge,bindTextureUnit:ye,unbindTextureUnit:function(t,e,n){Te(t,n),Jt(t,e,function(){return t.activeTexture(t.TEXTURE0+n)}),Jt(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:be,getProgramUniformLocation:we,bindTextureToProgramUniformSampler:xe,bindCanvasToFramebuffer:function(t,e){Jt(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Jt(t,e,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),Jt(t,e,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:ke,unbindColorTextureFromFramebuffer:Ee,validateFramebuffer:Ce,getFramebufferErrorMessage:_e,getBatchDim:Oe,getRowsCols:Ie,getShapeAs3D:Re,getTextureShapeFromLogicalShape:Ae,isReshapeFree:Ne,getWebGLMaxTextureSize:Pe,resetMaxTextureSize:function(){ae=null},resetMaxTexturesInShader:function(){ue=null},getMaxTexturesInShader:Me,getWebGLDisjointQueryTimerVersion:Fe,hasExtension:Le,isWebGLVersionEnabled:je,isCapableOfRenderingToFloatTexture:Be,isDownloadFloatTextureEnabled:Ve,isWebGLFenceEnabled:ze}),Ge=f();function He(t){f().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function qe(t,e){return jt.tidy(t,e)}function Ke(t){Pt(t).forEach(function(t){return t.dispose()})}function Xe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];f().getBool("IS_TEST")||console.warn.apply(console,t)}function Ye(t,e){var n=t;if(W(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||W(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&f().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||W(e)){C(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),C(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var i=n.slice(1),o=0;o<e.length;++o)t(e[o],i,r.concat(o))}else C(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(t,r,[]),r}function Qe(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function $e(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof xt)return Qe(r,t.dtype,e,n),t;var i=Y(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Qe(r,i,e,n),null==t||!W(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var o=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=Ye(t,i);W(t)||Array.isArray(t)||(t=[t]);var u="string"!==i?Z(t,i,f().getBool("DEBUG")):T(t,[],!0);return jt.makeTensor(u,a,i)}function Je(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return $e(t,e+"["+r+"]",n)},r)}function Ze(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function tn(t,e,n){for(var r=t.length+e.length,i=[],o=0,a=0,u=0;u<r;u++)-1===n.indexOf(u)?i.push(t[o++]):i.push(e[a++]);return i}function en(t,e){for(var n=[],r=t.length,i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map(function(e){return t[e]})]}function nn(t,e){return tn(t,e.map(function(t){return 1}),e)}function rn(t,e,n){C(Ze(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function on(t,e){if(Ze(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function an(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function un(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function sn(t,e){var n=t[0].length;t.forEach(function(t,e){C(t.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"})}),C(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(t,i){for(var o=0;o<n;o++)C(o===e||t[o]===r[o],function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function cn(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function ln(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];jt.startScope(n);try{var i=r.apply(void 0,t);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),jt.endScope(i),i}catch(t){throw jt.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Ge.registerFlag("HAS_WEBGL",function(){return Ge.getNumber("WEBGL_VERSION")>0}),Ge.registerFlag("WEBGL_VERSION",function(){return je(2)?2:je(1)?1:0}),Ge.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Ge.get("WEBGL_VERSION")}),Ge.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ge.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Ge.registerFlag("WEBGL_PACK",function(){return Ge.getBool("HAS_WEBGL")}),Ge.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_CLIP",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ge.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_REDUCE",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_CONV_IM2COL",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Pe(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Me(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=Ge.getNumber("WEBGL_VERSION");return 0===t?0:Fe(t)}),Ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ge.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),Ge.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Be(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Ge.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ge.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Ge.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Ve(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ze(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ge.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),wt=He;var fn=ln({complex_:function(t,e){var n=$e(t,"real","complex"),r=$e(e,"imag","complex");return _(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),jt.runKernelFunc(function(t){return t.complex(n,r)},{$real:n,$imag:r})}}),hn=ln({real_:function(t){var e=$e(t,"input","real");return jt.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),dn=ln({imag_:function(t){var e=$e(t,"input","imag");return jt.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function pn(t,e,n){return vn(t,e,Ye(t,n),n)}function vn(t,e,n,r){if(null==r&&(r=Y(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!W(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){it(e);var i=O(e),o=O(n);C(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<n.length;++a){var u=n[a],s=a!==n.length-1||u!==O(e.slice(a));C(n[a]===e[a]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return W(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?Z(t,r,f().getBool("DEBUG")):T(t,[],!0),jt.makeTensor(t,e,r)}function mn(t,e){if((W(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&W(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vn(t,[],[],e)}function gn(t,e){S(t);var n=Ye(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vn(t,null,n,e)}function yn(t,e,n){if(S(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ye(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vn(t,e,r,n)}function bn(t,e,n){if(S(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ye(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vn(t,e,r,n)}function wn(t,e,n){if(S(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Ye(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return vn(t,e,r,n)}function xn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=xn(t,"float32"),r=kn(t,"float32");return fn(n,r)}var i=et(O(t),e);return jt.makeTensor(i,t,e)}function kn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=kn(t,"float32"),r=kn(t,"float32");return fn(n,r)}var i=nt(O(t),e);return jt.makeTensor(i,t,e)}function En(t,e,n){return jt.runKernelFunc(function(r){return r.fill(t,e,n)},{})}function Cn(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return kn([0],r);var i=nt(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return gn(i,r)}var _n=ln({onesLike_:function(t){var e=$e(t,"x","onesLike");if("complex64"===e.dtype){var n=_n(hn(e)),r=Sn(dn(e));return fn(n,r)}return jt.runKernelFunc(function(t){return t.onesLike(e)},{$x:e},function(t,e){return{$x:function(){return Sn(t)}}})}}),Sn=ln({zerosLike_:function(t){var e=$e(t,"x","zerosLike");return jt.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,e){return{$x:function(){return Sn(t)}}})}}),Tn=ln({concat_:function(t,e){void 0===e&&(e=0),C(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=Je(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")}),e=F(e,n[0].shape)[0];var r=cn(n.map(function(t){return t.shape}),e);if(0===O(r))return pn([],r);if(1===(n=n.filter(function(t){return t.size>0})).length)return n[0];var i=n.map(function(t){return t.shape});sn(i,e);var o=n,a={axis:e};return jt.runKernelFunc(function(t){return t.concat(n,e)},o,function(t){var n=i.map(function(t){return t[e]});return Dn(t,n,e).map(function(t){return function(){return t}})},"Concat",a)}}),On=ln({concat1d_:function(t){return Tn(t,0)}}),In=ln({concat2d_:function(t,e){return Tn(t,e)}}),Rn=ln({concat3d_:function(t,e){return Tn(t,e)}}),An=ln({concat4d_:function(t,e){return Tn(t,e)}}),Dn=ln({split_:function(t,e,n){void 0===n&&(n=0);var r,i=$e(t,"x","split");return n=F(n,i.shape)[0],"number"==typeof e?(C(i.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[n]/e)):(C(i.shape[n]===e.reduce(function(t,e){return t+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),jt.runKernelFunc(function(t){return t.split(i,r,n)},{$x:i},function(t){return{$x:function(){return Tn(t,n)}}})}});function Nn(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof t||"undefined"!=typeof self&&self;var Pn=Nn(function(t){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function i(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+1.1102230246251565e-16*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}e&&e.exports?e.exports=o:this.alea=o}(0,t)}),Mn=Nn(function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}e&&e.exports?e.exports=o:this.xor128=o}(0,t)}),Fn=Nn(function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)}),Ln=Nn(function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function i(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&(o.x&&i(o,n),a.state=function(){return i(n,{})}),a}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)}),jn=Nn(function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,o=e.i;return e.w=r=r+1640531527|0,n=i[o+34&127],t=i[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,i,o,a,u=[],s=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,s=Math.max(s,e.length)),i=0,o=-32;o<s;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=u[127&o]^=r+a)?i+1:0);for(i>=128&&(u[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)r=u[i+34&127],n=u[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,u[i]=r^n;t.w=a,t.X=u,t.i=i}(e,t)}function i(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&(o.X&&i(o,n),a.state=function(){return i(n,{})}),a}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)}),Bn=Nn(function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}e&&e.exports?e.exports=o:this.tychei=o}(0,t)}),Vn=Nn(function(t){!function(e,r){var i,o=this,a=256,u=6,s="random",c=r.pow(a,u),l=r.pow(2,52),f=2*l,h=a-1;function d(t,n,h){var d=[],y=m(function t(e,n){var r,i=[],o=typeof e;if(n&&"object"==o)for(r in e)try{i.push(t(e[r],n-1))}catch(t){}return i.length?i:"string"==o?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(a):(t=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=o.navigator,r=n&&n.plugins;return[+new Date,o,r,o.screen,g(e)]}}():t,3),d),b=new p(d),w=function(){for(var t=b.g(u),e=c,n=0;t<l;)t=(t+n)*a,e*=a,n=b.g(1);for(;t>=f;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,m(g(b.S),e),(n.pass||h||function(t,e,n,i){return i&&(i.S&&v(i,b),t.state=function(){return v(b,{})}),n?(r[s]=t,e):t})(w,y,"global"in n?n.global:this==r,n.state)}function p(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,u=r.S=[];for(n||(t=[n++]);i<a;)u[i]=i++;for(i=0;i<a;i++)u[i]=u[o=h&o+t[i%n]+(e=u[i])],u[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,u=r.S;t--;)e=u[i=h&i+1],n=n*a+u[h&(u[i]=u[o=h&o+e])+(u[o]=e)];return r.i=i,r.j=o,n})(a)}function v(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,r=t+"",i=0;i<r.length;)e[h&i]=h&(n^=19*e[h&i])+r.charCodeAt(i++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(r["seed"+s]=d,m(r.random(),e),t.exports){t.exports=d;try{i=n(50)}catch(t){}}}([],Math)});Vn.alea=Pn,Vn.xor128=Mn,Vn.xorwow=Fn,Vn.xorshift7=Ln,Vn.xor4096=jn,Vn.tychei=Bn;var Un=Vn.alea,zn=function(){function t(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Un(o.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var i=void 0,o=void 0,a=void 0;do{a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o}while(a>=1||0===a);var u=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),Wn=function(){function t(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;var i=r||Math.random();this.randu=Un(i.toString()),this.randn=new zn(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,r,i,o;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,e=1-.331*(t=r*r)*t,n=.5*t+this.d*(1-o+Math.log(o)),(i=this.randu())<e||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),Gn=function(){function t(t,e,n,r){var i=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Un(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Hn(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",it(t),new gt(t,e,n)}var qn=ln({batchToSpaceND_:function(t,e,n){var r=$e(t,"x","batchToSpaceND"),i=e.reduce(function(t,e){return t*e});return C(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),C(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),C(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),jt.runKernelFunc(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}})}}),Kn=ln({broadcastTo_:function(t,e){var n=$e(t,"broadcastTo","x"),r=n.shape;if(e.some(function(t){return!(t>0)||t%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var i=n.shape.slice();i.length<e.length;)i.unshift(1);n=n.reshape(i)}for(var o=Array.from(e),a=e.length-1;a>=0;a--)if(n.shape[a]===e[a])o[a]=1;else if(1!==n.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=o.map(function(t,e){return t>1?e:-1}).filter(function(t){return t>=0});return 0===u.length?n.clone():jt.runKernelFunc(function(t){return t.tile(n,o)},{input:n},function(t){return{input:function(){return t.sum(u,!0)}}})}}),Xn=ln({cast_:function(t,e){var n=$e(t,"x","cast");if(!U(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:e};return jt.runKernelFunc(function(t){return t.cast(n,e)},{x:n},function(t){return{x:function(){return t.clone()}}},"Cast",r)}}),Yn=ln({clone_:function(t){var e=$e(t,"x","clone",null);return jt.runKernelFunc(function(){return jt.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),Qn=ln({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=$e(t,"x","cumsum"),o=on([e|=0],i.rank),a=i;null!=o&&(a=i.transpose(o));var u=un(1,i.rank)[0],s=jt.runKernelFunc(function(t){return t.cumsum(a,u,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=o&&(s=s.transpose(o)),s}}),$n=ln({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=$e(t,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return C(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),C(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),C(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),jt.runKernelFunc(function(t){return t.depthToSpace(r,e,n)},{$x:r})}}),Jn=ln({expandDims_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","expandDims",null);C(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(C(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),fr(n,r)}}),Zn=ln({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var i=Hn([t,e],r),o=t<=e?t:e,a=0;a<o;++a)i.set(1,a,a);var u=i.toTensor().as2D(t,e);if(null==n)return u;if(1===n.length)return vr(Jn(u,0),[n[0],1,1]);if(2===n.length)return vr(Jn(Jn(u,0),0),[n[0],n[1],1,1]);if(3===n.length)return vr(Jn(Jn(Jn(u,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),tr=ln({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var i=$e(t,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var u=1===a?i.as2D(1,-1):i,s=jt.runKernelFunc(function(t){return t.multinomial(u,r,e,n)},{logits2D:u});return 1===a?s.as1D():s}}),er=ln({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=$e(t,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),jt.runKernelFunc(function(t){return t.oneHot(i,e,n,r)},{$indices:i},function(t){return{$indices:function(){return kn(i.shape,"float32")}}}).reshape(o)}}),nr=ln({pad_:function(t,e,n){void 0===n&&(n=0);var r=$e(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:n};return jt.runKernelFunc(function(t){return t.pad(r,e,n)},{x:r},function(t){var n=e.map(function(t){return t[0]});return{x:function(){return t.slice(n,r.shape)}}},"PadV2",i)}}),rr=ln({pad1d_:function(t,e,n){return void 0===n&&(n=0),C(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),nr(t,[e],n)}}),ir=ln({pad2d_:function(t,e,n){return void 0===n&&(n=0),C(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),nr(t,e,n)}}),or=ln({pad3d_:function(t,e,n){return void 0===n&&(n=0),C(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),nr(t,e,n)}}),ar=ln({pad4d_:function(t,e,n){return void 0===n&&(n=0),C(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),nr(t,e,n)}}),ur=ln({rand_:function(t,e,n){var r=O(t),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return jt.makeTensor(i,t,n)}}),sr=ln({randomNormal_:function(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new zn(e,n,r,!1,i),a=Hn(t,r),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),cr=ln({randomGamma_:function(t,e,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var o=new Wn(e,n,r,i),a=Hn(t,r),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),lr=ln({randomUniform_:function(t,e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var o=Hn(t,r),a=new Gn(e,n,null,i),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),fr=ln({reshape_:function(t,e){var n=$e(t,"x","reshape",null);e=M(e,n.size),C(n.size===O(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return jt.runKernelFunc(function(t){return t.reshape(n,e)},{x:n},function(t){return{x:function(){return t.reshape(n.shape)}}},"Reshape",r)}}),hr=ln({spaceToBatchND_:function(t,e,n){var r=$e(t,"x","spaceToBatchND");return C(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),C(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),C(r.shape.reduce(function(t,r,i){return i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),jt.runKernelFunc(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}})}}),dr=ln({squeeze_:function(t,e){var n=$e(t,"x","squeeze");return fr(n,L(n.shape,e).newShape)}}),pr=ln({stack_:function(t,e){void 0===e&&(e=0);var n=Je(t,"tensors","stack");if(C(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(e);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;C(e<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(t){_(i,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){C(o===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(t){return t.expandDims(e)});return Tn(a,e)}}),vr=ln({tile_:function(t,e){var n=$e(t,"x","tile",null);C(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."});var r=[n],i={reps:e};return jt.runKernelFunc(function(t,r){var i=t.tile(n,e);return r([n]),i},{x:n},function(t,n){var r=n[0];return{x:function(){var n=Sn(r);if(1===r.rank)for(var i=0;i<e[0];++i)n=n.add(t.slice([i*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(i=0;i<e[0];++i)for(var o=0;o<e[1];++o)n=n.add(t.slice([i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(i=0;i<e[0];++i)for(o=0;o<e[1];++o)for(var a=0;a<e[2];++a)n=n.add(t.slice([i*r.shape[0],o*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<e[0];++i)for(o=0;o<e[1];++o)for(a=0;a<e[2];++a)for(var u=0;u<e[3];++u)n=n.add(t.slice([i*r.shape[0],o*r.shape[1],a*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}},"Tile",i,r)}}),mr=ln({truncatedNormal_:function(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new zn(e,n,r,!0,i),a=Hn(t,r),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),gr=ln({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=$e(t,"x","unstack");C(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length);var r={axis:e};return jt.runKernelFunc(function(t){return t.unstack(n,e)},{x:n},function(t){return{x:function(){return pr(t,e)}}},"Unpack",r)}});function yr(t,e,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([t[a+1]/e[a],e[a]]);i=i.concat(t.slice(o+1))}return i}function br(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<t;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function wr(t,e,n,r){void 0===r&&(r=!0);var i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(var o=1;o<t.length;++o)o<=e.length?r?i.push(e[o-1]*t[o]):i.push(t[o]/e[o-1]):i.push(t[o]);return i}function xr(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function kr(t,e,n){for(var r=t.slice(0,1),i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}function Er(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],i=1,o=0;o<n.length-1;++o)i*=n[o];var a=t.shape,u=n.slice();u.pop();var s=1;for(o=r;o<t.rank;++o)s*=a[o],u.push(a[o]);var c=J(t.shape).map(function(t){return t/s}).concat([1]).slice(0,r);return[u,i,s,c]}Object.freeze({prepareAndValidate:Er});var Cr=30;function _r(t){return t<=Cr?t:$(t,Math.floor(Math.sqrt(t)))}function Sr(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(o+" update.rank < "+i+". ");if(t.length<r+(n.rank-i))throw new Error(o+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+t.length-r)throw new Error(o+" update.rank != "+(i+t.length-r));for(var a=0;a<i;++a)if(n.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-i;++a)if(n.shape[a+i]!==t[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+n.shape[a+i]+") != shape["+(a+i)+"] ("+t[a+i]+")")}function Tr(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}Sr(n,e,t)}function Or(t,e,n){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=n.length,a=1,u=i;u<o;++u)a*=n[u];var s=i<1?1:i;return{sliceRank:i,numUpdates:O(e.shape)/s,sliceSize:a,strides:J(n.slice(0,i)).concat([1]),outputSize:O(n)}}Object.freeze({validateUpdateShape:Sr,validateInput:Tr,calculateShapes:Or});function Ir(t,e,n){C(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),C(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(r){C(e[r]+n[r]<=t.shape[r],function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"})},i=0;i<t.rank;++i)r(i)}function Rr(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function Ar(t,e,n){for(var r=[],i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function Dr(t,e,n,r,i){var o=e[i],a=n[i]||1;(t&1<<i||null==o)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[i];return o<0&&(o+=u),x(0,o,u-1)}function Nr(t,e,n,r,i){var o=e[i],a=n[i]||1;(t&1<<i||null==o)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[i];return o<0&&(o+=u),a>0?x(0,o,u):x(-1,o,u-1)}function Pr(t,e,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function Mr(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}Object.freeze({assertParamsValid:Ir,maskToAxes:Rr,computeOutShape:Ar,startForAxis:Dr,stopForAxis:Nr,isSliceContinous:Pr,computeFlatOffset:Mr});function Fr(t){return jt.customGrad(t)}var Lr=ln({softmax_:function(t,e){void 0===e&&(e=-1);var n=$e(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return jt.runKernelFunc(function(t,r){var i=t.softmax(n,e);return r([i]),i},{logits:n},function(t,n){var r=n[0],i=t.mul(r);return{logits:function(){return i.sub(i.sum([e],!0).mul(r))}}},"Softmax",{dim:e},[],[!0])}}),jr=ln({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=$e(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return Fr(function(t,n){var r=t.max(e,!0),i=t.sub(r),o=i.toFloat().sub(i.exp().sum(e,!0).log());return n([o]),{value:o,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}})(n)}}),Br=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),Vr=function(){function t(){}return t.prototype.time=function(t){return Ur("time")},t.prototype.read=function(t){return Ur("read")},t.prototype.readSync=function(t){return Ur("readSync")},t.prototype.numDataIds=function(){return Ur("numDataIds")},t.prototype.disposeData=function(t){return Ur("disposeData")},t.prototype.write=function(t,e,n){return Ur("write")},t.prototype.move=function(t,e,n,r){return Ur("move")},t.prototype.memory=function(){return Ur("memory")},t.prototype.floatPrecision=function(){return Ur("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){return Ur("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,Ur("fusedBatchMatMul")},t.prototype.slice=function(t,e,n){return Ur("slice")},t.prototype.stridedSlice=function(t,e,n,r){return Ur("stridedSlice")},t.prototype.unstack=function(t,e){return Ur("unstack")},t.prototype.reverse=function(t,e){return Ur("reverse")},t.prototype.concat=function(t,e){return Ur("concat")},t.prototype.neg=function(t){return Ur("neg")},t.prototype.add=function(t,e){return Ur("add")},t.prototype.addN=function(t){return Ur("addN")},t.prototype.subtract=function(t,e){return Ur("subtract")},t.prototype.multiply=function(t,e){return Ur("multiply")},t.prototype.realDivide=function(t,e){return Ur("realDivide")},t.prototype.floorDiv=function(t,e){return Ur("floorDiv")},t.prototype.sum=function(t,e){return Ur("sum")},t.prototype.prod=function(t,e){return Ur("prod")},t.prototype.unsortedSegmentSum=function(t,e,n){return Ur("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return Ur("argMin")},t.prototype.argMax=function(t,e){return Ur("argMax")},t.prototype.equal=function(t,e){return Ur("equal")},t.prototype.notEqual=function(t,e){return Ur("notEqual")},t.prototype.less=function(t,e){return Ur("less")},t.prototype.lessEqual=function(t,e){return Ur("lessEqual")},t.prototype.greater=function(t,e){return Ur("greater")},t.prototype.greaterEqual=function(t,e){return Ur("greaterEqual")},t.prototype.logicalNot=function(t){return Ur("logicalNot")},t.prototype.logicalAnd=function(t,e){return Ur("logicalAnd")},t.prototype.logicalOr=function(t,e){return Ur("logicalOr")},t.prototype.where=function(t){return Ur("where")},t.prototype.select=function(t,e,n){return Ur("select")},t.prototype.topk=function(t,e,n){return Ur("topk")},t.prototype.min=function(t,e){return Ur("min")},t.prototype.minimum=function(t,e){return Ur("minimum")},t.prototype.mod=function(t,e){return Ur("mod")},t.prototype.max=function(t,e){return Ur("max")},t.prototype.maximum=function(t,e){return Ur("maximum")},t.prototype.all=function(t,e){return Ur("all")},t.prototype.any=function(t,e){return Ur("any")},t.prototype.squaredDifference=function(t,e){return Ur("squaredDifference")},t.prototype.ceil=function(t){return Ur("ceil")},t.prototype.floor=function(t){return Ur("floor")},t.prototype.round=function(t){return Ur("round")},t.prototype.sign=function(t){return Ur("sign")},t.prototype.isNaN=function(t){return Ur("isNaN")},t.prototype.isInf=function(t){return Ur("isInf")},t.prototype.isFinite=function(t){return Ur("isFinite")},t.prototype.pow=function(t,e){return Ur("pow")},t.prototype.exp=function(t){return Ur("exp")},t.prototype.expm1=function(t){return Ur("expm1")},t.prototype.softmax=function(t,e){return Ur("softmax")},t.prototype.log=function(t){return Ur("log")},t.prototype.log1p=function(t){return Ur("log1p")},t.prototype.sqrt=function(t){return Ur("sqrt")},t.prototype.rsqrt=function(t){return Ur("rsqrt")},t.prototype.square=function(t){return Ur("square")},t.prototype.reciprocal=function(t){return Ur("reciprocal")},t.prototype.relu=function(t){return Ur("relu")},t.prototype.relu6=function(t){return Ur("relu6")},t.prototype.prelu=function(t,e){return Ur("prelu")},t.prototype.elu=function(t){return Ur("elu")},t.prototype.eluDer=function(t,e){return Ur("eluDer")},t.prototype.selu=function(t){return Ur("selu")},t.prototype.int=function(t){return Ur("int")},t.prototype.clip=function(t,e,n){return Ur("clip")},t.prototype.abs=function(t){return Ur("abs")},t.prototype.complexAbs=function(t){return Ur("complexAbs")},t.prototype.sigmoid=function(t){return Ur("sigmoid")},t.prototype.softplus=function(t){return Ur("softplus")},t.prototype.sin=function(t){return Ur("sin")},t.prototype.cos=function(t){return Ur("cos")},t.prototype.tan=function(t){return Ur("tan")},t.prototype.asin=function(t){return Ur("asin")},t.prototype.acos=function(t){return Ur("acos")},t.prototype.atan=function(t){return Ur("atan")},t.prototype.atan2=function(t,e){return Ur("atan2")},t.prototype.sinh=function(t){return Ur("sinh")},t.prototype.cosh=function(t){return Ur("cosh")},t.prototype.tanh=function(t){return Ur("tanh")},t.prototype.asinh=function(t){return Ur("asinh")},t.prototype.acosh=function(t){return Ur("acosh")},t.prototype.atanh=function(t){return Ur("atanh")},t.prototype.erf=function(t){return Ur("erf")},t.prototype.step=function(t,e){return Ur("step")},t.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,Ur("fusedConv2d")},t.prototype.conv2d=function(t,e,n){return Ur("conv2d")},t.prototype.conv2dDerInput=function(t,e,n){return Ur("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,n){return Ur("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,Ur("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,n){return Ur("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){return Ur("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){return Ur("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,n){return Ur("conv3d")},t.prototype.conv3dDerInput=function(t,e,n){return Ur("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,n){return Ur("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return Ur("maxPool")},t.prototype.maxPoolBackprop=function(t,e,n,r){return Ur("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return Ur("avgPool")},t.prototype.avgPoolBackprop=function(t,e,n){return Ur("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return Ur("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,n){return Ur("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return Ur("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,n,r){return Ur("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return Ur("reshape")},t.prototype.cast=function(t,e){return Ur("cast")},t.prototype.tile=function(t,e){return Ur("tile")},t.prototype.pad=function(t,e,n){return Ur("pad")},t.prototype.transpose=function(t,e){return Ur("transpose")},t.prototype.gather=function(t,e,n){return Ur("gather")},t.prototype.gatherND=function(t,e){return Ur("gatherND")},t.prototype.scatterND=function(t,e,n){return Ur("scatterND")},t.prototype.batchToSpaceND=function(t,e,n){return Ur("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,n){return Ur("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,n,r){return Ur("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,n){return Ur("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){return Ur("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){return Ur("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,n,r,i,o){return Ur("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,n,r,i){return Ur("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,n,r,i,o,a){return Ur("LRNGrad")},t.prototype.multinomial=function(t,e,n,r){return Ur("multinomial")},t.prototype.oneHot=function(t,e,n,r){return Ur("oneHot")},t.prototype.cumsum=function(t,e,n,r){return Ur("cumsum")},t.prototype.nonMaxSuppression=function(t,e,n,r,i){return Ur("nonMaxSuppression")},t.prototype.fft=function(t){return Ur("fft")},t.prototype.ifft=function(t){return Ur("ifft")},t.prototype.complex=function(t,e){return Ur("complex")},t.prototype.real=function(t){return Ur("real")},t.prototype.imag=function(t){return Ur("imag")},t.prototype.cropAndResize=function(t,e,n,r,i,o){return Ur("cropAndResize")},t.prototype.depthToSpace=function(t,e,n){return Ur("depthToSpace")},t.prototype.split=function(t,e,n){return Ur("split")},t.prototype.sparseToDense=function(t,e,n,r){return Ur("sparseToDense")},t.prototype.diag=function(t){return Ur("diag")},t.prototype.fill=function(t,e,n){return Ur("fill")},t.prototype.onesLike=function(t){return Ur("onesLike")},t.prototype.zerosLike=function(t){return Ur("zerosLike")},t.prototype.linspace=function(t,e,n){return Ur("linspace")},t.prototype.dispose=function(){return Ur("dispose")},t}();function Ur(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function zr(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,a=t[o]||1;(e[e.length-1-i]||1)>1&&1===a&&r.unshift(o)}return r}function Wr(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,a=e[o];(null==i||1===i&&a>1)&&n.unshift(o)}return n}function Gr(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var o=t[t.length-i-1];null==o&&(o=1);var a=e[e.length-i-1];if(null==a&&(a=1),1===o)n.unshift(a);else if(1===a)n.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(o)}}return n}function Hr(t,e,n,r,i,o,a){void 0===a&&(a="channelsLast");var u,s=Qr(e),c=s[0],l=s[1];if("channelsLast"===a)u=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);u=[c,l,t[1],t[1]]}return Kr(t,u,n,r,i,o,!1,a)}function qr(t,e,n,r,i,o,a){void 0===a&&(a="NDHWC");var u,s,c=$r(e),l=c[0],f=c[1],h=c[2];if("NDHWC"===a)s="channelsLast",u=[l,f,h,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);s="channelsFirst",u=[l,f,h,t[1],t[1]]}return Xr(t,u,n,r,i,!1,s,o)}function Kr(t,e,n,r,i,o,a,u){void 0===a&&(a=!1),void 0===u&&(u="channelsLast");var s=[-1,-1,-1,-1],c=s[0],l=s[1],f=s[2],h=s[3];if("channelsLast"===u)c=t[0],l=t[1],f=t[2],h=t[3];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat "+u);c=t[0],h=t[1],l=t[2],f=t[3]}var d,p=e[0],v=e[1],m=e[3],g=Qr(n),y=g[0],b=g[1],w=Qr(r),x=w[0],k=w[1],E=Jr(p,x),_=Jr(v,k),S=function(t,e,n,r,i,o,a,u){var s,c,l;if("number"==typeof t){s={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var f=function(t,e,n,r,i){null==r&&(r=Yr(t,e,n));var o=t[1],a=Zr((t[0]-e+2*r)/n+1,i);C(R(a),function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"});var u=Zr((o-e+2*r)/n+1,i);return C(R(u),function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"}),[a,u]}([e,n],o,r,t,u);c=f[0],l=f[1]}else if("same"===t){c=Math.ceil(e/r),l=Math.ceil(n/i);var h=Math.max(0,(c-1)*r+o-e),d=Math.max(0,(l-1)*i+a-n),p=Math.floor(h/2),v=h-p,m=Math.floor(d/2);s={top:p,bottom:v,left:m,right:d-m,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);s={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-o+1)/r),l=Math.ceil((n-a+1)/i)}return{padInfo:s,outHeight:c,outWidth:l}}(i,l,f,y,b,E,_,o),T=S.padInfo,O=S.outHeight,I=S.outWidth,A=a?m*h:m;return"channelsFirst"===u?d=[c,A,O,I]:"channelsLast"===u&&(d=[c,O,I,A]),{batchSize:c,dataFormat:u,inHeight:l,inWidth:f,inChannels:h,outHeight:O,outWidth:I,outChannels:A,padInfo:T,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:_,dilationHeight:x,dilationWidth:k,inShape:t,outShape:d,filterShape:e}}function Xr(t,e,n,r,i,o,a,u){void 0===o&&(o=!1),void 0===a&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],c=s[0],l=s[1],f=s[2],h=s[3],d=s[4];if("channelsLast"===a)c=t[0],l=t[1],f=t[2],h=t[3],d=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],d=t[1],l=t[2],f=t[3],h=t[4]}var p,v=e[0],m=e[1],g=e[2],y=e[4],b=$r(n),w=b[0],x=b[1],k=b[2],E=$r(r),_=E[0],S=E[1],T=E[2],O=Jr(v,_),I=Jr(m,S),A=Jr(g,T),D=function(t,e,n,r,i,o,a,u,s,c,l){var f,h,d,p;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var v=function(t,e,n,r,i,o){null==i&&(i=Yr(t,e,r));var a=t[1],u=t[2],s=Zr((t[0]-e+2*i)/r+1,o);C(R(s),function(){return"The output # of depths ("+s+") must be an integer. Change the stride and/or zero pad parameters"});var c=Zr((a-e+2*i)/r+1,o);C(R(c),function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"});var l=Zr((u-e+2*i)/r+1,o);return C(R(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[s,c,l,1]}([e,n,r,1],u,0,i,t,l);h=v[0],d=v[1],p=v[2]}else if("same"===t){var m=((h=Math.ceil(e/i))-1)*i+u-e,g=((d=Math.ceil(n/o))-1)*o+s-n,y=((p=Math.ceil(r/a))-1)*a+c-r,b=Math.floor(m/2),w=m-b,x=Math.floor(g/2),k=g-x,E=Math.floor(y/2);f={top:x,bottom:k,left:E,right:y-E,front:b,back:w,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-u+1)/i),d=Math.ceil((n-s+1)/o),p=Math.ceil((r-c+1)/a)}return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}(i,l,f,h,w,x,k,O,I,A,u),N=D.padInfo,P=D.outDepth,M=D.outHeight,F=D.outWidth,L=o?y*d:y;return"channelsFirst"===a?p=[c,L,P,M,F]:"channelsLast"===a&&(p=[c,P,M,F,L]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:f,inWidth:h,inChannels:d,outDepth:P,outHeight:M,outWidth:F,outChannels:L,padInfo:N,strideDepth:w,strideHeight:x,strideWidth:k,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:O,effectiveFilterHeight:I,effectiveFilterWidth:A,dilationDepth:_,dilationHeight:S,dilationWidth:T,inShape:t,outShape:p,filterShape:e}}function Yr(t,e,n,r){void 0===r&&(r=1);var i=Jr(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function Qr(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function $r(t){return"number"==typeof t?[t,t,t]:t}function Jr(t,e){return e<=1?t:t+(t-1)*(e-1)}function Zr(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function ti(t){var e=Qr(t),n=e[0],r=e[1],i=e[2];return 1===n&&1===r&&1===i}function ei(t,e){return ti(t)||ti(e)}function ni(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function ri(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=kn(t.shape),i=t.toFloat(),o=n.complex(i,r);return r.dispose(),i.dispose(),o}if(!z(t.dtype,e))return jt.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){var a=n.real(t);return o=a.cast(e),a.dispose(),o}if("int32"===e)return n.int(t);if("bool"===e){var u=mn(0,t.dtype);return o=n.notEqual(t,u),u.dispose(),o}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function ii(t,e){return jt.makeTensorFromDataId(t.dataId,e,t.dtype)}function oi(t,e,n){var r=(e-t)/(n-1),i=nt(n,"float32");i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return gn(i,"float32")}Object.freeze({castTensor:ri,reshapeTensor:ii,linspaceImpl:oi,upcastType:Rt,axesAreInnerMostDims:Ze,combineLocations:tn,computeOutAndReduceShapes:en,expandShapeToKeepDim:nn,assertAxesAreInnerMostDims:rn,getAxesPermutation:on,getUndoAxesPermutation:an,getInnerMostAxes:un,getBroadcastDims:zr,getReductionAxes:Wr,assertAndGetBroadcastShape:Gr,assertParamsConsistent:sn,computeOutShape:cn,computePool2DInfo:Hr,computePool3DInfo:qr,computeConv2DInfo:Kr,computeConv3DInfo:Xr,computeDefaultPad:Yr,tupleValuesAreOne:ti,eitherStridesOrDilationsAreOne:ei,convertConv2DDataFormat:ni,PARALLELIZE_THRESHOLD:Cr,computeOptimalWindowSize:_r});function ai(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function ui(t,e){return{real:t[2*e],imag:t[2*e+1]}}function si(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function ci(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function li(t,e,n){var r=function(t,e,n){return function(t,e,n){for(var r=0,i=t.length,o=0,a=!1;r<i;){var u=n(e,t[o=r+(i-r>>>1)]);u>0?r=o+1:(i=o,a=!u)}return a?r:-r-1}(t,e,n||fi)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function fi(t,e){return t>e?1:t<e?-1:0}function hi(t,e,n,r,i){return pi(t,e,n,r,i,0).selectedIndices}function di(t,e,n,r,i,o){var a=pi(t,e,n,r,i,o,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function pi(t,e,n,r,i,o,a,u){void 0===a&&(a=!1),void 0===u&&(u=!1);for(var s=Array.from(e).map(function(t,e){return{score:t,boxIndex:e,suppressBeginIndex:0}}).filter(function(t){return t.score>i}).sort(gi),c=o>0?-.5/o:0,l=[],f=[];l.length<n&&s.length>0;){var h=s.pop(),d=h.score,p=h.boxIndex,v=h.suppressBeginIndex;if(d<i)break;for(var m=!1,g=l.length-1;g>=v;--g){var y=vi(t,p,l[g]);if(y>=r){m=!0;break}if(h.score=h.score*mi(r,c,y),h.score<=i)break}h.suppressBeginIndex=l.length,m||(h.score===d?(l.push(p),f.push(h.score)):h.score>i&&li(s,h,gi))}var b=l.length;return u&&(l.fill(0,b),f.fill(0,b)),{selectedIndices:gn(l,"int32"),selectedScores:gn(f,"float32"),numValidOutputs:mn(b,"int32")}}function vi(t,e,n){var r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),u=Math.max(r[0],r[2]),s=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),d=(u-o)*(s-a),p=(f-c)*(h-l);if(d<=0||p<=0)return 0;var v=Math.max(o,c),m=Math.max(a,l),g=Math.min(u,f),y=Math.min(s,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function mi(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function gi(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function yi(t,e,n){var r=new Array(t.rank).fill(0),i=t.shape.slice();return e.map(function(e){i[n]=e;var o=t.slice(r,i);return r[n]+=e,o})}function bi(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var i=Hn(n,t.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(t.rank),u=0;u<a.length;u++)a[u]=o[u]%t.shape[u];var s=t.locToIndex(a);i.values[r]=t.values[s]}return i.toTensor()}function wi(t,e,n,r,i){for(var o=e[e.length-1],a=[t.length/o,o],u=a[0],s=a[1],c=j(n,u*r),l=j("int32",u*r),f=0;f<u;f++){for(var h=f*s,d=t.subarray(h,h+s),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort(function(t,e){return e.value-t.value});var m=f*r,g=c.subarray(m,m+r),y=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var b=e.slice();return b[b.length-1]=r,[pn(c,b,n),pn(l,b,"int32")]}function xi(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var i=Hn(t,"int32"),o=Hn([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=i.indexToLoc(n[r]),u=r*t.length;o.values.set(a,u)}return o.toTensor()}var ki=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Ei=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Ci=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,a=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var u="max"===e?">":"<",s=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+s+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+u+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function _i(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function Si(t,e){return 1===e?[t]:_i(t,e)}function Ti(){var t,e,n,r,i,o,a,u,s,c;return 2===f().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",u="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",s="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",a="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",s="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:u,defineSpecialInf:s,defineRound:c}}function Oi(t,e,n){void 0===n&&(n="index");var r=J(e);return r.map(function(e,i){return"int "+t[i]+" = "+n+" / "+e+"; "+(i===r.length-1?"int "+t[i+1]+" = "+n+" - "+t[i]+" * "+e:"index -= "+t[i]+" * "+e)+";"}).join("")}function Ii(t){var e=J(t).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var Ri="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Ai(t,e,n,r){var i=[];t.forEach(function(t){var e=O(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?i.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(i.push("uniform sampler2D "+t.name+";"),i.push("uniform int offset"+t.name+";"))});var o,a,u=i.join("\n"),s=t.map(function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";r+=n?function t(e){var n,r,i;switch(e.shapeInfo.logicalShape.length){case 0:return n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=Ti(),"\n    vec4 "+r+"() {\n      return "+i.texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=Ti();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+o.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],u=Ti();if(null!=i&&I(e,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n\n        return "+u.texture2D+"("+n+", uv);\n      }\n    ";var s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(e[1]/2);return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+c+", "+s[0]+", "+s[1]+", row, col);\n      return "+u.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===n[0]){var u=n.slice(1),s=Bi(e,u);return"\n        "+t(s)+"\n        vec4 "+i+"(int b, int row, int col) {\n          return "+i+"("+Vi(["b","row","col"],[1,2])+");\n        }\n      "}var c=a[0],l=a[1],f=Math.ceil(n[2]/2),h=f*Math.ceil(n[1]/2),d=Ti();return"\n    vec4 "+i+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+c+", "+l+", "+h+", "+f+", b, row, col);\n      return "+d.texture2D+"("+r+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=a[0],s=a[1],c=Math.ceil(e[n-1]/2),l=c*Math.ceil(e[n-2]/2),f="int b, int row, int col",h="b * "+l+" + (row / 2) * "+c+" + (col / 2)",d=2;d<n-1;d++)f="int b"+d+", "+f,l*=e[n-d-1],h="b"+d+" * "+l+" + "+h;var p=Ti();return"\n    vec4 "+i+"("+f+") {\n      int index = "+h+";\n      int texR = index / "+s+";\n      int texC = index - texR * "+s+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+s+", "+u+");\n      return "+p.texture2D+"("+r+", uv);\n    }\n  "}(e)}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape,i=r[0],o=r[1];if(1===i&&1===o)return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=t.shapeInfo.texShape,u=a[0],s=a[1],c=Fi(e);return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+u+", "+s+", "+c+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Li(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,i=r[0],o=r[1];if(1===o&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=Fi(e);return 1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+i+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+o+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+o+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape;if(null!=o&&I(n,o)){var a=o[0],u=o[1];return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+u+".0, "+a+".0);\n      return sampleTexture("+r+", uv);\n    }\n  "}var s=L(n),c=s.newShape,l=s.keptDims,f=c;if(f.length<n.length){var h=Bi(e,f);return"\n      "+t(h)+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+Vi(["row","col"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+Li(e)+"\n      }\n    ";var d=o[0],p=o[1],v=Fi(r);return 1===p?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+v+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+d+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===d?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+v+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+p+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+v+";\n    vec2 uv = uvFromFlat("+d+", "+p+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],a=n[2],u=L(n),s=u.newShape,c=u.keptDims,l=s;if(l.length<n.length){var f=Bi(e,l);return"\n        "+t(f)+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+Vi(["row","col","depth"],c)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+Li(e)+"\n      }\n    ";var h=e.shapeInfo.texShape,d=h[0],p=h[1],v=e.shapeInfo.flatOffset;if(p===o&&null==v)return"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+d+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ";if(p===a&&null==v)return"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+d+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var m=Fi(r);return"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+m+";\n        vec2 uv = uvFromFlat("+d+", "+p+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],a=n[2]*o,u=n[1]*a,s=L(n),c=s.newShape,l=s.keptDims;if(c.length<n.length){var f=Bi(e,c);return"\n      "+t(f)+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+Vi(["row","col","depth","depth2"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+a+", "+o+", 1)));\n        "+Li(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1];if(v===u&&null==h)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ";if(v===o&&null==h)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ";var m=Fi(r);return"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+v+", index + "+m+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[4],a=n[3]*o,u=n[2]*a,s=n[1]*u,c=L(n),l=c.newShape,f=c.keptDims;if(l.length<n.length){var h=Bi(e,l);return"\n      "+t(h)+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+Vi(["row","col","depth","depth2","depth3"],f)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+u+", "+a+", "+o+")) +\n          depth3;\n        "+Li(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1];if(m===s&&null==d)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ";if(m===o&&null==d)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ";var g=Fi(r);return"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+u+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+g+";\n      vec2 uv = uvFromFlat("+v+", "+m+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=L(n),a=o.newShape,u=o.keptDims;if(a.length<n.length){var s=Bi(e,a);return"\n      "+t(s)+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+Vi(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    "}var c=n[5],l=n[4]*c,f=n[3]*l,h=n[2]*f,d=n[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+h+", "+f+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+c+", 1)));\n        "+Li(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];if(g===d&&null==p)return"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+f+", "+l+", "+c+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ";if(g===c&&null==p)return"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ";var y=Fi(r);return"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+h+" + depth * "+f+" +\n          depth2 * "+l+" + depth3 * "+c+" + depth4 + "+y+";\n      vec2 uv = uvFromFlat("+m+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t);var i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(r+=n?function(t,e){var n,r=t.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"AtOutCoords",a=t.shapeInfo.logicalShape.length,u=e.logicalShape.length,s=zr(t.shapeInfo.logicalShape,e.logicalShape),c=ji(u),l=u-a,f=["x","y","z","w","u","v"];n=0===a?"":u<2&&s.length>=1?"coords = 0;":s.map(function(t){return"coords."+f[t+l]+" = 0;"}).join("\n");var h;h=u<2&&a>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+f[e+l]}).join(", ");var d="return outputValue;",p=1===O(t.shapeInfo.logicalShape),v=1===O(e.logicalShape);if(1!==a||p||v){if(p&&!v)d=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){var m=a-2,g=a-1;s.indexOf(m)>-1&&s.indexOf(g)>-1?d="return vec4(outputValue.x);":s.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+h+");\n      "+d+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",o=e.texShape,a=t.shapeInfo.texShape,u=t.shapeInfo.logicalShape.length,s=e.logicalShape.length;if(!t.shapeInfo.isUniform&&u===s&&null==t.shapeInfo.flatOffset&&I(a,o))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c=ji(s),l=zr(t.shapeInfo.logicalShape,e.logicalShape),f=s-u,h=["x","y","z","w","u","v"];return"\n    float "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===u?"":s<2&&l.length>=1?"coords = 0;":l.map(function(t){return"coords."+h[t+f]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(s<2&&u>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+h[e+f]}).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)}).join("\n"),c=e.texShape,l=Ti(),f="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",h=function(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Di+"\n    "+Ni+"\n    "+Pi+"\n  "}(l);return e.isPacked?(o=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(I(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=t,r=e,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=(o=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+o+");\n      int c = imod(index, "+o+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2),o=i,a="",u="b, r, c",s=2;s<t.length-1;s++)a="\n      int b"+s+" = index / "+(o*=t[t.length-s-1])+";\n      index -= b"+s+" * "+o+";\n    "+a,u="b"+s+", "+u;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+u+");\n    }\n  "}(t,e)}var n,r,i,o,a}(e.logicalShape,c),a="\n    void setOutput(vec4 val) {\n      "+l.output+" = val;\n    }\n  "):(o=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return I(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=e,r=Oi(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=Oi(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=Oi(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=Oi(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r}(e.logicalShape,c),a="\n    void setOutput(float val) {\n      "+l.output+" = vec4(val, 0, 0, 0);\n    }\n  "),r&&(h+=Mi),[h,f,a,u,o,s,n].join("\n")}var Di="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ni="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Pi="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Mi="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Fi(t){return"offset"+t}function Li(t){var e=t.name,n=O(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function ji(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Bi(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Vi(t,e){return e.map(function(e){return t[e]}).join(", ")}var Ui=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var i=t[t.length-1],o=Math.ceil(i/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,u,s=this.outputShape,c=s.length,l=ji(c),f=Si("coords",c);if(1===o){var h=ji(u=c+1);a="\n        "+h+" sourceLocR = "+h+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+h+" sourceLocG = "+h+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+h+" sourceLocA = "+h+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+h+" sourceLocB = "+h+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else u=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var d=["x","y","z","w","u","v"].slice(0,u),p="."+d[u-1],v=d.map(function(t){return"int "+t}),m=Si("sourceLocR",u-1).concat("inIdx.r"),g=Si("sourceLocG",u-1).concat("inIdx.g"),y=Si("sourceLocB",u-1).concat("inIdx.b"),b=Si("sourceLocA",u-1).concat("inIdx.a"),w="max"===n?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",k="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",E=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+d.join()+"),\n                                          vec2("+d.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+d.join()+"),\n                               vec2("+d.slice(-2).join()+"));\n      }\n      "+E+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(s[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(s[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+k+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+k+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+w+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},zi=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,s=t.effectiveFilterWidth,c=u-1-t.padInfo.top,l=s-1-t.padInfo.left,f=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+u+";\n            wR += "+o+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+s+";\n            wC+= "+a+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wi=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=l-1-t.padInfo.front,p=f-1-t.padInfo.top,v=h-1-t.padInfo.left,m=1/(e*n*r);this.userCode="\n      const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+u+") {\n          float dyD = float(dyDCorner + wD) / "+i+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+s+") {\n            float dyR = float(dyRCorner + wR) / "+o+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+h+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Gi=function(t,e,n,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Gr(t,e),Gr(t,n);var a="0.0";null!=r&&(Gr(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Gr(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+u+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Hi=function(t,e,n,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Gr(t,e),Gr(t,n);var a="vec4(0.0)";null!=r&&(Gr(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Gr(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+u+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},qi=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Gr(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Ki="return a + b;",Xi="return a - b;",Yi="return a * b;",Qi="return (a < 0.) ? b * a : a;",$i=function(t,e,n){this.variableNames=["A","B"],this.outputShape=Gr(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Ji="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Zi=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Gr(e,n);var i=this.outputShape.length,o="";if(r)if(0===i||1===O(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+ji(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=Si("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+a[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+a[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},to=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),eo=function(){function t(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),no=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},ro=function(t){this.outputShape=[],this.outputShape=cn(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var i=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},io=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=cn(t,e);var n=this.outputShape,r=n.length,i=ji(r),o=Si("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(t,e){return"T"+e});var u=new Array(t.length-1);u[0]=t[0][e];for(var s=1;s<u.length;s++)u[s]=u[s-1]+t[s][e];var c=a[e],l=a.slice(-2),f=a.join(),h="if ("+c+" < "+u[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(s=1;s<u.length;s++){var d=u[s-1];h+="\n        if ("+c+" < "+u[s]+"  && "+c+" >= "+u[s-1]+") {\n          return getChannel(\n            getT"+s+"("+oo(a,c,d)+"),\n            vec2("+oo(l,c,d)+"));\n        }"}var p=u.length,v=u[u.length-1];h+="\n        return getChannel(\n          getT"+p+"("+oo(a,c,v)+"),\n          vec2("+oo(l,c,v)+"));",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[r-1]+" = "+o[r-1]+" + 1;\n        if ("+o[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[r-2]+" = "+o[r-2]+" + 1;\n        if ("+o[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[r-1]+" = "+o[r-1]+" - 1;\n        if ("+o[r-2]+" < "+n[r-2]+" &&\n            "+o[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function oo(t,e,n){var r=t.indexOf(e);return t.map(function(t,e){return e===r?t+" - "+n:t}).join()}var ao=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+o+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uo=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,a=e-1-t.padInfo.top,u=n-1-t.padInfo.left,s=o?1:2,c=o?2:3,l=o?3:1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+u+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+s+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+o+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},so=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+i+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+o+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+a+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},co=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=e-1-t.padInfo.front,s=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+u+", "+s+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+o+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},lo=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fo=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+u+"; dm++) {\n              int d2 = d1 * "+u+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ho=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,a=t.strideHeight,u=t.strideWidth,s=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),d=t.inChannels%4,p="channelsLast"===t.dataFormat,v=p?1:2,m=p?2:3,g=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+u+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===d)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+h+") *\n                    getW(wR, wC, "+h+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+h+", xR, xC) *\n                    getW(wR, wC, "+h+", d2);\n              }\n\n            } else if ("+(2===d)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===d)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2),\n                getW(wR, wC, "+h+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1),\n                  getX(batch, xR, xC, "+h+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC),\n                  getX(batch, "+h+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+b+"\n        setOutput(result);\n      }\n    "},po=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,f=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+u+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+s+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vo=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,a=t.padInfo.top,u=t.padInfo.left,s=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,f=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=t.outChannels/t.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+s+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+u+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+h+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},mo=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var i=t.inHeight,o=t.inWidth,a=t.padInfo.top,u=t.padInfo.left,s=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,f=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=d,v="int xR; int xC; int xCOffset;",m=0;m<h;m++)for(var g=0;g<d;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<h;m++)for(var y=0;y<p;y++){if(v+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===c){if(g<d&&(v+=u%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+m+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<d)){var b=u%2==0?k(f):f;f%2==0&&u%2==1||f%2!=0&&u%2!=1?(v+="\n                  xCOffset = xC + "+u%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<d&&(v+="\n              if(xR >= 0 && xR < "+i+") {\n            ",u%2==1?(v+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<d&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<d&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<d&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<d&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<h;m++)for(g=0;g<d;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var w="",x="";n&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",x="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+s+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+u+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+E+"\n        "+x+"\n        setOutput(result);\n      }\n    "},go=function(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=t[0],a=t[1],u=t[2],s=t[3],c=e[0],l=n[0],f=n[1];this.outputShape=[c,l,f,s];var h="bilinear"===r?1:0,d=[a-1+".0",u-1+".0"],p=d[0],v=d[1],m=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],y=m[1],b=m[2],w=f>1?[""+(u-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],x=w[0],k=w[1],E=w[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+x+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+k+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+E+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+h+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},yo=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=t[t.length-1],o=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ji(r)+" coords = getOutputCoords();\n        int end = "+bo(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+bo(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===r)return""+e;if(2===r)return e+".x, "+e+".y";if(3===r)return e+".x, "+e+".y, "+e+".z";if(4===r)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}(0,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function bo(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var wo=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ut.DENSE;var e=Yt(t),n=Ti();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Oi(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},xo=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ut.DENSE;var e=Yt(t),n=Ti();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Oi(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},ko=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Eo=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Co=function(t){this.variableNames=["A"],this.outTexUsage=zt.DOWNLOAD;var e=Ti();this.outputShape=t,this.userCode="\n      "+Ri+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},_o=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=zt.DOWNLOAD;var e=Ti();this.outputShape=t,this.userCode="\n      "+Ri+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},So=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Ti(),i=e[0],o=e[1];this.outputShape=t;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+Ii(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},To=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ti(),i=e[0],o=e[1];this.outputShape=t;var a="",u="result";n&&(u="floor(result * 255. + 0.5)");for(var s=0;s<=1;s++)for(var c=0;c<=1;c++){var l=2*s+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+s+" < "+t[1]+") {\n              localCoords[1] += "+s+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Ii(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+u+";\n      }\n    "},Oo=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+o+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Io=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),Ro=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var i=ji(this.rank),o=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<t.length;o++)o===e?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}(t,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},Ao=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=ji(e.length),i=ji(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+o+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Do(t,e){var n=Ti();return ie(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function No(t,e){return he(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Po(t,e){return de(t,e,new Uint16Array([0,1,2,2,1,3]))}function Mo(t,e,n,r,i,o,a){ve(n,r);var u=pe(t,e),s=t.TEXTURE_2D;return Jt(t,e,function(){return t.bindTexture(s,u)}),Jt(t,e,function(){return t.texParameteri(s,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Jt(t,e,function(){return t.texParameteri(s,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Jt(t,e,function(){return t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Jt(t,e,function(){return t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Jt(t,e,function(){return t.texImage2D(s,0,i,n,r,0,o,a,null)}),Jt(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),u}function Fo(t,e,n,r,i){var o=Xt(n,r);return Mo(t,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,t.FLOAT)}function Lo(t,e,n,r,i){var o=Xt(n,r);return Mo(t,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function jo(t,e,n,r,i){var o=Xt(n,r);return Mo(t,e,o[0],o[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Bo(t,e,n,r,i){var o=Qt(n,r);return Mo(t,e,o[0],o[1],i.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Vo(t,e,n,r,i){var o=Qt(n,r);return Mo(t,e,o[0],o[1],i.internalFormatPackedHalfFloat,t.RGBA,i.textureTypeHalfFloat)}function Uo(t,e,n,r){return Jt(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),ge(t,e,n,"clipSpacePos",r,3,20,0)&&ge(t,e,n,"uv",r,2,20,12)}function zo(t,e,n,r,i,o,a){var u,s,c;Jt(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),o instanceof Uint8Array?(u=new Uint8Array(r*i*4),s=t.UNSIGNED_BYTE,c=t.RGBA):(u=new Float32Array(r*i*4),s=t.FLOAT,c=a.internalFormatPackedFloat),u.set(o),Jt(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,i,0,t.RGBA,s,u)}),Jt(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Wo(t,e,n,r){Jt(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Jt(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):Jt(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),Jt(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Go(t,e,n,r,i){var o=t.createBuffer();Jt(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,o)});var a=16*n*r;return Jt(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),Jt(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),Jt(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),o}function Ho(t,e,n){var r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function qo(t,e,n,r,i){var o=Xt(n,r),a=o[0],u=o[1],s=new Uint8Array(n*r*4);return Jt(t,e,function(){return t.readPixels(0,0,a,u,i.downloadTextureFormat,t.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)}function Ko(t,e,n,r,i,o,a,u){var s=t,c=new Float32Array(function(t,e){var n=Qt(o,a);return n[0]*n[1]*4}());return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,c),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),c}function Xo(t,e,n,r){var i=new Float32Array(n*r*4);return Jt(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,i)}),i}var Yo=Object.freeze({createVertexShader:Do,createVertexBuffer:No,createIndexBuffer:Po,createFloat32MatrixTexture:Fo,createFloat16MatrixTexture:Lo,createUnsignedBytesMatrixTexture:jo,createPackedMatrixTexture:Bo,createFloat16PackedMatrixTexture:Vo,bindVertexProgramAttributeStreams:Uo,uploadDenseMatrixToTexture:zo,uploadPixelDataToTexture:Wo,createBufferFromOutputTexture:Go,downloadFloat32MatrixFromBuffer:Ho,downloadByteEncodedFloatMatrixFromOutputTexture:qo,downloadPackedMatrixFromBuffer:Ko,downloadMatrixFromPackedOutputTexture:Xo}),Qo=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=f().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,qt(e,t)):this.gl=Kt(e);var n="WEBGL_color_buffer_float";if(1===f().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=re(this.gl,this.debug,"OES_texture_float"),Le(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=re(this.gl,this.debug,"OES_texture_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Le(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=re(this.gl,this.debug,"EXT_color_buffer_half_float");else if(f().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Le(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Le(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=No(this.gl,this.debug),this.indexBuffer=Po(this.gl,this.debug),this.framebuffer=me(this.gl,this.debug),this.textureConfig=$t(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return f().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Jt(e,this.debug,function(){return e.finish()}),Jt(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Jt(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Jt(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Jt(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Jt(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),Fo(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),Lo(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),jo(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Wo(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),zo(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Vo(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Bo(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(Ee(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Jt(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return qo(r.gl,r.debug,e,n,r.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,i,o){return Ko(this.gl,t,0,0,0,i,o,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return Ho(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=Go(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(f().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=i.clientWaitSync(o,0,0);return t===i.ALREADY_SIGNALED||t===i.CONDITION_SATISFIED},e=o}else f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Xo(r.gl,r.debug,e,n)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=oe(e,this.debug,t),r=Do(e,this.debug),i=ce(e,this.debug);return Jt(e,this.debug,function(){return e.attachShader(i,r)}),Jt(e,this.debug,function(){return e.attachShader(i,n)}),le(e,this.debug,i),this.debug&&fe(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Uo(e,this.debug,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Jt(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&fe(this.gl,this.debug,this.program),Jt(this.gl,this.debug,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?be(this.gl,this.debug,t,e):we(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Jt(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),xe(this.gl,this.debug,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=Qt(e,n),i=r[0],o=r[1];this.setOutputMatrixTextureDriver(t,i,o)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&fe(this.gl,this.debug,this.program),Ce(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Jt(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Jt(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=re(this.gl,this.debug,2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2!==f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return s(this,void 0,void 0,function(){var e=this;return c(this,function(n){switch(n.label){case 0:return[4,P(function(){return e.disposed||e.isQueryAvailable(t,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||P(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),ke(this.gl,this.debug,t,this.framebuffer),this.debug&&Ce(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(ke(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ce(this.gl)):Ee(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;ke(r,this.debug,t,this.framebuffer),this.debug&&Ce(r),this.outputTexture=t,Jt(r,this.debug,function(){return r.viewport(0,0,e,n)}),Jt(r,this.debug,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var i=this;this.throwIfDisposed(),Jt(this.gl,this.debug,function(){return i.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function $o(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,i=e[n],o=i.shape;if(!I(r,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+o+" must match");if(!t.isUniform||!i.isUniform){var a=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!I(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var Jo=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,i=n.inChannels,o=n.strideWidth,a=n.strideHeight,u=n.padInfo,s=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,f=n.dataFormat,h=u.left,d=u.top,p=i*r,v=Ti(),m="channelsLast"===f,g=m?0:1,y=m?1:2,b="",w=0;w<=1;w++)for(var x=0;x<=1;x++)b+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+w+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+s+")) * "+a+" - "+d+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+e[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+s+".) * "+o+". - "+h+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+i+".));\n\n              if(d1 < "+e[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+v.output+" = result;\n      }\n    "},Zo=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,u=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";o=.5===i?"inversesqrt("+s+")":1===i?"1.0/("+s+")":"exp(log("+s+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+u+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+o+";\n        setOutput(val);\n      }\n    "},ta=function(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},ea=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,u=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";o=.5===i?"inversesqrt("+s+")":1===i?"1.0/("+s+")":"exp(log("+s+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+u+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+o+";\n        setOutput(result);\n      }\n    "},na=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=i-1-t.padInfo.top,u=o-1-t.padInfo.left,s=i*o-1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+u+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+s+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ra=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterDepth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.front,f=s-1-t.padInfo.top,h=c-1-t.padInfo.left,d=u*s*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+f+", "+h+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+u+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+e+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+s+";\n              wR += "+o+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+a+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+d+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+s+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ia=function(t,e,n,r,i,o,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var u=n?t[1]:t[2],s=Math.ceil(u/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";o&&(d=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",p="result = activation(result);");var v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+d+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+h[0]+");\n          result += ("+f[1]+" * "+h[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},oa=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),aa=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},ua=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Si("rc",e),r=ji(e),i=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",i=t-2;i<t;i++)r+=n[i]+" >= "+e[i],i<t-1&&(r+="||");return r}(e,t,n),o=function(t,e,n,r){if(1===t)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var o=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),a=2;a<t;a++)o=e[e.length-1-a]+","+o;n.push(o)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},sa=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,i=ji(r),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+u+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},ca=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});for(var r=t.length,i=ji(r),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),u=Si("rc",r),s=Si("source",r),c=u[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+s.slice(-2).join()+")",f=[i+" rc = outputLoc;",u[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+u[r-2]+" += 1;\n       if("+u[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+u[r-1]+" += 1;\n         if("+c+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=1===r?2:4;p<v;p++)d+="\n        "+f[p]+"\n        if ("+h+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+s.join()+"), "+l+");\n        }\n      ";d+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+d+"\n        setOutput(result);\n      }\n    "},la=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,u=t.dilationWidth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var h="avg"===e,d="0.0";if(h||(d="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+l+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+s+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+u+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+u+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+u+", d),\n              getValue(batch, xR, xC + 2 * "+u+", d),\n              getValue(batch, xR, xC + 3 * "+u+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+u+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+u+", d),\n              getValue(batch, xR, xC + 2 * "+u+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},fa=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===e,g="0.0";if(m||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+o+", "+a+");\n        const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+u+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+f+";\n                wR += "+s+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+h+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+f+" * "+h+" +\n                      wR * "+h+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var b=4*Math.floor(r/4),w=r%4,x="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+u+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+";\n            wR += "+s+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},ha=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",u="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",u="min"):"max"===e&&(a="-1.0 / 1e-20",u="max");var s=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?s="sumValue":"prod"===e?s="prodValue":"all"===e?s="allValue":"any"===e&&(s="anyValue");var c=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+u+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===e?(a="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(a="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var d="";i%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+s+");\n      }\n    "},da=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Oi(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Ii(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},pa=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,u=a[1],s=a[2],c=[n&&u>1?i-1:i,n&&s>1?o-1:o],l=[n&&u>1?u-1:u,n&&s>1?s-1:s],f=c[0]/l[0],h=c[1]/l[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+u+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},va=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],u=t[3];this.outputShape=[i,e,n,u];var s=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+s[0]/c[0]+",\n          "+s[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},ma=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[0],o=t[1],a=t[2],u=t[3];this.outputShape=[i,e,n,u];var s=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/c[0]+",\n          "+s[1]/c[1]+",\n          "+s[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(u-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},ga=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,u=a[1],s=a[2],c=[n&&u>1?i-1:i,n&&s>1?o-1:o],l=[n&&u>1?u-1:u,n&&s>1?s-1:s],f=c[0]/l[0],h=c[1]/l[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+u+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ya=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],u=t[3];this.outputShape=[i,e,n,u];var s=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+s[0]/c[0]+",\n          "+s[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},ba=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),i=ji(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},wa=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=Si("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],o=r[n-2]+" + 1 < "+this.outputShape[n-2],a=ji(n);function u(n){var r=t.map(function(r,i){return function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+u(r.slice())+";\n          if("+i+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",u(t)}(r.slice())+";\n          }\n          if("+o+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",u(t)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",u(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},xa=function(t,e,n,r,i,o,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=ji(i.length),s=ji(o.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var h="getUpdates("+f+")",d=e>1?"strides[j]":"strides";this.userCode="\n        "+u+" strides = "+u+"("+i+");\n\n        void main() {\n          "+s+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+d+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+h+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},ka=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var u=4*Math.floor(n/4),s=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1===s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},Ea=function(t,e,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],u=[],s=0;s<e.length;s++)u.push(""+o[s]),s<t&&a.push(""+o[s]);r=a.join(),i=u.join()}var c=ji(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},Ca=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=ji(this.rank),r="uniform int start["+this.rank+"];",i=function(t){if(1===t)return"sourceLoc";if(t<=6)return _a.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map(function(t,e){return"sourceLoc."+_a[e]+" = start["+e+"] + coords."+_a[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+i+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),_a=["x","y","z","w","u","v"],Sa=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=ji(this.rank),n=Si("coords",this.rank),r=Si("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",o="getChannel(getSource("+r.join()+"), "+i+")",a="\n      result.x = "+o+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+o+";\n        --"+r[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+o+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+o+";\n        }\n      }\n    ",s=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(t,e){return"start["+e+"]"}).join()+");":t.map(function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+s+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),Ta=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=ji(n.length),o=ji(n.length),a="";if(1===r)a="coords * strides + begin";else{var u=0;a=n.map(function(t,e){return u++,1===n.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(u-1)+"] * strides["+e+"] + begin["+e+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+t+");\n      "+i+" strides = "+i+"("+e+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},Oa=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,i=Ia(e,n),o=Ra(t,i,n);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[o].shift();return this.usedTextures[o].push(a),a}return this.numUsedTextures++,this.log(),i===Wt.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Wt.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Wt.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Wt.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Wt.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var i=Ra(e,Ia(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],a=o.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Ia(t,e){if(t===zt.UPLOAD)return Wt.PACKED_2X2_FLOAT32;if(t===zt.RENDER||null==t)return function(t){return f().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Wt.PACKED_2X2_FLOAT32:Wt.UNPACKED_FLOAT32:t?Wt.PACKED_2X2_FLOAT16:Wt.UNPACKED_FLOAT16}(e);if(t===zt.DOWNLOAD||t===zt.PIXELS)return Wt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function Ra(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var Aa=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var i=ji(this.rank),o=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<t.length;i++)r.push("imod("+n[i]+", "+t[i]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},Da=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var i=ji(this.rank),o=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}(e);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},Na=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=ji(this.rank),o=_i("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var u="vec2("+a.slice(-2).join()+")",s="++"+o[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+a.join()+"), "+u+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+s+") {\n        result[1] = "+c+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+s+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Pa=1.7580993408473768,Ma=1.0507009873554805,Fa=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},La="if (isnan(x)) return x;",ja="return x;",Ba="return abs(x);",Va=La+"\n  return (x < 0.0) ? 0.0 : x;\n",Ua=La+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",za="return (x >= 0.0) ? x : (exp(x) - 1.0);",Wa="return -x;",Ga="return ceil(x);",Ha="return floor(x);",qa="return exp(x);",Ka="return exp(x) - 1.0;",Xa="return x;",Ya="return x;",Qa="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",$a="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ja="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Za=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},tu=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=Si("rc",e),r=ji(e),i=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),o=n.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},eu={};function nu(t,e){if(void 0===e&&(e=!1),"linear"===t)return e?Ya:ja;if("relu"===t)return e?Qa:Va;if("elu"===t)return e?Ja:za;if("relu6"===t)return e?$a:Ua;if("prelu"===t)return e?Ji:Qi;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var ru=600,iu=function(t){function e(e){var n,r=t.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!f().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=Kt(f().getNumber("WEBGL_VERSION"));r.binaryCache=(n=f().getNumber("WEBGL_VERSION"))in eu?eu[n]:(eu[n]={},eu[n]),r.gpgpu=new Qo(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new Oa(r.gpgpu),r.numMBBeforeWarning=null==f().global.screen?1024:f().global.screen.height*f().global.screen.width*window.devicePixelRatio*ru/1024/1024,r.texData=new Br(r,jt),r}return u(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,e,n){if(f().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:zt.UPLOAD}),r},e.prototype.move=function(t,e,n,r){if(f().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:zt.UPLOAD})},e.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,i=e.complexTensors,o=e.slice,a=e.shape,u=e.isPacked;if(null!=o){var s;s=u?new Za(a,Xa):new Fa(a,Xa);var c=this.runWebGLProgram(s,[{dataId:t,shape:a,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var f,h,d=null!=this.activeTimers;return d&&(f=rt()),h="complex64"===r?ai(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(t),d&&(this.downloadWaitMs+=rt()-f),this.convertAndCacheOnCPU(t,h)},e.prototype.read=function(t){return s(this,void 0,void 0,function(){var e,n,r,i,o,a,u,s,l,h,d,p,v,m,g,y,b,w,x,k,E,C;return c(this,function(c){switch(c.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise(function(t){return e.push(t)})];if(n=this.texData.get(t),r=n.values,i=n.shape,o=n.slice,a=n.dtype,u=n.complexTensors,s=n.isPacked,null!=o)return void 0,l=s?new Za(i,Xa):new Fa(i,Xa),h=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:a}],a),d=this.read(h.dataId),this.disposeData(h.dataId),[2,d];if(null!=r)return[2,this.convertAndCacheOnCPU(t)];if(!f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===f().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==a&&f().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),p=(C=this.gpgpu).createBufferFromTexture.apply(C,[m.texture].concat(Yt(i)))),this.pendingRead.set(t,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:c.sent(),c.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return y=c.sent(),b=y[0],w=y[1],g=ai(b,w),[3,5];case 4:null==p?g=this.getValuesFromTexture(t):(x=O(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),c.label=5;case 5:return null!=v&&this.disposeData(v.dataId),k=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(t){return t(k)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,k]}})})},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var e=0;e<t.length;e++){var n=t[e];if(!ee(n)){if(f().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},e.prototype.getValuesFromTexture=function(t){var e,n=this.texData.get(t),r=n.shape,i=n.dtype,o=n.isPacked,a=O(r);if(f().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),s=this.texData.get(u.dataId),c=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[s.texture].concat(Yt(r))).subarray(0,a);return this.disposeData(u.dataId),c}var l=f().getBool("WEBGL_PACK")&&!0===o,h=l?Re(r):r,d=l?new _o(h):new Co(h),p=this.runWebGLProgram(d,[{shape:h,dtype:i,dataId:t}],"float32"),v=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,a);return this.disposeData(p.dataId),m},e.prototype.time=function(t){return s(this,void 0,void 0,function(){var e,n,r,i,o,a,u;return c(this,function(s){switch(s.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),i=T(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),o=T(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return u=s.sent(),a.kernelMs=E(u),a.getExtraProfileInfo=function(){return u.map(function(t,e){return{name:o[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},[3,3];case 2:a.kernelMs={error:"WebGL query timers are not supported in this environment."},s.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,a]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:rt(),endMs:null}},e.prototype.endTimer=function(t){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=rt(),t)},e.prototype.getQueryTime=function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(n){return f().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,i=e.texShape,o=e.usage,a=e.isPacked,u=e.slice,s=u&&u.origDataId||t,c=this.dataRefCount.get(s);c>1?this.dataRefCount.set(s,c-1):(this.dataRefCount.delete(s),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,o,a)));var l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return f().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=jt.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,e){var n=this.makeOutput(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:jt.keep(t.clone()),imag:jt.keep(e.clone())},n},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===O(n))return pn([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,i=Pr(t.shape,e,n);if(r||!i){var o=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Sa(n):new Ca(n),a=o.getCustomSetupFunc(e);return this.compileAndRun(o,[t],null,a)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},e.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),i=this.makeOutput(n,t.dtype),o=this.texData.get(i.dataId);Object.assign(o,r),o.shape=n,o.dtype=t.dtype;var a=Mr(e,t.strides);r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};var u=this.dataRefCount.get(o.slice.origDataId)||1;return this.dataRefCount.set(o.slice.origDataId,u+1),i},e.prototype.stridedSlice=function(t,e,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r);var i=Ar(e,n,r);if(i.some(function(t){return 0===t}))return pn([],i);var o=new Ta(e,r,i);return this.compileAndRun(o,[t])},e.prototype.reverse=function(t,e){var n=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wa(t.shape,e):new ba(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var n=t.map(function(t){return hn(t)}),r=t.map(function(t){return dn(t)});return fn(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>f().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(t.length/2),o=this.concat(t.slice(0,i),e),a=this.concat(t.slice(i),e);return this.concat([o,a],e)}if(f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new io(t.map(function(t){return t.shape}),e);return this.compileAndRun(u,t)}var s=cn(t.map(function(t){return t.shape}),e),c=t.map(function(t){return t.as2D(-1,O(t.shape.slice(e)))}),l=new ro(c.map(function(t){return t.shape}));return this.compileAndRun(l,c).reshape(s)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Wa,t.dtype);var e=new Fa(t.shape,Wa);return this.compileAndRun(e,[t])},e.prototype.batchMatMul=function(t,e,n,r){var i=n?t.shape[2]:t.shape[1],o=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],u=t.shape[0];if((1===i||1===o)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var s=1===o?t:t.as3D(u,a,1),c=1===o?2:1,l=1===o?e.as3D(u,1,a):e;return this.multiply(s,l).sum(c,!0)}var f=Rt(t.dtype,e.dtype),h=new ia(t.shape,[u,i,o],n,r);return this.compileAndRun(h,[t,e],f)},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,i=t.transposeB,o=t.bias,a=t.activation,u=t.preluActivationWeights,s=r?e.shape[2]:e.shape[1],c=i?n.shape[1]:n.shape[2],l=e.shape[0],f=Rt(e.dtype,n.dtype),h=null!=o,d=null!=u,p=a?nu(a,!0):null,v=new ia(e.shape,[l,s,c],r,i,h,p,d),m=[e,n];return o&&m.push(o),u&&m.push(u),this.compileAndRun(v,m,f)},e.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),i=new qi("return areal * breal - aimag * bimag;",t.shape,e.shape),o=new qi("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag),this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],u=this.compileAndRun(i,a),s=this.compileAndRun(o,a),c=this.complex(u,s);return u.dispose(),s.dispose(),c}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Yi,t.dtype);var l=new $i(Yi,t.shape,e.shape);return this.compileAndRun(l,[t,e],t.dtype)},e.prototype.batchNormalization=function(t,e,n,r,i,o){var a=[t,e,n],u=null;null!=o&&(u=o.shape,a.push(o));var s=null;if(null!=i&&(s=i.shape,a.push(i)),f().getBool("WEBGL_PACK_NORMALIZATION")){var c=new Hi(t.shape,e.shape,n.shape,u,s,r);return this.compileAndRun(c,a)}var l=new Gi(t.shape,e.shape,n.shape,u,s,r);return this.compileAndRun(l,a)},e.prototype.localResponseNormalization4D=function(t,e,n,r,i){var o=f().getBool("WEBGL_PACK_NORMALIZATION")?new ea(t.shape,e,n,r,i):new Zo(t.shape,e,n,r,i);return this.compileAndRun(o,[t])},e.prototype.LRNGrad=function(t,e,n,r,i,o,a){var u=new ta(e.shape,r,i,o,a);return this.compileAndRun(u,[e,n,t])},e.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map(function(t){return at(t)});return bi(Hn(t.shape,t.dtype,n),e)}var r=new Aa(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,e,n){var r=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ca(t.shape,e,n):new sa(t.shape,e,n);return this.compileAndRun(r,[t])},e.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=f().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Na(t.shape,e):new Da(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new Ro(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},e.prototype.batchToSpaceND=function(t,e,n){C(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),i=yr(t.shape,e,r),o=br(i.length,e.length),a=wr(t.shape,e,r),u=xr(n,e.length),s=kr(a,n,e.length);return t.reshape(i).transpose(o).reshape(a).slice(u,s)},e.prototype.spaceToBatchND=function(t,e,n){C(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var a=t.pad(i),u=yr(a.shape,e,r,!1),s=br(u.length,e.length,!1),c=wr(a.shape,e,r,!1);return a.reshape(u).transpose(s).reshape(c)},e.prototype.reduce=function(t,e,n){var r=t.shape[0],i=t.shape[1],o=_r(i),a=new ha({windowSize:o,inSize:i,batchSize:r},e),u=this.compileAndRun(a,[t],n);return 1===u.shape[1]?u:this.reduce(u,e,n)},e.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],i=t.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o=_r(i),a=new Ci({windowSize:o,inSize:i,batchSize:r},e,null==n),u=[t];null!=n&&u.push(n);var s=this.compileAndRun(a,u,"int32");return 1===s.shape[1]?s:this.argReduce(t,e,s)},e.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,i=_r(r[r.length-1]),o=new Ui(r,i,e,null==n),a=null==n?[t]:[t,n],u=this.compileAndRun(o,a,"int32");return u.rank===t.rank?this.argReducePacked(t,e,u):u},e.prototype.sum=function(t,e){rn("sum",e,t.rank);var n=en(t.shape,e),r=n[0],i=O(n[1]),o=t.as2D(-1,i),a=At(t.dtype);return this.reduce(o,"sum",a).reshape(r)},e.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=en(t.shape,e),r=n[0],i=O(n[1]),o=t.as2D(-1,i),a=At(t.dtype);return this.reduce(o,"prod",a).reshape(r)},e.prototype.unsortedSegmentSum=function(t,e,n){var r=0,i=on([r],t.rank),o=t;null!=i&&(o=t.transpose(i),r=un(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],i=t.length,o=0;o<i;o++)o!==e?r.push(t[o]):r.push(n);return r}(o.shape,r,n),u=O([o.shape[r]]),s=o.as2D(-1,u),c=At(t.dtype),l=this.segOpCompute(s,"unsortedSegmentSum",e,c,n).reshape(a);return null!=i&&(l=l.transpose(an(i))),l},e.prototype.segOpCompute=function(t,e,n,r,i){var o=t.shape[0],a=t.shape[1],u=function(t,e){var n,r=!1;for(t<=Cr?(n=t,r=!0):n=$(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=$(t,n+1);return n}(a,i),s=new ka({windowSize:u,inSize:a,batchSize:o,numSegments:i},e),c=this.compileAndRun(s,[t,n],r);return c.shape[1]===i?c:(n=Cn(0,i).tile([a/u]),this.segOpCompute(c,e,n,r,i))},e.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(rn("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!f().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var i=en(t.shape,r),o=i[0],a=O(i[1]),u=t.as2D(-1,a);return this.argReduce(u,n).reshape(o)}return this.argReducePacked(t,n)},e.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},e.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},e.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var i=new yo(t.shape,n,r);return this.compileAndRun(i,[t])},e.prototype.equal=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new $i("return float(a == b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.notEqual=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new $i("return float(a != b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new $i("return float(a < b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.lessEqual=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new $i("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new $i("return float(a > b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greaterEqual=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new $i("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalNot=function(t){var e=new Fa(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},e.prototype.logicalAnd=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new $i("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalOr=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new $i("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.select=function(t,e,n){var r=new Ea(t.rank,e.shape,e.rank);return this.compileAndRun(r,[t,e,n],Rt(e.dtype,n.dtype))},e.prototype.where=function(t){Xe("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return xi(t.shape,e)},e.prototype.topk=function(t,e,n){return wi(t.dataSync(),t.shape,t.dtype,e)},e.prototype.min=function(t,e){rn("min",e,t.rank);var n=en(t.shape,e),r=n[0],i=O(n[1]),o=t.as2D(-1,i);return this.reduce(o,"min",o.dtype).reshape(r)},e.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new $i("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.mod=function(t,e){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new $i("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);rn("max",e,t.rank);var n=en(t.shape,e),r=n[0],i=O(n[1]),o=t.as2D(-1,i);return this.reduce(o,"max",o.dtype).reshape(r)},e.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new $i("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.all=function(t,e){rn("all",e,t.rank);var n=en(t.shape,e),r=n[0],i=O(n[1]),o=t.as2D(-1,i);return this.reduce(o,"all",o.dtype).reshape(r)},e.prototype.any=function(t,e){rn("any",e,t.rank);var n=en(t.shape,e),r=n[0],i=O(n[1]),o=t.as2D(-1,i);return this.reduce(o,"any",o.dtype).reshape(r)},e.prototype.realDivide=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new $i("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return this.compileAndRun(n,[t,e],"float32")},e.prototype.floorDiv=function(t,e){if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new $i("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(n,[t,e],"int32")},e.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Ki);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=Rt(t.dtype,e.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Ki,n);var r=new $i(Ki,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.packedUnaryOp=function(t,e,n){var r=new Za(t.shape,e);return this.compileAndRun(r,[t],n)},e.prototype.packedBinaryOp=function(t,e,n,r,i){void 0===i&&(i=!1);var o=new Zi(n,t.shape,e.shape,i);return this.compileAndRun(o,[t,e],r)},e.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,i=this.texData.get(t.dataId),o=this.texData.get(e.dataId),a=[[i.complexTensors.real,o.complexTensors.real],[i.complexTensors.imag,o.complexTensors.imag]].map(function(i){var o=i[0],a=i[1],u=r.makeComplexComponentTensorInfo(t,o),s=r.makeComplexComponentTensorInfo(e,a),c=new $i(n,t.shape,e.shape);return r.compileAndRun(c,[u,s],Rt(o.dtype,a.dtype))}),u=a[0],s=a[1],c=this.complex(u,s);return u.dispose(),s.dispose(),c},e.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>f().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var i=t.map(function(t){return t.dtype}).reduce(function(t,e){return Rt(t,e)}),o=t.map(function(t){return t.shape}),a=f().getBool("WEBGL_PACK")?new Ei(t[0].shape,o):new ki(t[0].shape,o);return this.compileAndRun(a,t,i)},e.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Xi);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=Rt(t.dtype,e.dtype);if(f().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Xi,t.dtype);var r=new $i(Xi,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.pow=function(t,e){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new $i("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=Rt(t.dtype,e.dtype);return this.compileAndRun(n,[t,e],r)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ga,t.dtype);var e=new Fa(t.shape,Ga);return this.compileAndRun(e,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ha,t.dtype);var e=new Fa(t.shape,Ha);return this.compileAndRun(e,[t])},e.prototype.sign=function(t){var e=new Fa(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},e.prototype.isNaN=function(t){var e=new Fa(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isInf=function(t){var e=new Fa(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isFinite=function(t){var e=new Fa(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.round=function(t){var e=new Fa(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,qa,t.dtype);var e=new Fa(t.shape,qa);return this.compileAndRun(e,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ka,t.dtype);var e=new Fa(t.shape,Ka);return this.compileAndRun(e,[t])},e.prototype.softmax=function(t,e){var n=F([e],t.shape),r=this.max(t,n),i=nn(r.shape,n),o=this.subtract(t,r.reshape(i)),a=this.exp(o),u=this.sum(a,n).reshape(i);return this.realDivide(a,u)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var e=new Fa(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])},e.prototype.log1p=function(t){var e=new Fa(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},e.prototype.sqrt=function(t){var e=new Fa(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new Fa(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},e.prototype.reciprocal=function(t){var e=new Fa(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},e.prototype.relu=function(t){var e;return e=f().getBool("WEBGL_PACK")?new Za(t.shape,Qa):new Fa(t.shape,Va),this.compileAndRun(e,[t])},e.prototype.relu6=function(t){var e;return e=f().getBool("WEBGL_PACK")?new Za(t.shape,$a):new Fa(t.shape,Ua),this.compileAndRun(e,[t])},e.prototype.prelu=function(t,e){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi(Ji,t.shape,e.shape):new $i(Qi,t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.elu=function(t){if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ja,t.dtype);var e=new Fa(t.shape,za);return this.compileAndRun(e,[t])},e.prototype.eluDer=function(t,e){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new $i("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.selu=function(t){var e=new Fa(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},e.prototype.int=function(t){var e=new Fa(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},e.prototype.clip=function(t,e,n){var r,i=(r=f().getBool("WEBGL_PACK_CLIP")?new eo(t.shape):new to(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,i)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(f().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ba,t.dtype);var e=new Fa(t.shape,Ba);return this.compileAndRun(e,[t])},e.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new no(t.shape),r=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(t){var e=new Fa(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},e.prototype.softplus=function(t){var e=new Fa(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},e.prototype.sin=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},e.prototype.cos=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},e.prototype.tan=function(t){var e=new Fa(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},e.prototype.asin=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(e,[t])},e.prototype.acos=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan2=function(t,e){var n=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new $i("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.sinh=function(t){var e=new Fa(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.cosh=function(t){var e=new Fa(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.tanh=function(t){var e=new Fa(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},e.prototype.asinh=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},e.prototype.acosh=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])},e.prototype.atanh=function(t){var e=new Fa(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])},e.prototype.erf=function(t){var e=new Fa(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(e,[t])},e.prototype.step=function(t,e){var n=new Fa(t.shape,function(t){return void 0===t&&(t=0),La+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},e.prototype.conv2dByMatMul=function(t,e,n,r,i,o){var a=t.shape,u=this.texData.get(t.dataId),s=n.inChannels,c=a[0]*a[1]*a[2],l=n.outChannels,h="channelsLast"===n.dataFormat,d=(1===c||1===l)&&s>1e3,p=a[2]%2!=0&&!!u.isPacked;if(d||!f().getBool("WEBGL_LAZILY_UNPACK")||!f().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var v=h?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],m=this.reshape(t,[1,v,n.inChannels]),g=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:o}),n.outShape)}var y=h?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),b={dataId:t.dataId,shape:[1,y,n.inChannels],dtype:t.dtype},w=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,C(Ne(u.shape,b.shape),function(){return"packed reshape "+u.shape+" to "+b.shape+" isn't free"});var x=this.reshape(e,[1,n.inChannels,n.outChannels]),k=this.fusedBatchMatMul({a:b,b:x,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:o}),E=this.texData.get(k.dataId);return C(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),u.shape=w,E.shape=n.outShape,jt.makeTensorFromDataId(k.dataId,n.outShape,k.dtype)},e.prototype.conv2dWithIm2Row=function(t,e,n,r,i,o){var a=n.filterWidth,u=n.filterHeight,s=n.inChannels,c=n.outWidth,l=n.outHeight,f="channelsLast"===n.dataFormat,h=a*u*s,d=l*c,p=[h,d],v=t.squeeze([0]),m=e.reshape([1,h,-1]),g=new Jo(p,v.shape,n),y=this.compileAndRun(g,[v]).reshape([1,p[0],p[1]]),b=null!=r,w=null!=o,x=i?nu(i,!0):null,k=new ia(y.shape,[1,d,n.outChannels],!0,!1,b,x,w),E=[y,m];r&&E.push(r),w&&E.push(o);var C=this.compileAndRun(k,E);return f?C.reshape([1,l,c,n.outChannels]):C.reshape([1,n.outChannels,l,c])},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,i=t.bias,o=t.activation,a=t.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,n,r,i,o,a);if(f().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,n,r,i,o,a);var u=null!=i,s=null!=a,c=o?nu(o,!1):null,l=new ho(r,u,c,s),h=[e,n];return i&&h.push(i),a&&h.push(a),this.compileAndRun(l,h)},e.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(f().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new ho(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerInput=function(t,e,n){var r=new uo(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerFilter=function(t,e,n){var r=new ao(n);return this.compileAndRun(r,[t,e])},e.prototype.fusedDepthwiseConv2D=function(t){var e,n=t.input,r=t.filter,i=t.convInfo,o=t.bias,a=t.activation,u=t.preluActivationWeights,s=f().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,c=a?nu(a,s):null,l=[n,r],h=null!=o,d=null!=u;return h&&l.push(o),d&&l.push(u),s?(e=new mo(i,h,c,d),this.compileAndRun(e,l)):(e=new vo(i,h,c,d),this.compileAndRun(e,l))},e.prototype.depthwiseConv2D=function(t,e,n){var r;return f().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new mo(n),this.compileAndRun(r,[t,e])):(r=new vo(n),this.compileAndRun(r,[t,e]))},e.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new fo(n);return this.compileAndRun(r,[t,e])},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new lo(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3d=function(t,e,n){var r=new po(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerInput=function(t,e,n){var r=new co(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerFilter=function(t,e,n){var r=new so(n);return this.compileAndRun(r,[t,e])},e.prototype.maxPool=function(t,e){var n=new la(e,"max",!1);return this.compileAndRun(n,[t])},e.prototype.avgPool=function(t,e){var n=new la(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPoolBackprop=function(t,e,n,r){var i=new la(r,"max",!0),o=this.compileAndRun(i,[e]),a=new na(r),u=this.compileAndRun(a,[t,o],e.dtype);return o.dispose(),u},e.prototype.avgPoolBackprop=function(t,e,n){var r=new zi(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.cast=function(t,e){return ri(t,e,this)},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),i=0,o=0;o<t.rank;o++)o!==e&&(r[i++]=t.shape[o]);var a=new Array(t.rank).fill(0),u=t.shape.slice();u[e]=1;var s=new Array(n);for(o=0;o<s.length;o++)a[e]=o,s[o]=this.slice(t,a,u).reshape(r);return s},e.prototype.avgPool3d=function(t,e){var n=new fa(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,e,n){var r=new Wi(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.maxPool3d=function(t,e){var n=new fa(e,"max",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,e,n,r){var i=new fa(r,"max",!0),o=this.compileAndRun(i,[e]),a=new ra(r),u=this.compileAndRun(a,[t,o],e.dtype);return o.dispose(),u},e.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);if(n.isPacked&&!Ne(t.shape,e)&&(null===n.texture||!Ne(n.shape,e))){var r=this.packedReshape(t,e);return jt.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return ii(t,e)},e.prototype.resizeBilinear=function(t,e,n,r){var i=f().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ma(t.shape,e,n,r):new va(t.shape,e,n,r);return this.compileAndRun(i,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,e,n){var r=new pa(t,e,n);return this.compileAndRun(r,[t])},e.prototype.resizeNearestNeighbor=function(t,e,n,r){var i=new ya(t.shape,e,n,r);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new ga(t,e,n);return this.compileAndRun(r,[t])},e.prototype.multinomial=function(t,e,n,r){var i=e?t:Lr(t),o=i.shape[0],a=i.shape[1],u=new oa(o,a,n),s=u.getCustomSetupFunc(r);return this.compileAndRun(u,[i],"int32",s)},e.prototype.oneHot=function(t,e,n,r){var i=new aa(t.size,e,n,r);return this.compileAndRun(i,[t])},e.prototype.diag=function(t){var e=new Eo(t.size);return this.compileAndRun(e,[t])},e.prototype.nonMaxSuppression=function(t,e,n,r,i){return Xe("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),hi(t.dataSync(),e.dataSync(),n,r,i)},e.prototype.cropAndResize=function(t,e,n,r,i,o){var a=new go(t.shape,e.shape,r,i,o);return this.compileAndRun(a,[t,e,n],"float32")},e.prototype.depthToSpace=function(t,e,n){C(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var r=t.shape[0],i="NHWC"===n?t.shape[1]:t.shape[2],o="NHWC"===n?t.shape[2]:t.shape[3],a="NHWC"===n?t.shape[3]:t.shape[1],u=i*e,s=o*e,c=a/(e*e),l=new ko("NHWC"===n?[r,u,s,c]:[r,c,u,s],e,n);return this.compileAndRun(l,[t])},e.prototype.split=function(t,e,n){return yi(t,e,n)},e.prototype.scatterND=function(t,e,n){var r=Or(0,t,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,u=r.strides,s=r.outputSize,c=[s/a,a],l=t.reshape([o,i]),f=e.reshape([o,a]);if(0===s)return ii(pn([]),n);var h=mn(0),d=new xa(o,i,l.rank,f.rank,u,c);return this.compileAndRun(d,[f,l,h]).reshape(n)},e.prototype.sparseToDense=function(t,e,n,r){var i=Or(0,t,n),o=i.sliceRank,a=i.numUpdates,u=i.strides,s=i.outputSize,c=new xa(a,o,t.rank,e.rank,u,[s,1],!1);return this.compileAndRun(c,[e,t,r]).reshape(n)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new Oo("return real * expR - imag * expI;",t.shape,e),i=new Oo("return real * expI + imag * expR;",t.shape,e),o=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],a=this.compileAndRun(r,o),u=this.compileAndRun(i,o),s=this.complex(a,u).as2D(t.shape[0],t.shape[1]);return a.dispose(),u.dispose(),s},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],i=Er(t,e),o=i[0],a=i[1],u=i[2],s=i[3],c=e.reshape([a,r]),l=t.reshape([t.size/u,u]),f=new Ao(r,s,[a,u]);return this.compileAndRun(f,[l,c]).reshape(o)},e.prototype.fill=function(t,e,n){if("string"===(n=n||Y(e))){var r=B(n,O(t));return r.fill(e),jt.makeTensor(r,t,n,this)}var i=new Io(t,e),o=i.getCustomSetupFunc(e);return this.compileAndRun(i,[],n,o)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,e,n){return oi(t,e,n)},e.prototype.makeTensorInfo=function(t,e){var n=this.write(null,t,e);return this.texData.get(n).usage=null,{dataId:n,shape:t,dtype:e}},e.prototype.makeOutput=function(t,e){var n=this.makeTensorInfo(t,e).dataId;return jt.makeTensorFromDataId(n,t,e,this)},e.prototype.unpackTensor=function(t){var e=new tu(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},e.prototype.packTensor=function(t){var e=new ua(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,e){var n=[Oe(t.shape)].concat(Ie(t.shape)),r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[Oe(e)].concat(Ie(e)),o=new da(i,n),a=this.runWebGLProgram(o,[r],t.dtype,null,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}},e.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,i=n.shape,o=n.dtype,a=Re(i);return e=r?new xo(a):new wo(a),{dtype:o,shape:i,dataId:this.runWebGLProgram(e,[{shape:a,dtype:o,dataId:t}],o,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,e,n,r,i){var o=this;void 0===i&&(i=!1);var a=this.makeTensorInfo(t.outputShape,n),u=this.texData.get(a.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Ut.DENSE){var s=Yt(t.outputShape);u.texShape=s.map(function(t){return 2*t})}if(null!=t.outTexUsage&&(u.usage=t.outTexUsage),0===O(a.shape))return u.values=j(a.dtype,0),a;var c=[],l=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=o.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&O(e.shape)<=f().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?o.unpackTensor(e):o.packTensor(e),c.push(e),n=o.texData.get(e.dataId);else if(n.isPacked&&!Ne(n.shape,e.shape)){var r=e,i=e.shape;e.shape=n.shape,e=o.packedReshape(e,i),c.push(e),n=o.texData.get(e.dataId),r.shape=i}return o.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(a.dataId);var h,d={shape:a.shape,texData:u,isUniform:!1},p=function(t,e,n){var r="";l.concat(n).forEach(function(t){var e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,n=t.isUniform?"uniform":t.texData.texShape;r+=t.shape+"_"+n+"_"+e});var i=t.userCode;return t.constructor.name+"_"+r+"_"+i}(t,0,d),v=this.getAndSaveBinary(p,function(){return function(t,e,n,r){var i=e.userCode,o=n.map(function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}}),a=o.map(function(t){return t.shapeInfo}),u={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=Ai(o,u,i,e.packedInputs),c=t.createProgram(s),l=null,h=t.getUniformLocation(c,"NAN",!1);1===f().getNumber("WEBGL_VERSION")&&(l=t.getUniformLocation(c,"INFINITY",!1));for(var d={},p=0;p<e.variableNames.length;p++){var v=e.variableNames[p];d[v]=t.getUniformLocation(c,v,!1),d["offset"+v]=t.getUniformLocation(c,"offset"+v,!1)}return{program:e,source:s,webGLProgram:c,uniformLocations:d,inShapeInfos:a,outShapeInfo:u,infLoc:l,nanLoc:h}}(o.gpgpu,t,l,d)}),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(t,e,n,r,i){$o(e.inShapeInfos,n),$o([e.outShapeInfo],[r]);var o=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(o,a[0],a[1]):t.setOutputMatrixTexture(o,a[0],a[1]),t.setProgram(e.webGLProgram),1===f().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(function(n,r){var i=e.program.variableNames[r],o=e.uniformLocations[i],a=e.uniformLocations["offset"+i];if(null!=o)if(n.isUniform)if(O(n.shape)<2)t.gl.uniform1f(o,n.uniformValues[0]);else{var u=n.uniformValues;u instanceof Float32Array||(u=new Float32Array(u)),t.gl.uniform1fv(o,u)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,o,r)}),null!=i&&i(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,v,l,d,r),c.forEach(function(t){return o.disposeData(t.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(h)})),!f().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var g=this.unpackTensor(a);return this.disposeData(a.dataId),g}return a},e.prototype.compileAndRun=function(t,e,n,r,i){void 0===i&&(i=!1),n=n||e[0].dtype;var o=this.runWebGLProgram(t,e,n,r,i);return jt.makeTensorFromDataId(o.dataId,o.shape,o.dtype)},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(f().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=qe(function(){if(!f().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=f().getBool("DEBUG");f().set("DEBUG",!1);var n=t.abs(mn(1e-8)).dataSync()[0];if(f().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,i=n.dtype,o=n.values,a=n.texture,u=n.usage,s=n.isPacked;if(null==a){var c,l=null!=this.activeTimers;l&&(c=rt());var f=n.texShape;if(null==f&&(f=Ae(r,s),n.texShape=f),null!=o){var h=Re(r),d=void 0,p=f[1],v=f[0],m=o instanceof Uint8Array;s?(p=(e=Qt(f[0],f[1]))[0],v=e[1],d=new To(h,[v,p],m)):d=new So(h,[v,p],m);var g=this.makeTensorInfo([v,p],i);this.texData.get(g.dataId).usage=m?zt.PIXELS:zt.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,v,o);var y=this.runWebGLProgram(d,[g],i,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=rt()-c)}else{var w=this.acquireTexture(f,u,i,s);n.texture=w}}},e.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},e.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,r)},e.prototype.computeBytes=function(t,e){return t[0]*t[1]*G(e)},e}(Vr);Bt()&&jt.registerBackend("webgl",function(){return new iu},2);var ou=ln({square_:function(t){var e=$e(t,"x","square"),n=[e];return jt.runKernelFunc(function(t,n){return n([e]),t.square(e)},{x:e},null,"Square",{},n,[])}}),au="SquaredDifference",uu=ln({squaredDifference_:function(t,e){var n,r=$e(t,"a","squaredDifference"),i=$e(e,"b","squaredDifference");n=Dt(r,i),r=n[0],i=n[1],Gr(r.shape,i.shape);var o={a:r,b:i},a=[r,i];return jt.runKernelFunc(function(t,e){var n=t.squaredDifference(r,i);return e([r,i]),n},o,function(t,e){var n=e[0],r=e[1],i=mn(2);return{a:function(){return t.mul(n.sub(r).mul(i))},b:function(){return t.mul(r.sub(n).mul(i))}}},au,{},a,[])}}),su=ln({abs_:function(t){var e=$e(t,"x","abs");return"complex64"===e.dtype?jt.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):jt.runKernelFunc(function(t,n){var r=t.abs(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().step(-1))}}},"Abs")}}),cu=ln({acos_:function(t){var e=$e(t,"x","acos");return jt.runKernelFunc(function(t,n){var r=t.acos(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(mn(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),lu=ln({acosh_:function(t){var e=$e(t,"x","acosh");return jt.runKernelFunc(function(t,n){var r=t.acosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),fu=ln({asin_:function(t){var e=$e(t,"x","asin");return jt.runKernelFunc(function(t,n){var r=t.asin(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(mn(1).sub(n.toFloat().square()).sqrt())}}})}}),hu=ln({asinh_:function(t){var e=$e(t,"x","asinh");return jt.runKernelFunc(function(t,n){var r=t.asinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(mn(1).add(n.toFloat().square()).sqrt())}}})}}),du=ln({atan_:function(t){var e=$e(t,"x","atan");return jt.runKernelFunc(function(t,n){var r=t.atan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}})}}),pu=ln({atanh_:function(t){var e=$e(t,"x","atanh");return jt.runKernelFunc(function(t,n){var r=t.atanh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(mn(1).sub(n.toFloat().square()))}}})}}),vu=ln({ceil_:function(t){var e=$e(t,"x","ceil");return jt.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Sn(t)}}})}}),mu=ln({clipByValue_:function(t,e,n){var r=$e(t,"x","clipByValue");C(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."});var i=[r],o={min:e,max:n};return jt.runKernelFunc(function(t,i){var o=t.clip(r,e,n);return i([r]),o},{x:r},function(t,r){var i=r[0];return{x:function(){return t.where(i.greaterEqual(e).logicalAnd(i.lessEqual(n)),Sn(t))}}},"ClipByValue",o,i)}}),gu=ln({cos_:function(t){var e=$e(t,"x","cos"),n=[e];return jt.runKernelFunc(function(t,n){var r=t.cos(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return n.toFloat().sin().neg().mul(t)}}},"Cos",{},n)}}),yu=ln({cosh_:function(t){var e=$e(t,"x","cosh");return jt.runKernelFunc(function(t,n){var r=t.cosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}})}}),bu=ln({erf_:function(t){var e=$e(t,"x","erf");return C("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),jt.runKernelFunc(function(t,n){var r=t.erf(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),wu=ln({exp_:function(t){var e=$e(t,"x","exp");return jt.runKernelFunc(function(t,n){var r=t.exp(e);return n([r]),r},{x:e},function(t,e){return{x:function(){return t.mulStrict(e[0])}}},"Exp",{},[],[!0])}}),xu=ln({expm1_:function(t){var e=$e(t,"x","expm1");return jt.runKernelFunc(function(t,n){var r=t.expm1(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}})}}),ku=ln({floor_:function(t){var e=$e(t,"x","floor");return jt.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Sn(t)}}})}}),Eu=ln({log_:function(t){var e=$e(t,"x","log"),n=[e];return jt.runKernelFunc(function(t,n){var r=t.log(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.div(n.toFloat())}}},"Log",{},n)}}),Cu=ln({log1p_:function(t){var e=$e(t,"x","log1p");return jt.runKernelFunc(function(t,n){var r=t.log1p(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}})}}),_u=ln({logSigmoid_:function(t){var e=$e(t,"x","logSigmoid");return jt.runKernelFunc(function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}})}}),Su=ln({neg_:function(t){var e=$e(t,"x","neg"),n=[e];return jt.runKernelFunc(function(t){return t.neg(e)},{x:e},function(t){return{x:function(){return t.neg()}}},"Neg",{},n)}}),Tu=ln({reciprocal_:function(t){var e=$e(t,"x","reciprocal");return jt.runKernelFunc(function(t,n){var r=t.reciprocal(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}})}}),Ou=ln({round_:function(t){var e=$e(t,"x","round");return jt.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Sn(t)}}})}}),Iu=ln({rsqrt_:function(t){var e=$e(t,"x","rsqrt"),n=[e];return jt.runKernelFunc(function(t,n){var r=t.rsqrt(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Ru=ln({sigmoid_:function(t){var e=$e(t,"x","sigmoid");return jt.runKernelFunc(function(t,n){var r=t.sigmoid(e);return n([r]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mul(n.mul(mn(1).sub(n)))}}},"Sigmoid")}}),Au=ln({sign_:function(t){var e=$e(t,"x","sign");return jt.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Sn(t)}}})}}),Du=ln({isNaN_:function(t){var e=$e(t,"x","isNaN");return jt.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Sn(t)}}})}}),Nu=ln({isInf_:function(t){var e=$e(t,"x","isInf");return jt.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Sn(t)}}})}}),Pu=ln({isFinite_:function(t){var e=$e(t,"x","isFinite");return jt.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Sn(t)}}})}}),Mu=ln({sin_:function(t){var e=$e(t,"x","sin"),n=[e];return jt.runKernelFunc(function(t,n){var r=t.sin(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return n.toFloat().cos().mul(t)}}},"Sin",{},n)}}),Fu=ln({sinh_:function(t){var e=$e(t,"x","sinh");return jt.runKernelFunc(function(t,n){var r=t.sinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}})}}),Lu=ln({softplus_:function(t){var e=$e(t,"x","softplus");return jt.runKernelFunc(function(t,n){var r=t.softplus(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}})}}),ju=ln({sqrt_:function(t){var e=$e(t,"x","sqrt");return jt.runKernelFunc(function(t,n){var r=t.sqrt(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}})}}),Bu=ln({step_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","step");return jt.runKernelFunc(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return Sn(t)}}})}}),Vu=ln({tan_:function(t){var e=$e(t,"x","tan");return jt.runKernelFunc(function(t,n){var r=t.tan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}})}}),Uu=ln({tanh_:function(t){var e=$e(t,"x","tanh");return jt.runKernelFunc(function(t,n){var r=t.tanh(e);return n([r]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return mn(1).sub(n.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function zu(t,e,n,r,i,o){var a,u,s=$e(t,"x","batchNorm"),c=$e(e,"mean","batchNorm"),l=$e(n,"variance","batchNorm");return null!=i&&(a=$e(i,"scale","batchNorm")),null!=r&&(u=$e(r,"offset","batchNorm")),C(2===s.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+s.rank+"."}),C(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),C(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&C(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=u&&C(2===u.rank||1===u.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."}),Hu(s,c,l,u,a,o)}function Wu(t,e,n,r,i,o){var a,u,s=$e(t,"x","batchNorm"),c=$e(e,"mean","batchNorm"),l=$e(n,"variance","batchNorm");return null!=i&&(a=$e(i,"scale","batchNorm")),null!=r&&(u=$e(r,"offset","batchNorm")),C(3===s.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+s.rank+"."}),C(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),C(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&C(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=u&&C(3===u.rank||1===u.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."}),Hu(s,c,l,u,a,o)}function Gu(t,e,n,r,i,o){var a,u,s=$e(t,"x","batchNorm"),c=$e(e,"mean","batchNorm"),l=$e(n,"variance","batchNorm");return null!=i&&(a=$e(i,"scale","batchNorm")),null!=r&&(u=$e(r,"offset","batchNorm")),C(4===s.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+s.rank+"."}),C(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),C(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&C(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=u&&C(4===u.rank||1===u.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."}),Hu(s,c,l,u,a,o)}function Hu(t,e,n,r,i,o){null==o&&(o=.001);var a,u,s,c=$e(t,"x","batchNorm"),l=$e(e,"mean","batchNorm"),f=$e(n,"variance","batchNorm");null!=i&&(a=$e(i,"scale","batchNorm")),null!=r&&(u=$e(r,"offset","batchNorm")),C(l.rank===f.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),C(null==u||l.rank===u.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),C(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),s=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var h=[c,l,f,a];return jt.runKernelFunc(function(t,e){var n=t.batchNormalization(s,qu(l),qu(f),o,qu(a),qu(u));return e([c,l,f,a]),n},{x:c,mean:l,variance:f,scale:a,offset:u},function(t,e){var n=e,r=n[0],i=n[1],a=n[2],u=n[3],c=null==u?mn(1):u,l=Wr(i.shape,s.shape),f=[];if(1===i.rank){for(var h=0;h<s.shape.length-1;++h)f.push(s.shape[h]);f.push(1)}var d=r.sub(i),p=t.mul(c),v=Iu(a.add(mn(o))),m=v.mul(v).mul(v).mul(mn(-.5));return{x:function(){return 1===i.rank?t.mul(vr(v.as4D(1,1,1,i.shape[0]),f)).mul(c).reshape(r.shape):t.mul(v).mul(c).reshape(r.shape)},mean:function(){var t=v.mul(mn(-1)).mul(p);return 1===i.rank&&(t=t.sum(l)),t.reshape(i.shape)},variance:function(){var t=m.mul(d).mul(p);return 1===i.rank&&(t=t.sum(l)),t.reshape(i.shape)},scale:function(){var e=d.mul(v),n=t.mul(e);return 1===i.rank&&(n=n.sum(l)),n.reshape(i.shape)},offset:function(){var e=t;return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)}}},"BatchNormalization",{varianceEpsilon:o},h).reshape(c.shape)}function qu(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Ku(){He("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Xu=ln({batchNormalization2d_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),Ku(),zu(t,e,n,o,i,r)}}),Yu=ln({batchNormalization3d_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),Ku(),Wu(t,e,n,o,i,r)}}),Qu=ln({batchNormalization4d_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),Ku(),Gu(t,e,n,o,i,r)}}),$u=ln({batchNormalization_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),Ku(),Hu(t,e,n,o,i,r)}}),Ju=ln({batchNorm_:Hu}),Zu=ln({batchNorm2d_:zu}),ts=ln({batchNorm3d_:Wu}),es=ln({batchNorm4d_:Gu}),ns=ln({logicalAnd_:function(t,e){var n=$e(t,"a","logicalAnd","bool"),r=$e(e,"b","logicalAnd","bool");return Gr(n.shape,r.shape),jt.runKernelFunc(function(t){return t.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),rs=ln({logicalNot_:function(t){var e=$e(t,"x","logicalNot","bool");return jt.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),is=ln({logicalOr_:function(t,e){var n=$e(t,"a","logicalOr","bool"),r=$e(e,"b","logicalOr","bool");return Gr(n.shape,r.shape),jt.runKernelFunc(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}}),os=ln({logicalXor_:function(t,e){var n=$e(t,"a","logicalXor","bool"),r=$e(e,"b","logicalXor","bool");return Gr(n.shape,r.shape),is(t,e).logicalAnd(ns(t,e).logicalNot())}}),as=ln({where_:function(t,e,n){var r=$e(e,"a","where"),i=$e(n,"b","where"),o=$e(t,"condition","where","bool");return _(r.shape,i.shape,"Error in where: "),1===o.rank?C(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):_(o.shape,i.shape,"Error in where: "),jt.runKernelFunc(function(t,e){var n=t.select(o,r,i);return e([o]),n},{$condition:o,$a:r,$b:i},function(t,e){var n=e[0];return{$condition:function(){return Sn(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}})}}),us=function(t){return s(this,void 0,void 0,function(){var e,n,r;return c(this,function(i){switch(i.label){case 0:return[4,(e=$e(t,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=xi(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},ss=ln({add_:function(t,e){var n,r=$e(t,"a","add"),i=$e(e,"b","add");n=Dt(r,i),r=n[0],i=n[1];var o=Gr(r.shape,i.shape);return jt.runKernelFunc(function(t){return t.add(r,i)},{a:r,b:i},function(t){return{a:function(){var e=t,n=Wr(r.shape,o);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=Wr(i.shape,o);return n.length>0&&(e=e.sum(n)),e.reshape(i.shape)}}},"Add")}}),cs=ln({addN_:function(t){C(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),C(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return $e(t,"tensors"+e,"addN")}),n=e[0];e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!I(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return jt.runKernelFunc(function(t){return t.addN(e)},r,function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n},"AddN")}}),ls=ln({addStrict_:function(t,e){var n=$e(t,"a","addStrict"),r=$e(e,"b","addStrict");return _(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),fs=ln({atan2_:function(t,e){var n,r=$e(t,"a","atan2"),i=$e(e,"b","atan2");n=Dt(r,i),r=n[0],i=n[1];var o=Gr(r.shape,i.shape);return jt.runKernelFunc(function(t,e){var n=t.atan2(r,i);return e([r,i]),n},{$a:r,$b:i},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=ss(n.square(),r.square()),i=t.mul(r.div(e)),a=Wr(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$b:function(){var e=ss(n.square(),r.square()),i=Su(t.mul(n.div(e))),a=Wr(r.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)}}})}}),hs=ln({div_:function(t,e){var n,r=$e(t,"a","div"),i=$e(e,"b","div");if(n=Dt(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return vs(r,i);var o=Gr(r.shape,i.shape);return jt.runKernelFunc(function(t,e){var n=t.realDivide(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),i=Wr(n.shape,o);return i.length>0?e.sum(i).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),i=Wr(r.shape,o);i.length>0&&(e=e.sum(i).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}},"Div")}}),ds=ln({divNoNan_:function(t,e){var n,r=$e(t,"a","div"),i=$e(e,"b","div");r=(n=Dt(r,i))[0],i=n[1];var o=hs(r,i),a=Sn(o),u=i.equal(a);return as(u,a,o)}}),ps=ln({divStrict_:function(t,e){var n=$e(t,"a","div"),r=$e(e,"b","div");return _(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),vs=ln({floorDiv_:function(t,e){var n,r=$e(t,"a","floorDiv"),i=$e(e,"b","floorDiv");n=Dt(r,i),r=n[0],i=n[1];var o=Gr(r.shape,i.shape);return jt.runKernelFunc(function(t,e){var n=t.floorDiv(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),i=Wr(n.shape,o);return i.length>0?e.sum(i).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),i=Wr(r.shape,o);i.length>0&&(e=e.sum(i).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}},"FloorDiv")}}),ms=ln({maximum_:function(t,e){var n,r=$e(t,"a","maximum"),i=$e(e,"b","maximum");return n=Dt(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Gr(r.shape,i.shape),jt.runKernelFunc(function(t,e){var n=t.maximum(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.greaterEqual(r).toFloat())},b:function(){return t.mul(n.less(r).toFloat())}}},"Maximum")}}),gs=ln({maximumStrict_:function(t,e){var n=$e(t,"a","maximumStrict"),r=$e(e,"b","maximumStrict");return _(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),ys=ln({minimum_:function(t,e){var n,r=$e(t,"a","minimum"),i=$e(e,"b","minimum");return n=Dt(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Gr(r.shape,i.shape),jt.runKernelFunc(function(t,e){var n=t.minimum(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.lessEqual(r).toFloat())},b:function(){return t.mul(n.greater(r).toFloat())}}},"Minimum")}}),bs=ln({minimumStrict_:function(t,e){var n=$e(t,"a","minimumStrict"),r=$e(e,"b","minimumStrict");return _(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),ws=ln({mod_:function(t,e){var n,r=$e(t,"a","mod"),i=$e(e,"b","mod");n=Dt(r,i),r=n[0],i=n[1];var o=Gr(r.shape,i.shape);return jt.runKernelFunc(function(t,e){var n=t.mod(r,i);return e([r,i]),n},{$a:r,$b:i},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=Wr(n.shape,o);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),i=Wr(r.shape,o);return i.length>0?e.sum(i).reshape(r.shape):e}}})}}),xs=ln({modStrict_:function(t,e){var n=$e(t,"a","modStrict"),r=$e(e,"b","modStrict");return _(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),ks=ln({mul_:function(t,e){var n,r=$e(t,"a","mul"),i=$e(e,"b","mul");n=Dt(r,i),r=n[0],i=n[1];var o=Gr(r.shape,i.shape);return jt.runKernelFunc(function(t,e){var n=t.multiply(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.mul(r.toFloat()),i=Wr(n.shape,o);return i.length>0?e.sum(i).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),i=Wr(r.shape,o);return i.length>0?e.sum(i).reshape(r.shape):e}}},"Mul")}}),Es=ln({mulStrict_:function(t,e){var n=$e(t,"a","mul"),r=$e(e,"b","mul");return _(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Cs=ln({pow_:function(t,e){var n,r=$e(t,"base","pow"),i=$e(e,"exp","pow");n=Dt(r,i),r=n[0],i=n[1];var o=Gr(r.shape,i.shape),a=[r,i];return jt.runKernelFunc(function(t,e){var n=t.pow(r,i);return e([r,i,n]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1],i=e[2];return{a:function(){var e=r.toFloat(),i=t.mul(e.mul(n.pow(e.sub(mn(1))))),a=Wr(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},b:function(){var e=n.greater(0),a=n.log().where(e,Sn(n)),u=t.mul(i.mul(a)),s=Wr(r.shape,o);return s.length>0&&(u=u.sum(s)),u.reshape(r.shape)}}},"Pow",{},a,[!0])}}),_s=ln({powStrict_:function(t,e){return _(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),Ss=ln({squaredDifferenceStrict_:function(t,e){var n=$e(t,"a","squaredDifferenceStrict"),r=$e(e,"b","squaredDifferenceStrict");return _(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Ts=ln({sub_:function(t,e){var n,r=$e(t,"a","sub"),i=$e(e,"b","sub");n=Dt(r,i),r=n[0],i=n[1];var o=Gr(r.shape,i.shape);return jt.runKernelFunc(function(t){return t.subtract(r,i)},{a:r,b:i},function(t){return{a:function(){var e=t,n=Wr(r.shape,o);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=Wr(i.shape,o);return n.length>0&&(e=e.sum(n)),e.neg().reshape(i.shape)}}},"Sub")}}),Os=ln({subStrict_:function(t,e){var n=$e(t,"a","subStrict"),r=$e(e,"b","subStrict");return _(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Is=ln({equal_:function(t,e){var n,r=$e(t,"a","equal"),i=$e(e,"b","equal");return n=Dt(r,i),r=n[0],i=n[1],Gr(r.shape,i.shape),jt.runKernelFunc(function(t){return t.equal(r,i)},{$a:r,$b:i})}}),Rs=ln({equalStrict_:function(t,e){var n=$e(t,"a","equalStrict"),r=$e(e,"b","equalStrict");return _(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),As=ln({greater_:function(t,e){var n,r=$e(t,"a","greater"),i=$e(e,"b","greater");return n=Dt(r,i),r=n[0],i=n[1],Gr(r.shape,i.shape),jt.runKernelFunc(function(t){return t.greater(r,i)},{a:r,b:i},null,"Greater")}}),Ds=ln({greaterEqual_:function(t,e){var n,r=$e(t,"a","greaterEqual"),i=$e(e,"b","greaterEqual");return n=Dt(r,i),r=n[0],i=n[1],Gr(r.shape,i.shape),jt.runKernelFunc(function(t,e){var n=t.greaterEqual(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){return Sn(n)},b:function(){return Sn(r)}}},"GreaterEqual")}}),Ns=ln({greaterEqualStrict_:function(t,e){var n=$e(t,"a","greaterEqualStrict"),r=$e(e,"b","greaterEqualStrict");return _(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Ps=ln({greaterStrict_:function(t,e){var n=$e(t,"a","greaterStrict"),r=$e(e,"b","greaterStrict");return _(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Ms=ln({less_:function(t,e){var n,r=$e(t,"a","less"),i=$e(e,"b","less");return n=Dt(r,i),r=n[0],i=n[1],Gr(r.shape,i.shape),jt.runKernelFunc(function(t){return t.less(r,i)},{a:r,b:i},null,"Less")}}),Fs=ln({lessEqual_:function(t,e){var n,r=$e(t,"a","lessEqual"),i=$e(e,"b","lessEqual");return n=Dt(r,i),r=n[0],i=n[1],Gr(r.shape,i.shape),jt.runKernelFunc(function(t,e){var n=t.lessEqual(r,i);return e([r,i]),n},{a:r,b:i},null,"LessEqual")}}),Ls=ln({lessEqualStrict_:function(t,e){var n=$e(t,"a","lessEqualStrict"),r=$e(e,"b","lessEqualStrict");return _(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),js=ln({lessStrict_:function(t,e){var n=$e(t,"a","lessStrict"),r=$e(e,"b","lessStrict");return _(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Bs=ln({notEqual_:function(t,e){var n,r=$e(t,"a","notEqual"),i=$e(e,"b","notEqual");return n=Dt(r,i),r=n[0],i=n[1],Gr(r.shape,i.shape),jt.runKernelFunc(function(t){return t.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),Vs=ln({notEqualStrict_:function(t,e){var n=$e(t,"a","notEqualStrict"),r=$e(e,"b","notEqualStrict");return _(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Us(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function zs(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var Ws=ln({gather_:function(t,e,n){void 0===n&&(n=0);var r=$e(t,"x","gather"),i=$e(e,"indices","gather","int32");n=F(n,r.shape)[0];var o=function(t,e,n){for(var r=t.shape[n],i=[],o=1,a=1,u=0;u<n;u++)i.push(t.shape[u]),o*=t.shape[u];for(u=0;u<e.rank;u++)i.push(e.shape[u]);for(u=n+1;u<t.rank;u++)i.push(t.shape[u]),a*=t.shape[u];return{batchSize:o,sliceSize:a,dimSize:r,outputShape:i}}(r,i,n);return jt.runKernelFunc(function(t,e){var o=t.gather(r,i.flatten(),n);return e([i]),o},{x:r,indices:i},function(t,e){var i=e[0];return{x:function(){var e=r.shape,o=i.size,a=e.slice(0,n),u=a.length,s=e.slice(n,e.length).slice(1),c=s.length,l=Us(0,u),f=Us(u+1,u+1+c),h=zs([a,[o],s]),d=t.reshape(h),p=i.reshape([o]),v=zs([[u],l,f]),m=d.transpose(v),g=Gs(m,p,r.shape[n]),y=an(v);return g.transpose(y)},indices:function(){return i}}},"Gather",{axis:n}).reshape(o.outputShape)}}),Gs=ln({unsortedSegmentSum_:function(t,e,n){var r=$e(t,"x","unsortedSegmentSum"),i=$e(e,"segmentIds","unsortedSegmentSum","int32");return C(R(n),function(){return"numSegments must be of dtype int"}),jt.runKernelFunc(function(t,e){var o=t.unsortedSegmentSum(r,i,n);return e([i]),o},{$x:r},function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=ms(e,Sn(e)),r=Ws(t,n),i=Ds(e,mn(0,"int32")),o=r.rank-i.rank,a=0;a<o;++a)i=Jn(i,a+1);i=ns(i,xn(r.shape,"bool"));var u=Sn(r);return as(i,r,u)}(t,n)}}})}});function Hs(t,e,n,r,i,o,a){void 0===o&&(o="NHWC"),C(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var u=t,s=e,c=!1;3===e.rank&&(c=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),u=[1,t[0],t[1],t[2]]),C(4===u.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."}),C(4===s.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),C(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var l="NHWC"===o?u[3]:u[1],f="NHWC"===o?s.shape[3]:s.shape[1];C(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),C(f===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&C(R(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=ni(o),d=Kr(u,n.shape,r,1,i,a,!1,h),p=jt.runKernelFunc(function(t,e){var r=t.conv2dDerInput(s,n,d);return e([n,s]),r},{dy4D:s,filter:n},function(t,e){var n=e[0],u=e[1];return{dy4D:function(){return Ys(t,n,r,i,o,1,a)},filter:function(){return $s(t,u,n.shape,r,i,o,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function qs(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t),n=e[0],r=e[1],i=e[2];return 1===n&&1===r&&1===i}function Ks(t,e,n,r,i){C(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var o=t,a=e,u=!1;4===e.rank&&(u=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,t[0],t[1],t[2],t[3]]);var s=o[4],c=a.shape[4];C(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),C(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),C(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),C(s===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+s+") must match input depth for filter "+n.shape[3]+"."}),C(c===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."});var l=Xr(o,n.shape,r,1,i),f=jt.runKernelFunc(function(t){return t.conv3dDerInput(a,n,l)},{dy5D:a});return u?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var Xs=ln({conv1d_:function(t,e,n,r,i,o,a){void 0===i&&(i="NWC"),void 0===o&&(o=1);var u=$e(t,"x","conv1d"),s=$e(e,"filter","conv1d"),c=u,l=!1;2===u.rank&&(l=!0,c=u.as3D(1,u.shape[0],u.shape[1])),C(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),C(3===s.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+s.rank+"."}),null!=a&&C(R(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),C(c.shape[2]===s.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+s.shape[1]+"."}),C(ei(n,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+o+"'"}),C("NWC"===i,function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var f=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),h=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),d=Ys(h,f,[1,n],r,"NHWC",[1,o],a);return l?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),Ys=ln({conv2d_:function(t,e,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var u=$e(t,"x","conv2d"),s=$e(e,"filter","conv2d"),c=u,l=!1;3===u.rank&&(l=!0,c=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),C(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),C(4===s.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+s.rank+"."}),null!=a&&C(R(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var f="NHWC"===i?c.shape[3]:c.shape[1];C(f===s.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+s.shape[2]+"."}),C(ei(n,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"});var h=ni(i),d=Kr(c.shape,s.shape,n,o,r,a,!1,h),p=[s,c],v=jt.runKernelFunc(function(t,e){var n=t.conv2d(c,s,d);return e([s,c]),n},{x:c,filter:s},function(t,e){var a=e,u=a[0],s=a[1];return C(ti(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return Js(s.shape,t,u,n,r,i)},filter:function(){return $s(s,t,u.shape,n,r,i)}}},"Conv2D",d,p);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Qs=ln({conv3d_:function(t,e,n,r,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var a=$e(t,"x","conv3d"),u=$e(e,"filter","conv3d"),s=a,c=!1;4===a.rank&&(c=!0,s=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),C(5===s.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+s.rank+"."}),C(5===u.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."}),C(s.shape[4]===u.shape[3],function(){return"Error in conv3d: depth of input ("+s.shape[4]+") must match input depth for filter "+u.shape[3]+"."}),C(function(t,e){return qs(n)||qs(e)}(0,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),C("NDHWC"===i,function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var l=Xr(s.shape,u.shape,n,o,r),f=jt.runKernelFunc(function(t,e){var n=t.conv3d(s,u,l);return e([s,u]),n},{x:s,$filter:u},function(t,e){C(qs(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var i=e[0],a=e[1];return{x:function(){return Ks(i.shape,t,a,n,r)},$filter:function(){return function(t,e,n,r,i){var o=t;4===t.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),C(5===o.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+o.shape+"."}),C(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),C(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),C(o.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+o.shape[4]+") must match input depth in filter ("+n[3]+"."}),C(a.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."});var u=Xr(o.shape,n,r,1,i);return jt.runKernelFunc(function(t){return t.conv3dDerFilter(o,a,u)},{x5D:o,dy5D:a})}(i,t,a.shape,n,r)}}});return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),$s=ln({conv2dDerFilter_:function(t,e,n,r,i,o,a){void 0===o&&(o="NHWC");var u=t;3===t.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=e;3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),C(4===u.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."}),C(4===s.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),C(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var c="NHWC"===o?u.shape[3]:u.shape[1],l="NHWC"===o?s.shape[3]:s.shape[1];C(c===n[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."}),C(l===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."}),null!=a&&C(R(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var f=ni(o),h=Kr(u.shape,n,r,1,i,a,!1,f);return jt.runKernelFunc(function(t){return t.conv2dDerFilter(u,s,h)},{x4D:u,dy4D:s})}}),Js=ln({conv2dDerInput_:Hs}),Zs=ln({depthwiseConv2d_:function(t,e,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var u=$e(t,"x","depthwiseConv2d"),s=$e(e,"filter","depthwiseConv2d"),c=u,l=!1;3===u.rank&&(l=!0,c=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),C(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),C(4===s.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+s.rank+"."}),C(c.shape[3]===s.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+s.shape[2]+"."}),null==o&&(o=[1,1]),C(ei(n,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=a&&C(R(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var f=Kr(c.shape,s.shape,n,o,r,a,!0),h=[c,s],d=jt.runKernelFunc(function(t,e){var n=t.depthwiseConv2D(c,s,f);return e([c,s]),n},{x:c,filter:s},function(t,e){C(ti(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var n=e[0],r=e[1];return{x:function(){return tc(n.shape,t,r,f)},filter:function(){return ec(n,t,r.shape,f)}}},"DepthwiseConv2dNative",f,h);return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),tc=ln({depthwiseConv2dDerInput_:function(t,e,n,r){var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=jt.runKernelFunc(function(t){return t.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),ec=ln({depthwiseConv2dDerFilter_:function(t,e,n,r){var i=t;3===t.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=e;return 3===o.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),jt.runKernelFunc(function(t){return t.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),nc=ln({separableConv2d_:function(t,e,n,r,i,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var u=$e(t,"x","separableConv2d"),s=$e(e,"depthwiseFilter","separableConv2d"),c=$e(n,"pointwiseFilter","separableConv2d"),l=u,f=!1;if(3===u.rank&&(f=!0,l=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");C(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),C(4===s.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+s.rank+"."}),C(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+s.rank+"."}),C(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),C(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var h=s.shape[2],d=s.shape[3];C(c.shape[2]===h*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*d+", but got "+c.shape[2]+"."});var p=Zs(l,s,r,i,a,o),v=Ys(p,c,1,"valid",a);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),rc=ln({conv2dTranspose_:function(t,e,n,r,i,o){return Hs(n,$e(t,"x","conv2dTranspose"),$e(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),ic=ln({conv3dTranspose_:function(t,e,n,r,i){return Ks(n,$e(t,"x","conv3dTranspose"),$e(e,"filter","conv3dTranspose"),r,i)}}),oc=ln({matMul_:function(t,e,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var o=$e(t,"a","matMul"),a=$e(e,"b","matMul");i=Dt(o,a),o=i[0],a=i[1];var u=n?o.shape[o.rank-2]:o.shape[o.rank-1],s=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?o.shape[o.rank-1]:o.shape[o.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],f=o.shape.slice(0,-2),h=a.shape.slice(0,-2),d=O(f),p=O(h);C(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),C(I(f,h),function(){return"Error in matMul: outer dimensions ("+f+") and ("+h+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),C(u===s,function(){return"Error in matMul: inner shapes ("+u+") and ("+s+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=o.shape.slice(0,-2).concat([c,l]),m=n?o.as3D(d,u,c):o.as3D(d,c,u),g=r?a.as3D(p,l,s):a.as3D(p,s,l),y={transposeA:n,transposeB:r};return jt.runKernelFunc(function(t,e){var i=t.batchMatMul(m,g,n,r);return e([m,g]),i},{a:m,b:g},function(t,e){var i=e,o=i[0],a=i[1];return n||r?!n&&r?{a:function(){return t.matMul(a,!1,!1)},b:function(){return t.matMul(o,!0,!1)}}:n&&!r?{a:function(){return a.matMul(t,!1,!0)},b:function(){return o.matMul(t,!1,!1)}}:{a:function(){return a.matMul(t,!0,!0)},b:function(){return t.matMul(o,!0,!0)}}:{a:function(){return t.matMul(a,!1,!0)},b:function(){return o.matMul(t,!0,!1)}}},"BatchMatMul",y).reshape(v)}}),ac=ln({dot_:function(t,e){var n=$e(t,"t1","dot"),r=$e(e,"t2","dot");C(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var i=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];return C(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),uc=ln({outerProduct_:function(t,e){var n=$e(t,"v1","outerProduct"),r=$e(e,"v2","outerProduct");return C(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),sc=ln({reverse_:function(t,e){var n=$e(t,"x","reverse");if(0===n.rank)return n.clone();var r=F(e,n.shape);return jt.runKernelFunc(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)}}),cc=ln({reverse1d_:function(t){var e=$e(t,"x","reverse");return C(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),sc(e,0)}}),lc=ln({reverse2d_:function(t,e){var n=$e(t,"x","reverse");return C(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),sc(n,e)}}),fc=ln({reverse3d_:function(t,e){var n=$e(t,"x","reverse");return C(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),sc(n,e)}}),hc=ln({reverse4d_:function(t,e){var n=$e(t,"x","reverse");return C(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),sc(n,e)}});function dc(t,e,n,r,i,o){var a=$e(t,"x","maxPool"),u=a,s=!1;3===a.rank&&(s=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),C(4===u.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."}),C(ei(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=o&&C(R(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=Hr(u.shape,e,n,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&I(c.inShape,c.outShape))return a.clone();var l=[u],f=jt.runKernelFunc(function(t,e){var n=t.maxPool(u,c);return e([u,n]),n},{x:u},function(t,o){var a=o[0],u=o[1];return{x:function(){return function(t,e,n,r,i,o,a,u){var s=$e(t,"dy","maxPoolBackprop"),c=$e(e,"input","maxPoolBackprop"),l=$e(n,"output","maxPoolBackprop");C(c.rank===s.rank,function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+s.rank+")"}),null==o&&(o=[1,1]),C(ei(i,o),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}),C(4===s.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."}),C(4===c.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."});var f=Hr(c.shape,r,i,o,a,u);return jt.runKernelFunc(function(t){return t.maxPoolBackprop(s,c,l,f)},{$dy:s,$input:c})}(t,a,u,e,n,r,i)}}},"MaxPool",c,l);return s?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function pc(t,e,n,r,i,o){var a=$e(t,"x","avgPool","float32");null==r&&(r=[1,1]),C(ei(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var u=a,s=!1;3===a.rank&&(s=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),C(4===u.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."}),null!=o&&C(R(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=Hr(u.shape,e,n,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&I(c.inShape,c.outShape))return a.clone();var l=jt.runKernelFunc(function(t){return t.avgPool(u,c)},{x:u},function(t){return{x:function(){return function(t,e,n,r,i,o){var a=$e(t,"dy","avgPoolBackprop"),u=$e(e,"input","avgPoolBackprop");C(u.rank===a.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+a.rank+")"}),null==i&&(i=[1,1]),C(ei(r,i),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"});var s=u,c=a,l=!1;3===u.rank&&(l=!0,s=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),C(4===c.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."}),C(4===s.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+"."});var f=Hr(s.shape,n,r,i,o),h=jt.runKernelFunc(function(t){return t.avgPoolBackprop(c,s,f)},{dy4D:c,input4D:s});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(t,u,e,n,r,i)}}},"AvgPool",c);return l=l.cast(a.dtype),s?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var vc=ln({maxPool_:function(t,e,n,r,i){return dc(t,e,n,1,r,i)}}),mc=ln({avgPool_:function(t,e,n,r,i){return pc(t,e,n,1,r,i)}}),gc=ln({pool_:function(t,e,n,r,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===r&&(r="valid");var a=$e(t,"x","maxPool"),u=a,s=!1;3===a.rank&&(s=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),C(ei(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var c,l=Hr(u.shape,e,o,i,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function(t,e){var n=t.map(function(t,n){return t+(t-1)*(e[n]-1)}).map(function(t){return t-1}),r=n.map(function(t){return Math.floor(t/2)}),i=n.map(function(t,e){return t-r[e]});return n.map(function(t,e){return[r[e],i[e]]})}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var h=1===f[0]&&1===f[1],d=function(t,e,n){var r=n.map(function(t){return t[0]}),i=n.map(function(t){return t[1]}),o=t.concat(r,i),a=e.map(function(t,e){return(t-o[e]%t)%t}),u=i.map(function(t,e){return t+a[e]});return[e.map(function(t,e){return[r[e],u[e]]}),e.map(function(t,e){return[0,a[e]]})]}([l.inHeight,l.inWidth],f,c),p=d[0],v=d[1],m=h?r:"valid",g=h?u:hr(u,f,p),y=("avg"===n?function(){return pc(g,e,o,1,m)}:function(){return dc(g,e,o,1,m)})(),b=h?y:qn(y,f,v);return s?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),yc=ln({maxPool3d_:function(t,e,n,r,i,o,a){void 0===o&&(o="NDHWC");var u=$e(t,"x","maxPool3d"),s=u,c=!1;4===u.rank&&(c=!0,s=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),null==a&&(a=[1,1,1]),C(5===s.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),C("NDHWC"===o,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),C(ei(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&C(R(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=qr(s.shape,e,n,a,r,i,o),f=jt.runKernelFunc(function(t,e){var n=t.maxPool3d(s,l);return e([s,n]),n},{x:s},function(t,o){var u=o[0],s=o[1];return{x:function(){return function(t,e,n,r,i,o,a,u){var s=$e(t,"dy","maxPool3dBackprop"),c=$e(e,"input","maxPool3dBackprop"),l=$e(n,"output","maxPool3dBackprop"),f=s,h=c,d=l,p=!1;4===c.rank&&(p=!0,f=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),h=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),C(5===f.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."}),C(5===h.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."}),C(5===d.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+d.rank+"."}),null==o&&(o=[1,1,1]),C(ei(i,o),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}),null!=u&&C(R(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."});var v=qr(h.shape,r,i,o,a,u),m=jt.runKernelFunc(function(t){return t.maxPool3dBackprop(f,h,d,v)},{dy5D:f,input5D:h});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(t,u,s,e,n,a,r,i)}}});return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),bc=ln({avgPool3d_:function(t,e,n,r,i,o,a){void 0===o&&(o="NDHWC");var u=$e(t,"x","avgPool3d","float32"),s=u,c=!1;4===u.rank&&(c=!0,s=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),null==a&&(a=[1,1,1]),C(5===s.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),C("NDHWC"===o,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),C(ei(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&C(R(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=qr(s.shape,e,n,a,r,i,o),f=jt.runKernelFunc(function(t){return t.avgPool3d(s,l)},{x:s},function(t){return{x:function(){return function(t,e,n,r,i,o,a){var u=$e(t,"dy","avgPool3dBackprop"),s=$e(e,"input","avgPool3dBackprop"),c=u,l=s,f=!1;4===s.rank&&(f=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),C(5===c.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."}),C(5===l.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."}),null==i&&(i=[1,1,1]),C(ei(r,i),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}),null!=a&&C(R(o),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var h=qr(l.shape,n,r,i,o,a),d=jt.runKernelFunc(function(t){return t.avgPool3dBackprop(c,l,h)},{dy5D:c,input5D:l});return f?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}(t,s,e,n,a,r,i)}}});return f=f.cast(s.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),wc=ln({slice_:function(t,e,n){var r,i,o=$e(t,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(t){C(-1!==t,function(){return"slice() does not support negative begin indexing."})}),i=(i=null==n?new Array(o.rank).fill(-1):"number"==typeof n?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(C(-1===t,function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+e+"."}),o.shape[e]-r[e])}),Ir(o,r,i);var a=o.shape,u={begin:r,size:i};return jt.runKernelFunc(function(t){return t.slice(o,r,i)},{x:o},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-i[n]]);return{x:function(){return t.pad(e)}}},"Slice",u)}}),xc=ln({slice1d_:function(t,e,n){var r=$e(t,"x","slice1d");return C(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),wc(r,[e],[n])}}),kc=ln({slice2d_:function(t,e,n){var r=$e(t,"x","slice2d");return C(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),wc(r,e,n)}}),Ec=ln({slice3d_:function(t,e,n){var r=$e(t,"x","slice3d");return C(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),wc(r,e,n)}}),Cc=ln({slice4d_:function(t,e,n){var r=$e(t,"x","slice4d");return C(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),wc(r,e,n)}});function _c(t,e,n,r,i){return e.rank<n.rank&&(e=e.reshape(nn(e.shape,r))),t.rank<n.rank&&(t=t.reshape(nn(t.shape,r))),{x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==i?r:r.transpose(i)}}}var Sc=ln({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","all","bool"),i=F(e,r.shape),o=i,a=on(o,r.rank);null!=a&&(r=r.transpose(a),o=un(o.length,r.rank));var u=jt.runKernelFunc(function(t){return t.all(r,o)},{$x:r});if(n){var s=nn(u.shape,i);return u.reshape(s)}return u}}),Tc=ln({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","any","bool"),i=F(e,r.shape),o=i,a=on(o,r.rank);null!=a&&(r=r.transpose(a),o=un(o.length,r.rank));var u=jt.runKernelFunc(function(t){return t.any(r,o)},{$x:r});if(n){var s=nn(u.shape,i);return u.reshape(s)}return u}}),Oc=ln({argMax_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","argMax");null==e&&(e=0);var r=F(e,n.shape),i=on(r,n.rank);null!=i&&(n=n.transpose(i),r=un(r.length,n.rank));var o={axis:r[0]},a=[n];return jt.runKernelFunc(function(t,e){var i=t.argMax(n,r[0]);return e([n]),i},{x:n},function(t,e){var n=e[0];return{x:function(){return Sn(n)}}},"ArgMax",o,a)}}),Ic=ln({argMin_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","argMin");null==e&&(e=0);var r=F(e,n.shape),i=on(r,n.rank);return null!=i&&(n=n.transpose(i),r=un(r.length,n.rank)),jt.runKernelFunc(function(t,e){var i=t.argMin(n,r[0]);return e([n]),i},{$x:n},function(t,e){var n=e[0];return{$x:function(){return Sn(n)}}})}}),Rc=ln({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","logSumExp"),i=F(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),u=o.reshape(a.shape).add(a);if(n){var s=nn(u.shape,i);return u.reshape(s)}return u}}),Ac=ln({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","max"),i=r,o=F(e,r.shape),a=o,u=on(a,r.rank);null!=u&&(r=r.transpose(u),a=un(a.length,r.rank));var s=[r],c=jt.runKernelFunc(function(t,e){var n=t.max(r,a);return e([i,n]),n},{x:r},function(t,e){return _c(t,e[1],e[0],o,u)},"Max",{axes:a},s,[!0]);if(n){var l=nn(c.shape,o);c=c.reshape(l)}return c}}),Dc=ln({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","mean"),i=F(e,r.shape),o=O(en(r.shape,i)[1]);return Fr(function(t){var r=mn(o);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return i.forEach(function(t){n[t]=1}),e.reshape(n).mul(xn(t.shape,"float32")).div(o)}}})(r)}}),Nc=ln({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","min"),i=r,o=F(e,r.shape),a=o,u=on(a,r.rank);null!=u&&(r=r.transpose(u),a=un(a.length,r.rank));var s=[r],c=jt.runKernelFunc(function(t,e){var n=t.min(r,a);return e([i,n]),n},{x:r},function(t,e){return _c(t,e[1],e[0],o,u)},"Min",{axes:a},s,[!0]);if(n){var l=nn(c.shape,o);c=c.reshape(l)}return c}}),Pc=ln({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=F(e,(t=$e(t,"x","moments")).shape),i=t.mean(r,n),o=i.shape;n||(o=nn(i.shape,r));var a=t.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,n)}}}),Mc=ln({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=F(e,r.shape);return Fr(function(t){var e=on(i,t.rank),r=i,o=t;null!=e&&(o=t.transpose(e),r=un(r.length,t.rank));var a=function(e){var n=t.shape.slice();return i.forEach(function(t){n[t]=1}),e.reshape(n).mul(xn(t.shape,"float32"))},u={axes:r},s=jt.runKernelFunc(function(t){return t.sum(o,r)},{x:o},function(t){return{x:function(){return a(t)}}},"Sum",u);if(n){var c=nn(s.shape,i);s=s.reshape(c)}return{value:s,gradFunc:a}})(r)}}),Fc=ln({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=F(e,r.shape),o=on(i,r.rank),a=i,u=r;null!=o&&(u=r.transpose(o),a=un(a.length,r.rank));var s=jt.runKernelFunc(function(t){return t.prod(u,a)},{permutedX:u});if(n){var c=nn(s.shape,i);s=s.reshape(c)}return s}}),Lc=ln({elu_:function(t){var e=$e(t,"x","elu");return jt.runKernelFunc(function(t,n){var r=t.elu(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return jt.runKernelFunc(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),jc=ln({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=$e(t,"x","leakyRelu");return ms(mn(e).mul(n),n)}}),Bc=ln({prelu_:function(t,e){var n=$e(t,"x","prelu"),r=$e(e,"alpha","prelu");return jt.runKernelFunc(function(t,e){var i=t.prelu(n,r);return e([n,r]),i},{x:n,alpha:r},function(t,e){var n=e[0],r=e[1],i=n.greater(0);return{x:function(){return as(i,t,t.mul(r))},alpha:function(){var e=as(i,Sn(t),t.mul(n)),o=Wr(r.shape,t.shape);return o.length>0&&(e=e.sum(o)),e.reshape(r.shape)}}},"Prelu")}}),Vc=ln({relu_:function(t){var e=$e(t,"x","relu");return"bool"===e.dtype?e.toInt():jt.runKernelFunc(function(t,n){var r=t.relu(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n.step().toFloat())}}},"Relu")}}),Uc=ln({relu6_:function(t){var e=$e(t,"x","relu6");return"bool"===e.dtype?e.toInt():jt.runKernelFunc(function(t,n){var r=t.relu6(e);return n([e]),r},{x:e},function(t,e){var n=e[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return t.mulStrict(r.toFloat())}}},"Relu6")}}),zc=ln({selu_:function(t){var e=$e(t,"x","selu");return jt.runKernelFunc(function(t,n){var r=t.selu(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){var e=n.greater(mn(0)),r=mn(Pa),i=mn(Ma),o=t.mul(i),a=t.mul(r).mul(n.toFloat().exp());return as(e,o,a)}}})}}),Wc=ln({transpose_:function(t,e){var n=$e(t,"x","transpose");if(null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),C(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(t){C(t>=0&&t<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1)return n.clone();var r={perm:e};return jt.runKernelFunc(function(t){return t.transpose(n,e)},{x:n},function(t){var n=an(e);return{x:function(){return t.transpose(n)}}},"Transpose",r)}}),Gc=ln({localResponseNormalization_:function(t,e,n,r,i){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=$e(t,"x","localResponseNormalization");C(4===o.rank||3===o.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."}),C(R(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,u=!1;3===o.rank&&(u=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var s=jt.runKernelFunc(function(t,o){var u=t.localResponseNormalization4D(a,e,n,r,i);return o([a,u]),u},{x4D:a},function(t,o){var a=o[0],u=o[1];return{x4D:function(){return jt.runKernelFunc(function(o){return o.LRNGrad(t,a,u,e,n,r,i)},{})}}});return u?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),Hc=ln({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(mn(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=$e(t,"x","norm"),e,n),o=i.shape;if(r){var a=F(n,t.shape);o=nn(i.shape,a)}return i.reshape(o)}}),qc=ln({basicLSTMCell_:function(t,e,n,r,i,o){var a=$e(t,"forgetBias","basicLSTMCell"),u=$e(e,"lstmKernel","basicLSTMCell"),s=$e(n,"lstmBias","basicLSTMCell"),c=$e(r,"data","basicLSTMCell"),l=$e(i,"c","basicLSTMCell"),f=$e(o,"h","basicLSTMCell"),h=c.concat(f,1).matMul(u).add(s),d=h.shape[0],p=h.shape[1]/4,v=[d,p],m=h.slice([0,0],v),g=h.slice([0,p],v),y=h.slice([0,2*p],v),b=h.slice([0,3*p],v),w=m.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(a.add(y).sigmoid())),x=w.tanh().mulStrict(b.sigmoid());return[w,x]}}),Kc=ln({multiRNNCell_:function(t,e,n,r){for(var i=$e(e,"data","multiRNNCell"),o=Je(n,"c","multiRNNCell"),a=Je(r,"h","multiRNNCell"),u=i,s=[],c=0;c<t.length;c++){var l=t[c](u,o[c],a[c]);s.push(l[0]),s.push(l[1]),u=l[1]}var f=[],h=[];for(c=0;c<s.length;c+=2)f.push(s[c]),h.push(s[c+1]);return[f,h]}}),Xc=ln({movingAverage_:function(t,e,n,r,i){void 0===i&&(i=!0);var o=$e(t,"v","movingAverage"),a=$e(e,"x","movingAverage"),u=$e(n,"decay","movingAverage");Nt(o,a),C(I(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var s=mn(1),c=s.sub(u),l=a.sub(o).mul(c);if(i){C(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=$e(r,"step","movingAverage");l=l.div(s.sub(Cs(u,f)))}return o.add(l)}}),Yc=ln({stridedSlice_:function(t,e,n,r,i,o,a,u,s){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=0),void 0===s&&(s=0),null==r&&(r=new Array(e.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=$e(t,"x","stridedSlice"),l=Rr(u),f=c.shape.slice();l.forEach(function(t){e[t]=0,n[t]=1,f.splice(t,0,1)}),c=c.reshape(f);for(var h=0;h<c.rank;h++)e[h]=Dr(i,e,r,c.shape,h),n[h]=Nr(o,n,r,c.shape,h),r[h]=r[h]||1;var d=Rr(s);d.forEach(function(t){n[t]=e[t]+1,r[t]=1});var p=Ar(e,n,r),v=p.filter(function(t,e){return-1===d.indexOf(e)});return r.every(function(t){return 1===t})?wc(c,e,p).reshape(v):jt.runKernelFunc(function(t){return t.stridedSlice(c,e,n,r)},{$x:c}).reshape(v)}}),Qc=ln({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=$e(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=jt.runKernelFunc(function(t){return t.topk(r,e,n)},{$x:r});return{values:o[0],indices:o[1]}}}),$c=ln({scatterND_:function(t,e,n){var r=$e(t,"indices","scatterND","int32"),i=$e(e,"updates","scatterND");return Tr(i,r,n),jt.runKernelFunc(function(t){return t.scatterND(r,i,n)},{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),Jc=ln({fft_:function(t){C("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return jt.runKernelFunc(function(t){return t.fft(r)},{input:t}).reshape(t.shape)}}),Zc=ln({ifft_:function(t){C("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return jt.runKernelFunc(function(t){return t.ifft(r)},{input:t}).reshape(t.shape)}}),tl=ln({rfft_:function(t,e){C("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],i=t.size/r;if(null!=e&&e<r){var o=t.shape.map(function(t){return 0}),a=t.shape.map(function(t){return t});a[t.shape.length-1]=e,n=t.slice(o,a),r=e}else if(null!=e&&e>r){var u=t.shape.map(function(t){return t});u[t.shape.length-1]=e-r,n=t.concat(kn(u),t.shape.length-1),r=e}else n=t;var s=n.zerosLike(),c=fn(n,s).as2D(i,r),l=Jc(c),f=Math.floor(r/2)+1,h=hn(l),d=dn(l),p=h.split([f,r-f],h.shape.length-1),v=d.split([f,r-f],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,fn(p[0],v[0]).reshape(m)}}),el=ln({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),i=Zc(r);return hn(i)}var o=[n,2*(e-1)],a=hn(t).as2D(n,e),u=dn(t).as2D(n,e),s=a.slice([0,1],[n,e-2]).reverse(1),c=u.slice([0,1],[n,e-2]).reverse(1).mul(mn(-1)),l=a.concat(s,1),f=u.concat(c,1);return r=fn(l,f).as2D(o[0],o[1]),i=Zc(r),hn(i)}}),nl=Object.freeze({fft:Jc,ifft:Zc,rfft:tl,irfft:el}),rl=ln({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var i=$e(t,"sparseIndices","sparseToDense","int32"),o=$e(e,"sparseValues","sparseToDense"),a=$e(r,"defaultValue","sparseToDense",o.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var i=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+o+".");var a=e.size;if(0!==e.rank&&(1!==e.rank||a!==i))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+i+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,n,a),jt.runKernelFunc(function(t){return t.sparseToDense(i,o,n,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),il=ln({gatherND_:function(t,e){var n=$e(e,"indices","gatherND","int32"),r=$e(t,"x","gatherND");return jt.runKernelFunc(function(t){return t.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),ol=ln({diag_:function(t){var e=$e(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return jt.runKernelFunc(function(t){return t.diag(e)},{$x:e}).reshape(n)}}),al=ln({dropout_:function(t,e,n,r){var i=$e(t,"x","dropout");if(C("float32"===i.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),C(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return t instanceof xt?i.clone():i;var o=function(t,e){if(null==e)return t.shape.slice();if(I(t.shape,e))return e;if(t.shape.length===e.length){for(var n=[],r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(i,n),a=1-e,u=lr(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(u)}});function ul(t,e,n){for(var r=1-t%2,i=new Float32Array(t),o=0;o<t;++o){var a=2*Math.PI*o/(t+r-1);i[o]=e-n*Math.cos(a)}return gn(i,"float32")}var sl,cl=ln({hannWindow_:function(t){return ul(t,.5,.5)}}),ll=ln({hammingWindow_:function(t){return ul(t,.54,.46)}}),fl=ln({frame_:function(t,e,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var o=0,a=[];o+e<=t.size;)a.push(wc(t,o,e)),o+=n;if(r)for(;o<t.size;){var u=o+e-t.size,s=Tn([wc(t,o,e-u),En([u],i)]);a.push(s),o+=n}return 0===a.length?yn([],[0,e]):Tn(a).as2D(a.length,e)}}),hl=ln({stft_:function(t,e,n,r,i){var o;void 0===i&&(i=cl),null==r&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=fl(t,e,n),u=ks(a,i(e)),s=[],c=0;c<a.shape[0];c++)s.push(tl(u.slice([c,0],[1,e]),r));return Tn(s)}}),dl=Object.freeze({hannWindow:cl,hammingWindow:ll,frame:fl,stft:hl});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(sl||(sl={}));var pl=ln({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=sl.SUM_BY_NONZERO_WEIGHTS);var i=$e(t,"labels","absoluteDifference"),o=$e(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=$e(n,"weights","absoluteDifference")),_(i.shape,o.shape,"Error in absoluteDifference: ");var u=i.sub(o).abs();return vl(u,a,r)}}),vl=ln({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=sl.SUM_BY_NONZERO_WEIGHTS);var r=$e(t,"losses","computeWeightedLoss"),i=null;null!=e&&(i=$e(e,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(n===sl.NONE)return o;if(n===sl.SUM)return o.sum();if(n===sl.MEAN){if(null==i)return o.mean();var a=r.size/i.size,u=o.sum().div(i.sum());return a>1?u.div(mn(a)):u}if(n===sl.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(mn(r.size));var s=i.mul(xn(r.shape)).notEqual(mn(0)).sum().toFloat();return o.sum().div(s)}throw Error("Unknown reduction: "+n)}}),ml=ln({cosineDistance_:function(t,e,n,r,i){void 0===i&&(i=sl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"labels","cosineDistance"),a=$e(e,"predictions","cosineDistance"),u=null;null!=r&&(u=$e(r,"weights","cosineDistance")),_(o.shape,a.shape,"Error in cosineDistance: ");var s=mn(1).sub(o.mul(a).sum(n,!0));return vl(s,u,i)}}),gl=ln({hingeLoss_:function(t,e,n,r){void 0===r&&(r=sl.SUM_BY_NONZERO_WEIGHTS);var i=$e(t,"labels","hingeLoss"),o=$e(e,"predictions","hingeLoss"),a=null;null!=n&&(a=$e(n,"weights","hingeLoss")),_(i.shape,o.shape,"Error in hingeLoss: ");var u=mn(1);i=mn(2).mul(i).sub(u);var s=u.sub(i.mul(o)).relu();return vl(s,a,r)}}),yl=ln({huberLoss_:function(t,e,n,r,i){void 0===r&&(r=1),void 0===i&&(i=sl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"labels","huberLoss"),a=$e(e,"predictions","huberLoss"),u=null;null!=n&&(u=$e(n,"weights","huberLoss")),_(o.shape,a.shape,"Error in huberLoss: ");var s=mn(r),c=a.sub(o).abs(),l=ys(c,s),f=c.sub(l),h=mn(.5).mul(l.square()).add(s.mul(f));return vl(h,u,i)}}),bl=ln({logLoss_:function(t,e,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=sl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"labels","logLoss"),a=$e(e,"predictions","logLoss"),u=null;null!=n&&(u=$e(n,"weights","logLoss")),_(o.shape,a.shape,"Error in logLoss: ");var s=mn(1),c=mn(r),l=o.mul(a.add(c).log()).neg().sub(s.sub(o).mul(s.sub(a).add(c).log()));return vl(l,u,i)}}),wl=ln({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=sl.SUM_BY_NONZERO_WEIGHTS);var i=$e(t,"labels","meanSquaredError"),o=$e(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=$e(n,"weights","meanSquaredError")),_(i.shape,o.shape,"Error in meanSquaredError: ");var u=i.squaredDifference(o);return vl(u,a,r)}}),xl=ln({sigmoidCrossEntropy_:function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=sl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"multiClassLabels","sigmoidCrossEntropy"),a=$e(e,"logits","sigmoidCrossEntropy"),u=null;if(null!=n&&(u=$e(n,"weights","sigmoidCrossEntropy")),_(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var s=mn(r),c=mn(1),l=mn(.5);o=o.mul(c.sub(s)).add(l.mul(s))}var f=function(t,e){var n=$e(t,"labels","sigmoidCrossEntropyWithLogits"),r=$e(e,"logits","sigmoidCrossEntropyWithLogits");_(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),o=r.mul(n),a=r.abs().neg().exp().log1p();return i.sub(o).add(a)}(o,a);return vl(f,u,i)}}),kl=ln({softmaxCrossEntropy_:function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=sl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"onehotLabels","softmaxCrossEntropy"),a=$e(e,"logits","softmaxCrossEntropy"),u=null;if(null!=n&&(u=$e(n,"weights","softmaxCrossEntropy")),_(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var s=mn(r),c=mn(1),l=mn(o.shape[1]);o=o.mul(c.sub(s)).add(s.div(l))}var f=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return Fr(function(t,e,r){var i=e.logSumExp([n],!0),o=e.toFloat().sub(i);return r([t,o]),{value:o.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],i=e[1],o=nn(t.shape,[n]);return[t.reshape(o).mul(r.toFloat().sub(i.exp())),t.reshape(o).mul(i.exp().sub(r.toFloat()))]}}})(t,e)}(o,a);return vl(f,u,i)}}),El=Object.freeze({get Reduction(){return sl},absoluteDifference:pl,computeWeightedLoss:vl,cosineDistance:ml,hingeLoss:gl,huberLoss:yl,logLoss:bl,meanSquaredError:wl,sigmoidCrossEntropy:xl,softmaxCrossEntropy:kl});function Cl(t,e){return void 0===e&&(e=!1),jt.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],i=Zn(n),o=t.clone(),a=yn([[1]],[1,1]),u=a.clone(),s=n>=r?r:n,c=function(t){var e,s=o,c=u,l=i;e=jt.tidy(function(){var e=o.slice([t,t],[n-t,1]),s=e.norm(),c=o.slice([t,t],[1,1]),l=yn([[-1]]).where(c.greater(0),yn([[1]])),f=c.sub(l.mul(s)),h=e.div(f);u=1===h.shape[0]?a.clone():a.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var d=l.matMul(f).div(s).neg(),p=o.slice([t,0],[n-t,r]),v=d.mul(u);if(0===t)o=p.sub(v.matMul(u.transpose().matMul(p)));else{var m=p.sub(v.matMul(u.transpose().matMul(p)));o=o.slice([0,0],[t,r]).concat(m,0)}var g=i.slice([0,t],[n,i.shape[1]-t]);if(0===t)i=g.sub(g.matMul(u).matMul(v.transpose()));else{var y=g.sub(g.matMul(u).matMul(v.transpose()));i=i.slice([0,0],[n,t]).concat(y,1)}return[u,o,i]}),u=e[0],o=e[1],i=e[2],Ke([s,c,l])},l=0;l<s;++l)c(l);return!e&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]})}var _l=ln({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=$e(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],u=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(n<=u))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+u+").");e<0&&(e=a),n<0&&(n=u);var s=Cn(0,a,1,"int32").reshape([-1,1]),c=Cn(0,u,1,"int32"),l=Ts(s,c),f=ns(l.lessEqual(mn(+e,"int32")),l.greaterEqual(mn(-n,"int32"))),h=kn([a,u],r.dtype);return pr(gr(r.reshape([-1,a,u])).map(function(t){return as(f,t,h)})).reshape(i)}}),Sl=ln({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,C(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(e){C(t[e].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"})},i=1;i<t.length;++i)r(i)}else e=!0,t=Dn(t,t.shape[0],0).map(function(t){return dr(t,[0])});C(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var o=[],a=t,u=function(t){o.push(jt.tidy(function(){var e=a[t];if(t>0)for(var n=0;n<t;++n){var r=Mc(o[n].mulStrict(e)).mul(o[n]);e=e.sub(r)}return e.div(Hc(e,"euclidean"))}))};for(i=0;i<t.length;++i)u(i);return e?pr(o,0):o}}),Tl=ln({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return Cl(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=gr(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];return r.forEach(function(t){var n=Cl(t,e),r=n[0],a=n[1];i.push(r),o.push(a)}),[pr(i,0).reshape(t.shape),pr(o,0).reshape(t.shape)]}}),Ol=Object.freeze({bandPart:_l,gramSchmidt:Sl,qr:Tl});function Il(t,e,n,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var a=t.shape[0];return n=Math.min(n,a),C(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),C(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),C(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),C(1===e.rank,function(){return"scores must be a 1D tensor"}),C(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),C(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var Rl=ln({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=$e(t,"images","resizeBilinear");C(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),C(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],u=e[1],s=jt.runKernelFunc(function(t,e){return e([i]),t.resizeBilinear(i,a,u,n)},{x:i},function(t,e){return{x:function(){return jt.runKernelFunc(function(r){return r.resizeBilinearBackprop(t,e[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:u});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),Al=ln({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=$e(t,"images","resizeNearestNeighbor");C(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),C(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),C("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],u=e[1],s=jt.runKernelFunc(function(t,e){return e([i]),t.resizeNearestNeighbor(i,a,u,n)},{batchImages:i},function(t,e){return{batchImages:function(){return jt.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)},{})}}});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),Dl=ln({nonMaxSuppression_:function(t,e,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=$e(t,"boxes","nonMaxSuppression"),a=$e(e,"scores","nonMaxSuppression"),u=Il(o,a,n,r,i);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold;var s={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return jt.runKernelFunc(function(t){return t.nonMaxSuppression(o,a,n,r,i)},{boxes:o,scores:a},null,"NonMaxSuppressionV3",s)}}),Nl=ln({nonMaxSuppressionWithScore_:function(t,e,n,r,i,o){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var a=$e(t,"boxes","nonMaxSuppression"),u=$e(e,"scores","nonMaxSuppression"),s=Il(a,u,n,r,i,o),c={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:i=s.scoreThreshold,softNmsSigma:o=s.softNmsSigma},l=jt.runKernel("NonMaxSuppressionV5",{boxes:a,scores:u},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Pl=ln({cropAndResize_:function(t,e,n,r,i,o){var a=$e(t,"image","cropAndResize"),u=$e(e,"boxes","cropAndResize","float32"),s=$e(n,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=u.shape[0];return C(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),C(2===u.rank&&4===u.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+u.shape+"."}),C(1===s.rank&&s.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+u.shape+"."}),C(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),C(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),C("bilinear"===i||"nearest"===i,function(){return"method must be bilinear or nearest, but was "+i}),jt.runKernelFunc(function(t,e){return t.cropAndResize(a,u,s,r,i,o)},{images:a,boxes:u,boxInd:s},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),Ml=Object.freeze({resizeBilinear:Rl,resizeNearestNeighbor:Al,nonMaxSuppression:Dl,nonMaxSuppressionAsync:function(t,e,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),s(this,void 0,void 0,function(){var o,a,u,s,l,f,h;return c(this,function(c){switch(c.label){case 0:return o=$e(t,"boxes","nonMaxSuppressionAsync"),a=$e(e,"scores","nonMaxSuppressionAsync"),u=Il(o,a,n,r,i),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return s=c.sent(),l=s[0],f=s[1],h=hi(l,f,n,r,i),o!==t&&o.dispose(),a!==e&&a.dispose(),[2,h]}})})},nonMaxSuppressionWithScore:Nl,nonMaxSuppressionWithScoreAsync:function(t,e,n,r,i,o){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),s(this,void 0,void 0,function(){var a,u,s,l,f,h,d;return c(this,function(c){switch(c.label){case 0:return a=$e(t,"boxes","nonMaxSuppressionAsync"),u=$e(e,"scores","nonMaxSuppressionAsync"),s=Il(a,u,n,r,i,o),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,o=s.softNmsSigma,[4,Promise.all([a.data(),u.data()])];case 1:return l=c.sent(),f=l[0],h=l[1],d=di(f,h,n,r,i,o),a!==t&&a.dispose(),u!==e&&u.dispose(),[2,d]}})})},cropAndResize:Pl}),Fl=function(t,e){return!(t>0)||"linear"===e},Ll=function(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},jl=function(t,e){var n=e,r=Wr(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},Bl=function(t,e,n){if("linear"===e)return t;if("relu"===e)return Vc(t);if("elu"===e)return Lc(t);if("relu6"===e)return Uc(t);if("prelu"===e)return Bc(t,n);throw new Error("Unknown fused activation "+e+".")},Vl=ln({fusedMatMul_:function(t){var e,n=t.a,r=t.b,i=t.transposeA,o=void 0!==i&&i,a=t.transposeB,u=void 0!==a&&a,s=t.bias,c=t.activation,l=void 0===c?"linear":c,f=t.preluActivationWeights;if(!1===Fl(jt.state.gradientDepth,l)){var h=oc(n,r,o,u);return null!=s&&(h=ss(h,s)),Bl(h,l,f)}var d=$e(n,"a","fused matMul"),p=$e(r,"b","fused matMul");e=Dt(d,p),d=e[0],p=e[1];var v=o?d.shape[d.rank-2]:d.shape[d.rank-1],m=u?p.shape[p.rank-1]:p.shape[p.rank-2],g=o?d.shape[d.rank-1]:d.shape[d.rank-2],y=u?p.shape[p.rank-2]:p.shape[p.rank-1],b=d.shape.slice(0,-2),w=p.shape.slice(0,-2),x=O(b),k=O(w);C(d.rank>=2&&p.rank>=2&&d.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."}),C(I(b,w),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+w+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."}),C(v===m,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+u+" must match."});var E,_,S=d.shape.slice(0,-2).concat([g,y]),T=o?d.as3D(x,v,g):d.as3D(x,g,v),R=u?p.as3D(k,y,m):p.as3D(k,m,y);null!=s&&Gr(S,(E=Dt(E=$e(s,"bias","fused matMul"),d)[0]).shape),null!=f&&(_=$e(f,"prelu weights","fused matMul"));var A={a:T,b:R};null!=s&&(A.bias=E),null!=f&&(A.preluActivationWeights=_);var D=[T,R];return jt.runKernelFunc(function(t,e){var n=t.fusedBatchMatMul({a:T,b:R,transposeA:o,transposeB:u,bias:E,activation:l,preluActivationWeights:_});return e([T,R,n]),n},A,function(t,e){var n=e[0],r=e[1],i=e[2],a=Ll(t,i,l),c={};return null!=s&&(c={bias:function(){return jl(E,a)}}),o||u?!o&&u?Object.assign({a:function(){return a.matMul(r,!1,!1)},b:function(){return a.matMul(n,!0,!1)}},c):o&&!u?Object.assign({a:function(){return r.matMul(a,!1,!0)},b:function(){return n.matMul(a,!1,!1)}},c):Object.assign({a:function(){return r.matMul(a,!0,!0)},b:function(){return a.matMul(n,!0,!0)}},c):Object.assign({a:function(){return a.matMul(r,!1,!0)},b:function(){return n.matMul(a,!0,!1)}},c)},"_FusedMatMul",{transposeA:o,transposeB:u,activation:l},D,[!0]).reshape(S)}}),Ul=ln({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,a=void 0===o?"NHWC":o,u=t.dilations,s=void 0===u?[1,1]:u,c=t.dimRoundingMode,l=t.bias,f=t.activation,h=void 0===f?"linear":f,d=t.preluActivationWeights;if(h=h||"linear",!1===Fl(jt.state.gradientDepth,h)){var p=Ys(e,n,r,i,a,s,c);return null!=l&&(p=ss(p,l)),Bl(p,h,d)}var v=$e(e,"x","conv2d"),m=$e(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),C(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),C(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=c&&C(R(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."}),C(g.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),C(ei(r,s),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+s+"'"}),C("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var b,w,x=Kr(g.shape,m.shape,r,s,i,c);null!=l&&(b=Dt(b=$e(l,"bias","fused conv2d"),v)[0],Gr(x.outShape,b.shape)),null!=d&&(w=$e(d,"prelu weights","fused conv2d"));var k={x:g,filter:m};null!=l&&(k.bias=b),null!=d&&(k.preluActivationWeights=w);var E=[m,g],_=jt.runKernelFunc(function(t,e){var n=t.fusedConv2d({input:g,filter:m,convInfo:x,bias:b,activation:h,preluActivationWeights:w});return e([m,g,n]),n},k,function(t,e){var n=e,o=n[0],a=n[1],u=n[2],c=Ll(t,u,h);C(ti(s),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"});var f={};return null!=l&&(f={bias:function(){return jl(b,c)}}),Object.assign({x:function(){return Js(a.shape,c,o,r,i)},filter:function(){return $s(a,c,o.shape,r,i)}},f)},"FusedConv2D",{convInfo:x,activation:h},E,[!0]);return y?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),zl=ln({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,a=void 0===o?"NHWC":o,u=t.dilations,s=void 0===u?[1,1]:u,c=t.dimRoundingMode,l=t.bias,f=t.activation,h=void 0===f?"linear":f,d=t.preluActivationWeights;if(!1===Fl(jt.state.gradientDepth,h)){var p=Zs(e,n,r,i,a,s,c);return null!=l&&(p=ss(p,l)),Bl(p,h,d)}var v=$e(e,"x","depthwiseConv2d"),m=$e(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),C(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),C(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),C(g.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==s&&(s=[1,1]),C(ei(r,s),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+s+"'"}),null!=c&&C(R(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."});var b,w,x=Kr(g.shape,m.shape,r,s,i,c,!0);null!=l&&(b=Dt(b=$e(l,"bias","fused conv2d"),v)[0],Gr(x.outShape,b.shape)),null!=d&&(w=$e(d,"prelu weights","fused depthwiseConv2d"));var k={x:g,filter:m};null!=l&&(k.bias=b),null!=d&&(k.preluActivationWeights=w);var E=[m,g],_=jt.runKernelFunc(function(t,e){var n=t.fusedDepthwiseConv2D({input:g,filter:m,convInfo:x,bias:b,activation:h,preluActivationWeights:w});return e([m,g,n]),n},k,function(t,e){C(ti(s),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"});var n=e[0],r=e[1],i=e[2],o=Ll(t,i,h),a={};return null!=l&&(a={bias:function(){return jl(b,o)}}),Object.assign({x:function(){return tc(r.shape,o,n,x)},filter:function(){return ec(r,o,n.shape,x)}},a)},"FusedDepthwiseConv2D",{convInfo:x,activation:h},E,[!0]);return y?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),Wl=Object.freeze({matMul:Vl,conv2d:Ul,depthwiseConv2d:zl}),Gl=Object.freeze({image:Ml,linalg:Ol,losses:El,spectral:nl,fused:Wl,signal:dl,square:ou,squaredDifference:uu,conv1d:Xs,conv2d:Ys,conv3d:Qs,depthwiseConv2d:Zs,separableConv2d:nc,conv2dTranspose:rc,conv3dTranspose:ic,op:ln,batchNormalization2d:Xu,batchNormalization3d:Yu,batchNormalization4d:Qu,batchNormalization:$u,batchNorm:Ju,batchNorm2d:Zu,batchNorm3d:ts,batchNorm4d:es,booleanMaskAsync:function(t,e,n){return s(this,void 0,void 0,function(){var r,i,o,a,u,s,l,f,h,d,p,v,m;return c(this,function(c){switch(c.label){case 0:for(r=$e(t,"tensor","boolMask"),i=$e(e,"mask","boolMask","bool"),o=null==n?0:n,a=i.rank,u=r.shape,C(a>0,function(){return"mask cannot be scalar"}),_(u.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),s=1,l=o;l<o+a;l++)s*=u[l];return f=u.slice(0,o).concat([s],u.slice(o+a)),h=r.reshape(f),d=i.reshape([-1]),[4,us(d)];case 1:return p=c.sent(),v=p.squeeze([1]),m=Ws(h,v,o),t!==r&&r.dispose(),e!==i&&i.dispose(),v.dispose(),h.dispose(),d.dispose(),p.dispose(),[2,m]}})})},complex:fn,real:hn,imag:dn,concat:Tn,concat1d:On,concat2d:In,concat3d:Rn,concat4d:An,split:Dn,matMul:oc,dot:ac,outerProduct:uc,reverse:sc,reverse1d:cc,reverse2d:lc,reverse3d:fc,reverse4d:hc,maxPool:vc,avgPool:mc,pool:gc,maxPool3d:yc,avgPool3d:bc,slice:wc,slice1d:xc,slice2d:kc,slice3d:Ec,slice4d:Cc,abs:su,acos:cu,acosh:lu,asin:fu,asinh:hu,atan:du,atanh:pu,ceil:vu,clipByValue:mu,cos:gu,cosh:yu,erf:bu,exp:wu,expm1:xu,floor:ku,log:Eu,log1p:Cu,logSigmoid:_u,neg:Su,reciprocal:Tu,round:Ou,rsqrt:Iu,sigmoid:Ru,sign:Au,isNaN:Du,isInf:Nu,isFinite:Pu,sin:Mu,sinh:Fu,softplus:Lu,sqrt:ju,step:Bu,tan:Vu,tanh:Uu,all:Sc,any:Tc,argMax:Oc,argMin:Ic,logSumExp:Rc,max:Ac,mean:Dc,min:Nc,moments:Pc,sum:Mc,prod:Fc,equal:Is,equalStrict:Rs,greater:As,greaterEqual:Ds,greaterEqualStrict:Ns,greaterStrict:Ps,less:Ms,lessEqual:Fs,lessEqualStrict:Ls,lessStrict:js,notEqual:Bs,notEqualStrict:Vs,add:ss,addN:cs,addStrict:ls,atan2:fs,div:hs,divNoNan:ds,divStrict:ps,floorDiv:vs,maximum:ms,maximumStrict:gs,minimum:ys,minimumStrict:bs,mod:ws,modStrict:xs,mul:ks,mulStrict:Es,pow:Cs,powStrict:_s,squaredDifferenceStrict:Ss,sub:Ts,subStrict:Os,elu:Lc,leakyRelu:jc,prelu:Bc,relu:Vc,relu6:Uc,selu:zc,logicalAnd:ns,logicalNot:rs,logicalOr:is,logicalXor:os,where:as,whereAsync:us,buffer:Hn,print:function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},batchToSpaceND:qn,broadcastTo:Kn,cast:Xn,clone:Yn,cumsum:Qn,depthToSpace:$n,expandDims:Jn,eye:Zn,multinomial:tr,oneHot:er,pad:nr,pad1d:rr,pad2d:ir,pad3d:or,pad4d:ar,rand:ur,randomNormal:sr,randomGamma:cr,randomUniform:lr,reshape:fr,spaceToBatchND:hr,squeeze:dr,stack:pr,tile:vr,truncatedNormal:mr,unstack:gr,setdiff1dAsync:function(t,e){return s(this,void 0,void 0,function(){var n,r,i,o,a,u,s,l,f,h;return c(this,function(c){switch(c.label){case 0:return n=$e(t,"x","setdiff1d"),r=$e(e,"y","setdiff1d"),C(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),C(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),C(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return i=c.sent(),[4,r.data()];case 2:for(o=c.sent(),a=new Set(o),u=0,f=0;f<i.length;f++)a.has(i[f])||u++;for(s=new gt([u],n.dtype),l=new gt([u],"int32"),f=0,h=0;f<i.length;f++)a.has(i[f])||(s.values[h]=i[f],l.values[h]=f,h++);return[2,[s.toTensor(),l.toTensor()]]}})})},fill:En,linspace:function(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return jt.runKernelFunc(function(r){return r.linspace(t,e,n)},{})},ones:xn,range:Cn,scalar:mn,tensor:pn,tensor1d:gn,tensor2d:yn,tensor3d:bn,tensor4d:wn,tensor5d:function(t,e,n){if(S(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Ye(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return vn(t,e,r,n)},tensor6d:function(t,e,n){if(S(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Ye(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return vn(t,e=e||r,r,n)},variable:function(t,e,n,r){return void 0===e&&(e=!0),jt.makeVariable(t,e,n,r)},zeros:kn,onesLike:_n,zerosLike:Sn,transpose:Wc,softmax:Lr,logSoftmax:jr,localResponseNormalization:Gc,norm:Hc,gather:Ws,unsortedSegmentSum:Gs,basicLSTMCell:qc,multiRNNCell:Kc,movingAverage:Xc,stridedSlice:Yc,topk:Qc,scatterND:$c,fft:Jc,ifft:Zc,rfft:tl,irfft:el,sparseToDense:rl,gatherND:il,diag:ol,dropout:al,hannWindow:cl,hammingWindow:ll,frame:fl,stft:hl,inTopKAsync:function(t,e,n){return void 0===n&&(n=1),s(this,void 0,void 0,function(){var r,i,o,a,u,s,l,f,h,d,p,v,m,g;return c(this,function(c){switch(c.label){case 0:return r=$e(t,"predictions","inTopK"),i=$e(e,"targets","inTopK"),C(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),C(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),_(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],C(n>0&&n<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+n}),[4,r.data()];case 1:return a=c.sent(),[4,i.data()];case 2:for(u=c.sent(),s=[a.length/o,o],f=s[1],h=j("bool",l=s[0]),d=0;d<l;d++){for(p=d*f,v=a.subarray(p,p+f),m=[],g=0;g<v.length;g++)m.push({value:v[g],index:g});for(m.sort(function(t,e){return e.value-t.value}),h[d]=0,g=0;g<n;g++)if(m[g].index===u[d]){h[d]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),[2,pn(h,i.shape,"bool")]}})})}});function Hl(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&C("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})}function ql(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("elu"===n)return t.elu(e);if("relu6"===n)return t.relu6(e);if("prelu"===n)return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Kl=function(t){function e(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new Br(e,jt),e}return u(e,t),e.prototype.write=function(t,e,n){this.firstUse&&(this.firstUse=!1,f().get("IS_NODE")&&Xe("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:t,dtype:n}),r},e.prototype.move=function(t,e,n,r){this.data.set(t,{values:e,dtype:r})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var e=this.data.get(t),n=e.dtype,r=e.complexTensors;return"complex64"===n?ai(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map(function(t){return at(t)})}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Hn(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,e,n){var r=this.write(t,e,n);return jt.makeTensorFromDataId(r,e,n,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(n){return e=rt(),t(),[2,{kernelMs:rt()-e}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var n=this.makeOutput(null,t.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:jt.keep(t.clone()),imag:jt.keep(e.clone())},n},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(Hl(t,"slice"),Pr(t.shape,e,n)){var r=Mr(e,t.strides),i=O(n);return pn(this.readSync(t.dataId).subarray(r,r+i),n,t.dtype)}for(var o=Hn(n,t.dtype),a=this.bufferSync(t),u=0;u<o.size;++u){var s=o.indexToLoc(u).map(function(t,n){return t+e[n]});o.values[u]=a.get.apply(a,s)}return o.toTensor()},e.prototype.stridedSlice=function(t,e,n,r){Hl(t,"stridedSlice");var i=Ar(e,n,r);if(i.some(function(t){return 0===t}))return pn([],i);for(var o=Hn(i,t.dtype),a=this.bufferSync(t),u=0;u<o.size;u++){for(var s=o.indexToLoc(u),c=new Array(s.length),l=0;l<c.length;l++)c[l]=s[l]*r[l]+e[l];o.set.apply(o,[a.get.apply(a,c)].concat(s))}return o.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),n=Hn([t.size,t.size],t.dtype),r=n.values,i=0;i<e.length;i++)r[i*t.size+i]=e[i];return n.toTensor()},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),i=0,o=0;o<t.rank;o++)o!==e&&(r[i++]=t.shape[o]);var a=new Array(t.rank).fill(0),u=t.shape.slice();u[e]=1;var s=new Array(n);for(o=0;o<s.length;o++)a[e]=o,s[o]=this.slice(t,a,u).reshape(r);return s},e.prototype.reverse=function(t,e){Hl(t,"reverse");for(var n=Hn(t.shape,t.dtype),r=this.bufferSync(t),i=function(i){var o=n.indexToLoc(i),a=o.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(o))},o=0;o<n.size;o++)i(o);return n.toTensor()},e.prototype.concat=function(t,e){var n=this;if("complex64"===t[0].dtype){var r=t.map(function(t){return hn(t)}),i=t.map(function(t){return dn(t)});return fn(this.concat(r,e),this.concat(i,e))}var o=t.map(function(t){var n=O(t.shape.slice(e));return t.as2D(-1,n)}),a=cn(o.map(function(t){return t.shape}),1),u=Hn(a,t[0].dtype).values;if(1===o[0].shape[0]){var s=0;o.forEach(function(t){u.set(n.readSync(t.dataId),s),s+=t.size})}else{var c=0;o.forEach(function(t){for(var e=n.readSync(t.dataId),r=0,i=0;i<t.shape[0];++i)for(var o=i*a[1]+c,s=0;s<t.shape[1];++s)u[o+s]=e[r++];c+=t.shape[1]})}var l=cn(t.map(function(t){return t.shape}),e);return pn(u,l,t[0].dtype)},e.prototype.neg=function(t){return Hl(t,"neg"),this.multiply(mn(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,Rt(t.dtype,e.dtype),function(t,e){return t+e})},e.prototype.addN=function(t){var e=this;Hl(t,"addN");for(var n=t.map(function(t){return e.readSync(t.dataId)}),r=Hn(t[0].shape,t[0].dtype),i=r.values,o=0;o<t.length;o++)for(var a=n[o],u=0;u<i.length;u++)i[u]+=a[u];return r.toTensor()},e.prototype.softmax=function(t,e){var n=F([e],t.shape),r=this.max(t,n),i=nn(r.shape,n),o=this.subtract(t,r.reshape(i)),a=this.exp(o),u=this.sum(a,n).reshape(i);return this.realDivide(a,u)},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,Rt(t.dtype,e.dtype),function(t,e){return t-e})},e.prototype.pow=function(t,e){return Hl([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},e.prototype.batchMatMul=function(t,e,n,r){Hl([t,e],"matMul");for(var i=n?t.shape[1]:t.shape[2],o=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],u=t.shape[0],s=this.readSync(t.dataId),c=this.readSync(e.dataId),l=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=l[0],h=l[1],d=l[2],p=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],v=p[0],m=p[1],g=p[2],y=o*a,b=Hn([u,o,a],t.dtype),w=b.values,x=this.blockSize,k=0;k<u;k++)for(var E=0;E<o;E+=x)for(var C=0;C<a;C+=x)for(var _=0;_<i;_+=x)for(var S=Math.min(E+x,o),T=Math.min(C+x,a),O=Math.min(_+x,i),I=E;I<S;I++)for(var R=C;R<T;R++){for(var A=0,D=_;D<O;D++)A+=s[k*f+I*h+D*d]*c[D*v+R*m+k*g];w[k*y+(I*a+R)]+=A}return b.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,i=t.transposeB,o=t.bias,a=t.activation,u=t.preluActivationWeights,s=this.batchMatMul(e,n,r,i);return o&&(s=this.add(s,o)),a&&(s=ql(this,s,a,u)),s},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,Rt(t.dtype,e.dtype),function(t,e){return t*e})},e.prototype.realDivide=function(t,e){return Hl([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},e.prototype.floorDiv=function(t,e){return Hl([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},e.prototype.sum=function(t,e){Hl(t,"sum"),rn("sum",e,t.rank);for(var n=en(t.shape,e),r=n[0],i=n[1],o=kn(r,Rt(t.dtype,"int32")),a=O(i),u=this.readSync(o.dataId),s=this.readSync(t.dataId),c=0;c<u.length;++c){for(var l=c*a,f=0,h=0;h<a;++h)f+=s[l+h];u[c]=f}return o},e.prototype.prod=function(t,e){Hl(t,"sum");for(var n=en(t.shape,e),r=n[0],i=n[1],o=kn(r,Rt(t.dtype,"int32")),a=O(i),u=this.readSync(o.dataId),s=this.readSync(t.dataId),c=0;c<u.length;++c){for(var l=c*a,f=1,h=0;h<a;++h)f*=s[l+h];u[c]=f}return o},e.prototype.unsortedSegmentSum=function(t,e,n){Hl(t,"unsortedSegmentSum");for(var r=[],i=t.rank-e.rank,o=0;o<i;++o)e=e.expandDims(o+1);for(o=0;o<n;++o){var a=mn(o,"int32"),u=Is(a,e).asType("float32").mul(t).sum(0);r.push(u)}return pr(r)},e.prototype.argMin=function(t,e){Hl(t,"argMin");var n=[e];rn("argMin",n,t.rank);for(var r=en(t.shape,n),i=r[0],o=r[1],a=kn(i,"int32"),u=O(o),s=this.readSync(a.dataId),c=this.readSync(t.dataId),l=0;l<s.length;++l){for(var f=l*u,h=c[f],d=0,p=0;p<u;++p){var v=c[f+p];v<h&&(h=v,d=p)}s[l]=d}return a},e.prototype.argMax=function(t,e){Hl(t,"argMax");var n=[e];rn("argMax",n,t.rank);for(var r=en(t.shape,n),i=r[0],o=r[1],a=kn(i,"int32"),u=O(o),s=this.readSync(a.dataId),c=this.readSync(t.dataId),l=0;l<s.length;++l){for(var f=l*u,h=c[f],d=0,p=0;p<u;++p){var v=c[f+p];v>h&&(h=v,d=p)}s[l]=d}return a},e.prototype.cumsum=function(t,e,n,r){if(Hl(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var i=Rt(t.dtype,"int32"),o=kn(t.shape,i),a=this.readSync(o.dataId),u=this.readSync(t.dataId),s=t.shape[t.rank-1],c=r?function(t,e){return t+s-e-1}:function(t,e){return t+e},l=0;l<u.length;l+=s)for(var f=0;f<s;f++){var h=c(l,f);if(0===f)a[h]=n?0:u[h];else{var d=c(l,f-1);a[h]=n?u[d]+a[d]:u[h]+a[d]}}return o},e.prototype.equal=function(t,e){return Hl([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},e.prototype.notEqual=function(t,e){return Hl([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},e.prototype.less=function(t,e){return Hl([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},e.prototype.lessEqual=function(t,e){return Hl([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},e.prototype.greater=function(t,e){return Hl([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},e.prototype.greaterEqual=function(t,e){return Hl([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},e.prototype.logicalNot=function(t){Hl(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return this.makeOutput(n,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return Hl([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},e.prototype.logicalOr=function(t,e){return Hl([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},e.prototype.select=function(t,e,n){Hl([t,e,n],"select");for(var r=this.readSync(t.dataId),i=this.readSync(e.dataId),o=this.readSync(n.dataId),a=kn(e.shape,Rt(e.dtype,n.dtype)),u=this.readSync(a.dataId),s=0,c=0===t.rank||t.rank>1||1===e.rank?1:O(e.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<c;f++)1===r[l]?u[s++]=i[l]:u[s++]=o[l];return a},e.prototype.where=function(t){Hl([t],"where");var e=this.readSync(t.dataId);return xi(t.shape,e)},e.prototype.topk=function(t,e,n){return Hl(t,"topk"),wi(this.readSync(t.dataId),t.shape,t.dtype,e)},e.prototype.min=function(t,e){Hl(t,"min"),rn("min",e,t.rank);for(var n=en(t.shape,e),r=n[0],i=n[1],o=kn(r,t.dtype),a=O(i),u=this.readSync(o.dataId),s=this.readSync(t.dataId),c=0;c<u.length;++c){for(var l=c*a,f=s[l],h=0;h<a;++h){var d=s[l+h];d<f&&(f=d)}u[c]=f}return o},e.prototype.minimum=function(t,e){return Hl([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},e.prototype.mod=function(t,e){return Hl([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},e.prototype.max=function(t,e){Hl(t,"max"),rn("max",e,t.rank);for(var n=en(t.shape,e),r=n[0],i=n[1],o=kn(r,t.dtype),a=O(i),u=this.readSync(o.dataId),s=this.readSync(t.dataId),c=0;c<u.length;++c){for(var l=c*a,f=s[l],h=0;h<a;++h){var d=s[l+h];d>f&&(f=d)}u[c]=f}return o},e.prototype.maximum=function(t,e){return Hl([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},e.prototype.all=function(t,e){Hl(t,"all"),rn("all",e,t.rank);for(var n=en(t.shape,e),r=n[0],i=n[1],o=kn(r,t.dtype),a=O(i),u=this.readSync(o.dataId),s=this.readSync(t.dataId),c=0;c<u.length;++c){for(var l=c*a,f=s[l],h=0;h<a;++h){var d=s[l+h];f=f&&d}u[c]=f}return o},e.prototype.any=function(t,e){Hl(t,"any"),rn("any",e,t.rank);for(var n=en(t.shape,e),r=n[0],i=n[1],o=kn(r,t.dtype),a=O(i),u=this.readSync(o.dataId),s=this.readSync(t.dataId),c=0;c<u.length;++c){for(var l=c*a,f=s[l],h=0;h<a;++h){var d=s[l+h];f=f||d}u[c]=f}return o},e.prototype.squaredDifference=function(t,e){return Hl([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},e.prototype.ceil=function(t){Hl(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.floor=function(t){Hl(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.sign=function(t){Hl(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)e[r]<0?n[r]=-1:e[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,t.shape,"float32")},e.prototype.isNaN=function(t){Hl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isInf=function(t){Hl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isFinite=function(t){Hl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.round=function(t){Hl(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=Math.floor(e[r]);e[r]-i<.5?n[r]=Math.floor(e[r]):e[r]-i>.5?n[r]=Math.ceil(e[r]):n[r]=i%2==0?i:i+1}return this.makeOutput(n,t.shape,"float32")},e.prototype.exp=function(t){Hl(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.expm1=function(t){Hl(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.log=function(t){Hl(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.log1p=function(t){Hl(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log1p(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.sqrt=function(t){Hl(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.sqrt(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.rsqrt=function(t){Hl(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=1/Math.sqrt(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.reciprocal=function(t){Hl(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return this.makeOutput(n,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Hl(t,"relu");for(var e=kn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return e},e.prototype.relu6=function(t){Hl(t,"relu");for(var e=kn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return e},e.prototype.prelu=function(t,e){return Hl([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},e.prototype.elu=function(t){Hl(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var i=n[r];e[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){Hl([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=this.readSync(t.dataId),o=0;o<r.length;++o){var a=r[o];n[o]=a>=1?i[o]:i[o]*(a+1)}return this.makeOutput(n,e.shape,"float32")},e.prototype.selu=function(t){Hl(t,"selu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var i=n[r];e[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(e,t.shape,"float32")},e.prototype.clip=function(t,e,n){Hl(t,"clip");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>n?n:a<e?e:a}return this.makeOutput(r,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r){var i=n[2*r],o=n[2*r+1];e[r]=Math.hypot(i,o)}return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){Hl(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){Hl(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){Hl(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),i=0;i<r.length;++i){var o,a=r[i]>-e,u=r[i]<e,s=Math.exp(r[i]);o=u?s:a?r[i]:Math.log(1+s),n[i]=o}return this.makeOutput(n,t.shape,"float32")},e.prototype.sin=function(t){Hl(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){Hl(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){Hl(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){Hl(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){Hl(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){Hl(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return Hl([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},e.prototype.sinh=function(t){Hl(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){Hl(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){Hl(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=A(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){Hl(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){Hl(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){Hl(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){Hl(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),o=Math.abs(n[r]),a=1/(1+.3275911*o);e[r]=i*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-o*o))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),Hl(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=0;i<r.length;++i){var o=r[i];isNaN(o)?n[i]=NaN:n[i]=o>0?1:e}return this.makeOutput(n,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,i=t.bias,o=t.activation,a=t.preluActivationWeights,u=this.conv2d(e,n,r);return i&&(u=this.add(u,i)),o&&(u=ql(this,u,o,a)),u},e.prototype.conv2d=function(t,e,n){Hl([t,e],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,u=n.padInfo.left,s=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Hn(n.outShape,t.dtype),f=t.strides[0],h=c?t.strides[1]:t.strides[2],d=c?t.strides[2]:1,p=c?1:t.strides[1],v=l.strides[0],m=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(t.dataId),w=this.readSync(e.dataId),x=l.values,k=0;k<n.batchSize;++k)for(var E=k*f,C=k*v,_=0;_<n.outHeight;++_)for(var S=C+_*m,T=_*n.strideHeight-s,O=0;O<r;O++){var I=T+O*o;if(!(I<0||I>=n.inHeight))for(var R=O*e.strides[0],A=E+I*h,D=0;D<n.outWidth;++D)for(var N=S+D*g,P=D*n.strideWidth-u,M=0;M<i;M++){var F=P+M*a;if(!(F<0||F>=n.inWidth))for(var L=A+F*d,j=R+M*e.strides[1],B=0;B<n.inChannels;++B){for(var V=b[L+B*p],U=0;U<n.outChannels;++U)x[N+U*y]+=V*w[j+U];j+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,i=n.filterHeight,o=n.filterWidth,a=n.dilationDepth,u=n.dilationHeight,s=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,h=Hn(n.outShape,t.dtype),d=this.readSync(t.dataId),p=this.readSync(e.dataId),v=h.values,m=0;m<n.batchSize;++m)for(var g=m*t.strides[0],y=m*h.strides[0],b=0;b<n.outDepth;++b)for(var w=y+b*h.strides[1],x=b*n.strideDepth-c,k=0;k<r;k++){var E=x+k*a;if(!(E<0||E>=n.inDepth))for(var C=k*e.strides[0],_=g+E*t.strides[1],S=0;S<n.outHeight;++S)for(var T=w+S*h.strides[2],O=S*n.strideHeight-f,I=0;I<i;I++){var R=O+I*u;if(!(R<0||R>=n.inHeight))for(var A=C+I*e.strides[1],D=_+R*t.strides[2],N=0;N<n.outWidth;++N)for(var P=T+N*n.outChannels,M=N*n.strideWidth-l,F=0;F<o;F++){var L=M+F*s;if(!(L<0||L>=n.inWidth))for(var j=A+F*e.strides[2],B=D+L*n.inChannels,V=j,U=0;U<n.inChannels;++U){for(var z=d[B+U],W=0;W<n.outChannels;++W)v[P+W]+=z*p[V+W];V+=n.outChannels}}}}return h.toTensor()},e.prototype.conv2dDerInput=function(t,e,n){Hl([t,e],"conv2dDerInput");for(var r=Hn(n.inShape,"float32"),i=r.values,o=this.readSync(t.dataId),a=this.readSync(e.dataId),u=e.strides,s=u[0],c=u[1],l=u[2],f=n.batchSize,h=n.filterHeight,d=n.filterWidth,p=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,w=n.strideHeight,x=n.strideWidth,k=n.dataFormat,E=h-1-n.padInfo.top,C=d-1-n.padInfo.left,_="channelsLast"===k,S=r.strides[0],T=_?r.strides[1]:r.strides[2],O=_?r.strides[2]:1,I=_?1:r.strides[1],R=t.strides[0],A=_?t.strides[1]:t.strides[2],D=_?t.strides[2]:1,N=_?1:t.strides[1],P=0;P<f;++P)for(var M=0;M<p;++M)for(var F=0;F<v;++F)for(var L=F-E,j=Math.max(0,Math.ceil(L/w)),B=Math.min(y,(h+L)/w),V=0;V<m;++V){for(var U=V-C,z=Math.max(0,Math.ceil(U/x)),W=Math.min(b,(d+U)/x),G=0,H=j;H<B;++H)for(var q=H*w-L,K=z;K<W;++K)for(var X=R*P+A*H+D*K,Y=s*(h-1-q)+c*(d-1-(K*x-U))+l*M,Q=0;Q<g;++Q)G+=o[X+N*Q]*a[Y+Q];i[S*P+T*F+O*V+I*M]=G}return r.toTensor()},e.prototype.conv3dDerInput=function(t,e,n){for(var r=Hn(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],u=o[1],s=o[2],c=o[3],l=this.readSync(t.dataId),f=t.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],w=g[2],x=g[3],k=n.batchSize,E=n.filterDepth,C=n.filterHeight,_=n.filterWidth,S=n.inChannels,T=n.inDepth,O=n.inHeight,I=n.inWidth,R=n.outChannels,A=n.outDepth,D=n.outHeight,N=n.outWidth,P=n.strideDepth,M=n.strideHeight,F=n.strideWidth,L=E-1-n.padInfo.front,j=C-1-n.padInfo.top,B=_-1-n.padInfo.left,V=0;V<k;++V)for(var U=0;U<S;++U)for(var z=0;z<T;++z)for(var W=z-L,G=Math.max(0,Math.ceil(W/P)),H=Math.min(A,(E+W)/P),q=0;q<O;++q)for(var K=q-j,X=Math.max(0,Math.ceil(K/M)),Y=Math.min(D,(C+K)/M),Q=0;Q<I;++Q){for(var $=Q-B,J=Math.max(0,Math.ceil($/F)),Z=Math.min(N,(_+$)/F),tt=0,et=G;et<H;++et)for(var nt=et*P-W,rt=X;rt<Y;++rt)for(var it=rt*M-K,ot=J;ot<Z;++ot)for(var at=h*V+d*et+p*rt+v*ot,ut=y*(E-1-nt)+b*(C-1-it)+w*(_-1-(ot*F-$))+x*U,st=0;st<R;++st)tt+=l[at+st]*m[ut+st];i[a*V+u*z+s*q+c*Q+U]=tt}return r.toTensor()},e.prototype.conv2dDerFilter=function(t,e,n){Hl([t,e],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,u="channelsLast"===n.dataFormat,s=Hn(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(t),h=this.bufferSync(e),d=0;d<o;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),v=Math.min(n.outHeight,(n.inHeight+l-d)/r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((c-m)/i)),y=Math.min(n.outWidth,(n.inWidth+c-m)/i),b=0;b<n.inChannels;++b)for(var w=0;w<n.outChannels;++w){for(var x=0,k=0;k<n.batchSize;++k)for(var E=p;E<v;++E)for(var C=d+E*r-l,_=g;_<y;++_){var S=m+_*i-c;x+=u?f.get(k,C,S,b)*h.get(k,E,_,w):f.get(k,b,C,S)*h.get(k,w,E,_)}s.set(x,d,m,b,w)}return s.toTensor()},e.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.filterDepth,u=n.filterHeight,s=n.filterWidth,c=Hn(n.filterShape,"float32"),l=c.values,f=c.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],w=g[2],x=g[3],k=this.readSync(t.dataId),E=t.strides,C=E[0],_=E[1],S=E[2],T=E[3],O=n.padInfo.front,I=n.padInfo.left,R=n.padInfo.top,A=0;A<a;++A)for(var D=Math.max(0,Math.ceil((O-A)/r)),N=Math.min(n.outDepth,(n.inDepth+O-A)/r),P=A*h,M=0;M<u;++M)for(var F=Math.max(0,Math.ceil((R-M)/i)),L=Math.min(n.outHeight,(n.inHeight+R-M)/i),j=M*d+P,B=0;B<s;++B)for(var V=Math.max(0,Math.ceil((I-B)/o)),U=Math.min(n.outWidth,(n.inWidth+I-B)/o),z=B*p+j,W=0;W<n.inChannels;++W)for(var G=W*v+z,H=0;H<n.outChannels;++H){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*C,Y=K*y,Q=D;Q<N;++Q)for(var $=(A+Q*r-O)*_+X,J=Q*b+Y,Z=F;Z<L;++Z)for(var tt=(M+Z*i-R)*S+$,et=Z*w+J,nt=V;nt<U;++nt){var rt=nt*x+et;q+=k[(B+nt*o-I)*T+tt+W]*m[rt+H]}l[G+H]=q}return c.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,n=t.filter,r=t.convInfo,i=t.bias,o=t.activation,a=t.preluActivationWeights,u=this.depthwiseConv2D(e,n,r);return i&&(u=this.add(u,i)),o&&(u=ql(this,u,o,a)),u},e.prototype.depthwiseConv2D=function(t,e,n){Hl([t,e],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,u=n.padInfo.left,s=n.padInfo.top,c=n.outChannels/n.inChannels,l=Hn(n.outShape,t.dtype),f=this.readSync(t.dataId),h=this.readSync(e.dataId),d=l.values,p=0;p<n.batchSize;++p)for(var v=p*t.strides[0],m=p*l.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*l.strides[1],b=g*n.strideHeight-u,w=0;w<r;++w){var x=b+w*o;if(!(x<0||x>=n.inHeight))for(var k=w*e.strides[0],E=v+x*t.strides[1],C=0;C<n.outWidth;++C)for(var _=y+C*l.strides[2],S=C*n.strideWidth-s,T=0;T<i;++T){var O=S+T*a;if(!(O<0||O>=n.inWidth))for(var I=k+T*e.strides[1],R=E+O*n.inChannels,A=_,D=I,N=0;N<n.inChannels;++N){for(var P=f[R+N],M=0;M<c;++M)d[A+M]+=P*h[D+M];A+=c,D+=c}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,n){Hl([t,e],"depthwiseConv2DDerInput");for(var r=Hn(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],u=o[1],s=o[2],c=this.readSync(t.dataId),l=t.strides,f=l[0],h=l[1],d=l[2],p=this.readSync(e.dataId),v=e.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,k=n.inChannels,E=n.inHeight,C=n.inWidth,_=n.outChannels,S=n.outHeight,T=n.outWidth,O=n.strideHeight,I=n.strideWidth,R=w-1-n.padInfo.top,A=x-1-n.padInfo.left,D=_/k,N=0;N<b;++N)for(var P=0;P<k;++P)for(var M=0;M<E;++M)for(var F=M-R,L=Math.max(0,Math.ceil(F/O)),j=Math.min(S,(w+F)/O),B=0;B<C;++B){for(var V=B-A,U=Math.max(0,Math.ceil(V/I)),z=Math.min(T,(x+V)/I),W=0,G=L;G<j;++G)for(var H=G*O-F,q=U;q<z;++q)for(var K=f*N+h*G+d*q,X=m*(w-1-H)+g*(x-1-(q*I-V))+y*P,Y=0;Y<D;++Y)W+=c[K+(P*D+Y)]*p[X+Y];i[a*N+u*M+s*B+P]=W}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){Hl([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,u=Hn(n.filterShape,"float32"),s=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(t),h=this.bufferSync(e),d=0;d<o;++d)for(var p=Math.max(0,Math.ceil((c-d)/r)),v=Math.min(n.outHeight,(n.inHeight+c-d)/r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((s-m)/i)),y=Math.min(n.outWidth,(n.inWidth+s-m)/i),b=0;b<n.outChannels;++b){for(var w=Math.trunc(b/l),x=b%l,k=0,E=0;E<n.batchSize;++E)for(var C=p;C<v;++C)for(var _=d+C*r-c,S=g;S<y;++S){var T=m+S*i-s;k+=f.get(E,_,T,w)*h.get(E,C,S,b)}u.set(k,d,m,w,x)}return u.toTensor()},e.prototype.tile=function(t,e){return Hl(t,"tile"),bi(this.bufferSync(t),e)},e.prototype.pad=function(t,e,n){Hl(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),i=e.map(function(t){return t[0]}),o=this.bufferSync(t),a=Hn(r,t.dtype);0!==n&&a.values.fill(n);for(var u=0;u<t.size;u++){var s=o.indexToLoc(u),c=s.map(function(t,e){return t+i[e]});a.set.apply(a,[o.get.apply(o,s)].concat(c))}return a.toTensor()},e.prototype.transpose=function(t,e){Hl(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var i=this.readSync(t.dataId),o=Hn(n,t.dtype),a=this.bufferSync(t);for(r=0;r<t.size;++r){for(var u=a.indexToLoc(r),s=new Array(u.length),c=0;c<s.length;c++)s[c]=u[e[c]];var l=o.locToIndex(s);o.values[l]=i[r]}return o.toTensor()},e.prototype.gather=function(t,e,n){Hl([t,e],"gather");var r=t.shape.slice(),i=this.readSync(e.dataId);r[n]=i.length;for(var o=Hn(r,t.dtype),a=this.bufferSync(t),u=0;u<o.size;++u){var s=o.indexToLoc(u),c=s.slice();c[n]=i[s[n]];var l=a.locToIndex(c);o.values[u]=a.values[l]}return o.toTensor()},e.prototype.batchToSpaceND=function(t,e,n){Hl([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),i=yr(t.shape,e,r),o=br(i.length,e.length),a=wr(t.shape,e,r),u=xr(n,e.length),s=kr(a,n,e.length);return t.reshape(i).transpose(o).reshape(a).slice(u,s)},e.prototype.spaceToBatchND=function(t,e,n){Hl([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var a=t.pad(i),u=yr(a.shape,e,r,!1),s=br(u.length,e.length,!1),c=wr(a.shape,e,r,!1);return a.reshape(u).transpose(s).reshape(c)},e.prototype.pool=function(t,e,n){Hl(t,"pool");for(var r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,u=e.effectiveFilterHeight,s=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=this.readSync(t.dataId),d=Hn(e.outShape,t.dtype),p=d.values,v=e.outShape[1]*e.outShape[2]*e.outShape[3],m=e.outShape[2]*e.outShape[3],g=e.outShape[3],y=0;y<e.batchSize;++y)for(var b=y*v,w=y*t.strides[0],x=0;x<e.inChannels;++x)for(var k=0;k<e.outHeight;++k)for(var E=k*r-c,C=Math.max(0,E),_=Math.min(e.inHeight,u+E),S=b+k*m,T=0;T<e.outWidth;++T){for(var O=T*i-l,I=Math.max(0,O),R=Math.min(e.inWidth,s+O),A=f,D=0,N=0,P=C;P<_;P+=o){for(var M=w+P*t.strides[1],F=I;F<R;F+=a){var L=h[M+F*t.strides[2]+x];"max"===n&&L>A?A=L:"avg"===n&&(D+=L,N++)}if(isNaN(A))break}p[S+T*g+x]="avg"===n?D/N:A}return d.toTensor()},e.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var n=Hn(e.outShape,"int32"),r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,u=e.effectiveFilterHeight,s=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,f=this.bufferSync(t),h=0;h<e.batchSize;++h)for(var d=0;d<e.inChannels;++d)for(var p=0;p<e.outHeight;++p){for(var v=p*r-c,m=v;m<0;)m+=o;for(var g=Math.min(e.inHeight,u+v),y=0;y<e.outWidth;++y){for(var b=y*i-l,w=b;w<0;)w+=a;for(var x=Math.min(e.inWidth,s+b),k=Number.NEGATIVE_INFINITY,E=-1,C=m;C<g;C+=o)for(var _=C-v,S=w;S<x;S+=a){var T=S-b,O=f.get(h,C,S,d);O>k&&(k=O,E=_*s+T)}n.set(E,h,p,y,d)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(t,e,n,r){Hl([e,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(e,r),o=r.strideHeight,a=r.strideWidth,u=r.dilationHeight,s=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=l-1-r.padInfo.left,h=c-1-r.padInfo.top,d=Hn(e.shape,"float32"),p=this.bufferSync(i),v=this.bufferSync(t),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var w=y-h,x=b-f,k=0,E=0;E<c;E+=u){var C=(w+E)/o;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var _=0;_<l;_+=s){var S=(x+_)/a;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var T=c*l-1-p.get(m,C,S,g)===E*l+_?1:0;0!==T&&(k+=v.get(m,C,S,g)*T)}}}d.set(k,m,y,b,g)}return d.toTensor()},e.prototype.avgPoolBackprop=function(t,e,n){Hl([t,e],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,u=n.dilationHeight,s=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,h=c-1-n.padInfo.top,d=Hn(e.shape,"float32"),p=1/(o*a),v=this.bufferSync(t),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var w=y-h,x=b-f,k=0,E=0;E<c;E+=u){var C=(w+E)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var _=0;_<l;_+=s){var S=(x+_)/i;S<0||S>=n.outWidth||Math.floor(S)!==S||(k+=v.get(m,C,S,g))}}d.set(k*p,m,y,b,g)}return d.toTensor()},e.prototype.pool3d=function(t,e,n){Hl(t,"pool3d");for(var r=e.strideDepth,i=e.strideHeight,o=e.strideWidth,a=e.dilationDepth,u=e.dilationHeight,s=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(t.dataId),g=Hn(e.outShape,t.dtype),y=g.values,b=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[2]*e.outShape[3]*e.outShape[4],x=e.outShape[3]*e.outShape[4],k=e.outShape[4],E=0;E<e.batchSize;++E)for(var C=E*b,_=E*t.strides[0],S=0;S<e.inChannels;++S)for(var T=0;T<e.outDepth;++T){for(var O=T*r-h,I=O;I<0;)I+=a;for(var R=Math.min(e.inDepth,c+O),A=C+T*w,D=0;D<e.outHeight;++D){for(var N=D*i-d,P=N;P<0;)P+=u;for(var M=Math.min(e.inHeight,l+N),F=A+D*x,L=0;L<e.outWidth;++L){for(var j=L*o-p,B=j;B<0;)B+=s;for(var V=Math.min(e.inWidth,f+j),U=F+L*k,z=v,W=0,G=0,H=I;H<R;H+=a){for(var q=_+H*t.strides[1],K=P;K<M;K+=u){for(var X=q+K*t.strides[2],Y=B;Y<V;Y+=s){var Q=m[X+Y*t.strides[3]+S];if("max"===n&&Q>z?z=Q:"avg"===n&&(W+=Q,G++),isNaN(z))break}if(isNaN(z))break}if(isNaN(z))break}y[U+S]="avg"===n?W/G:z}}}return g.toTensor()},e.prototype.avgPool3d=function(t,e){return Hl(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,n){Hl([t,e],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.filterDepth,u=n.filterHeight,s=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,h=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=h-1-n.padInfo.front,m=p-1-n.padInfo.left,g=d-1-n.padInfo.top,y=Hn(e.shape,"float32"),b=1/(a*u*s),w=this.bufferSync(t),x=0;x<n.batchSize;++x)for(var k=0;k<n.inChannels;++k)for(var E=0;E<n.inDepth;++E)for(var C=0;C<n.inHeight;++C)for(var _=0;_<n.inWidth;++_){for(var S=E-v,T=C-g,O=_-m,I=0,R=0;R<h;R+=c){var A=(S+R)/r;if(!(A<0||A>=n.outDepth||Math.floor(A)!==A))for(var D=0;D<d;D+=l){var N=(T+D)/i;if(!(N<0||N>=n.outHeight||Math.floor(N)!==N))for(var P=0;P<p;P+=f){var M=(O+P)/o;M<0||M>=n.outWidth||Math.floor(M)!==M||(I+=w.get(x,A,N,M,k))}}}y.set(I*b,x,E,C,_,k)}return y.toTensor()},e.prototype.maxPool3d=function(t,e){return Hl(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var n=Hn(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,o=e.strideWidth,a=e.dilationDepth,u=e.dilationHeight,s=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v=this.bufferSync(t),m=0;m<e.batchSize;++m)for(var g=0;g<e.inChannels;++g)for(var y=0;y<e.outDepth;++y){for(var b=y*r-h,w=b;w<0;)w+=a;for(var x=Math.min(e.inDepth,c+b),k=0;k<e.outHeight;++k){for(var E=k*i-d,C=E;C<0;)C+=u;for(var _=Math.min(e.inHeight,l+E),S=0;S<e.outWidth;++S){for(var T=S*o-p,O=T;O<0;)O+=s;for(var I=Math.min(e.inWidth,f+T),R=Number.NEGATIVE_INFINITY,A=-1,D=w;D<x;D+=a)for(var N=D-b,P=C;P<_;P+=u)for(var M=P-E,F=O;F<I;F+=s){var L=F-T,j=v.get(m,D,P,F,g);j>=R&&(R=j,A=N*l*f+M*l+L)}n.set(A,m,y,k,S,g)}}}return n.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,n,r){Hl([e,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(e,r),o=r.strideDepth,a=r.strideHeight,u=r.strideWidth,s=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=f-1-r.padInfo.front,v=d-1-r.padInfo.left,m=h-1-r.padInfo.top,g=Hn(e.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var x=0;x<r.inChannels;++x)for(var k=0;k<r.inDepth;++k)for(var E=0;E<r.inHeight;++E)for(var C=0;C<r.inWidth;++C){for(var _=k-p,S=E-m,T=C-v,O=0,I=0;I<f;I+=s){var R=(_+I)/o;if(!(R<0||R>=r.outDepth||Math.floor(R)!==R))for(var A=0;A<h;A+=c){var D=(S+A)/a;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var N=0;N<d;N+=l){var P=(T+N)/u;if(!(P<0||P>=r.outWidth||Math.floor(P)!==P)){var M=f*h*d-1-y.get(w,R,D,P,x)===I*h*d+A*d+N?1:0;0!==M&&(O+=b.get(w,R,D,P,x)*M)}}}}g.set(O,w,k,E,C,x)}return g.toTensor()},e.prototype.cast=function(t,e){return ri(t,e,this)},e.prototype.reshape=function(t,e){return ii(t,e)},e.prototype.avgPool=function(t,e){return Hl(t,"avgPool"),this.pool(t,e,"avg").toFloat()},e.prototype.resizeBilinear=function(t,e,n,r){Hl(t,"resizeBilinear");for(var i=t.shape,o=i[0],a=i[1],u=i[2],s=i[3],c=this.readSync(t.dataId),l=new Float32Array(O([o,e,n,s])),f=[r&&e>1?a-1:a,r&&n>1?u-1:u],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],d=0,p=f[0]/h[0],v=f[1]/h[1],m=0;m<o;m++)for(var g=0;g<e;g++)for(var y=p*g,b=Math.floor(y),w=y-b,x=Math.min(a-1,Math.ceil(y)),k=m*t.strides[0]+b*t.strides[1],E=m*t.strides[0]+x*t.strides[1],C=0;C<n;C++)for(var _=v*C,S=Math.floor(_),T=_-S,I=Math.min(u-1,Math.ceil(_)),R=k+S*t.strides[2],A=E+S*t.strides[2],D=k+I*t.strides[2],N=E+I*t.strides[2],P=0;P<s;P++){var M=c[R+P],F=c[A+P],L=M+(c[D+P]-M)*T,j=L+(F+(c[N+P]-F)*T-L)*w;l[d++]=j}return pn(l,[o,e,n,s])},e.prototype.resizeBilinearBackprop=function(t,e,n){Hl([t,e],"resizeBilinearBackprop");for(var r=e.shape,i=r[0],o=r[1],a=r[2],u=r[3],s=t.shape,c=s[1],l=s[2],f=new Float32Array(i*o*a*u),h=[n&&c>1?o-1:o,n&&l>1?a-1:a],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=h[0]/d[0],v=h[1]/d[1],m=this.readSync(t.dataId),g=0,y=0;y<i;y++)for(var b=y*e.strides[0],w=0;w<c;w++)for(var x=w*p,k=Math.floor(x),E=Math.min(Math.ceil(x),o-1),C=b+k*e.strides[1],_=b+E*e.strides[1],S=x-k,T=1-S,O=0;O<l;O++)for(var I=O*v,R=Math.floor(I),A=Math.min(Math.ceil(I),a-1),D=I-R,N=1-D,P=C+R*e.strides[2],M=C+A*e.strides[2],F=_+R*e.strides[2],L=_+A*e.strides[2],j=T*N,B=T*D,V=S*N,U=S*D,z=0;z<u;z++){var W=m[g++];f[P+z]+=W*j,f[M+z]+=W*B,f[F+z]+=W*V,f[L+z]+=W*U}return wn(f,[i,a,o,u],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,n,r){Hl(t,"resizeNearestNeighbor");for(var i=t.shape,o=i[0],a=i[1],u=i[2],s=i[3],c=this.readSync(t.dataId),l=new Float32Array(o*e*n*s),f=[r&&e>1?a-1:a,r&&n>1?u-1:u],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],d=f[0]/h[0],p=f[1]/h[1],v=0,m=0;m<o;m++)for(var g=m*t.strides[0],y=0;y<e;y++)for(var b=d*y,w=g+Math.min(a-1,r?Math.round(b):Math.floor(b))*t.strides[1],x=0;x<n;x++)for(var k=p*x,E=w+Math.min(u-1,r?Math.round(k):Math.floor(k))*t.strides[2],C=0;C<s;C++){var _=c[E+C];l[v++]=_}return pn(l,[o,e,n,s],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){Hl([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,i=r[0],o=r[1],a=r[2],u=r[3],s=t.shape,c=s[1],l=s[2],f=new Float32Array(i*o*a*u),h=this.readSync(t.dataId),d=[n&&c>1?o-1:o,n&&l>1?a-1:a],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],v=d[0]/p[0],m=d[1]/p[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,w=2*Math.ceil(y)+2,x=0;x<i;x++)for(var k=x*e.strides[0],E=0;E<o;E++)for(var C=k+E*e.strides[1],_=Math.floor(E*g),S=Math.floor(_-b/2),T=0;T<a;T++)for(var O=C+T*e.strides[2],I=Math.floor(T*y),R=Math.floor(I-w/2),A=0;A<u;A++){for(var D=0,N=0;N<b;N++){var P=N+S;if(!(P<0||P>=c)){var M=k+P*t.strides[1],F=P*v;if(E===Math.min(o-1,n?Math.round(F):Math.floor(F)))for(var L=0;L<w;L++){var j=L+R;if(!(j<0||j>=l)){var B=M+j*t.strides[2],V=j*m;T===Math.min(a-1,n?Math.round(V):Math.floor(V))&&(D+=h[B+A])}}}}f[O+A]=D}return wn(f,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,n,r,i,o){Hl([t,e,n,i,o],"batchNorm");for(var a=this.readSync(t.dataId),u=this.readSync(e.dataId),s=this.readSync(n.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),l=o?this.readSync(o.dataId):new Float32Array([0]),f=new Float32Array(a.length),h=l.length,d=c.length,p=s.length,v=u.length,m=0,g=0,y=0,b=0,w=0;w<a.length;++w)f[w]=l[m++]+(a[w]-u[g++])*c[y++]/Math.sqrt(s[b++]+r),m>=h&&(m=0),g>=v&&(g=0),y>=d&&(y=0),b>=p&&(b=0);return wn(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,n,r,i){Hl(t,"localResponseNormalization4D");var o=t.shape[3],a=o-1,u=this.readSync(t.dataId),s=t.size,c=new Float32Array(s);function l(t){for(var n=t%o,r=t-n+Math.max(0,n-e),i=t-n+Math.min(n+e,a),s=0;r<=i;r++){var c=u[r];s+=c*c}return s}for(var f=0;f<s;f++){var h=l(f),d=u[f]*Math.pow(n+r*h,-i);c[f]=d}return wn(c,t.shape)},e.prototype.LRNGrad=function(t,e,n,r,i,o,a){Hl(t,"LRNGrad");for(var u=t.shape[3],s=this.readSync(t.dataId),c=this.readSync(e.dataId),l=this.readSync(n.dataId),f=new Float32Array(t.size),h=t.size,d=0;d<h;d++){for(var p=d%u,v=d-p+Math.max(0,p-r),m=d-p+Math.min(u,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(c[y],2);for(g=o*g+i,y=v;y<m;y++){var b=-2*o*a*c[y]*l[d]/g;d===y&&(b+=Math.pow(g,-a)),b*=s[d],f[y]+=b}}return wn(f,t.shape)},e.prototype.multinomial=function(t,e,n,r){Hl(t,"multinomial");for(var i=e?t:Lr(t),o=i.shape[0],a=i.shape[1],u=kn([o,n],"int32"),s=this.readSync(u.dataId),c=this.readSync(i.dataId),l=0;l<o;++l){var f=l*a,h=new Float32Array(a-1);h[0]=c[f];for(var d=1;d<h.length;++d)h[d]=h[d-1]+c[f+d];for(var p=Un(r.toString()),v=l*n,m=0;m<n;++m){var g=p();s[v+m]=h.length;for(var y=0;y<h.length;y++)if(g<h[y]){s[v+m]=y;break}}}return u},e.prototype.oneHot=function(t,e,n,r){Hl(t,"oneHot");var i=new Float32Array(t.size*e);i.fill(r);for(var o=this.readSync(t.dataId),a=0;a<t.size;++a)o[a]>=0&&o[a]<e&&(i[a*e+o[a]]=n);return yn(i,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,n,r,i){return Hl(t,"nonMaxSuppression"),hi(this.readSync(t.dataId),this.readSync(e.dataId),n,r,i)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],i=Hn(t.shape,"float32"),o=Hn(t.shape,"float32"),a=hn(t).as2D(n,r),u=dn(t).as2D(n,r),s=0;s<n;s++)for(var c=a.slice([s,0],[1,r]),l=u.slice([s,0],[1,r]),f=fn(c,l),h=this.readSync(this.fftImpl(f,e).dataId),d=0;d<r;d++){var p=ui(h,d);i.values[s*r+d]=p.real,o.values[s*r+d]=p.imag}return fn(i.toTensor(),o.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(i=fn(hn(i).div(mn(r)),dn(i).div(mn(r)))),i}var o=this.readSync(t.dataId),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(o,r,e));return fn(a.real,a.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),i=e/2,o=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}(r),a=fn(o.real,o.imag).as1D(),u=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}(r),s=fn(u.real,u.imag).as1D();a=this.fftRadix2(a,i,n),s=this.fftRadix2(s,i,n);var c=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),i=0;i<Math.ceil(t/2);i++){var o=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(o),r[i]=Math.sin(o)}return{real:n,imag:r}}(e,n),l=fn(c.real,c.imag).mul(s),f=a.add(l),h=a.sub(l),d=hn(f).concat(hn(h)),p=dn(f).concat(dn(h));return fn(d,p).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),i=0;i<e;i++){for(var o=0,a=0,u=0;u<e;u++){var s=ci(i*u,e,n),c=ui(t,u);o+=c.real*s.real-c.imag*s.imag,a+=c.real*s.imag+c.imag*s.real}n&&(o/=e,a/=e),si(r,o,a,i)}return r},e.prototype.depthToSpace=function(t,e,n){C("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),C(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var r=t.shape[0],i=t.shape[1],o=t.shape[2],a=t.shape[3],u=i*e,s=o*e,c=a/(e*e),l=this.readSync(t.dataId),f=new Float32Array(r*u*s*c),h=0,d=0;d<r;++d)for(var p=0;p<u;++p)for(var v=Math.floor(p/e),m=p%e,g=0;g<s;++g)for(var y=Math.floor(g/e),b=(m*e+g%e)*c,w=0;w<c;++w){var x=w+b+a*(y+o*(v+i*d));f[h++]=l[x]}return wn(f,[r,u,s,c])},e.prototype.broadcastedBinaryOp=function(t,e,n,r){var i=Gr(t.shape,e.shape),o=Hn(i,n),a=this.readSync(t.dataId),u=this.readSync(e.dataId),s=zr(t.shape,i),c=zr(e.shape,i),l=o.values;if(s.length+c.length===0)for(var f=0;f<l.length;++f)l[f]=r(a[f%a.length],u[f%u.length]);else{var h=this.bufferSync(t),d=this.bufferSync(e),p=function(n){var i=o.indexToLoc(n),f=i.slice(-t.rank);s.forEach(function(t){return f[t]=0});var p=h.locToIndex(f),v=i.slice(-e.rank);c.forEach(function(t){return v[t]=0});var m=d.locToIndex(v);l[n]=r(a[p],u[m])};for(f=0;f<l.length;++f)p(f)}return o.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=Gr(t.shape,e.shape),i=Hn(r,"float32"),o=Hn(r,"float32"),a=this.readSync(t.dataId),u=this.readSync(e.dataId),s=zr(t.shape,r),c=zr(e.shape,r),l=i.values,f=o.values;if(s.length+c.length===0)for(var h=0;h<l.length;h++){var d=h%a.length,p=h%u.length,v=n(a[2*d],a[2*d+1],u[2*p],u[2*p+1]);l[h]=v.real,f[h]=v.imag}else{var m=this.bufferSync(this.data.get(t.dataId).complexTensors.real),g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var o=i.indexToLoc(r),h=o.slice(-t.rank);s.forEach(function(t){return h[t]=0});var d=m.locToIndex(h),p=o.slice(-e.rank);c.forEach(function(t){return p[t]=0});var v=g.locToIndex(p),y=n(a[2*d],a[2*d+1],u[2*v],u[2*v+1]);l[r]=y.real,f[r]=y.imag};for(h=0;h<l.length;h++)y(h)}return this.complex(i.toTensor(),o.toTensor())},e.prototype.split=function(t,e,n){return yi(t,e,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,e,n,r,i,o){for(var a=t.shape,u=a[0],s=a[1],c=a[2],l=a[3],f=e.shape[0],h=r[0],d=r[1],p=Hn([f,h,d,l],"float32"),v=this.readSync(e.dataId),m=this.readSync(n.dataId),g=this.readSync(t.dataId),y=t.strides,b=p.strides,w=0;w<f;w++){var x=4*w,k=v[x],E=v[x+1],C=v[x+2],_=v[x+3],S=m[w];if(!(S>=u))for(var T=h>1?(C-k)*(s-1)/(h-1):0,O=d>1?(_-E)*(c-1)/(d-1):0,I=0;I<h;I++){var R=h>1?k*(s-1)+I*T:.5*(k+C)*(s-1);if(R<0||R>s-1)for(var A=0;A<d;A++)for(var D=0;D<l;D++){var N=D+A*b[2]+I*b[1]+w*b[0];p.values[N]=o}else if("bilinear"===i){var P=Math.floor(R),M=Math.ceil(R),F=R-P;for(A=0;A<d;A++)if((H=d>1?E*(c-1)+A*O:.5*(E+_)*(c-1))<0||H>c-1)for(D=0;D<l;D++)N=D+A*b[2]+I*b[1]+w*b[0],p.values[N]=o;else{var L=Math.floor(H),j=Math.ceil(H),B=H-L;for(D=0;D<l;D++){var V=g[N=D+L*y[2]+P*y[1]+S*y[0]],U=g[N=D+j*y[2]+P*y[1]+S*y[0]],z=g[N=D+L*y[2]+M*y[1]+S*y[0]],W=V+(U-V)*B,G=z+(g[N=D+j*y[2]+M*y[1]+S*y[0]]-z)*B;N=D+A*b[2]+I*b[1]+w*b[0],p.values[N]=W+(G-W)*F}}}else for(A=0;A<d;++A){var H;if((H=d>1?E*(c-1)+A*O:.5*(E+_)*(c-1))<0||H>c-1)for(D=0;D<l;D++)N=D+A*b[2]+I*b[1]+w*b[0],p.values[N]=o;else{var q=Math.round(H),K=Math.round(R);for(D=0;D<l;D++){var X=D+q*y[2]+K*y[1]+S*y[0],Y=D+A*b[2]+I*b[1]+w*b[0];p.values[Y]=g[X]}}}}}return p.toTensor()},e.prototype.sparseToDense=function(t,e,n,r){var i=Or(0,t,n),o=i.sliceRank,a=i.numUpdates,u=i.sliceSize,s=i.strides,c=i.outputSize;return this.scatter(t,e,n,c,u,a,o,s,r,!1)},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],i=Er(t,e),o=i[0],a=i[1],u=i[2],s=i[3];if(0===a)return pn([],o,t.dtype);for(var c=new gt([a,u],t.dtype),l=this.readSync(e.dataId),f=this.readSync(t.dataId),h=0;h<a;h++){for(var d=[],p=0,v=0;v<r;v++){var m=l[h*r+v];p+=m*s[v],d.push(m)}if(p<0||p>=t.size/u)throw new Error("Invalid indices: "+d+" does not index into "+t.shape);for(var g=0;g<u;g++)c.values[h*u+g]=f[p*u+g]}return c.toTensor().reshape(o)},e.prototype.scatterND=function(t,e,n){var r=Or(0,t,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,u=r.strides,s=r.outputSize,c=mn(0);return this.scatter(t,e,n,s,a,o,i,u,c,!0)},e.prototype.fill=function(t,e,n){var r=B(n=n||Y(e),O(t));return r.fill(e),jt.makeTensor(r,t,n,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=B(t.dtype,O(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,n){return oi(t,e,n)},e.prototype.scatter=function(t,e,n,r,i,o,a,u,s,c){var l=[r/i,i],f=this.readSync(t.dataId),h=this.readSync(e.dataId);if(0===r)return pn([],n,e.dtype);var d=new gt(l,e.dtype);d.values.fill(this.readSync(s.dataId)[0]);for(var p=0;p<o;p++){for(var v=[],m=0,g=0;g<a;g++){var y=f[p*a+g];v.push(y),m+=y*u[g]}if(m<0||m>=r/i)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<i;b++)c?d.values[m*i+b]+=h[p*i+b]:d.values[m*i+b]=0===e.rank?h[0]:h[p*i+b]}return d.toTensor().reshape(n)},e}(Vr);jt.registerBackend("cpu",function(){return new Kl},1);for(var Xl=0,Yl=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e,o=i.boxes,a=i.scores,u=r,s=u.maxOutputSize,c=u.iouThreshold,l=u.scoreThreshold,f=u.softNmsSigma,h=n;Hl(o,"NonMaxSuppressionWithScore");var d=di(h.data.get(o.dataId).values,h.data.get(a.dataId).values,s,c,l,f);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n;Hl(r,"square");for(var o=i.data.get(r.dataId).values,a=new Float32Array(o.length),u=0;u<o.length;++u){var s=o[u];a[u]=s*s}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:au,backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,a=n;Hl([i,o],au);var u=a.data.get(i.dataId).values,s=a.data.get(o.dataId).values,c=function(t,e,n,r,i,o){var a=Gr(t,e),u=a.length,s=J(a),c=j(i,O(a)),l=t.length,f=e.length,h=J(t),d=J(e),p=zr(t,a),v=zr(e,a);if(p.length+v.length===0)for(var m=0;m<c.length;++m)c[m]=o(n[m%n.length],r[m%r.length]);else{var g=function(t){var e=st(t,u,s),i=e.slice(-l);p.forEach(function(t){return i[t]=0});var a=ut(i,l,h),m=e.slice(-f);v.forEach(function(t){return m[t]=0});var g=ut(m,f,d);c[t]=o(n[a],r[g])};for(m=0;m<c.length;++m)g(m)}return[c,a]}(i.shape,o.shape,u,s,i.dtype,function(t,e){var n=t-e;return n*n}),l=c[0],f=c[1];return{dataId:a.write(l,f,i.dtype),shape:f,dtype:i.dtype}}}];Xl<Yl.length;Xl++)g(Yl[Xl]);for(var Ql,$l=function(t){this.variableNames=["A"];var e=Ti(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Jl=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Ti(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},Zl=0,tf=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e.pixels,o=r.numChannels,a="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,s=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=s[0],l=s[1],h=[l,c],d=[l,c,o];(u||a)&&(null==Ql&&(Ql=document.createElement("canvas").getContext("2d")),Ql.canvas.width=c,Ql.canvas.height=l,Ql.drawImage(i,0,0,c,l),i=Ql.canvas);var p=n.makeTensorInfo(h,"int32");n.texData.get(p.dataId).usage=zt.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),i);var v=f().getBool("WEBGL_PACK")?new Jl(d):new $l(d),m=n.runWebGLProgram(v,[p],"int32");return n.disposeData(p.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;Xe("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,u=r,s=u.maxOutputSize,c=u.iouThreshold,l=u.scoreThreshold,f=u.softNmsSigma,h=n,d=di(h.readSync(o.dataId),h.readSync(a.dataId),s,c,l,f);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n,o=new Fa(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:au,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,a=n,u=f().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("return (a - b) * (a - b);",i.shape,o.shape):new $i("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(u,[i,o])}}];Zl<tf.length;Zl++)g(tf[Zl]);for(var ef=0,nf=[{kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:au,gradFunc:function(t,e){var n=e[0],r=e[1],i=mn(2);return{a:function(){return ks(t,ks(i,Ts(n,r)))},b:function(){return ks(t,ks(i,Ts(r,n)))}}}}];ef<nf.length;ef++)y(nf[ef]);var rf=function(){function t(){}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();f().get("IS_BROWSER")&&f().setPlatform("browser",new rf);var of,af=function(){function t(){this.util=n(52),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=f().global.fetch?f().global.fetch(t,e):(null==of&&(of=n(51)),of(t,e))},t.prototype.now=function(){var t=r.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();f().get("IS_NODE")&&f().setPlatform("node",new af);var uf={float32:4,int32:4,uint16:2,uint8:1,bool:1},sf=4;function cf(t,e){for(var n={},r=0,i=function(e){var i=e.name,o=e.dtype,a=e.shape,u=O(a),s=void 0;if("quantization"in e){var c=e.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=uf[c.dtype],f=t.slice(r,r+u*l),h="uint8"===c.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===o)s=Float32Array.from(h,function(t){return t*c.scale+c.min});else{if("int32"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);s=Int32Array.from(h,function(t){return Math.round(t*c.scale+c.min)})}r+=u*l}else if("string"===o){var d=O(e.shape);s=[];for(var p=0;p<d;p++){var v=new Uint32Array(t.slice(r,r+sf))[0];r+=sf;var m=new Uint8Array(t.slice(r,r+v));s.push(m),r+=v}}else{var g=uf[o];if(f=t.slice(r,r+u*g),"float32"===o)s=new Float32Array(f);else if("int32"===o)s=new Int32Array(f);else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);s=new Uint8Array(f)}r+=u*g}n[i]=pn(s,a,o)},o=0,a=e;o<a.length;o++)i(a[o]);return n}function lf(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),i=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),i),i+=t.byteLength}),r.buffer}var ff="undefined"!=typeof i&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function hf(t){return ff?i.byteLength(t):new Blob([t]).size}function df(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function pf(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function vf(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:hf(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:hf(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var mf=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var i=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(t){var n=t(e,r);null!==n&&i.push(n)}),i},t}(),gf="://",yf=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){C(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(gf)&&(e=e.slice(0,e.indexOf(gf))),C(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();C(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function bf(t){if(-1===t.indexOf(gf))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+yf.getSchemes().join(","));return{scheme:t.split(gf)[0],path:t.split(gf)[1]}}function wf(t,e,n){return void 0===n&&(n=!1),s(this,void 0,void 0,function(){var r,i,o,a,u,s,l,f,h;return c(this,function(c){switch(c.label){case 0:return C(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),C((r=mf.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),C(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),i=r[0],C((o=mf.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),C(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=o[0],u=bf(t).scheme,s=bf(t).path,l=u===bf(t).scheme,[4,i.load()];case 1:return f=c.sent(),n&&l?[4,yf.getManager(u).removeModel(s)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[4,a.save(f)];case 4:return h=c.sent(),!n||l?[3,6]:[4,yf.getManager(u).removeModel(s)];case 5:c.sent(),c.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var xf="models_store",kf="model_info_store";function Ef(){if(!f().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Cf(t){var e=t.result;e.createObjectStore(xf,{keyPath:"modelPath"}),e.createObjectStore(kf,{keyPath:"modelPath"})}var _f=function(){function t(t){if(this.indexedDB=Ef(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return s(this,void 0,void 0,function(){return c(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Cf(i)},i.onsuccess=function(){var o=i.result;if(null==e){var a=o.transaction(xf,"readonly"),u=a.objectStore(xf).get(n.modelPath);u.onsuccess=function(){if(null==u.result)return o.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(u.result.modelArtifacts)},u.onerror=function(t){return o.close(),r(u.error)},a.oncomplete=function(){return o.close()}}else{var s,c=vf(e),l=o.transaction(kf,"readwrite"),f=l.objectStore(kf),h=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});h.onsuccess=function(){var i=(s=o.transaction(xf,"readwrite")).objectStore(xf).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});i.onsuccess=function(){return t({modelArtifactsInfo:c})},i.onerror=function(t){var e=(f=l.objectStore(kf)).delete(n.modelPath);e.onsuccess=function(){return o.close(),r(i.error)},e.onerror=function(t){return o.close(),r(i.error)}}},h.onerror=function(t){return o.close(),r(h.error)},l.oncomplete=function(){null==s?o.close():s.oncomplete=function(){return o.close()}}}},i.onerror=function(t){return r(i.error)}})},t.URL_SCHEME="indexeddb://",t}(),Sf=function(t){return f().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(_f.URL_SCHEME)?(e=t.slice(_f.URL_SCHEME.length),new _f(e)):null;var e};mf.registerSaveRouter(Sf),mf.registerLoadRouter(Sf);var Tf=function(){function t(){this.indexedDB=Ef()}return t.prototype.listModels=function(){return s(this,void 0,void 0,function(){var t=this;return c(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return Cf(r)},r.onsuccess=function(){var t=r.result,i=t.transaction(kf,"readonly"),o=i.objectStore(kf).getAll();o.onsuccess=function(){for(var t={},n=0,r=o.result;n<r.length;n++){var i=r[n];t[i.modelPath]=i.modelArtifactsInfo}e(t)},o.onerror=function(e){return t.close(),n(o.error)},i.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return s(this,void 0,void 0,function(){var e=this;return c(this,function(n){var r;return t=(r=t).startsWith(_f.URL_SCHEME)?r.slice(_f.URL_SCHEME.length):r,[2,new Promise(function(n,r){var i=e.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Cf(i)},i.onsuccess=function(){var e,o=i.result,a=o.transaction(kf,"readwrite"),u=a.objectStore(kf),s=u.get(t);s.onsuccess=function(){if(null==s.result)return o.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var i=u.delete(t),a=function(){var i=(e=o.transaction(xf,"readwrite")).objectStore(xf).delete(t);i.onsuccess=function(){return n(s.result.modelArtifactsInfo)},i.onerror=function(t){return r(s.error)}};i.onsuccess=a,i.onerror=function(t){return a(),o.close(),r(s.error)}},s.onerror=function(t){return o.close(),r(s.error)},a.oncomplete=function(){null==e?o.close():e.oncomplete=function(){return o.close()}}},i.onerror=function(t){return r(i.error)}})]})})},t}();if(f().getBool("IS_BROWSER"))try{yf.registerManager(_f.URL_SCHEME,new Tf)}catch(Tt){}var Of="/",If="tensorflowjs_models",Rf="info",Af="model_topology",Df="weight_specs",Nf="weight_data",Pf="model_metadata";function Mf(t){return{info:[If,t,Rf].join(Of),topology:[If,t,Af].join(Of),weightSpecs:[If,t,Df].join(Of),weightData:[If,t,Nf].join(Of),modelMetadata:[If,t,Pf].join(Of)}}function Ff(t){var e=t.split(Of);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(Of)}var Lf=function(){function t(t){if(!f().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Mf(this.modelPath)}return t.prototype.save=function(t){return s(this,void 0,void 0,function(){var e,n,r;return c(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=vf(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(ff)return i.from(t).toString("base64");for(var e=new Uint8Array(t),n="",r=0,o=e.length;r<o;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return s(this,void 0,void 0,function(){var t,e,n,r,o,a,u;return c(this,function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,e.userDefinedMetadata=a.userDefinedMetadata),null==(u=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(ff){var e=i.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(u),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),jf=function(t){return f().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Lf.URL_SCHEME)?(e=t.slice(Lf.URL_SCHEME.length),new Lf(e)):null;var e};mf.registerSaveRouter(jf),mf.registerLoadRouter(jf);var Bf=function(){function t(){C(f().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),C("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return s(this,void 0,void 0,function(){var t,e,n,r,i,o;return c(this,function(a){for(t={},e=If+Of,n=Of+Rf,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(e)&&i.endsWith(n)&&(o=Ff(i),t[o]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},t.prototype.removeModel=function(t){return s(this,void 0,void 0,function(){var e,n;return c(this,function(r){var i;if(t=(i=t).startsWith(Lf.URL_SCHEME)?i.slice(Lf.URL_SCHEME.length):i,e=Mf(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(f().getBool("IS_BROWSER"))try{yf.registerManager(Lf.URL_SCHEME,new Bf)}catch(Tt){}var Vf="model",Uf=".json",zf=".weights.bin";function Wf(t){return new Promise(function(t){return setTimeout(t)}).then(t)}var Gf=function(){function t(e){if(!f().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=Vf),this.modelTopologyFileName=e+Uf,this.weightDataFileName=e+zf}return t.prototype.save=function(t){return s(this,void 0,void 0,function(){var e,n,r,i,o,a;return c(this,function(u){switch(u.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,[4,Wf(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==t.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=e,[4,Wf(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:vf(t)}]}})})},t.URL_SCHEME="downloads://",t}(),Hf=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return s(this,void 0,void 0,function(){var t,e,n=this;return c(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,i){var o=new FileReader;o.onload=function(o){var a=JSON.parse(o.target.result),u=a.modelTopology;if(null!=u){0===e.length&&r({modelTopology:u});var s=a.weightsManifest;if(null!=s){var c;try{c=n.checkManifestAndWeightFiles(s,e)}catch(t){return void i(t)}var l=[],f=[],h=[];s.forEach(function(t){t.paths.forEach(function(t){f.push(t),h.push(null)}),l.push.apply(l,t.weights)}),s.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,i=f.indexOf(t);h[i]=n,-1===h.indexOf(null)&&r({modelTopology:u,weightSpecs:l,weightData:df(h),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},e.onerror=function(e){return i("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])})})}else i(new Error("weightManifest field is missing from file "+t.name))}else i(new Error("modelTopology field is missing from file "+t.name))},o.onerror=function(e){return i("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return pf(t.name)}),i={},o=0,a=t;o<a.length;o++)a[o].paths.forEach(function(t){var o=pf(t);if(-1!==n.indexOf(o))throw new Error("Duplicate file basename found in weights manifest: '"+o+"'");if(n.push(o),-1===r.indexOf(o))throw new Error("Weight file with basename '"+o+"' is not provided.");i[t]=e[r.indexOf(o)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return i},t}();function qf(t,e,n,r){!function(t){C(null!=t&&Array.isArray(t)&&t.length>0,function(){return"promises must be a none empty array"})}(t),function(t,e){C(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t}),C(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),C(e>=t,function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e})}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(t.map(function(o){return o.then(function(o){var a=n+ ++i/t.length*(r-n);return e(a),o}),o}))}function Kf(t,e){return s(this,void 0,void 0,function(){var n,r,i,o,a,u,s,l,h;return c(this,function(c){switch(c.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?f().platform.fetch:e.fetchFunc,r=t.map(function(t){return n(t,e.requestInit,{isBinary:!0})}),i=0,o=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=c.sent(),[3,4];case 2:return[4,qf(r,e.onProgress,i,o)];case 3:a=c.sent(),c.label=4;case 4:return u=a.map(function(t){return t.arrayBuffer()}),s=.5,l=1,null!=e.onProgress?[3,6]:[4,Promise.all(u)];case 5:return h=c.sent(),[3,8];case 6:return[4,qf(u,e.onProgress,s,l)];case 7:h=c.sent(),c.label=8;case 8:return[2,h]}})})}function Xf(t){var e=this;return function(n,r,i){return void 0===r&&(r=""),s(e,void 0,void 0,function(){var e,o,a,u,s,l,f,h,d,p;return c(this,function(c){switch(c.label){case 0:if(e=n.map(function(){return!1}),o={},a=null!=i?i.map(function(){return!1}):[],u=[],n.forEach(function(t,n){var r=0;t.weights.forEach(function(t){var s="quantization"in t?t.quantization.dtype:t.dtype,c=uf[s]*O(t.shape),l=function(){e[n]=!0,null==o[n]&&(o[n]=[]),o[n].push({manifestEntry:t,groupOffset:r,sizeBytes:c})};null!=i?i.forEach(function(e,n){e===t.name&&(l(),a[n]=!0)}):l(),u.push(t.name),r+=c})}),!a.every(function(t){return t}))throw s=i.filter(function(t,e){return!a[e]}),new Error("Could not find weights in manifest with names: "+s.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=e.reduce(function(t,e,n){return e&&t.push(n),t},[]),f=[],l.forEach(function(t){n[t].paths.forEach(function(t){var e=r+(r.endsWith("/")?"":"/")+t;f.push(e)})}),[4,t(f)];case 1:return h=c.sent(),d={},p=0,l.forEach(function(t){for(var e=n[t].paths.length,r=0,i=0;i<e;i++)r+=h[p+i].byteLength;for(var a=new ArrayBuffer(r),u=new Uint8Array(a),s=0,c=0;c<e;c++){var l=new Uint8Array(h[p+c]);u.set(l,s),s+=l.byteLength}o[t].forEach(function(t){var e=cf(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)d[n]=e[n]}),p+=e}),[2,d]}})})}}mf.registerSaveRouter(function(t){return f().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Gf.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new Gf(t)}(t.slice(Gf.URL_SCHEME.length)):null});var Yf=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(C("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=f().platform.fetch,C(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&C(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return s(this,void 0,void 0,function(){var e,n,r,i;return c(this,function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=o.sent()).ok)return[2,{modelArtifactsInfo:vf(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},t.prototype.load=function(){return s(this,void 0,void 0,function(){var t,e,n,r,i,o,a,u,s,l,f,h;return c(this,function(c){switch(c.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=c.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");c.label=2;case 2:return c.trys.push([2,4,,5]),[4,t.json()];case 3:return e=c.sent(),[3,5];case 4:throw c.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=e.modelTopology,i=e.weightsManifest,o=e.generatedBy,a=e.convertedBy,u=e.format,s=e.userDefinedMetadata,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:h=c.sent(),l=h[0],f=h[1],c.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:f,userDefinedMetadata:s,generatedBy:o,convertedBy:a,format:u}]}})})},t.prototype.loadWeights=function(t){return s(this,void 0,void 0,function(){var e,n,r,i,o,a,u,s,l,f,h;return c(this,function(c){switch(c.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],i=n[1],o=this.weightPathPrefix||r,a=[],u=0,s=t;u<s.length;u++)l=s[u],a.push.apply(a,l.weights);return f=[],t.forEach(function(t){t.paths.forEach(function(t){f.push(o+t+i)})}),[4,Kf(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=c.sent(),[2,[a,df(h)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function Qf(t){return null!=t.match(Yf.URL_SCHEME_REGEX)}var $f=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every(function(t){return Qf(t)}):Qf(t))?Jf(t,{onProgress:e}):null};function Jf(t,e){return new Yf(t,e)}mf.registerSaveRouter($f),mf.registerLoadRouter($f);var Zf,th=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return s(this,void 0,void 0,function(){return c(this,function(t){return[2,this.modelArtifacts]})})},t}(),eh=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){return[2,this.saveHandler(t)]})})},t}(),nh=Object.freeze({browserFiles:function(t){return new Hf(t)},browserHTTPRequest:function(t,e){return Jf(t,e)},concatenateArrayBuffers:df,decodeWeights:cf,encodeWeights:function(t,e){return s(this,void 0,void 0,function(){var n,r,i,o,a,u=this;return c(this,function(l){switch(l.label){case 0:for(n=[],r=[],i=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t),o=function(o){var a=i[o],l=Array.isArray(t)?t[o].tensor:t[a];if("float32"!==l.dtype&&"int32"!==l.dtype&&"bool"!==l.dtype&&"string"!==l.dtype)throw new Error("Unsupported dtype in weight '"+a+"': "+l.dtype);var f={name:a,shape:l.shape,dtype:l.dtype};if("string"===l.dtype){var h=new Promise(function(t){return s(u,void 0,void 0,function(){var e,n,r,i,o,a,u;return c(this,function(s){switch(s.label){case 0:return[4,l.bytes()];case 1:for(e=s.sent(),n=e.reduce(function(t,e){return t+e.length},0)+sf*e.length,r=new Uint8Array(n),i=0,o=0;o<e.length;o++)a=e[o],u=new Uint8Array(new Uint32Array([a.length]).buffer),r.set(u,i),i+=sf,r.set(a,i),i+=a.length;return t(r),[2]}})})});r.push(h)}else r.push(l.data());null!=e&&(f.group=e),n.push(f)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:lf(l.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new th(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new th({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new th({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return mf.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:vf,getSaveHandlers:function(t){return mf.getSaveHandlers(t)},http:Jf,isHTTPScheme:Qf,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),s(this,void 0,void 0,function(){return c(this,function(i){return[2,Xf(function(t){return Kf(t,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return mf.registerLoadRouter(t)},registerSaveRouter:function(t){return mf.registerSaveRouter(t)},weightsLoaderFactory:Xf,withSaveHandler:function(t){return new eh(t)},copyModel:function(t,e){return s(this,void 0,void 0,function(){return c(this,function(n){return[2,wf(t,e,!1)]})})},listModels:function(){return s(this,void 0,void 0,function(){var t,e,n,r,i,o,a;return c(this,function(u){switch(u.label){case 0:t=yf.getSchemes(),e={},n=0,r=t,u.label=1;case 1:return n<r.length?(i=r[n],[4,yf.getManager(i).listModels()]):[3,4];case 2:for(a in o=u.sent())e[i+gf+a]=o[a];u.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return s(this,void 0,void 0,function(){return c(this,function(n){return[2,wf(t,e,!0)]})})},removeModel:function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(n){return e=bf(t),[2,yf.getManager(e.scheme).removeModel(e.path)]})})}}),rh=ln({confusionMatrix_:function(t,e,n){var r=$e(t,"labels","confusionMatrix"),i=$e(e,"predictions","confusionMatrix");C(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),C(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),C(1===i.rank,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),C(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),C(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var o=er(r.asType("int32"),n),a=er(i.asType("int32"),n);return o.transpose().matMul(a).asType("int32")}}),ih=(Object.freeze({confusionMatrix:rh}),ln({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(i&&i&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=v("FromPixels",jt.backendName))return jt.runKernel("FromPixels",{pixels:t},{numChannels:e});var u,s,c=i?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],f=c[1];if(a?u=t.getContext("2d").getImageData(0,0,l,f).data:r||n?u=t.data:(o||i)&&(null==Zf&&(Zf=document.createElement("canvas").getContext("2d")),Zf.canvas.width=l,Zf.canvas.height=f,Zf.drawImage(t,0,0,l,f),u=Zf.getImageData(0,0,l,f).data),4===e)s=new Int32Array(u);else{var h=l*f;s=new Int32Array(h*e);for(var d=0;d<h;d++)for(var p=0;p<e;++p)s[d*e+p]=u[4*d+p]}return bn(s,[f,l,e],"int32")}})),oh=Object.freeze({toPixels:function(t,e){return s(this,void 0,void 0,function(){var n,r,i,o,a,u,s,l,f,h,d,p,v,m,g,y,b,w,x,k,E,C,_;return c(this,function(c){switch(c.label){case 0:if(n=$e(t,"img","toPixels"),t instanceof xt||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],o=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return u=c.sent(),s=n.min(),l=n.max(),[4,Promise.all([s.data(),l.data()])];case 2:if(f=c.sent(),h=f[0],d=f[1],p=h[0],v=d[0],s.dispose(),l.dispose(),"float32"===n.dtype){if(p<0||v>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+v+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||v>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+v+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(o*i*4),y=0;y<i*o;++y)b=void 0,w=void 0,x=void 0,k=void 0,1===a?(b=u[y]*m,w=u[y]*m,x=u[y]*m,k=255):3===a?(b=u[3*y]*m,w=u[3*y+1]*m,x=u[3*y+2]*m,k=255):4===a&&(b=u[4*y]*m,w=u[4*y+1]*m,x=u[4*y+2]*m,k=u[4*y+3]*m),g[0+(E=4*y)]=Math.round(b),g[E+1]=Math.round(w),g[E+2]=Math.round(x),g[E+3]=Math.round(k);return null!=e&&(e.width=o,e.height=i,C=e.getContext("2d"),_=new ImageData(g,o,i),C.putImageData(_,0,0)),n!==t&&n.dispose(),[2,g]}})})},fromPixels:ih}),ah=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),uh=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function sh(t){C(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),C("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),C(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),uh.register(t)}Object.freeze({Serializable:ah,SerializationMap:uh,registerClass:sh});var ch=.001,lh=.1;function fh(){return 32===jt.backend.floatPrecision()?ch:lh}function hh(t,e,n){var r=!0;if((W(t)||W(e))&&(r=!1),W(t)&&W(e)&&(r=!0),r){var i=t.constructor.name,o=e.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(t)&&Array.isArray(e)){var a=Ye(t),u=Ye(e);if(!I(a,u))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+u+"]")}var s=W(t)?t:T(t),c=W(e)?e:T(e);if(s.length!==c.length)throw new Error("Arrays have different lengths actual: "+s.length+" vs expected: "+c.length+".\nActual:   "+s+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=s[l],h=c[l];if(!n(f,h))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+h+".\nActual:   "+s+".\nExpected: "+c+".")}}function dh(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}Object.freeze({TEST_EPSILON_FLOAT16:lh,expectArraysClose:function(t,e,n){return null==n&&(n=fh()),hh(t,e,function(t,e){return dh(t,e,n)})},testEpsilon:fh,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return q(t)||q(t[0])||q(e)||q(e[0])?hh(t,n,function(t,e){return t==e}):hh(t,e,function(t,e){return dh(t,e,0)})},expectNumbersClose:function(t,e,n){if(null==n&&(n=fh()),!dh(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error("Value out of range:"+t[r]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:Yo,webgl_util:We,forceHalfFloat:function(){f().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:iu,setWebGLContext:qt,GPGPUContext:Qo});var ph=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),i=r.value,o=r.grads;if(null!=n){var a=n.map(function(t){return{name:t.name,tensor:o[t.name]}});this.applyGradients(a)}else this.applyGradients(o);return Ke(o),e?i:(i.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return function(t,e){C(Q(t),function(){return"The f passed in variableGrads(f) must be a function"}),C(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof Ot}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=e;if(!n)for(var r in e=[],jt.registeredVariables)e.push(jt.registeredVariables[r]);var i=n?e.filter(function(t){return!t.trainable}):null,o=e.length;C((e=e.filter(function(t){return t.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=jt.gradients(t,e,null,!0),u=a.value,s=a.grads;C(s.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),C(0===u.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"});var c={};return e.forEach(function(t,e){null!=s[e]&&(c[t.name]=s[e])}),null!=i&&i.forEach(function(t){return c[t.name]=null}),{value:u,grads:c}}(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&Ke(this.iterations_)},e.prototype.saveIterations=function(){return s(this,void 0,void 0,function(){return c(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:mn(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){return c(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){return c(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}})})},e}(ah);Object.defineProperty(ph,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var vh=function(t){function e(e,n,r){void 0===r&&(r=null);var i=t.call(this)||this;return i.learningRate=e,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=jt.backend.epsilon()),i}return u(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=jt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:qe(function(){return Sn(i).variable(!1)})}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:qe(function(){return Sn(i).variable(!1)})});var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=e.accumulatedGrads[r].variable,u=e.accumulatedUpdates[r].variable;qe(function(){var t=a.mul(e.rho).add(o.square().mul(1-e.rho)),n=u.add(e.epsilon).sqrt().div(a.add(e.epsilon).sqrt()).mul(o),r=u.mul(e.rho).add(n.square().mul(1-e.rho));a.assign(t),u.assign(r);var s=n.mul(-e.learningRate).add(i);i.assign(s)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Ke(this.accumulatedGrads.map(function(t){return t.variable})),Ke(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(ph);sh(vh);var mh=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return u(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=jt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:qe(function(){return En(i.shape,e.initialAccumulatorValue).variable(!1)})});var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=e.accumulatedGrads[r].variable;qe(function(){var t=a.add(o.square());a.assign(t);var n=o.div(t.add(jt.backend.epsilon()).sqrt()).mul(-e.learningRate).add(i);i.assign(n)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Ke(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(ph);sh(mh);var gh=function(t){function e(e,n,r,i){void 0===i&&(i=null);var o=t.call(this)||this;return o.learningRate=e,o.beta1=n,o.beta2=r,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],qe(function(){o.accBeta1=mn(n).variable(),o.accBeta2=mn(r).variable()}),null==i&&(o.epsilon=jt.backend.epsilon()),o}return u(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);qe(function(){var r=Ts(1,e.accBeta1),i=Ts(1,e.accBeta2);n.forEach(function(n,o){var a=jt.registeredVariables[n];null==e.accumulatedFirstMoment[o]&&(e.accumulatedFirstMoment[o]={originalName:n+"/m",variable:qe(function(){return Sn(a).variable(!1)})}),null==e.accumulatedSecondMoment[o]&&(e.accumulatedSecondMoment[o]={originalName:n+"/v",variable:qe(function(){return Sn(a).variable(!1)})});var u=Array.isArray(t)?t[o].tensor:t[n];if(null!=u){var s=e.accumulatedFirstMoment[o].variable,c=e.accumulatedSecondMoment[o].variable,l=s.mul(e.beta1).add(u.mul(1-e.beta1)),f=c.mul(e.beta2).add(u.square().mul(1-e.beta2)),h=l.div(r),d=f.div(i);s.assign(l),c.assign(f);var p=h.div(d.sqrt().add(e.epsilon)).mul(-e.learningRate).add(a);a.assign(p)}}),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ke(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&Ke(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){var e,n=this;return c(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),qe(function(){n.accBeta1.assign(Cs(n.beta1,n.iterations_+1)),n.accBeta2.assign(Cs(n.beta2,n.iterations_+1))}),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(ph);sh(gh);var yh=function(t){function e(e,n,r,i,o){void 0===i&&(i=null),void 0===o&&(o=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=i,a.decay=o,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],qe(function(){a.iteration=mn(0).variable(),a.accBeta1=mn(n).variable()}),null==i&&(a.epsilon=jt.backend.epsilon()),a}return u(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);qe(function(){var r=Ts(1,e.accBeta1),i=hs(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach(function(n,o){var a=jt.registeredVariables[n];null==e.accumulatedFirstMoment[o]&&(e.accumulatedFirstMoment[o]={originalName:n+"/m",variable:Sn(a).variable(!1)}),null==e.accumulatedWeightedInfNorm[o]&&(e.accumulatedWeightedInfNorm[o]={originalName:n+"/v",variable:Sn(a).variable(!1)});var u=Array.isArray(t)?t[o].tensor:t[n];if(null!=u){var s=e.accumulatedFirstMoment[o].variable,c=e.accumulatedWeightedInfNorm[o].variable,l=s.mul(e.beta1).add(u.mul(1-e.beta1)),f=c.mul(e.beta2),h=u.abs(),d=f.maximum(h);s.assign(l),c.assign(d);var p=i.div(r).mul(l.div(d.add(e.epsilon))).add(a);a.assign(p)}}),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ke(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&Ke(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){return c(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){return c(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(ph);sh(yh);var bh=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return u(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var o=jt.registeredVariables[n];qe(function(){var t=e.c.mul(i).add(o);o.assign(t)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function(t){return jt.keep(t)}(mn(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(ph);sh(bh);var wh=function(t){function e(e,n,r){void 0===r&&(r=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=mn(i.momentum),i}return u(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=jt.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:qe(function(){return Sn(i).variable(!1)})});var o=e.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[n];null!=a&&qe(function(){var t,n=e.m.mul(o).add(a);t=e.useNesterov?e.c.mul(a.add(n.mul(e.m))).add(i):e.c.mul(n).add(i),o.assign(n),i.assign(t)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Ke(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(bh);sh(wh);var xh=function(t){function e(e,n,r,i,o){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1);var a=t.call(this)||this;if(a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=i,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=o,null==i&&(a.epsilon=jt.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return u(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=jt.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:qe(function(){return Sn(i).variable(!1)})}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:qe(function(){return Sn(i).variable(!1)})}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:qe(function(){return Sn(i).variable(!1)})});var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=e.accumulatedMeanSquares[r].variable,u=e.accumulatedMoments[r].variable;qe(function(){var t=a.mul(e.decay).add(o.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,s=n.mul(e.decay).add(o.mul(1-e.decay)),c=u.mul(e.momentum).add(o.mul(e.learningRate).div(t.sub(s.square().add(e.epsilon)).sqrt()));a.assign(t),n.assign(s),u.assign(c);var l=i.sub(c);i.assign(l)}else{var f=a.mul(e.decay).add(o.square().mul(1-e.decay));c=u.mul(e.momentum).add(o.mul(e.learningRate).div(f.add(e.epsilon).sqrt())),a.assign(f),u.assign(c),l=i.sub(c),i.assign(l)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Ke(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Ke(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&Ke(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(ph);sh(xh);var kh=function(){function t(){}return t.sgd=function(t){return new bh(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new wh(t,e,n)},t.rmsprop=function(t,e,n,r,i){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new xh(t,e,n,r,i)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new gh(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new vh(t,e,n)},t.adamax=function(t,e,n,r,i){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new yh(t,e,n,r,i)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new mh(t,e)},t}();kh.sgd,kh.momentum,kh.adadelta,kh.adagrad,kh.rmsprop,kh.adamax,kh.adam,"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame;xt.prototype.squaredDifference=function(t){return uu(this,t)},bt=Gl}).call(this,n(23),n(26),n(44).Buffer,n(48).setImmediate)},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";t.exports=n(37)},function(t,e,n){"use strict";function r(t,e,n,r,i,o,a){try{var u=t[o](a),s=u.value}catch(c){return void n(c)}u.done?e(s):Promise.resolve(s).then(r,i)}function i(t){return function(){var e=this,n=arguments;return new Promise(function(i,o){var a=t.apply(e,n);function u(t){r(a,i,o,u,s,"next",t)}function s(t){r(a,i,o,u,s,"throw",t)}u(void 0)})}}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return d}),n.d(e,"b",function(){return T}),n.d(e,"c",function(){return S}),n.d(e,"d",function(){return h}),n.d(e,"e",function(){return p}),n.d(e,"f",function(){return I}),n.d(e,"g",function(){return A}),n.d(e,"h",function(){return v}),n.d(e,"i",function(){return g}),n.d(e,"j",function(){return b}),n.d(e,"k",function(){return w}),n.d(e,"l",function(){return E}),n.d(e,"m",function(){return m}),n.d(e,"n",function(){return y}),n.d(e,"o",function(){return k}),n.d(e,"p",function(){return x}),n.d(e,"q",function(){return C});n(11);var r=n(9),i=n(6),o=n(8),a=n(21),u=n(35),s=n(2),c=n(3);var l=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296===(64512&i)&&r+1<t.length&&56320===(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},f={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,u=a?t[i+1]:0,s=i+2<t.length,c=s?t[i+2]:0,l=o>>2,f=(3&o)<<4|u>>4,h=(15&u)<<2|c>>6,d=63&c;s||(d=64,a||(h=64)),r.push(n[l],n[f],n[h],n[d])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(l(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var a=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{var u=t[n++],s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&u)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,u=++i<t.length?n[t.charAt(i)]:64,s=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==u||null==s)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==u){var l=a<<4&240|u>>2;if(r.push(l),64!==s){var f=u<<6&192|s;r.push(f)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},h=function(t){return function(t){var e=l(t);return f.encodeByteArray(e,!0)}(t).replace(/\./g,"")};var d=function(){function t(){var e=this;Object(s.a)(this,t),this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return Object(c.a)(t,[{key:"wrapCallback",value:function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"===typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}}}]),t}();function p(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var o=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(o)),""].join(".")}function v(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())}function g(){var t="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof t&&void 0!==t.id}function y(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function b(){return v().indexOf("Electron/")>=0}function w(){var t=v();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function x(){return v().indexOf("MSAppHost/")>=0}function k(){return!function(){try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E(){return"object"===typeof indexedDB}function C(){return new Promise(function(t,e){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(o){e(o)}})}var _="FirebaseError",S=function(t){function e(t,n,o){var u;return Object(s.a)(this,e),(u=Object(r.a)(this,Object(i.a)(e).call(this,n))).code=t,u.customData=o,u.name=_,Object.setPrototypeOf(Object(a.a)(Object(a.a)(u)),e.prototype),Error.captureStackTrace&&Error.captureStackTrace(Object(a.a)(Object(a.a)(u)),T.prototype.create),u}return Object(o.a)(e,t),e}(Object(u.a)(Error)),T=function(){function t(e,n,r){Object(s.a)(this,t),this.service=e,this.serviceName=n,this.errors=r}return Object(c.a)(t,[{key:"create",value:function(t){var e=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(t),r=this.errors[t],i=r?function(t,e){return t.replace(O,function(t,n){var r=e[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,e):"Error",o="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new S(n,o,e)}}]),t}();var O=/\{\$([^}]+)}/g;function I(t,e){if(t===e)return!0;for(var n=Object.keys(t),r=Object.keys(e),i=0,o=n;i<o.length;i++){var a=o[i];if(!r.includes(a))return!1;var u=t[a],s=e[a];if(R(u)&&R(s)){if(!I(u,s))return!1}else if(u!==s)return!1}for(var c=0,l=r;c<l.length;c++){var f=l[c];if(!n.includes(f))return!1}return!0}function R(t){return null!==t&&"object"===typeof t}function A(t){return t&&t._delegate?t._delegate:t}}).call(this,n(23))},function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(25);function i(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Object(r.a)(t,e)}},function(t,e,n){"use strict";function r(t){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return(i="function"===typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return r(t)}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)})(t)}var o=n(21);function a(t,e){return!e||"object"!==i(e)&&"function"!==typeof e?Object(o.a)(t):e}n.d(e,"a",function(){return a})},function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(s){i=!0,o=s}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";var r=n(32);n.d(e,"a",function(){return r.a}),n.d(e,"b",function(){return r.b}),n.d(e,"c",function(){return r.c}),n.d(e,"d",function(){return r.d}),n.d(e,"e",function(){return r.e}),n.d(e,"f",function(){return r.f}),n.d(e,"g",function(){return r.g}),n.d(e,"h",function(){return r.h}),n.d(e,"i",function(){return r.i}),n.d(e,"j",function(){return r.j})},function(t,e,n){"use strict";var r,i,o=n(14),a=n(5),u=n(10),s=n(2),c=n(3),l=n(20),f=n(17),h=n(7),d=n(19),p=function(t,e){return e.some(function(e){return t instanceof e})};var v=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap;var w={get:function(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return m.get(t);if("objectStoreNames"===e)return t.objectStoreNames||g.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return E(t[e])},set:function(t,e,n){return t[e]=n,!0},has:function(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function x(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(C(this),n),E(v.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return E(t.apply(C(this),n))}:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=t.call.apply(t,[C(this),e].concat(r));return g.set(o,e.sort?e.sort():[e]),E(o)}}function k(t){return"function"===typeof t?x(t):(t instanceof IDBTransaction&&function(t){if(!m.has(t)){var e=new Promise(function(e,n){var r=function(){t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=function(){e(),r()},o=function(){n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});m.set(t,e)}}(t),p(t,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,w):t)}function E(t){if(t instanceof IDBRequest)return function(t){var e=new Promise(function(e,n){var r=function(){t.removeEventListener("success",i),t.removeEventListener("error",o)},i=function(){e(E(t.result)),r()},o=function(){n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(function(e){e instanceof IDBCursor&&v.set(e,t)}).catch(function(){}),b.set(e,t),e}(t);if(y.has(t))return y.get(t);var e=k(t);return e!==t&&(y.set(t,e),b.set(e,t)),e}var C=function(t){return b.get(t)};function _(){_=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(T){u=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new E(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=w(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(T){return{type:"throw",arg:T}}}t.wrap=s;var l={};function f(){}function h(){}function d(){}var p={};u(p,i,function(){return this});var v=Object.getPrototypeOf,m=v&&v(v(C([])));m&&m!==e&&n.call(m,i)&&(p=m);var g=d.prototype=f.prototype=Object.create(p);function y(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var r;this._invoke=function(i,o){function a(){return new e(function(r,a){!function r(i,o,a,u){var s=c(t[i],t,o);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then(function(t){r("next",t,a,u)},function(t){r("throw",t,a,u)}):e.resolve(f).then(function(t){l.value=t,a(l)},function(t){return r("throw",t,a,u)})}u(s.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function C(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=d,u(g,"constructor",d),u(d,"constructor",h),h.displayName=u(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},y(b.prototype),u(b.prototype,o,function(){return this}),t.AsyncIterator=b,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new b(s(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},y(g),u(g,a,"Generator"),u(g,i,function(){return this}),u(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=C,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var S,T,O=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],R=new Map;function A(t,e){if(t instanceof IDBDatabase&&!(e in t)&&"string"===typeof e){if(R.get(e))return R.get(e);var n=e.replace(/FromIndex$/,""),r=e!==n,i=I.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||O.includes(n))){var o=function(){var t=Object(a.a)(_().mark(function t(e){var o,a,u,s,c,l,f=arguments;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(a=this.transaction(e,i?"readwrite":"readonly"),u=a.store,s=f.length,c=new Array(s>1?s-1:0),l=1;l<s;l++)c[l-1]=f[l];return r&&(u=u.index(c.shift())),t.next=6,Promise.all([(o=u)[n].apply(o,c),i&&a.done]);case 6:return t.abrupt("return",t.sent[0]);case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}();return R.set(e,o),o}}}function D(){D=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(S){u=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new E(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return _()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=w(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(S){return{type:"throw",arg:S}}}t.wrap=s;var l={};function f(){}function h(){}function d(){}var p={};u(p,i,function(){return this});var v=Object.getPrototypeOf,m=v&&v(v(C([])));m&&m!==e&&n.call(m,i)&&(p=m);var g=d.prototype=f.prototype=Object.create(p);function y(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var r;this._invoke=function(i,o){function a(){return new e(function(r,a){!function r(i,o,a,u){var s=c(t[i],t,o);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then(function(t){r("next",t,a,u)},function(t){r("throw",t,a,u)}):e.resolve(f).then(function(t){l.value=t,a(l)},function(t){return r("throw",t,a,u)})}u(s.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function C(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:_}}function _(){return{value:void 0,done:!0}}return h.prototype=d,u(g,"constructor",d),u(d,"constructor",h),h.displayName=u(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},y(b.prototype),u(b.prototype,o,function(){return this}),t.AsyncIterator=b,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new b(s(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},y(g),u(g,a,"Generator"),u(g,i,function(){return this}),u(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=C,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function N(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return P(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}w=function(t){return Object(d.a)({},t,{get:function(e,n,r){return A(e,n)||t.get(e,n,r)},has:function(e,n){return!!A(e,n)||t.has(e,n)}})}(w),n.d(e,"a",function(){return Q}),n.d(e,"b",function(){return H}),n.d(e,"c",function(){return G}),n.d(e,"d",function(){return q}),n.d(e,"e",function(){return J}),n.d(e,"f",function(){return $}),n.d(e,"g",function(){return Z});var M=function(){function t(e){Object(s.a)(this,t),this.container=e}return Object(c.a)(t,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map(function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}(t)){var e=t.getImmediate();return"".concat(e.library,"/").concat(e.version)}return null}).filter(function(t){return t}).join(" ")}}]),t}();var F="@firebase/app",L="0.7.27",j=new f.b("@firebase/app"),B="[DEFAULT]",V=(S={},Object(u.a)(S,F,"fire-core"),Object(u.a)(S,"@firebase/app-compat","fire-core-compat"),Object(u.a)(S,"@firebase/analytics","fire-analytics"),Object(u.a)(S,"@firebase/analytics-compat","fire-analytics-compat"),Object(u.a)(S,"@firebase/app-check","fire-app-check"),Object(u.a)(S,"@firebase/app-check-compat","fire-app-check-compat"),Object(u.a)(S,"@firebase/auth","fire-auth"),Object(u.a)(S,"@firebase/auth-compat","fire-auth-compat"),Object(u.a)(S,"@firebase/database","fire-rtdb"),Object(u.a)(S,"@firebase/database-compat","fire-rtdb-compat"),Object(u.a)(S,"@firebase/functions","fire-fn"),Object(u.a)(S,"@firebase/functions-compat","fire-fn-compat"),Object(u.a)(S,"@firebase/installations","fire-iid"),Object(u.a)(S,"@firebase/installations-compat","fire-iid-compat"),Object(u.a)(S,"@firebase/messaging","fire-fcm"),Object(u.a)(S,"@firebase/messaging-compat","fire-fcm-compat"),Object(u.a)(S,"@firebase/performance","fire-perf"),Object(u.a)(S,"@firebase/performance-compat","fire-perf-compat"),Object(u.a)(S,"@firebase/remote-config","fire-rc"),Object(u.a)(S,"@firebase/remote-config-compat","fire-rc-compat"),Object(u.a)(S,"@firebase/storage","fire-gcs"),Object(u.a)(S,"@firebase/storage-compat","fire-gcs-compat"),Object(u.a)(S,"@firebase/firestore","fire-fst"),Object(u.a)(S,"@firebase/firestore-compat","fire-fst-compat"),Object(u.a)(S,"fire-js","fire-js"),Object(u.a)(S,"firebase","fire-js-all"),S),U=new Map,z=new Map;function W(t,e){try{t.container.addComponent(e)}catch(n){j.debug("Component ".concat(e.name," failed to register with FirebaseApp ").concat(t.name),n)}}function G(t){var e=t.name;if(z.has(e))return j.debug("There were multiple attempts to register component ".concat(e,".")),!1;z.set(e,t);var n,r=N(U.values());try{for(r.s();!(n=r.n()).done;){W(n.value,t)}}catch(i){r.e(i)}finally{r.f()}return!0}function H(t,e){var n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function q(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B;H(t,e).clearInstance(n)}var K=(T={},Object(u.a)(T,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),Object(u.a)(T,"bad-app-name","Illegal App name: '{$appName}"),Object(u.a)(T,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),Object(u.a)(T,"app-deleted","Firebase App named '{$appName}' already deleted"),Object(u.a)(T,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),Object(u.a)(T,"invalid-log-argument","First argument to `onLog` must be null or a function."),Object(u.a)(T,"storage-open","Error thrown when opening storage. Original error: {$originalErrorMessage}."),Object(u.a)(T,"storage-get","Error thrown when reading from storage. Original error: {$originalErrorMessage}."),Object(u.a)(T,"storage-set","Error thrown when writing to storage. Original error: {$originalErrorMessage}."),Object(u.a)(T,"storage-delete","Error thrown when deleting from storage. Original error: {$originalErrorMessage}."),T),X=new h.b("app","Firebase",K),Y=function(){function t(e,n,r){var i=this;Object(s.a)(this,t),this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new l.a("app",function(){return i},"PUBLIC"))}return Object(c.a)(t,[{key:"checkDestroyed",value:function(){if(this.isDeleted)throw X.create("app-deleted",{appName:this._name})}},{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(t){this._isDeleted=t}}]),t}(),Q="9.8.4";function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"object"!==typeof e&&(e={name:e});var n=Object.assign({name:B,automaticDataCollectionEnabled:!1},e),r=n.name;if("string"!==typeof r||!r)throw X.create("bad-app-name",{appName:String(r)});var i=U.get(r);if(i){if(Object(h.f)(t,i.options)&&Object(h.f)(n,i.config))return i;throw X.create("duplicate-app",{appName:r})}var o,a=new l.b(r),u=N(z.values());try{for(u.s();!(o=u.n()).done;){var s=o.value;a.addComponent(s)}}catch(f){u.e(f)}finally{u.f()}var c=new Y(t,n,a);return U.set(r,c),c}function J(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,e=U.get(t);if(!e)throw X.create("no-app",{appName:t});return e}function Z(t,e,n){var r,i=null!==(r=V[t])&&void 0!==r?r:t;n&&(i+="-".concat(n));var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var u=['Unable to register library "'.concat(i,'" with version "').concat(e,'":')];return o&&u.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),o&&a&&u.push("and"),a&&u.push('version name "'.concat(e,'" contains illegal characters (whitespace or "/")')),void j.warn(u.join(" "))}G(new l.a("".concat(i,"-version"),function(){return{library:i,version:e}},"VERSION"))}var tt="firebase-heartbeat-database",et=1,nt="firebase-heartbeat-store",rt=null;function it(){return rt||(rt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,o=n.blocking,a=n.terminated,u=indexedDB.open(t,e),s=E(u);return i&&u.addEventListener("upgradeneeded",function(t){i(E(u.result),t.oldVersion,t.newVersion,E(u.transaction))}),r&&u.addEventListener("blocked",function(){return r()}),s.then(function(t){a&&t.addEventListener("close",function(){return a()}),o&&t.addEventListener("versionchange",function(){return o()})}).catch(function(){}),s}(tt,et,{upgrade:function(t,e){switch(e){case 0:t.createObjectStore(nt)}}}).catch(function(t){throw X.create("storage-open",{originalErrorMessage:t.message})})),rt}function ot(t){return at.apply(this,arguments)}function at(){return(at=Object(a.a)(D().mark(function t(e){var n,r;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,it();case 3:return r=t.sent,t.abrupt("return",r.transaction(nt).objectStore(nt).get(ct(e)));case 7:throw t.prev=7,t.t0=t.catch(0),X.create("storage-get",{originalErrorMessage:null===(n=t.t0)||void 0===n?void 0:n.message});case 10:case"end":return t.stop()}},t,null,[[0,7]])}))).apply(this,arguments)}function ut(t,e){return st.apply(this,arguments)}function st(){return(st=Object(a.a)(D().mark(function t(e,n){var r,i,o,a;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,it();case 3:return i=t.sent,o=i.transaction(nt,"readwrite"),a=o.objectStore(nt),t.next=8,a.put(n,ct(e));case 8:return t.abrupt("return",o.done);case 11:throw t.prev=11,t.t0=t.catch(0),X.create("storage-set",{originalErrorMessage:null===(r=t.t0)||void 0===r?void 0:r.message});case 14:case"end":return t.stop()}},t,null,[[0,11]])}))).apply(this,arguments)}function ct(t){return"".concat(t.name,"!").concat(t.options.appId)}var lt=1024,ft=function(){function t(e){var n=this;Object(s.a)(this,t),this.container=e,this._heartbeatsCache=null;var r=this.container.getProvider("app").getImmediate();this._storage=new vt(r),this._heartbeatsCachePromise=this._storage.read().then(function(t){return n._heartbeatsCache=t,t})}return Object(c.a)(t,[{key:"triggerHeartbeat",value:function(){var t=Object(a.a)(D().mark(function t(){var e,n,r;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.container.getProvider("platform-logger").getImmediate(),n=e.getPlatformInfoString(),r=ht(),null!==this._heartbeatsCache){t.next=7;break}return t.next=6,this._heartbeatsCachePromise;case 6:this._heartbeatsCache=t.sent;case 7:if(this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some(function(t){return t.date===r})){t.next=11;break}return t.abrupt("return");case 11:this._heartbeatsCache.heartbeats.push({date:r,agent:n});case 12:return this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(function(t){var e=new Date(t.date).valueOf();return Date.now()-e<=2592e6}),t.abrupt("return",this._storage.overwrite(this._heartbeatsCache));case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getHeartbeatsHeader",value:function(){var t=Object(a.a)(D().mark(function t(){var e,n,r,i,o;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==this._heartbeatsCache){t.next=3;break}return t.next=3,this._heartbeatsCachePromise;case 3:if(null!==this._heartbeatsCache&&0!==this._heartbeatsCache.heartbeats.length){t.next=5;break}return t.abrupt("return","");case 5:if(e=ht(),n=dt(this._heartbeatsCache.heartbeats),r=n.heartbeatsToSend,i=n.unsentEntries,o=Object(h.d)(JSON.stringify({version:2,heartbeats:r})),this._heartbeatsCache.lastSentHeartbeatDate=e,!(i.length>0)){t.next=15;break}return this._heartbeatsCache.heartbeats=i,t.next=13,this._storage.overwrite(this._heartbeatsCache);case 13:t.next=17;break;case 15:this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);case 17:return t.abrupt("return",o);case 18:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),t}();function ht(){return(new Date).toISOString().substring(0,10)}function dt(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lt,r=[],i=t.slice(),o=N(t);try{var a=function(){var t=e.value,o=r.find(function(e){return e.agent===t.agent});if(o){if(o.dates.push(t.date),mt(r)>n)return o.dates.pop(),"break"}else if(r.push({agent:t.agent,dates:[t.date]}),mt(r)>n)return r.pop(),"break";i=i.slice(1)};for(o.s();!(e=o.n()).done;){if("break"===a())break}}catch(u){o.e(u)}finally{o.f()}return{heartbeatsToSend:r,unsentEntries:i}}var pt,vt=function(){function t(e){Object(s.a)(this,t),this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}return Object(c.a)(t,[{key:"runIndexedDBEnvironmentCheck",value:function(){var t=Object(a.a)(D().mark(function t(){return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Object(h.l)()){t.next=4;break}return t.abrupt("return",!1);case 4:return t.abrupt("return",Object(h.q)().then(function(){return!0}).catch(function(){return!1}));case 5:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()},{key:"read",value:function(){var t=Object(a.a)(D().mark(function t(){var e;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._canUseIndexedDBPromise;case 2:if(t.sent){t.next=7;break}return t.abrupt("return",{heartbeats:[]});case 7:return t.next=9,ot(this.app);case 9:return e=t.sent,t.abrupt("return",e||{heartbeats:[]});case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"overwrite",value:function(){var t=Object(a.a)(D().mark(function t(e){var n,r;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._canUseIndexedDBPromise;case 2:if(t.sent){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,this.read();case 9:return r=t.sent,t.abrupt("return",ut(this.app,{lastSentHeartbeatDate:null!==(n=e.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats}));case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"add",value:function(){var t=Object(a.a)(D().mark(function t(e){var n,r;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._canUseIndexedDBPromise;case 2:if(t.sent){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,this.read();case 9:return r=t.sent,t.abrupt("return",ut(this.app,{lastSentHeartbeatDate:null!==(n=e.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:[].concat(Object(o.a)(r.heartbeats),Object(o.a)(e.heartbeats))}));case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}();function mt(t){return Object(h.d)(JSON.stringify({version:2,heartbeats:t})).length}pt="",G(new l.a("platform-logger",function(t){return new M(t)},"PRIVATE")),G(new l.a("heartbeat",function(t){return new ft(t)},"PRIVATE")),Z(F,L,pt),Z(F,L,"esm2017"),Z("fire-js","")},function(t,e,n){"use strict";function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return vr}),n.d(e,"b",function(){return gr}),n.d(e,"c",function(){return mr}),n.d(e,"d",function(){return br}),n.d(e,"e",function(){return yr}),n.d(e,"f",function(){return wr}),n.d(e,"g",function(){return xr}),n.d(e,"h",function(){return dr}),n.d(e,"i",function(){return pr});var r=n(9),i=n(22),o=n(6),a=n(8),u=n(2),s=n(3);function c(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f,h="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{},d={},p=p||{},v=h||self;function m(){}function g(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function y(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var b="closure_uid_"+(1e9*Math.random()>>>0),w=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function k(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function E(t,e,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:k).apply(null,arguments)}function C(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function _(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function S(){this.s=this.s,this.o=this.o}var T={};S.prototype.s=!1,S.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,b)&&t[b]||(t[b]=++w)}(this);delete T[t]}},S.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var O=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"===typeof t)return"string"!==typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},I=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"===typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function R(t){return Array.prototype.concat.apply([],arguments)}function A(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function D(t){return/^[\s\xa0]*$/.test(t)}var N,P=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function M(t,e){return-1!=t.indexOf(e)}function F(t,e){return t<e?-1:t>e?1:0}t:{var L=v.navigator;if(L){var j=L.userAgent;if(j){N=j;break t}}N=""}function B(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function V(t){var e={};for(var n in t)e[n]=t[n];return e}var U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<U.length;o++)n=U[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function W(t){return W[" "](t),t}W[" "]=m;var G,H=M(N,"Opera"),q=M(N,"Trident")||M(N,"MSIE"),K=M(N,"Edge"),X=K||q,Y=M(N,"Gecko")&&!(M(N.toLowerCase(),"webkit")&&!M(N,"Edge"))&&!(M(N,"Trident")||M(N,"MSIE"))&&!M(N,"Edge"),Q=M(N.toLowerCase(),"webkit")&&!M(N,"Edge");function $(){var t=v.document;return t?t.documentMode:void 0}t:{var J="",Z=function(){var t=N;return Y?/rv:([^\);]+)(\)|;)/.exec(t):K?/Edge\/([\d\.]+)/.exec(t):q?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):Q?/WebKit\/(\S+)/.exec(t):H?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(Z&&(J=Z?Z[1]:""),q){var tt=$();if(null!=tt&&tt>parseFloat(J)){G=String(tt);break t}}G=J}var et,nt={};function rt(){return function(t){var e=nt;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}(function(){for(var t=0,e=P(String(G)).split("."),n=P("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=F(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||F(0==o[2].length,0==a[2].length)||F(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}if(v.document&&q){var it=$();et=it||(parseInt(G,10)||void 0)}else et=void 0;var ot=et,at=function(){if(!v.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{v.addEventListener("test",m,e),v.removeEventListener("test",m,e)}catch(n){}return t}();function ut(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function st(t,e){if(ut.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Y){t:{try{W(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"===typeof t.pointerType?t.pointerType:ct[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&st.Z.h.call(this)}}ut.prototype.h=function(){this.defaultPrevented=!0},_(st,ut);var ct={2:"touch",3:"pen",4:"mouse"};st.prototype.h=function(){st.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var lt="closure_listenable_"+(1e6*Math.random()|0),ft=0;function ht(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++ft,this.ca=this.fa=!1}function dt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function pt(t){this.src=t,this.g={},this.h=0}function vt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=O(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(dt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function mt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}pt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var a=mt(t,e,r,i);return-1<a?(e=t[a],n||(e.fa=!1)):((e=new ht(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var gt="closure_lm_"+(1e6*Math.random()|0),yt={};function bt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=St(r);return e&&e[lt]?e.O(n,r,y(i)?!!i.capture:!!i,o):wt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)bt(t,e[o],n,r,i);return null}return n=St(n),t&&t[lt]?t.N(e,n,y(r)?!!r.capture:!!r,i):wt(t,e,n,!1,r,i)}function wt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=y(i)?!!i.capture:!!i,u=Ct(t);if(u||(t[gt]=u=new pt(t)),(n=u.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Et;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)at||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(kt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function xt(t){if("number"!==typeof t&&t&&!t.ca){var e=t.src;if(e&&e[lt])vt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(kt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ct(e))?(vt(n,t),0==n.h&&(n.src=null,e[gt]=null)):dt(t)}}}function kt(t){return t in yt?yt[t]:yt[t]="on"+t}function Et(t,e){if(t.ca)t=!0;else{e=new st(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&xt(t),t=n.call(r,e)}return t}function Ct(t){return(t=t[gt])instanceof pt?t:null}var _t="__closure_events_fn_"+(1e9*Math.random()>>>0);function St(t){return"function"===typeof t?t:(t[_t]||(t[_t]=function(e){return t.handleEvent(e)}),t[_t])}function Tt(){S.call(this),this.i=new pt(this),this.P=this,this.I=null}function Ot(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"===typeof e)e=new ut(e,t);else if(e instanceof ut)e.target=e.target||t;else{var i=e;z(e=new ut(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var a=e.g=n[o];i=It(a,r,!0,e)&&i}if(i=It(a=e.g=t,r,!0,e)&&i,i=It(a,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=It(a=e.g=n[o],r,!1,e)&&i}function It(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ca&&a.capture==n){var u=a.listener,s=a.ia||a.src;a.fa&&vt(t.i,a),i=!1!==u.call(s,r)&&i}}return i&&!r.defaultPrevented}_(Tt,S),Tt.prototype[lt]=!0,Tt.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=y(i)?!!i.capture:!!i,r=St(r),e&&e[lt]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=mt(a=e.g[n],r,i,o))&&(dt(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.g[n],e.h--))):e&&(e=Ct(e))&&(n=e.g[n.toString()],e=-1,n&&(e=mt(n,r,i,o)),(r=-1<e?n[e]:null)&&xt(r))}(this,t,e,n,r)},Tt.prototype.M=function(){if(Tt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)dt(n[r]);delete e.g[t],e.h--}}this.I=null},Tt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Tt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Rt=v.JSON.stringify;function At(){var t=Bt,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Dt,Nt=function(){function t(){Object(u.a)(this,t),this.h=this.g=null}return Object(s.a)(t,[{key:"add",value:function(t,e){var n=Pt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}}]),t}(),Pt=new(function(){function t(e,n){Object(u.a)(this,t),this.i=e,this.j=n,this.h=0,this.g=null}return Object(s.a)(t,[{key:"get",value:function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}]),t}())(function(){return new Mt},function(t){return t.reset()}),Mt=function(){function t(){Object(u.a)(this,t),this.next=this.g=this.h=null}return Object(s.a)(t,[{key:"set",value:function(t,e){this.h=t,this.g=e,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),t}();function Ft(t){v.setTimeout(function(){throw t},0)}function Lt(t,e){Dt||function(){var t=v.Promise.resolve(void 0);Dt=function(){t.then(Vt)}}(),jt||(Dt(),jt=!0),Bt.add(t,e)}var jt=!1,Bt=new Nt;function Vt(){for(var t;t=At();){try{t.h.call(t.g)}catch(n){Ft(n)}var e=Pt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}jt=!1}function Ut(t,e){Tt.call(this),this.h=t||1,this.g=e||v,this.j=E(this.kb,this),this.l=Date.now()}function zt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Wt(t,e,n){if("function"===typeof t)n&&(t=E(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=E(t.handleEvent,t)}return 2147483647<Number(e)?-1:v.setTimeout(t,e||0)}_(Ut,Tt),(f=Ut.prototype).da=!1,f.S=null,f.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ot(this,"tick"),this.da&&(zt(this),this.start()))}},f.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},f.M=function(){Ut.Z.M.call(this),zt(this),delete this.g};var Gt=function(t){function e(t,n){var i;return Object(u.a)(this,e),(i=Object(r.a)(this,Object(o.a)(e).call(this))).m=t,i.j=n,i.h=null,i.i=!1,i.g=null,i}return Object(a.a)(e,t),Object(s.a)(e,[{key:"l",value:function(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=Wt(function(){e.g=null,e.i&&(e.i=!1,t(e))},e.j);var n=e.h;e.h=null,e.m.apply(null,n)}(this)}},{key:"M",value:function(){Object(i.a)(Object(o.a)(e.prototype),"M",this).call(this),this.g&&(v.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),e}(S);function Ht(t){S.call(this),this.h=t,this.g={}}_(Ht,S);var qt=[];function Kt(t,e,n,r){Array.isArray(n)||(n&&(qt[0]=n.toString()),n=qt);for(var i=0;i<n.length;i++){var o=bt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Xt(t){B(t.g,function(t,e){this.g.hasOwnProperty(e)&&xt(t)},t),t.g={}}function Yt(){this.g=!0}function Qt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var a=1;a<i.length;a++)i[a]=""}}}return Rt(n)}catch(u){return e}}(t,n)+(r?" "+r:"")})}Ht.prototype.M=function(){Ht.Z.M.call(this),Xt(this)},Ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Yt.prototype.Aa=function(){this.g=!1},Yt.prototype.info=function(){};var $t={},Jt=null;function Zt(){return Jt=Jt||new Tt}function te(t){ut.call(this,$t.Ma,t)}function ee(t){var e=Zt();Ot(e,new te(e,t))}function ne(t,e){ut.call(this,$t.STAT_EVENT,t),this.stat=e}function re(t){var e=Zt();Ot(e,new ne(e,t))}function ie(t,e){ut.call(this,$t.Na,t),this.size=e}function oe(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return v.setTimeout(function(){t()},e)}$t.Ma="serverreachability",_(te,ut),$t.STAT_EVENT="statevent",_(ne,ut),$t.Na="timingevent",_(ie,ut);var ae={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ue={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function se(){}function ce(t){return t.h||(t.h=t.i())}function le(){}se.prototype.h=null;var fe,he={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function de(){ut.call(this,"d")}function pe(){ut.call(this,"c")}function ve(){}function me(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Ht(this),this.P=ye,t=X?125:void 0,this.W=new Ut(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ge}function ge(){this.i=null,this.g="",this.h=!1}_(de,ut),_(pe,ut),_(ve,se),ve.prototype.g=function(){return new XMLHttpRequest},ve.prototype.i=function(){return{}},fe=new ve;var ye=45e3,be={},we={};function xe(t,e,n){t.K=1,t.v=Ge(je(e)),t.s=n,t.U=!0,ke(t,null)}function ke(t,e){t.F=Date.now(),Se(t),t.A=je(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),rn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new ge,t.g=ar(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Gt(E(t.Ia,t,t.g),t.O)),Kt(t.V,t.g,"readystatechange",t.gb),e=t.H?V(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),ee(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var a="",u=o.split("&"),s=0;s<u.length;s++){var c=u[s].split("=");if(1<c.length){var l=c[0];c=c[1];var f=l.split("_");a=2<=f.length&&"type"==f[1]?a+(l+"=")+c+"&":a+(l+"=redacted&")}}else a=null;else a=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+a})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ee(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Ce(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=_e(t,n))==we){4==e&&(t.o=4,re(14),i=!1),Qt(t.j,t.m,null,"[Incomplete Response]");break}if(r==be){t.o=4,re(15),Qt(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Qt(t.j,t.m,r,null),Ae(t,r)}Ee(t)&&r!=we&&r!=be&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,re(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Jn(e),e.L=!0,re(11))):(Qt(t.j,t.m,n,"[Invalid Chunked Response]"),Re(t),Ie(t))}function _e(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?we:(n=Number(e.substring(n,r)),isNaN(n)?be:(r+=1)+n>e.length?we:(e=e.substr(r,n),t.C=r+n,e))}function Se(t){t.Y=Date.now()+t.P,Te(t,t.P)}function Te(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=oe(E(t.eb,t),e)}function Oe(t){t.B&&(v.clearTimeout(t.B),t.B=null)}function Ie(t){0==t.l.G||t.I||er(t.l,t)}function Re(t){Oe(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,zt(t.W),Xt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ae(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||hn(n.i,t)))if(n.I=t.N,!t.J&&hn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;tr(n),Wn(n)}$n(n),re(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=oe(E(n.ab,n),6e3));if(1>=fn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else rr(n,11)}else if((t.J||n.g==t)&&tr(n),!D(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var a=o[3];null!=a&&(n.ma=a,n.h.info("VER="+n.ma));var u=o[4];null!=u&&(n.za=u,n.h.info("SVER="+n.za));var s=o[5];null!=s&&"number"===typeof s&&0<s&&(r=1.5*s,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var f=r.i;!f.g&&(M(l,"spdy")||M(l,"quic")||M(l,"h2"))&&(f.j=f.l,f.g=new Set,f.h&&(dn(f,f.h),f.h=null))}if(r.D){var h=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;h&&(r.sa=h,We(r.F,r.D,h))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=or(r,r.H?r.la:null,r.W),d.J){pn(r.i,d);var p=d,v=r.K;v&&p.setTimeout(v),p.B&&(Oe(p),Se(p)),r.g=d}else Qn(r);0<n.l.length&&qn(n)}else"stop"!=o[0]&&"close"!=o[0]||rr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?rr(n,7):zn(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}ee(4)}catch(o){}}function De(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(g(t)||"string"===typeof t)I(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(g(t)||"string"===typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"===typeof t)return t.split("");if(g(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ne(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ne)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Pe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Me(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Me(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Me(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(f=me.prototype).setTimeout=function(t){this.P=t},f.gb=function(t){t=t.target;var e=this.L;e&&3==Ln(t)?e.l():this.Ia(t)},f.Ia=function(t){try{if(t==this.g)t:{var e=Ln(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||X||this.g&&(this.h.h||this.g.ga()||jn(this.g)))){this.I||4!=e||7==n||ee(8==n||0>=r?3:2),Oe(this);var i=this.g.ba();this.N=i;e:if(Ee(this)){var o=jn(this.g);t="";var a=o.length,u=4==Ln(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Re(this),Ie(this);var s="";break e}this.h.i=new v.TextDecoder}for(n=0;n<a;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:u&&n==a-1});o.splice(0,a),this.h.g+=t,this.C=0,s=this.h.g}else s=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,a){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+a})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(c)){var f=c;break e}}f=null}if(!(i=f)){this.i=!1,this.o=3,re(12),Re(this),Ie(this);break t}Qt(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ae(this,i)}this.U?(Ce(this,e,s),X&&this.i&&3==e&&(Kt(this.V,this.W,"tick",this.fb),this.W.start())):(Qt(this.j,this.m,s,null),Ae(this,s)),4==e&&Re(this),this.i&&!this.I&&(4==e?er(this.l,this):(this.i=!1,Se(this)))}else 400==i&&0<s.indexOf("Unknown SID")?(this.o=3,re(12)):(this.o=0,re(13)),Re(this),Ie(this)}}}catch(e){}},f.fb=function(){if(this.g){var t=Ln(this.g),e=this.g.ga();this.C<e.length&&(Oe(this),Ce(this,t,e),this.i&&4!=t&&Se(this))}},f.cancel=function(){this.I=!0,Re(this)},f.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(ee(3),re(17)),Re(this),this.o=2,Ie(this)):Te(this,this.Y-t)},(f=Ne.prototype).R=function(){Pe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},f.T=function(){return Pe(this),this.g.concat()},f.get=function(t,e){return Me(this.h,t)?this.h[t]:e},f.set=function(t,e){Me(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},f.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Fe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Le(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Le){this.g=void 0!==e?e:t.g,Be(this,t.j),this.s=t.s,Ve(this,t.i),Ue(this,t.m),this.l=t.l,e=t.h;var n=new Ze;n.i=e.i,e.g&&(n.g=new Ne(e.g),n.h=e.h),ze(this,n),this.o=t.o}else t&&(n=String(t).match(Fe))?(this.g=!!e,Be(this,n[1]||"",!0),this.s=He(n[2]||""),Ve(this,n[3]||"",!0),Ue(this,n[4]),this.l=He(n[5]||"",!0),ze(this,n[6]||"",!0),this.o=He(n[7]||"")):(this.g=!!e,this.h=new Ze(null,this.g))}function je(t){return new Le(t)}function Be(t,e,n){t.j=n?He(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ve(t,e,n){t.i=n?He(e,!0):e}function Ue(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function ze(t,e,n){e instanceof Ze?(t.h=e,function(t,e){e&&!t.j&&(tn(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(en(this,e),rn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=qe(e,$e)),t.h=new Ze(e,t.g))}function We(t,e,n){t.h.set(e,n)}function Ge(t){return We(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function He(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qe(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,Ke),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ke(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Le.prototype.toString=function(){var t=[],e=this.j;e&&t.push(qe(e,Xe,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(qe(e,Xe,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(qe(n,"/"==n.charAt(0)?Qe:Ye,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",qe(n,Je)),t.join("")};var Xe=/[#\/\?@]/g,Ye=/[#\?:]/g,Qe=/[#\?]/g,$e=/[#\?@]/g,Je=/#/g;function Ze(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function tn(t){t.g||(t.g=new Ne,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function en(t,e){tn(t),e=on(t,e),Me(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Me((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Pe(t)))}function nn(t,e){return tn(t),e=on(t,e),Me(t.g.h,e)}function rn(t,e,n){en(t,e),0<n.length&&(t.i=null,t.g.set(on(t,e),A(n)),t.h+=n.length)}function on(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(f=Ze.prototype).add=function(t,e){tn(this),this.i=null,t=on(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},f.forEach=function(t,e){tn(this),this.g.forEach(function(n,r){I(n,function(n){t.call(e,n,r,this)},this)},this)},f.T=function(){tn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},f.R=function(t){tn(this);var e=[];if("string"===typeof t)nn(this,t)&&(e=R(e,this.g.get(on(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=R(e,t[n])}return e},f.set=function(t,e){return tn(this),this.i=null,nn(this,t=on(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},f.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},f.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.i=t.join("&")};var an=function t(e,n){Object(u.a)(this,t),this.h=e,this.g=n};function un(t){this.l=t||cn,v.PerformanceNavigationTiming?t=0<(t=v.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(v.g&&v.g.Ea&&v.g.Ea()&&v.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var sn,cn=10;function ln(t){return!!t.h||!!t.g&&t.g.size>=t.j}function fn(t){return t.h?1:t.g?t.g.size:0}function hn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function dn(t,e){t.g?t.g.add(e):t.h=e}function pn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function vn(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var e,n=t.i,r=c(t.g.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n=n.concat(i.D)}}catch(o){r.e(o)}finally{r.f()}return n}return A(t.i)}function mn(){}function gn(){this.g=new mn}function yn(t,e,n){var r=n||"";try{De(t,function(t,n){var i=t;y(t)&&(i=Rt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function bn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function wn(t){this.l=t.$b||null,this.j=t.ib||!1}function xn(t,e){Tt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=kn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}un.prototype.cancel=function(){if(this.i=vn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var t,e=c(this.g.values());try{for(e.s();!(t=e.n()).done;){t.value.cancel()}}catch(n){e.e(n)}finally{e.f()}this.g.clear()}},mn.prototype.stringify=function(t){return v.JSON.stringify(t,void 0)},mn.prototype.parse=function(t){return v.JSON.parse(t,void 0)},_(wn,se),wn.prototype.g=function(){return new xn(this.l,this.j)},wn.prototype.i=(sn={},function(){return sn}),_(xn,Tt);var kn=0;function En(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Cn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,_n(t)}function _n(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(f=xn.prototype).open=function(t,e){if(this.readyState!=kn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,_n(this)},f.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||v).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},f.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Cn(this)),this.readyState=kn},f.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,_n(this)),this.g&&(this.readyState=3,_n(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof v.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;En(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},f.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Cn(this):_n(this),3==this.readyState&&En(this)}},f.Ua=function(t){this.g&&(this.response=this.responseText=t,Cn(this))},f.Ta=function(t){this.g&&(this.response=t,Cn(this))},f.ha=function(){this.g&&Cn(this)},f.setRequestHeader=function(t,e){this.v.append(t,e)},f.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},f.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(xn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Sn=v.JSON.parse;function Tn(t){Tt.call(this),this.headers=new Ne,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=On,this.K=this.L=!1}_(Tn,Tt);var On="",In=/^https?$/i,Rn=["POST","PUT"];function An(t){return"content-type"==t.toLowerCase()}function Dn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Nn(t),Mn(t)}function Nn(t){t.D||(t.D=!0,Ot(t,"complete"),Ot(t,"error"))}function Pn(t){if(t.h&&"undefined"!=typeof p&&(!t.C[1]||4!=Ln(t)||2!=t.ba()))if(t.v&&4==Ln(t))Wt(t.Fa,0,t);else if(Ot(t,"readystatechange"),4==Ln(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(Fe)[1]||null;if(!o&&v.self&&v.self.location){var a=v.self.location.protocol;o=a.substr(0,a.length-1)}i=!In.test(o?o.toLowerCase():"")}e=i}if(e)Ot(t,"complete"),Ot(t,"success");else{t.m=6;try{var u=2<Ln(t)?t.g.statusText:""}catch(s){u=""}t.j=u+" ["+t.ba()+"]",Nn(t)}}finally{Mn(t)}}}function Mn(t,e){if(t.g){Fn(t);var n=t.g,r=t.C[0]?m:null;t.g=null,t.C=null,e||Ot(t,"ready");try{n.onreadystatechange=r}catch(i){}}}function Fn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(v.clearTimeout(t.A),t.A=null)}function Ln(t){return t.g?t.g.readyState:0}function jn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case On:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Bn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return B(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"===typeof t?null!=n&&encodeURIComponent(String(n)):We(t,e,n))}function Vn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Un(t){this.za=0,this.l=[],this.h=new Yt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Vn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Vn("baseRetryDelayMs",5e3,t),this.$a=Vn("retryDelaySeedMs",1e4,t),this.Ya=Vn("forwardChannelMaxRetries",2,t),this.ra=Vn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new un(t&&t.concurrentRequestLimit),this.Ca=new gn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function zn(t){if(Gn(t),3==t.G){var e=t.V++,n=je(t.F);We(n,"SID",t.J),We(n,"RID",e),We(n,"TYPE","terminate"),Xn(t,n),(e=new me(t,t.h,e,void 0)).K=2,e.v=Ge(je(n)),n=!1,v.navigator&&v.navigator.sendBeacon&&(n=v.navigator.sendBeacon(e.v.toString(),"")),!n&&v.Image&&((new Image).src=e.v,n=!0),n||(e.g=ar(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Se(e)}ir(t)}function Wn(t){t.g&&(Jn(t),t.g.cancel(),t.g=null)}function Gn(t){Wn(t),t.u&&(v.clearTimeout(t.u),t.u=null),tr(t),t.i.cancel(),t.m&&("number"===typeof t.m&&v.clearTimeout(t.m),t.m=null)}function Hn(t,e){t.l.push(new an(t.Za++,e)),3==t.G&&qn(t)}function qn(t){ln(t.i)||t.m||(t.m=!0,Lt(t.Ha,t),t.C=0)}function Kn(t,e){var n;n=e?e.m:t.V++;var r=je(t.F);We(r,"SID",t.J),We(r,"RID",n),We(r,"AID",t.U),Xn(t,r),t.o&&t.s&&Bn(r,t.o,t.s),n=new me(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Yn(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),dn(t.i,n),xe(n,r,e)}function Xn(t,e){t.j&&De({},function(t,n){We(e,n,t)})}function Yn(t,e,n){n=Math.min(t.l.length,n);var r=t.j?E(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].h,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var u=!0,s=0;s<n;s++){var c=i[s].h,l=i[s].g;if(0>(c-=o))o=Math.max(0,i[s].h-100),u=!1;else try{yn(l,a,"req"+c+"_")}catch(f){r&&r(l)}}if(u){r=a.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Qn(t){t.g||t.u||(t.Y=1,Lt(t.Ga,t),t.A=0)}function $n(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=oe(E(t.Ga,t),nr(t,t.A)),t.A++,!0)}function Jn(t){null!=t.B&&(v.clearTimeout(t.B),t.B=null)}function Zn(t){t.g=new me(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=je(t.oa);We(e,"RID","rpc"),We(e,"SID",t.J),We(e,"CI",t.N?"0":"1"),We(e,"AID",t.U),Xn(t,e),We(e,"TYPE","xmlhttp"),t.o&&t.s&&Bn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Ge(je(e)),n.s=null,n.U=!0,ke(n,t)}function tr(t){null!=t.v&&(v.clearTimeout(t.v),t.v=null)}function er(t,e){var n=null;if(t.g==e){tr(t),Jn(t),t.g=null;var r=2}else{if(!hn(t.i,e))return;n=e.D,pn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Ot(r=Zt(),new ie(r,n,e,i)),qn(t)}else Qn(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(fn(t.i)>=t.i.j-(t.m?1:0))&&(t.m?(t.l=e.D.concat(t.l),!0):!(1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya))&&(t.m=oe(E(t.Ha,t,e),nr(t,t.C)),t.C++,!0))}(t,e)||2==r&&$n(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:rr(t,5);break;case 4:rr(t,10);break;case 3:rr(t,6);break;default:rr(t,2)}}function nr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function rr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=E(t.jb,t);n||(n=new Le("//www.google.com/images/cleardot.gif"),v.location&&"http"==v.location.protocol||Be(n,"https"),Ge(n)),function(t,e){var n=new Yt;if(v.Image){var r=new Image;r.onload=C(bn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=C(bn,n,r,"TestLoadImage: error",!1,e),r.onabort=C(bn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=C(bn,n,r,"TestLoadImage: timeout",!1,e),v.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else re(2);t.G=0,t.j&&t.j.va(e),ir(t),Gn(t)}function ir(t){t.G=0,t.I=-1,t.j&&(0==vn(t.i).length&&0==t.l.length||(t.i.i.length=0,A(t.l),t.l.length=0),t.j.ua())}function or(t,e,n){var r=function(t){return t instanceof Le?je(t):new Le(t,void 0)}(n);if(""!=r.i)e&&Ve(r,e+"."+r.i),Ue(r,r.m);else{var i=v.location;r=function(t,e,n,r){var i=new Le(null,void 0);return t&&Be(i,t),e&&Ve(i,e),n&&Ue(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&B(t.aa,function(t,e){We(r,e,t)}),e=t.D,n=t.sa,e&&n&&We(r,e,n),We(r,"VER",t.ma),Xn(t,r),r}function ar(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Tn(new wn({ib:!0})):new Tn(t.qa)).L=t.H,e}function ur(){}function sr(){if(q&&!(10<=Number(ot)))throw Error("Environmental error: no available transport.")}function cr(t,e){Tt.call(this),this.g=new Un(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!D(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!D(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new hr(this)}function lr(t){de.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function fr(){pe.call(this),this.status=1}function hr(t){this.g=t}(f=Tn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():fe.g(),this.C=this.u?ce(this.u):ce(fe),this.g.onreadystatechange=E(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Dn(this,o)}t=n||"";var i=new Ne(this.headers);r&&De(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=An,n=t.length,r="string"===typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"===typeof t?t.charAt(e):t[e]}(i.T()),n=v.FormData&&t instanceof v.FormData,!(0<=O(Rn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Fn(this),0<this.B&&((this.K=function(t){return q&&rt()&&"number"===typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=E(this.pa,this)):this.A=Wt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Dn(this,o)}},f.pa=function(){"undefined"!=typeof p&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ot(this,"timeout"),this.abort(8))},f.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ot(this,"complete"),Ot(this,"abort"),Mn(this))},f.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mn(this,!0)),Tn.Z.M.call(this)},f.Fa=function(){this.s||(this.F||this.v||this.l?Pn(this):this.cb())},f.cb=function(){Pn(this)},f.ba=function(){try{return 2<Ln(this)?this.g.status:-1}catch(sn){return-1}},f.ga=function(){try{return this.g?this.g.responseText:""}catch(sn){return""}},f.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Sn(e)}},f.Da=function(){return this.m},f.La=function(){return"string"===typeof this.j?this.j:String(this.j)},(f=Un.prototype).ma=8,f.G=1,f.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},f.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new me(this,this.h,t,void 0),n=this.s;if(this.P&&(n?z(n=V(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"===typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Yn(this,e,r),We(i=je(this.F),"RID",t),We(i,"CVER",22),this.D&&We(i,"X-HTTP-Session-Id",this.D),Xn(this,i),this.o&&n&&Bn(i,this.o,n),dn(this.i,e),this.Ra&&We(i,"TYPE","init"),this.ja?(We(i,"$req",r),We(i,"SID","null"),e.$=!0,xe(e,i,null)):xe(e,i,r),this.G=2}}else 3==this.G&&(t?Kn(this,t):0==this.l.length||ln(this.i)||Kn(this))},f.Ga=function(){if(this.u=null,Zn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=oe(E(this.bb,this),t)}},f.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,re(10),Wn(this),Zn(this))},f.ab=function(){null!=this.v&&(this.v=null,Wn(this),$n(this),re(19))},f.jb=function(t){t?(this.h.info("Successfully pinged google.com"),re(2)):(this.h.info("Failed to ping google.com"),re(1))},(f=ur.prototype).xa=function(){},f.wa=function(){},f.va=function(){},f.ua=function(){},f.Oa=function(){},sr.prototype.g=function(t,e){return new cr(t,e)},_(cr,Tt),cr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Lt(E(t.hb,t,e))),re(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=or(t,null,t.W),qn(t)},cr.prototype.close=function(){zn(this.g)},cr.prototype.u=function(t){if("string"===typeof t){var e={};e.__data__=t,Hn(this.g,e)}else this.v?((e={}).__data__=Rt(t),Hn(this.g,e)):Hn(this.g,t)},cr.prototype.M=function(){this.g.j=null,delete this.j,zn(this.g),delete this.g,cr.Z.M.call(this)},_(lr,de),_(fr,pe),_(hr,ur),hr.prototype.xa=function(){Ot(this.g,"a")},hr.prototype.wa=function(t){Ot(this.g,new lr(t))},hr.prototype.va=function(t){Ot(this.g,new fr(t))},hr.prototype.ua=function(){Ot(this.g,"b")},sr.prototype.createWebChannel=sr.prototype.g,cr.prototype.send=cr.prototype.u,cr.prototype.open=cr.prototype.m,cr.prototype.close=cr.prototype.close,ae.NO_ERROR=0,ae.TIMEOUT=8,ae.HTTP_ERROR=6,ue.COMPLETE="complete",le.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",Tt.prototype.listen=Tt.prototype.N,Tn.prototype.listenOnce=Tn.prototype.O,Tn.prototype.getLastError=Tn.prototype.La,Tn.prototype.getLastErrorCode=Tn.prototype.Da,Tn.prototype.getStatus=Tn.prototype.ba,Tn.prototype.getResponseJson=Tn.prototype.Qa,Tn.prototype.getResponseText=Tn.prototype.ga,Tn.prototype.send=Tn.prototype.ea;var dr=d.createWebChannelTransport=function(){return new sr},pr=d.getStatEventTarget=function(){return Zt()},vr=d.ErrorCode=ae,mr=d.EventType=ue,gr=d.Event=$t,yr=d.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},br=d.FetchXmlHttpFactory=wn,wr=d.WebChannel=le,xr=d.XhrIo=Tn}).call(this,n(23))},function(t,e,n){"use strict";var r=n(1);function i(t,e,n){if(void 0===n&&(n=!1),t.beginPath(),e.slice(1).forEach(function(n,r){var i=n.x,o=n.y,a=e[r];t.moveTo(a.x,a.y),t.lineTo(i,o)}),n){var r=e[e.length-1],i=e[0];if(!r||!i)return;t.moveTo(r.x,r.y),t.lineTo(i.x,i.y)}t.stroke()}var o=n(0),a=function(){function t(t,e){if(!v(t)||!v(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function u(t,e){return t instanceof r.a&&t.shape.length===e}function s(t){return u(t,3)}function c(t){return u(t,4)}function l(t){return t%2===0}function f(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}function h(t){return t&&t.width&&t.height}function d(t){return t.reduce(function(t,e){return t.add(e)},new g(0,0)).div(new g(t.length,t.length))}function p(t,e,n){return Array(t).fill(0).map(function(t,r){return e+r*n})}function v(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function m(t){return v(t)&&0<=t&&t<=1}var g=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),y=function(){function t(e,n){void 0===n&&(n=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(v),o=[r.x,r.y,r.width,r.height].every(v);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],u=a[0],s=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:u,y:s,width:c,height:l},"Box.constructor",n),this._x=u,this._y=s,this._width=c,this._height=l}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(v)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new g(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new g(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new g(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new g(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.round(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.floor(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this.x,n=this.y,r=this.width,i=this.height,o=Math.abs(r-i);return r<i&&(e-=o/2,r+=o),i<r&&(n-=o/2,i+=o),new t({x:e,y:n,width:r,height:i})},t.prototype.rescale=function(e){var n=h(e)?e.width:e,r=h(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this.x,i=this.y,o=this.right,a=this.bottom,u=Math.max(r,0),s=Math.max(i,0),c=o-u,l=a-s;return new t({x:u,y:s,width:Math.min(c,e-u),height:Math.min(l,n-s)}).floor()},t.prototype.shift=function(e,n){var r=this.width,i=this.height;return new t({x:this.x+e,y:this.y+n,width:r,height:i})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,i=n,o=r,a=this.left,u=this.top,s=this.right,c=this.bottom;return s>e&&(i=-s+e+n,s=e),c>t&&(o=-c+t+r,c=t),a<1&&(o=2-a,a=1),u<1&&(o=2-u,u=1),{dy:1,edy:o,dx:1,edx:i,y:u,ey:c,x:a,ex:s,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),b=function(t){function e(e,n,r,i,o){return void 0===o&&(o=!1),t.call(this,{left:e,top:n,right:r,bottom:i},o)||this}return Object(o.c)(e,t),e}(y),w=function(){function t(t,e,n,r,i){this._imageDims=new a(i.width,i.height),this._score=t,this._classScore=e,this._className=n,this._box=new y(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new y(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),x=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return Object(o.c)(e,t),e.prototype.forSize=function(n,r){var i=t.prototype.forSize.call(this,n,r);return new e(i.score,i.relativeBox,i.imageDims)},e}(w);function k(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}function E(t,e,n,r){void 0===r&&(r=!0);for(var i=e.map(function(t,e){return{score:t,boxIndex:e}}).sort(function(t,e){return t.score-e.score}).map(function(t){return t.boxIndex}),o=[],a=function(){var e=i.pop();o.push(e);for(var a=i,u=[],s=0;s<a.length;s++){var c=a[s],l=t[e],f=t[c];u.push(k(l,f,r))}i=i.filter(function(t,e){return u[e]<=n})};i.length>0;)a();return o}function C(t,e){return r.L(function(){var n=e[0],i=e[1],a=e[2],u=r.n(Object(o.f)(t.shape.slice(0,3),[1]),n),s=r.n(Object(o.f)(t.shape.slice(0,3),[1]),i),c=r.n(Object(o.f)(t.shape.slice(0,3),[1]),a),l=r.h([u,s,c],3);return r.F(t,l)})}function _(t){return 1/(1+Math.exp(-t))}var S=function(t){function e(e,n,r,i,o){return void 0===o&&(o=!1),t.call(this,{x:e,y:n,width:r,height:i},o)||this}return Object(o.c)(e,t),e}(y),T=function(){function t(t,e,n){void 0===n&&(n=new g(0,0));var r=e.width,i=e.height;this._imgDims=new a(r,i),this._shift=n,this._positions=t.map(function(t){return t.mul(new g(r,i)).add(n)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new g(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new g(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new g(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var n=t instanceof x?t.box.floor():new y(t);return this.shiftBy(n.x,n.y).align(null,e)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),i=r.useDlibAlignment,o=r.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(o)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],r=t[2],i=function(t){return r.sub(t).magnitude()},o=(i(e)+i(n))/2,a=Math.floor(o/.45),u=d(t),s=Math.floor(Math.max(0,u.x-.5*a)),c=Math.floor(Math.max(0,u.y-.43*a));return new S(s,c,Math.min(a,this.imageWidth+s),Math.min(a,this.imageHeight+c))},t.prototype.alignMinBbox=function(t){var e=function(t){var e=t.map(function(t){return t.x}),n=t.map(function(t){return t.y}),r=e.reduce(function(t,e){return e<t?e:t},1/0),i=n.reduce(function(t,e){return e<t?e:t},1/0),o=e.reduce(function(t,e){return t<e?e:t},0),a=n.reduce(function(t,e){return t<e?e:t},0);return new b(r,i,o,a)}(this.positions);return e.pad(e.width*t,e.height*t)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],d([t[3],t[4]])]},e}(T),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(d)},e}(T),R=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+f(this.distance)+")":"")},t}(),A=function(t){function e(e,n){var r=t.call(this,e)||this;return r._label=n,r}return Object(o.c)(e,t),e.assertIsValidLabeledBox=function(t,e){if(y.assertIsValidBox(t,e),!v(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(y),D=function(){function t(t,e){if("string"!==typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},t.fromJSON=function(e){var n=e.descriptors.map(function(t){return new Float32Array(t)});return new t(e.label,n)},t}();!function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o._score=r,o._classScore=i,o}Object(o.c)(e,t),e.assertIsValidPredictedBox=function(t,e){if(A.assertIsValidLabeledBox(t,e),!m(t.score)||!m(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(A);function N(t){return t.detection instanceof x}function P(t,e){var n={detection:e};return Object.assign({},t,n)}function M(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var F=n(28),L=n(29);function j(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}var B,V=n(30);function U(t){B=t}function z(){j()&&U(M()),Object(V.a)()&&U(Object(L.a)())}var W,G={getEnv:function(){if(!B)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return B},setEnv:U,initialize:z,createBrowserEnv:M,createFileSystem:F.a,createNodejsEnv:L.a,monkeyPatch:function(t){if(B||z(),!B)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=void 0===e?B.Canvas:e,r=t.Image,i=void 0===r?B.Image:r;B.Canvas=n,B.Image=i,B.createCanvasElement=t.createCanvasElement||function(){return new n},B.createImageElement=t.createImageElement||function(){return new i},B.ImageData=t.ImageData||B.ImageData,B.Video=t.Video||B.Video,B.fetch=t.fetch||B.fetch,B.readFile=t.readFile||B.readFile},isBrowser:j,isNodejs:V.a};function H(t){return G.isNodejs()||"string"!==typeof t?t:document.getElementById(t)}function q(t){var e=G.getEnv(),n=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var r=H(t);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=r.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}z(),function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(W||(W={}));var K=function(){return function(t){void 0===t&&(t={});var e=t.anchorPosition,n=t.backgroundColor,r=t.fontColor,i=t.fontSize,o=t.fontStyle,a=t.padding;this.anchorPosition=e||W.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=a||4}}(),X=function(){function t(e,n,r){void 0===r&&(r={}),this.text="string"===typeof e?[e]:e instanceof t?e.text:e,this.anchor=n,this.options=new K(r)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(e){return t.measureText(e).width}).reduce(function(t,e){return t<e?e:t},0)+2*e},t.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},t.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,r=n===W.BOTTOM_RIGHT||n===W.TOP_RIGHT,i=n===W.BOTTOM_LEFT||n===W.BOTTOM_RIGHT,o=this.measureWidth(t),a=this.measureHeight(),u=r?this.anchor.x-o:this.anchor.x,s=i?this.anchor.y-a:this.anchor.y;if(e){var c=e.width,l=e.height;return{x:Math.max(Math.min(u,c-o),0),y:Math.max(Math.min(s,l-a),0)}}return{x:u,y:s}},t.prototype.draw=function(t){var e=H(t),n=q(e),r=this.options,i=r.backgroundColor,o=r.fontColor,a=r.fontSize,u=r.fontStyle,s=r.padding;n.font=a+"px "+u;var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=i;var f=this.getUpperLeft(n,e);n.fillRect(f.x,f.y,c,l),n.fillStyle=o,this.text.forEach(function(t,e){var r=s+f.x,i=s+f.y+(e+1)*a;n.fillText(t,r,i)})},t}(),Y=function(){return function(t){void 0===t&&(t={});var e=t.boxColor,n=t.lineWidth,r=t.label,i=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var o={anchorPosition:W.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new K(Object.assign({},o,i))}}();!function(){function t(t,e){void 0===e&&(e={}),this.box=new y(t),this.options=new Y(e)}t.prototype.draw=function(t){var e=q(t),n=this.options,r=n.boxColor,i=n.lineWidth,o=this.box,a=o.x,u=o.y,s=o.width,c=o.height;e.strokeStyle=r,e.lineWidth=i,e.strokeRect(a,u,s,c);var l=this.options.label;l&&new X([l],{x:a-i/2,y:u},this.options.drawLabelOptions).draw(t)}}();function Q(t){var e=G.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function $(t){return new Promise(function(e,n){if(!(t instanceof Blob))return n("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!==typeof r.result)return n("bufferToImage - expected reader.result to be a string, in onload");var t=G.getEnv().createImageElement();t.onload=function(){return e(t)},t.onerror=n,t.src=r.result},r.onerror=n,r.readAsDataURL(t)})}function J(t){var e=G.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new a(t.naturalWidth,t.naturalHeight):t instanceof r?new a(t.videoWidth,t.videoHeight):new a(t.width,t.height)}function Z(t){var e=t.width,n=t.height,r=(0,G.getEnv().createCanvasElement)();return r.width=e,r.height=n,r}function tt(t,e){var n=G.getEnv().ImageData;if(!(t instanceof n)&&!Q(t))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||J(t),i=r.width,o=r.height,a=Z({width:i,height:o});return t instanceof n?q(a).putImageData(t,0,0):q(a).drawImage(t,0,0,i,o),a}function et(t,e){return Object(o.b)(this,void 0,void 0,function(){var n,i,a,u,s,l;return Object(o.d)(this,function(o){switch(o.label){case 0:return n=e||G.getEnv().createCanvasElement(),i=t.shape.slice(c(t)?1:0),a=i[0],u=i[1],s=i[2],l=r.L(function(){return t.as3D(a,u,s).toInt()}),[4,r.f.toPixels(l,n)];case 1:return o.sent(),l.dispose(),[2,n]}})})}function nt(t){var e=G.getEnv(),n=e.Image,r=e.Canvas,i=e.Video;return t instanceof n||t instanceof r||t instanceof i}var rt=function(){function t(t,e){var n=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(t,e){if(s(t))return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape);if(c(t)){var r=t.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape.slice(1))}var i=t instanceof G.getEnv().Canvas?t:tt(t);n._canvases[e]=i,n._inputDimensions[e]=[i.height,i.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return p(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(t,e){var n=t.width,r=t.height,i=e/Math.max(r,n);return new a(Math.round(n*i),Math.round(r*i))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,r.L(function(){var i=p(n.batchSize,0,1).map(function(i){var o=n.getInput(i);if(o instanceof r.a){var a=c(o)?o:o.expandDims();return(a=function(t,e){return void 0===e&&(e=!1),r.L(function(){var n=t.shape.slice(1),i=n[0],o=n[1];if(i===o)return t;var a=Math.abs(i-o),u=Math.round(a*(e?.5:1)),s=i>o?2:1,c=function(e){var n=t.shape.slice();return n[s]=e,r.n(n,0)},l=c(u),f=a-l.shape[s],h=[e&&f?c(f):null,t,l].filter(function(t){return!!t}).map(function(t){return t.toFloat()});return r.h(h,s)})}(a,e)).shape[1]===t&&a.shape[2]===t||(a=r.o.resizeBilinear(a,[t,t])),a.as3D(t,t,3)}if(o instanceof G.getEnv().Canvas)return r.f.fromPixels(function(t,e,n){void 0===n&&(n=!1);var r=G.getEnv(),i=r.Image,o=r.Canvas;if(!(t instanceof i||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=J(t),u=e/Math.max(a.height,a.width),s=u*a.width,c=u*a.height,l=Z({width:e,height:e}),f=t instanceof o?t:tt(t),h=Math.abs(s-c)/2,d=n&&s<c?h:0,p=n&&c<s?h:0;return q(l).drawImage(f,d,p,s,c),l}(o,t,e));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)});return r.E(i.map(function(t){return t.toFloat()})).as4D(n.batchSize,t,t,3)})},t}();function it(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,r;return Object(o.d)(this,function(i){switch(i.label){case 0:if(t instanceof rt)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(H)).forEach(function(t,r){if(!nt(t)&&!s(t)&&!c(t)){if("string"===typeof e[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+e[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(c(t)){var i=t.shape[0];if(1!==i)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(t){return nt(t)&&(e=t,new Promise(function(t,n){if(e instanceof G.getEnv().Canvas||Q(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),t(e))}function i(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",i),n(t))}e.addEventListener("load",r),e.addEventListener("error",i)}));var e}))];case 1:return i.sent(),[2,new rt(r,Array.isArray(t))]}})})}function ot(t,e){return Object(o.b)(this,void 0,void 0,function(){var n,r,i,a,u,s;return Object(o.d)(this,function(o){switch(o.label){case 0:return n=G.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,it(t)];case 1:if((i=o.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=i.getInput(0))instanceof n?(u=a,[3,4]):[3,2];case 2:return[4,et(a)];case 3:u=o.sent(),o.label=4;case 4:r=u,o.label=5;case 5:return s=q(r),[2,e.map(function(t){return t instanceof x?t.forSize(r.width,r.height).box.floor():t}).map(function(t){return t.clipAtImageBorders(r.width,r.height)}).map(function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=Z({width:r,height:i});return q(o).putImageData(s.getImageData(e,n,r,i),0,0),o})]}})})}function at(t,e){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(n){if(!s(t)&&!c(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(c(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,r.L(function(){var n=t.shape.slice(c(t)?1:0),i=n[0],o=n[1],a=n[2];return e.map(function(t){return t instanceof x?t.forSize(o,i).box:t}).map(function(t){return t.clipAtImageBorders(o,i)}).map(function(e){var n=e.x,u=e.y,s=e.width,c=e.height;return r.C(t.as3D(i,o,a),[u,n,0],[c,s,a])})})]})})}function ut(t,e){return Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:return[4,(0,G.getEnv().fetch)(t,e)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function st(t){return Object(o.b)(this,void 0,void 0,function(){var e,n;return Object(o.d)(this,function(r){switch(r.label){case 0:return[4,ut(t)];case 1:return[4,(e=r.sent()).blob()];case 2:if(!(n=r.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+n.type+", for url: "+e.url);return[2,$(n)]}})})}function ct(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return[4,ut(t)];case 1:return[2,e.sent().json()]}})})}function lt(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",i=(t=t.replace(r,"")).split("/").filter(function(t){return t}),o=t.endsWith(".json")?i[i.length-1]:n,a=r+(t.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+o:a+"/"+o}}function ft(t,e){return Object(o.b)(this,void 0,void 0,function(){var n,i,a,u;return Object(o.d)(this,function(o){switch(o.label){case 0:return n=lt(t,e),i=n.manifestUri,a=n.modelBaseUri,[4,ct(i)];case 1:return u=o.sent(),[2,r.p.loadWeights(u,a)]}})})}function ht(t,e,n){void 0===n&&(n=!1);var r=n?J(e):e,i=r.width,o=r.height;return t.width=i,t.height=o,{width:i,height:o}}var dt=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,i=n.objProp;r[i].dispose(),r[i]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof r.b})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof r.b)})},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var n=e.path,r=e.tensor;t.reassignParamFromPath(n,r.variable())})},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,i=e.tensor,o=r.G(i.dataSync());i.dispose(),t.reassignParamFromPath(n,o)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},t.prototype.load=function(t){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:if(t&&"string"!==typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,ft(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,i,a,u,s,c,l,f,h;return Object(o.d)(this,function(o){switch(o.label){case 0:if(t&&"string"!==typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=G.getEnv().readFile,n=lt(t,this.getDefaultModelName()),i=n.manifestUri,a=n.modelBaseUri,u=function(t){return Promise.all(t.map(function(t){return e(t).then(function(t){return t.buffer})}))},s=r.p.weightsLoaderFactory(u),f=(l=JSON).parse,[4,e(i)];case 1:return c=f.apply(l,[o.sent().toString()]),[4,s(c,a)];case 2:return h=o.sent(),this.loadFromWeightMap(h),[2]}})})},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(e,n){if(!e.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}},{nextObj:this.params}),n=e.obj,i=e.objProp;if(!n||!i||!(n[i]instanceof r.a))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:i}},t}();function pt(t,e,n){return r.L(function(){var i=r.z(t,e.depthwise_filter,e.pointwise_filter,n,"same");return i=r.c(i,e.bias)})}function vt(t,e,n){return void 0===n&&(n=!1),r.L(function(){var i=r.w(n?r.c(r.i(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):pt(t,e.conv0,[2,2])),o=pt(i,e.conv1,[1,1]),a=pt(r.w(r.c(i,o)),e.conv2,[1,1]);return r.w(r.c(i,r.c(o,a)))})}function mt(t,e,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!0),r.L(function(){var o=r.w(n?r.c(r.i(t,e.conv0.filters,i?[2,2]:[1,1],"same"),e.conv0.bias):pt(t,e.conv0,i?[2,2]:[1,1])),a=pt(o,e.conv1,[1,1]),u=pt(r.w(r.c(o,a)),e.conv2,[1,1]),s=pt(r.w(r.c(o,r.c(a,u))),e.conv3,[1,1]);return r.w(r.c(o,r.c(a,r.c(u,s))))})}function gt(t,e,n,i){return void 0===n&&(n="same"),void 0===i&&(i=!1),r.L(function(){var o=r.c(r.i(t,e.filters,[1,1],n),e.bias);return i?r.w(o):o})}function yt(t,e){Object.keys(t).forEach(function(n){e.some(function(t){return t.originalPath===n})||t[n].dispose()})}function bt(t,e){return function(n,i,o,a){var u=r.K(t(n*i*o*o),[o,o,n,i]),s=r.H(t(i));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:u,bias:s}}}function wt(t,e){return function(n,i,o){var a=r.I(t(n*i),[n,i]),u=r.H(t(i));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:u}}}var xt=function(){return function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n}}();function kt(t,e){return function(n,i,o){var a=r.K(t(9*n),[3,3,n,1]),u=r.K(t(n*i),[1,1,n,i]),s=r.H(t(i));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new xt(a,u,s)}}function Et(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),i=t(e+"/bias",1);return new xt(n,r,i)}}function Ct(t,e){return function(n,r,i){var o=t[n];if(!u(o,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:n,paramPath:i||n}),o}}function _t(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function St(t,e){var n=bt(t,e),r=kt(t,e);function i(t,e,i,o){return void 0===o&&(o=!1),{conv0:o?n(t,e,3,i+"/conv0"):r(t,e,i+"/conv0"),conv1:r(e,e,i+"/conv1"),conv2:r(e,e,i+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(t,e,n,o){void 0===o&&(o=!1);var a=i(t,e,n,o);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(e,e,n+"/conv3")}}}}function Tt(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function Ot(t,e){var n=Ct(t,e),r=Tt(n),i=Et(n);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):i(t+"/conv0"),conv1:i(t+"/conv1"),conv2:i(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):i(t+"/conv0"),conv1:i(t+"/conv1"),conv2:i(t+"/conv2"),conv3:i(t+"/conv3")}}}}var It=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return Object(o.c)(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return r.L(function(){var n=mt(C(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(r.y(255)),e.dense0,!0);return n=mt(n,e.dense1),n=mt(n,e.dense2),n=mt(n,e.dense3),n=r.d(n,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Ot(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return yt(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=_t(t),r=n.extractWeights,i=n.getRemainingWeights,o=St(r,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),u=o(32,64,"dense1"),s=o(64,128,"dense2"),c=o(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:u,dense2:s,dense3:c}}}(t)},e}(dt);function Rt(t,e){return r.L(function(){return r.c(r.q(t,e.weights),e.bias)})}function At(t){var e={},n={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?n:e)[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}var Dt=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return r.L(function(){var r=t instanceof rt?e.faceFeatureExtractor.forwardInput(t):t;return Rt(r.as2D(r.shape[0],-1),n.fc)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var r=[],i=_t(t),o=i.extractWeights,a=i.getRemainingWeights,u=wt(o,r)(e,n,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e=At(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e,n=[],r=Ct(t,n),i={fc:(e="fc",{weights:r(e+"/weights",2),bias:r(e+"/bias",1)})};return yt(t,n),{params:i,paramMappings:n}}(r)},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(dt),Nt=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Pt=function(){function t(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);Nt.forEach(function(n,r){e[n]=t[r]})}return t.prototype.asSortedArray=function(){var t=this;return Nt.map(function(e){return{expression:e,probability:t[e]}}).sort(function(t,e){return e.probability-t.probability})},t}(),Mt=function(t){function e(e){return void 0===e&&(e=new It),t.call(this,"FaceExpressionNet",e)||this}return Object(o.c)(e,t),e.prototype.forwardInput=function(t){var e=this;return r.L(function(){return r.D(e.runNet(t))})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictExpressions=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,i,a,u=this;return Object(o.d)(this,function(s){switch(s.label){case 0:return[4,it(t)];case 1:return e=s.sent(),[4,this.forwardInput(e)];case 2:return n=s.sent(),[4,Promise.all(r.O(n).map(function(t){return Object(o.b)(u,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,t.data()];case 1:return e=n.sent(),t.dispose(),[2,e]}})})}))];case 3:return i=s.sent(),n.dispose(),a=i.map(function(t){return new Pt(t)}),[2,e.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(Dt);function Ft(t,e){var n={expressions:e};return Object.assign({},t,n)}function Lt(t){return N(t)&&t.landmarks instanceof T&&t.unshiftedLandmarks instanceof T&&t.alignedRect instanceof x}function jt(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),i=r.align(),o=t.detection.imageDims,a={landmarks:r,unshiftedLandmarks:e,alignedRect:new x(t.detection.score,i.rescale(o.reverse()),o)};return Object.assign({},t,a)}var Bt=function(){return function(t){void 0===t&&(t={});var e=t.drawLines,n=void 0===e||e,r=t.drawPoints,i=void 0===r||r,o=t.lineWidth,a=t.lineColor,u=t.pointSize,s=t.pointColor;this.drawLines=n,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=u||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=s||"rgba(255, 0, 255, 1)"}}();!function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new Bt(e)}t.prototype.draw=function(t){var e=q(t),n=this.options,r=n.drawLines,o=n.drawPoints,a=n.lineWidth,u=n.lineColor,s=n.pointSize,c=n.pointColor;if(r&&this.faceLandmarks instanceof I&&(e.strokeStyle=u,e.lineWidth=a,i(e,this.faceLandmarks.getJawOutline()),i(e,this.faceLandmarks.getLeftEyeBrow()),i(e,this.faceLandmarks.getRightEyeBrow()),i(e,this.faceLandmarks.getNose()),i(e,this.faceLandmarks.getLeftEye(),!0),i(e,this.faceLandmarks.getRightEye(),!0),i(e,this.faceLandmarks.getMouth(),!0)),o){e.strokeStyle=c,e.fillStyle=c;this.faceLandmarks.positions.forEach(function(t){e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.fill()})}}}();function Vt(t,e){var n=[],r=_t(t),i=r.extractWeights,o=r.getRemainingWeights,a=function(t,e){var n=bt(t,e),r=kt(t,e);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(t,e,i){return{separable_conv0:r(t,e,i+"/separable_conv0"),separable_conv1:r(e,e,i+"/separable_conv1"),expansion_conv:n(t,e,1,i+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:r(t,t,e+"/separable_conv0"),separable_conv1:r(t,t,e+"/separable_conv1"),separable_conv2:r(t,t,e+"/separable_conv2")}}}}(i,n),u=a.extractConvParams,s=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,f={conv_in:u(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},h={};p(e,0,1).forEach(function(t){h["main_block_"+t]=l(128,"middle_flow/main_block_"+t)});var d={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:s(256,512,"exit_flow/separable_conv")};if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:h,exit_flow:d}}}function Ut(t,e){var n=[],r=function(t,e){var n=Ct(t,e),r=Tt(n),i=Et(n);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(t){return{separable_conv0:i(t+"/separable_conv0"),separable_conv1:i(t+"/separable_conv1"),expansion_conv:r(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:i(t+"/separable_conv0"),separable_conv1:i(t+"/separable_conv1"),separable_conv2:i(t+"/separable_conv2")}}}}(t,n),i=r.extractConvParams,o=r.extractSeparableConvParams,a=r.extractReductionBlockParams,u=r.extractMainBlockParams,s={conv_in:i("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},c={};p(e,0,1).forEach(function(t){c["main_block_"+t]=u("middle_flow/main_block_"+t)});var l={reduction_block:a("exit_flow/reduction_block"),separable_conv:o("exit_flow/separable_conv")};return yt(t,n),{params:{entry_flow:s,middle_flow:c,exit_flow:l},paramMappings:n}}function zt(t,e,n){return r.c(r.i(t,e.filters,n,"same"),e.bias)}function Wt(t,e,n){void 0===n&&(n=!0);var i=n?r.w(t):t;return i=pt(i,e.separable_conv0,[1,1]),i=pt(r.w(i),e.separable_conv1,[1,1]),i=r.s(i,[3,3],[2,2],"same"),i=r.c(i,zt(t,e.expansion_conv,[2,2]))}var Gt,Ht=function(t){function e(e){var n=t.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return Object(o.c)(e,t),e.prototype.forwardInput=function(t){var e=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return r.L(function(){var i=C(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(r.y(256)),o=r.w(zt(i,n.entry_flow.conv_in,[2,2]));return o=Wt(o,n.entry_flow.reduction_block_0,!1),o=Wt(o,n.entry_flow.reduction_block_1),p(e._numMainBlocks,0,1).forEach(function(t){o=function(t,e){var n=pt(r.w(t),e.separable_conv0,[1,1]);return n=pt(r.w(n),e.separable_conv1,[1,1]),n=pt(r.w(n),e.separable_conv2,[1,1]),n=r.c(n,t)}(o,n.middle_flow["main_block_"+t])}),o=Wt(o,n.exit_flow.reduction_block),o=r.w(pt(o,n.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Ut(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return Vt(t,this._numMainBlocks)},e}(dt);!function(t){t.FEMALE="female",t.MALE="male"}(Gt||(Gt={}));var qt=function(t){function e(e){void 0===e&&(e=new Ht(2));var n=t.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return r.L(function(){var i=t instanceof rt?e.faceFeatureExtractor.forwardInput(t):t,o=r.d(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1);return{age:Rt(o,n.fc.age).as1D(),gender:Rt(o,n.fc.gender)}})},e.prototype.forwardInput=function(t){var e=this;return r.L(function(){var n=e.runNet(t),i=n.age,o=n.gender;return{age:i,gender:r.D(o)}})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,i,a,u,s,c=this;return Object(o.d)(this,function(l){switch(l.label){case 0:return[4,it(t)];case 1:return e=l.sent(),[4,this.forwardInput(e)];case 2:return n=l.sent(),i=r.O(n.age),a=r.O(n.gender),u=i.map(function(t,e){return{ageTensor:t,genderTensor:a[e]}}),[4,Promise.all(u.map(function(t){var e=t.ageTensor,n=t.genderTensor;return Object(o.b)(c,void 0,void 0,function(){var t,r,i,a,u;return Object(o.d)(this,function(o){switch(o.label){case 0:return[4,e.data()];case 1:return t=o.sent()[0],[4,n.data()];case 2:return r=o.sent()[0],a=(i=r>.5)?Gt.MALE:Gt.FEMALE,u=i?r:1-r,e.dispose(),n.dispose(),[2,{age:t,gender:a,genderProbability:u}]}})})}))];case 3:return s=l.sent(),n.age.dispose(),n.gender.dispose(),[2,e.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],n=_t(t),r=n.extractWeights,i=n.getRemainingWeights,o=wt(r,e),a=o(512,1,"fc/age"),u=o(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:u}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=At(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e=[],n=Ct(t,e);function r(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return yt(t,e),{params:i,paramMappings:e}}(r)},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),n=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(n)},e}(dt),Kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.postProcess=function(t,e,n){var i=n.map(function(t){var n=t.width,r=t.height,i=e/Math.max(r,n);return{width:n*i,height:r*i}}),o=i.length;return r.L(function(){var n=function(t,e){return r.E([r.n([68],t),r.n([68],e)],1).as2D(1,136).as1D()},a=function(t,e){var n=i[t],r=n.width,o=n.height;return e(r,o)?Math.abs(r-o)/2:0};return t.mul(r.n([o,136],e)).sub(r.E(Array.from(Array(o),function(t,e){return n(function(t){return a(t,function(t,e){return t<e})}(e),function(t){return a(t,function(t,e){return e<t})}(e))}))).div(r.E(Array.from(Array(o),function(t,e){return n(i[e].width,i[e].height)})))})},e.prototype.forwardInput=function(t){var e=this;return r.L(function(){var n=e.runNet(t);return e.postProcess(n,t.inputSize,t.inputDimensions.map(function(t){return{height:t[0],width:t[1]}}))})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,i,a=this;return Object(o.d)(this,function(u){switch(u.label){case 0:return[4,it(t)];case 1:return e=u.sent(),n=r.L(function(){return r.O(a.forwardInput(e))}),[4,Promise.all(n.map(function(t,n){return Object(o.b)(a,void 0,void 0,function(){var r,i,a,u,s;return Object(o.d)(this,function(o){switch(o.label){case 0:return a=(i=Array).from,[4,t.data()];case 1:return r=a.apply(i,[o.sent()]),u=r.filter(function(t,e){return l(e)}),s=r.filter(function(t,e){return!l(e)}),[2,new I(Array(68).fill(0).map(function(t,e){return new g(u[e],s[e])}),{height:e.getInputHeight(n),width:e.getInputWidth(n)})]}})})}))];case 2:return i=u.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?i:i[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(Dt),Xt=function(t){function e(e){return void 0===e&&(e=new It),t.call(this,"FaceLandmark68Net",e)||this}return Object(o.c)(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(Kt);var Yt=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return Object(o.c)(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return r.L(function(){var n=vt(C(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(r.y(255)),e.dense0,!0);return n=vt(n,e.dense1),n=vt(n,e.dense2),n=r.d(n,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Ot(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return yt(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=_t(t),r=n.extractWeights,i=n.getRemainingWeights,o=St(r,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),u=o(32,64,"dense1"),s=o(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:u,dense2:s}}}(t)},e}(dt),Qt=function(t){function e(e){return void 0===e&&(e=new Yt),t.call(this,"FaceLandmark68TinyNet",e)||this}return Object(o.c)(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(Kt);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Object(o.c)(e,t)}(Xt);function $t(t,e,n,i,o){void 0===o&&(o="same");var a=e.conv,u=a.filters,s=a.bias,c=r.i(t,u,n,o);return c=function(t,e){return r.c(r.t(t,e.weights),e.biases)}(c=r.c(c,s),e.scale),i?r.w(c):c}function Jt(t,e){return $t(t,e,[1,1],!1)}function Zt(t,e){return $t(t,e,[2,2],!0,"valid")}function te(t,e){function n(n,i,o,a){var u=function(e,n,i){var o=t(e),a=o.length/(n*i*i);if(a%1!==0)throw new Error("depth has to be an integer: "+a+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+i);return r.L(function(){return r.N(r.K(o,[n,a,i,i]),[2,3,1,0])})}(n,i,o),s=r.H(t(i));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:u,bias:s}}function i(i,o,a,u){return{conv:n(i,o,a,u+"/conv"),scale:function(n,i){var o=r.H(t(n)),a=r.H(t(n));return e.push({paramPath:i+"/weights"},{paramPath:i+"/biases"}),{weights:o,biases:a}}(o,u+"/scale")}}return{extractConvLayerParams:i,extractResidualLayerParams:function(t,e,n,r,o){return void 0===o&&(o=!1),{conv1:i((o?.5:1)*t,e,n,r+"/conv1"),conv2:i(t,e,n,r+"/conv2")}}}}function ee(t,e){var n=Ct(t,e);function r(t){return{conv:{filters:n(t+"/conv/filters",4),bias:n(t+"/conv/bias",1)},scale:function(t){return{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}(t)}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t){return{conv1:r(t+"/conv1"),conv2:r(t+"/conv2")}}}}function ne(t){var e=[],n=ee(t,e),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,o=r("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),c=i("conv32_3"),l=i("conv64_down"),f=i("conv64_1"),h=i("conv64_2"),d=i("conv64_3"),p=i("conv128_down"),v=i("conv128_1"),m=i("conv128_2"),g=i("conv256_down"),y=i("conv256_1"),b=i("conv256_2"),w=i("conv256_down_out"),x=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!u(x,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var k={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:c,conv64_down:l,conv64_1:f,conv64_2:h,conv64_3:d,conv128_down:p,conv128_1:v,conv128_2:m,conv256_down:g,conv256_1:y,conv256_2:b,conv256_down_out:w,fc:x};return yt(t,e),{params:k,paramMappings:e}}function re(t,e){var n=function(t,e){return $t(t,e,[1,1],!0)}(t,e.conv1);return n=Jt(n,e.conv2),n=r.c(n,t),n=r.w(n)}function ie(t,e){var n=Zt(t,e.conv1);n=Jt(n,e.conv2);var i=r.d(t,2,2,"valid"),a=r.P(i.shape),u=i.shape[3]!==n.shape[3];if(i.shape[1]!==n.shape[1]||i.shape[2]!==n.shape[2]){var s=Object(o.f)(n.shape);s[1]=1;var c=r.P(s);n=r.h([n,c],1);var l=Object(o.f)(n.shape);l[2]=1;var f=r.P(l);n=r.h([n,f],2)}return i=u?r.h([i,a],3):i,n=r.c(i,n),n=r.w(n)}var oe=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return Object(o.c)(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return r.L(function(){var n=Zt(C(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(r.y(256)),e.conv32_down);n=re(n=r.s(n,3,2,"valid"),e.conv32_1),n=re(n,e.conv32_2),n=re(n,e.conv32_3),n=re(n=ie(n,e.conv64_down),e.conv64_1),n=re(n,e.conv64_2),n=re(n,e.conv64_3),n=re(n=ie(n,e.conv128_down),e.conv128_1),n=re(n,e.conv128_2),n=re(n=ie(n,e.conv256_down),e.conv256_1);var i=(n=ie(n=re(n,e.conv256_2),e.conv256_down_out)).mean([1,2]);return r.q(i,e.fc)})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Object(o.b)(this,void 0,void 0,function(){var e,n,i,a=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return[4,it(t)];case 1:return e=o.sent(),n=r.L(function(){return r.O(a.forwardInput(e))}),[4,Promise.all(n.map(function(t){return t.data()}))];case 2:return i=o.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return ne(t)},e.prototype.extractParams=function(t){return function(t){var e=_t(t),n=e.extractWeights,i=e.getRemainingWeights,o=[],a=te(n,o),u=a.extractConvLayerParams,s=a.extractResidualLayerParams,c=u(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),f=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),v=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),y=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),w=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),C=r.L(function(){return r.N(r.I(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{conv32_down:c,conv32_1:l,conv32_2:f,conv32_3:h,conv64_down:d,conv64_1:p,conv64_2:v,conv64_3:m,conv128_down:g,conv128_1:y,conv128_2:b,conv256_down:w,conv256_1:x,conv256_2:k,conv256_down_out:E,fc:C},paramMappings:o}}(t)},e}(dt);function ae(t,e){var n={descriptor:e};return Object.assign({},t,n)}function ue(t,e){var n={age:e};return Object.assign({},t,n)}function se(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var ce=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,i=e.maxNumScales,o=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=i||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=a,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(t){return"number"!==typeof t}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(t){return"number"!==typeof t})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function le(t,e){function n(n,i,o,a,u){var s=r.K(t(n*i*o*o),[o,o,n,i]),c=r.H(t(i));return e.push({paramPath:a+"/filters"},{paramPath:a+"/"+(u?"batch_norm_offset":"bias")}),{filters:s,bias:c}}function i(t,e,r,i){var o=n(t,e,r,i,!0);return{filters:o.filters,batch_norm_offset:o.bias}}function o(n,o,a){return{depthwise_conv:function(n,i){var o=r.K(t(9*n),[3,3,n,1]),a=r.H(t(n)),u=r.H(t(n)),s=r.H(t(n)),c=r.H(t(n));return e.push({paramPath:i+"/filters"},{paramPath:i+"/batch_norm_scale"},{paramPath:i+"/batch_norm_offset"},{paramPath:i+"/batch_norm_mean"},{paramPath:i+"/batch_norm_variance"}),{filters:o,batch_norm_scale:a,batch_norm_offset:u,batch_norm_mean:s,batch_norm_variance:c}}(n,a+"/depthwise_conv"),pointwise_conv:i(n,o,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:i(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:i(1024,256,1,"prediction_layer/conv_0"),conv_1:i(256,512,3,"prediction_layer/conv_1"),conv_2:i(512,128,1,"prediction_layer/conv_2"),conv_3:i(128,256,3,"prediction_layer/conv_3"),conv_4:i(256,128,1,"prediction_layer/conv_4"),conv_5:i(128,256,3,"prediction_layer/conv_5"),conv_6:i(256,64,1,"prediction_layer/conv_6"),conv_7:i(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function fe(t){var e=[],n=function(t,e){var n=Ct(t,e);function r(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function i(t){var e="mobilenetv1/conv_"+t,i="MobilenetV1/Conv2d_"+t+"_depthwise",o=e+"/depthwise_conv",a=e+"/pointwise_conv";return{depthwise_conv:{filters:n(i+"/depthwise_weights",4,o+"/filters"),batch_norm_scale:n(i+"/BatchNorm/gamma",1,o+"/batch_norm_scale"),batch_norm_offset:n(i+"/BatchNorm/beta",1,o+"/batch_norm_offset"),batch_norm_mean:n(i+"/BatchNorm/moving_mean",1,o+"/batch_norm_mean"),batch_norm_variance:n(i+"/BatchNorm/moving_variance",1,o+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",t,a)}}function o(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:o("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:o("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,o=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!s(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return yt(t,e),{params:a,paramMappings:e}}function he(t,e,n){return r.L(function(){var i=r.i(t,e.filters,n,"same");return i=r.c(i,e.batch_norm_offset),r.g(i,0,6)})}var de=.0010000000474974513;function pe(t,e){return r.L(function(){var n=null,i=he(t,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach(function(t,e){var o,a,u,s=e+1,c=function(t){return[2,4,6,12].some(function(e){return e===t})?[2,2]:[1,1]}(s);o=i,a=t.depthwise_conv,u=c,i=he(i=r.L(function(){var t=r.j(o,a.filters,u,"same");return t=r.e(t,a.batch_norm_mean,a.batch_norm_variance,a.batch_norm_offset,a.batch_norm_scale,de),r.g(t,0,6)}),t.pointwise_conv,[1,1]),11===s&&(n=i)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:i,conv11:n}})}function ve(t,e,n){var r=t.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),u=Math.max(r[e][1],r[e][3]),s=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),h=(a-i)*(u-o),d=(l-s)*(f-c);if(h<=0||d<=0)return 0;var p=Math.max(i,s),v=Math.max(o,c),m=Math.min(a,l),g=Math.min(u,f),y=Math.max(m-p,0)*Math.max(g-v,0);return y/(h+d-y)}function me(t,e){var n=function(t){var e=r.O(r.N(t,[1,0])),n=[r.F(e[2],e[0]),r.F(e[3],e[1])];return{sizes:n,centers:[r.c(e[0],r.k(n[0],r.y(2))),r.c(e[1],r.k(n[1],r.y(2)))]}}(t),i=n.sizes,o=n.centers,a=r.O(r.N(e,[1,0])),u=r.k(r.t(r.l(r.k(a[2],r.y(5))),i[0]),r.y(2)),s=r.c(r.t(r.k(a[0],r.y(10)),i[0]),o[0]),c=r.k(r.t(r.l(r.k(a[3],r.y(5))),i[1]),r.y(2)),l=r.c(r.t(r.k(a[1],r.y(10)),i[1]),o[1]);return r.N(r.E([r.F(s,u),r.F(l,c),r.c(s,u),r.c(l,c)]),[1,0])}function ge(t,e){return r.L(function(){var n=t.shape[0];return{boxPredictionEncoding:r.x(gt(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:r.x(gt(t,e.class_predictor),[n,-1,3])}})}var ye=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),be=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return Object(o.c)(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return r.L(function(){var n=t.toBatchTensor(512,!1).toFloat(),i=pe(r.F(r.t(n,r.y(.007843137718737125)),r.y(1)),e.mobilenetv1),o=function(t,e,n){return r.L(function(){var i=he(t,n.conv_0,[1,1]),o=he(i,n.conv_1,[2,2]),a=he(o,n.conv_2,[1,1]),u=he(a,n.conv_3,[2,2]),s=he(u,n.conv_4,[1,1]),c=he(s,n.conv_5,[2,2]),l=he(c,n.conv_6,[1,1]),f=he(l,n.conv_7,[2,2]),h=ge(e,n.box_predictor_0),d=ge(t,n.box_predictor_1),p=ge(o,n.box_predictor_2),v=ge(u,n.box_predictor_3),m=ge(c,n.box_predictor_4),g=ge(f,n.box_predictor_5);return{boxPredictions:r.h([h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:r.h([h.classPrediction,d.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction,g.classPrediction],1)}})}(i.out,i.conv11,e.prediction_layer);return function(t,e,n){return r.L(function(){var i=t.shape[0],o=me(r.x(r.M(n.extra_dim,[i,1,1]),[-1,4]),r.x(t,[-1,4]));o=r.x(o,[i,o.shape[0]/i,4]);var a=r.A(r.B(e,[0,0,1],[-1,-1,-1])),u=r.B(a,[0,0,0],[-1,-1,1]);return u=r.x(u,[i,u.shape[1]]),{boxes:r.O(o),scores:r.O(u)}})}(o.boxPredictions,o.classPredictions,e.output_layer)})},e.prototype.forward=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,it(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),Object(o.b)(this,void 0,void 0,function(){var n,r,i,a,u,s,c,l,f,h,d,p,v,m,g,y,b,w,k,E;return Object(o.d)(this,function(o){switch(o.label){case 0:return n=new ye(e),r=n.maxResults,i=n.minConfidence,[4,it(t)];case 1:for(a=o.sent(),u=this.forwardInput(a),s=u.boxes,c=u.scores,l=s[0],f=c[0],h=1;h<s.length;h++)s[h].dispose(),c[h].dispose();return v=(p=Array).from,[4,f.data()];case 2:return d=v.apply(p,[o.sent()]),.5,m=function(t,e,n,r,i){var o=t.shape[0],a=Math.min(n,o),u=e.map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>i}).sort(function(t,e){return e.score-t.score}),s=[];return u.forEach(function(e){if(!(s.length>=a)){for(var n=e.score,o=s.length-1;o>=0;--o){var u=ve(t,e.boxIndex,s[o]);if(0!==u&&(e.score*=u<=r?1:0,e.score<=i))break}n===e.score&&s.push(e.boxIndex)}}),s}(l,d,r,.5,i),g=a.getReshapedInputDimensions(0),y=a.inputSize,b=y/g.width,w=y/g.height,k=l.arraySync(),E=m.map(function(t){var e=[Math.max(0,k[t][0]),Math.min(1,k[t][2])].map(function(t){return t*w}),n=e[0],r=e[1],i=[Math.max(0,k[t][1]),Math.min(1,k[t][3])].map(function(t){return t*b}),o=i[0],u=i[1];return new x(d[t],new S(o,n,u-o,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),l.dispose(),f.dispose(),[2,E]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return fe(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=_t(t),i=n.extractWeights,o=n.getRemainingWeights,a=le(i,e),u=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,c=u(),l=s(),f={extra_dim:r.J(i(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:c,prediction_layer:l,output_layer:f},paramMappings:e}}(t)},e}(dt);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Object(o.c)(e,t)}(be);var we,xe=.4,ke=[new g(.738768,.874946),new g(2.42204,2.65704),new g(4.30971,7.04493),new g(10.246,4.59428),new g(12.6868,11.8741)],Ee=[new g(1.603231,2.094468),new g(6.041143,7.080126),new g(2.882459,3.518061),new g(4.266906,5.178857),new g(9.041765,10.66308)],Ce=[117.001,114.697,97.404],_e=function(t){return"number"===typeof t};function Se(t){return r.L(function(){var e=r.t(t,r.y(.10000000149011612));return r.c(r.w(r.F(t,e)),e)})}function Te(t,e){return r.L(function(){var n=r.v(t,[[0,0],[1,1],[1,1],[0,0]]);return n=r.i(n,e.conv.filters,[1,1],"valid"),n=r.F(n,e.bn.sub),n=r.t(n,e.bn.truediv),Se(n=r.c(n,e.conv.bias))})}function Oe(t,e){return r.L(function(){var n=r.v(t,[[0,0],[1,1],[1,1],[0,0]]);return n=r.z(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),Se(n=r.c(n,e.bias))})}function Ie(t,e){var n=bt(t,e);var i=kt(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:function(i,o,a){return{conv:n(i,o,3,a+"/conv"),bn:function(n,i){var o=r.H(t(n)),a=r.H(t(n));return e.push({paramPath:i+"/sub"},{paramPath:i+"/truediv"}),{sub:o,truediv:a}}(o,a+"/bn")}},extractSeparableConvParams:i}}function Re(t,e){var n=Ct(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){return{conv:r(t+"/conv"),bn:function(t){return{sub:n(t+"/sub",1),truediv:n(t+"/truediv",1)}}(t+"/bn")}},extractSeparableConvParams:Et(n)}}!function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"}(we||(we={}));var Ae=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),De=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return function(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!==typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!_e(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(t){return"string"===typeof t}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(t){return t||{}}).every(function(t){return _e(t.x)&&_e(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(_e)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),n._config=e,n}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=Te(t,e.conv0);return n=Te(n=r.s(n,[2,2],[2,2],"same"),e.conv1),n=Te(n=r.s(n,[2,2],[2,2],"same"),e.conv2),n=Te(n=r.s(n,[2,2],[2,2],"same"),e.conv3),n=Te(n=r.s(n,[2,2],[2,2],"same"),e.conv4),n=Te(n=r.s(n,[2,2],[2,2],"same"),e.conv5),n=Te(n=r.s(n,[2,2],[1,1],"same"),e.conv6),gt(n=Te(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?Se(gt(t,e.conv0,"valid",!1)):Oe(t,e.conv0);return n=Oe(n=r.s(n,[2,2],[2,2],"same"),e.conv1),n=Oe(n=r.s(n,[2,2],[2,2],"same"),e.conv2),n=Oe(n=r.s(n,[2,2],[2,2],"same"),e.conv3),n=Oe(n=r.s(n,[2,2],[2,2],"same"),e.conv4),n=Oe(n=r.s(n,[2,2],[2,2],"same"),e.conv5),n=r.s(n,[2,2],[1,1],"same"),n=e.conv6?Oe(n,e.conv6):n,gt(n=e.conv7?Oe(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var n=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return r.L(function(){var o=t.toBatchTensor(e,!1).toFloat();return o=(o=n.config.meanRgb?C(o,n.config.meanRgb):o).div(r.y(256)),n.config.withSeparableConvs?n.runMobilenet(o,i):n.runTinyYolov2(o,i)})},e.prototype.forward=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,it(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent()]}})})},e.prototype.detect=function(t,e){return void 0===e&&(e={}),Object(o.b)(this,void 0,void 0,function(){var n,i,a,u,s,c,l,f,h,d,p,v,m,g=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return n=new Ae(e),i=n.inputSize,a=n.scoreThreshold,[4,it(t)];case 1:return u=o.sent(),[4,this.forwardInput(u,i)];case 2:return s=o.sent(),c=r.L(function(){return r.O(s)[0].expandDims()}),l={width:u.getInputWidth(0),height:u.getInputHeight(0)},[4,this.extractBoxes(c,u.getReshapedInputDimensions(0),a)];case 3:return f=o.sent(),s.dispose(),c.dispose(),h=f.map(function(t){return t.box}),d=f.map(function(t){return t.score}),p=f.map(function(t){return t.classScore}),v=f.map(function(t){return g.config.classes[t.label]}),m=E(h.map(function(t){return t.rescale(i)}),d,this.config.iouThreshold,!0),[2,m.map(function(t){return new w(d[t],p[t],v[t],h[t],l)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],i=Re(t,r),o=i.extractConvParams,a=i.extractConvWithBatchNormParams,u=i.extractSeparableConvParams;if(e.withSeparableConvs){var s=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?o("conv0"):u("conv0"),conv1:u("conv1"),conv2:u("conv2"),conv3:u("conv3"),conv4:u("conv4"),conv5:u("conv5"),conv6:s>7?u("conv6"):void 0,conv7:s>8?u("conv7"):void 0,conv8:o("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:o("conv8")};return yt(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var i,o=_t(t),a=o.extractWeights,u=o.getRemainingWeights,s=[],c=Ie(a,s),l=c.extractConvParams,f=c.extractConvWithBatchNormParams,h=c.extractSeparableConvParams;if(e.withSeparableConvs){var d=r[0],p=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],w=r[7],x=r[8];i={conv0:e.isFirstLayerConv2d?l(d,p,3,"conv0"):h(d,p,"conv0"),conv1:h(p,v,"conv1"),conv2:h(v,m,"conv2"),conv3:h(m,g,"conv3"),conv4:h(g,y,"conv4"),conv5:h(y,b,"conv5"),conv6:w?h(b,w,"conv6"):void 0,conv7:x?h(w,x,"conv7"):void 0,conv8:l(x||w||b,5*n,1,"conv8")}}else d=r[0],p=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],w=r[7],x=r[8],i={conv0:f(d,p,"conv0"),conv1:f(p,v,"conv1"),conv2:f(v,m,"conv2"),conv3:f(m,g,"conv3"),conv4:f(g,y,"conv4"),conv5:f(y,b,"conv5"),conv6:f(b,w,"conv6"),conv7:f(w,x,"conv7"),conv8:l(x,5*n,1,"conv8")};if(0!==u().length)throw new Error("weights remaing after extract: "+u().length);return{params:i,paramMappings:s}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){return Object(o.b)(this,void 0,void 0,function(){var i,a,u,s,c,l,f,h,d,p,v,m,g,y,w,x,k,E,C,S,T,O,I,R,A,D,N,P,M,F=this;return Object(o.d)(this,function(L){switch(L.label){case 0:return i=e.width,a=e.height,u=Math.max(i,a),s=u/i,c=u/a,l=t.shape[1],f=this.config.anchors.length,h=r.L(function(){var e=t.reshape([l,l,f,F.boxEncodingSize]);return[e.slice([0,0,0,0],[l,l,f,4]),e.slice([0,0,0,4],[l,l,f,1]),F.withClassScores?r.D(e.slice([0,0,0,5],[l,l,f,F.config.classes.length]),3):r.y(0)]}),d=h[0],p=h[1],v=h[2],m=[],[4,p.array()];case 1:return g=L.sent(),[4,d.array()];case 2:y=L.sent(),w=0,L.label=3;case 3:if(!(w<l))return[3,12];x=0,L.label=4;case 4:if(!(x<l))return[3,11];k=0,L.label=5;case 5:return k<f?(E=_(g[w][x][k][0]),!n||E>n?(C=(x+_(y[w][x][k][0]))/l*s,S=(w+_(y[w][x][k][1]))/l*c,T=Math.exp(y[w][x][k][2])*this.config.anchors[k].x/l*s,O=Math.exp(y[w][x][k][3])*this.config.anchors[k].y/l*c,I=C-T/2,R=S-O/2,A={row:w,col:x,anchor:k},this.withClassScores?[4,this.extractPredictedClass(v,A)]:[3,7]):[3,9]):[3,10];case 6:return M=L.sent(),[3,8];case 7:M={classScore:1,label:0},L.label=8;case 8:N=(D=M).classScore,P=D.label,m.push(Object(o.a)({box:new b(I,R,I+T,R+O),score:E,classScore:E*N,label:P},A)),L.label=9;case 9:return k++,[3,5];case 10:return x++,[3,4];case 11:return w++,[3,3];case 12:return d.dispose(),p.dispose(),v.dispose(),[2,m]}})})},e.prototype.extractPredictedClass=function(t,e){return Object(o.b)(this,void 0,void 0,function(){var n,r,i,a;return Object(o.d)(this,function(o){switch(o.label){case 0:return n=e.row,r=e.col,i=e.anchor,[4,t.array()];case 1:return a=o.sent(),[2,Array(this.config.classes.length).fill(0).map(function(t,e){return a[n][r][i][e]}).map(function(t,e){return{classScore:t,label:e}}).reduce(function(t,e){return t.classScore>e.classScore?t:e})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(dt),Ne=function(t){function e(e){void 0===e&&(e=!0);var n=Object.assign({},{withSeparableConvs:e,iouThreshold:xe,classes:["face"]},e?{anchors:Ee,meanRgb:Ce}:{anchors:ke,withClassScores:!0});return t.call(this,n)||this}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new x(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(De);var Pe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return Object(o.c)(e,t),e}(Ae),Me=function(){function t(){}return t.prototype.then=function(t){return Object(o.b)(this,void 0,void 0,function(){var e;return Object(o.d)(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},t.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},t}();function Fe(t,e,n,i,a){return void 0===a&&(a=function(t){return t.alignedRect}),Object(o.b)(this,void 0,void 0,function(){var u,s,c,l,f;return Object(o.d)(this,function(o){switch(o.label){case 0:return u=t.map(function(t){return Lt(t)?a(t):t.detection}),(c=i)?[3,5]:e instanceof r.a?[4,at(e,u)]:[3,2];case 1:return l=o.sent(),[3,4];case 2:return[4,ot(e,u)];case 3:l=o.sent(),o.label=4;case 4:c=l,o.label=5;case 5:return[4,n(s=c)];case 6:return f=o.sent(),s.forEach(function(t){return t instanceof r.a&&t.dispose()}),[2,f]}})})}function Le(t,e,n,r,i){return Object(o.b)(this,void 0,void 0,function(){var a=this;return Object(o.d)(this,function(u){return[2,Fe([t],e,function(t){return Object(o.b)(a,void 0,void 0,function(){return Object(o.d)(this,function(e){return[2,n(t[0])]})})},r,i)]})})}var je=2,Be=12;function Ve(t){var e=_t(t),n=e.extractWeights,i=e.getRemainingWeights,a=[],u=function(t,e){var n=bt(t,e),i=wt(t,e);function a(n,i){var o=r.H(t(n));return e.push({paramPath:i}),o}function u(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:a(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:a(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:a(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=u([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return Object(o.a)(Object(o.a)({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=u([3,28,48,64],"rnet",!0),e=i(576,128,"rnet/fc1"),n=a(128,"rnet/prelu4_alpha"),r=i(128,2,"rnet/fc2_1"),s=i(128,4,"rnet/fc2_2");return Object(o.a)(Object(o.a)({},t),{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var t=u([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),r=a(128,"onet/prelu4_alpha"),s=i(1152,256,"onet/fc1"),c=a(256,"onet/prelu5_alpha"),l=i(256,2,"onet/fc2_1"),f=i(256,4,"onet/fc2_2"),h=i(256,10,"onet/fc2_3");return Object(o.a)(Object(o.a)({},t),{conv4:e,prelu4_alpha:r,fc1:s,prelu5_alpha:c,fc2_1:l,fc2_2:f,fc2_3:h})}}}(n,a),s=u.extractPNetParams,c=u.extractRNetParams,l=u.extractONetParams,f=s(),h=c(),d=l();if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{pnet:f,rnet:h,onet:d},paramMappings:a}}function Ue(t){var e=[],n=function(t,e){var n=Ct(t,e);function r(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function i(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function a(t){return n(t,1)}function u(t){return{conv1:r(t+"/conv1"),prelu1_alpha:a(t+"/prelu1_alpha"),conv2:r(t+"/conv2"),prelu2_alpha:a(t+"/prelu2_alpha"),conv3:r(t+"/conv3"),prelu3_alpha:a(t+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=u("pnet"),e=r("pnet/conv4_1"),n=r("pnet/conv4_2");return Object(o.a)(Object(o.a)({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=u("rnet"),e=i("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=i("rnet/fc2_1"),s=i("rnet/fc2_2");return Object(o.a)(Object(o.a)({},t),{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var t=u("onet"),e=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=i("onet/fc1"),c=a("onet/prelu5_alpha"),l=i("onet/fc2_1"),f=i("onet/fc2_2"),h=i("onet/fc2_3");return Object(o.a)(Object(o.a)({},t),{conv4:e,prelu4_alpha:n,fc1:s,prelu5_alpha:c,fc2_1:l,fc2_2:f,fc2_3:h})}}}(t,e),r=n.extractPNetParams,i=n.extractRNetParams,a=n.extractONetParams,u=r(),s=i(),c=a();return yt(t,e),{params:{pnet:u,rnet:s,onet:c},paramMappings:e}}function ze(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}var We=function(t){function e(e,n,r,i){return t.call(this,{left:e,top:n,right:r,bottom:i},!0)||this}return Object(o.c)(e,t),e}(y);function Ge(t){return r.L(function(){return r.t(r.F(t,r.y(127.5)),r.y(.0078125))})}function He(t,e){return r.L(function(){return r.c(r.w(t),r.t(e,r.u(r.w(r.u(t)))))})}function qe(t,e,n){return void 0===n&&(n=!1),r.L(function(){var i=gt(t,e.conv1,"valid");return i=He(i,e.prelu1_alpha),i=He(i=gt(i=r.s(i,n?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),i=He(i=gt(i=n?i:r.s(i,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function Ke(t,e,n,i,o){o.stage1=[];var a=e.map(function(e){return r.L(function(){var n={scale:e},o=function(t,e){return r.L(function(){var n=ze(e,t.shape.slice(1)),i=n.height,o=n.width,a=Ge(r.o.resizeBilinear(t,[i,o]));return r.N(a,[0,2,1,3])})}(t,e),a=Date.now(),u=function(t,e){return r.L(function(){var n=qe(t,e,!0),i=gt(n,e.conv4_1,"valid"),o=r.m(r.r(i,3),3);return{prob:r.D(r.F(i,o),3),regions:gt(n,e.conv4_2,"valid")}})}(o,i),s=u.prob,c=u.regions;return n.pnet=Date.now()-a,{scoresTensor:r.O(r.O(s,3)[1])[0],regionsTensor:r.O(c)[0],scale:e,statsForScale:n}})}).map(function(t){var e=t.scoresTensor,r=t.regionsTensor,i=t.scale,a=t.statsForScale,u=function(t,e,n,r){for(var i=[],o=t.arraySync(),a=0;a<t.shape[0];a++)for(var u=0;u<t.shape[1];u++)o[a][u]>=r&&i.push(new g(u,a));return i.map(function(t){var r=new b(Math.round((t.y*je+1)/n),Math.round((t.x*je+1)/n),Math.round((t.y*je+Be)/n),Math.round((t.x*je+Be)/n)),i=o[t.y][t.x],a=e.arraySync();return{cell:r,score:i,region:new We(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}})}(e,r,i,n);if(e.dispose(),r.dispose(),!u.length)return o.stage1.push(a),[];var s=Date.now(),c=E(u.map(function(t){return t.cell}),u.map(function(t){return t.score}),.5);return a.nms=Date.now()-s,a.numBoxes=c.length,o.stage1.push(a),c.map(function(t){return u[t]})}).reduce(function(t,e){return t.concat(e)},[]),u=[],s=[];if(a.length>0){var c=Date.now(),l=E(a.map(function(t){return t.cell}),a.map(function(t){return t.score}),.7);o.stage1_nms=Date.now()-c,s=l.map(function(t){return a[t].score}),u=l.map(function(t){return a[t]}).map(function(t){var e=t.cell,n=t.region;return new b(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()})}return{boxes:u,scores:s}}function Xe(t,e,n){var i=n.width,a=n.height;return Object(o.b)(this,void 0,void 0,function(){var n,u,s,c=this;return Object(o.d)(this,function(l){switch(l.label){case 0:return n=q(t),[4,Promise.all(e.map(function(e){return Object(o.b)(c,void 0,void 0,function(){var r,i,a,u,s,c,l,f;return Object(o.d)(this,function(o){return r=e.padAtBorders(t.height,t.width),i=r.y,a=r.ey,u=r.x,s=r.ex,c=u-1,l=i-1,f=n.getImageData(c,l,s-c,a-l),[2,G.isNodejs()?tt(f):createImageBitmap(f)]})})}))];case 1:return u=l.sent(),s=[],u.forEach(function(t){var e=q(Z({width:i,height:a}));e.drawImage(t,0,0,i,a);for(var n=e.getImageData(0,0,i,a).data,r=[],o=0;o<n.length;o+=4)r.push(n[o+2]),r.push(n[o+1]),r.push(n[o]);s.push(r)}),[2,s.map(function(t){return r.L(function(){return Ge(r.N(r.K(t,[1,i,a,3]),[0,2,1,3]).toFloat())})})]}})})}function Ye(t,e,n,i,a){return Object(o.b)(this,void 0,void 0,function(){var u,s,c,l,f,h,d,p,v,m,g,y,b,w;return Object(o.d)(this,function(o){switch(o.label){case 0:return u=Date.now(),[4,Xe(t,e,{width:24,height:24})];case 1:return s=o.sent(),a.stage2_extractImagePatches=Date.now()-u,u=Date.now(),c=s.map(function(t){var e=function(t,e){return r.L(function(){var n=qe(t,e),i=He(Rt(r.x(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),o=Rt(i,e.fc2_1),a=r.m(r.r(o,1),1),u=r.D(r.F(o,a),1),s=Rt(i,e.fc2_2);return{scores:r.O(u,1)[1],regions:s}})}(t,i);return t.dispose(),e}),a.stage2_rnet=Date.now()-u,l=c.length>1?r.h(c.map(function(t){return t.scores})):c[0].scores,d=(h=Array).from,[4,l.data()];case 2:return f=d.apply(h,[o.sent()]),l.dispose(),p=f.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),v=p.map(function(t){return e[t]}),m=p.map(function(t){return f[t]}),g=[],y=[],v.length>0&&(u=Date.now(),b=E(v,m,.7),a.stage2_nms=Date.now()-u,w=b.map(function(t){var e=c[p[t]].regions.arraySync();return new We(e[0][0],e[0][1],e[0][2],e[0][3])}),y=b.map(function(t){return m[t]}),g=b.map(function(t,e){return v[t].calibrate(w[e])})),c.forEach(function(t){t.regions.dispose(),t.scores.dispose()}),[2,{boxes:g,scores:y}]}})})}function Qe(t,e,n,i,a){return Object(o.b)(this,void 0,void 0,function(){var u,s,c,l,f,h,d,p,v,m,y,b,w,x,k;return Object(o.d)(this,function(o){switch(o.label){case 0:return u=Date.now(),[4,Xe(t,e,{width:48,height:48})];case 1:return s=o.sent(),a.stage3_extractImagePatches=Date.now()-u,u=Date.now(),c=s.map(function(t){var e=function(t,e){return r.L(function(){var n=qe(t,e);n=He(n=gt(n=r.s(n,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var i=He(Rt(r.x(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),o=Rt(i,e.fc2_1),a=r.m(r.r(o,1),1),u=r.D(r.F(o,a),1),s=Rt(i,e.fc2_2),c=Rt(i,e.fc2_3);return{scores:r.O(u,1)[1],regions:s,points:c}})}(t,i);return t.dispose(),e}),a.stage3_onet=Date.now()-u,l=c.length>1?r.h(c.map(function(t){return t.scores})):c[0].scores,d=(h=Array).from,[4,l.data()];case 2:return f=d.apply(h,[o.sent()]),l.dispose(),p=f.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),v=p.map(function(t){var e=c[t].regions.arraySync();return new We(e[0][0],e[0][1],e[0][2],e[0][3])}),m=p.map(function(t,n){return e[t].calibrate(v[n])}),y=p.map(function(t){return f[t]}),b=[],w=[],x=[],m.length>0&&(u=Date.now(),k=E(m,y,.7,!1),a.stage3_nms=Date.now()-u,b=k.map(function(t){return m[t]}),w=k.map(function(t){return y[t]}),x=k.map(function(t,e){return Array(5).fill(0).map(function(n,r){var i=c[t].points.arraySync();return new g(i[0][r]*(b[e].width+1)+b[e].left,i[0][r+5]*(b[e].height+1)+b[e].top)})})),c.forEach(function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()}),[2,{boxes:b,scores:w,points:x}]}})})}var $e=function(t){function e(){return t.call(this,"Mtcnn")||this}return Object(o.c)(e,t),e.prototype.load=function(e){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},e.prototype.loadFromDisk=function(e){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),Object(o.b)(this,void 0,void 0,function(){var n,i,a,u,s,c,l,f,h,d,p,v,m,y,b,w,k,E,C,_,T;return Object(o.d)(this,function(o){switch(o.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(i=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},u=Date.now(),s=r.L(function(){return t=r.m(r.f.fromPixels(i)).toFloat(),r.L(function(){return r.E(r.O(t,3).reverse(),3)});var t}),c=function(t){return s.dispose(),a.total=Date.now()-u,t},l=s.shape.slice(1),f=l[0],h=l[1],d=new ce(e),p=d.minFaceSize,v=d.scaleFactor,m=d.maxNumScales,y=d.scoreThresholds,b=d.scaleSteps,w=(b||function(t,e,n){for(var r=n[0],i=n[1],o=Be/t,a=[],u=Math.min(r,i)*o,s=0;u>=12;)a.push(o*Math.pow(e,s)),u*=e,s+=1;return a}(p,v,[f,h])).filter(function(t){var e=ze(t,[f,h]);return Math.min(e.width,e.height)>Be}).slice(0,m),a.scales=w,a.pyramid=w.map(function(t){return ze(t,[f,h])}),k=Date.now(),[4,Ke(s,w,y[0],n.pnet,a)];case 1:return E=o.sent(),a.total_stage1=Date.now()-k,E.boxes.length?(a.stage2_numInputBoxes=E.boxes.length,k=Date.now(),[4,Ye(i,E.boxes,y[1],n.rnet,a)]):[2,c({results:[],stats:a})];case 2:return C=o.sent(),a.total_stage2=Date.now()-k,C.boxes.length?(a.stage3_numInputBoxes=C.boxes.length,k=Date.now(),[4,Qe(i,C.boxes,y[2],n.onet,a)]):[2,c({results:[],stats:a})];case 3:return _=o.sent(),a.total_stage3=Date.now()-k,T=_.boxes.map(function(t,e){return jt(P({},new x(_.scores[e],new S(t.left/h,t.top/f,t.width/h,t.height/f),{height:f,width:h})),new O(_.points[e].map(function(e){return e.sub(new g(t.left,t.top)).div(new g(t.width,t.height))}),{width:t.width,height:t.height}))}),[2,c({results:T,stats:a})]}})})},e.prototype.forward=function(t,e){return void 0===e&&(e={}),Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,it(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent().results]}})})},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),Object(o.b)(this,void 0,void 0,function(){var n;return Object(o.d)(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,it(t)];case 1:return[2,n.apply(this,[r.sent(),e])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Ue(t)},e.prototype.extractParams=function(t){return Ve(t)},e}(dt),Je=.4,Ze=[new g(1.603231,2.094468),new g(6.041143,7.080126),new g(2.882459,3.518061),new g(4.266906,5.178857),new g(9.041765,10.66308)],tn=[117.001,114.697,97.404],en=function(t){function e(){var e={withSeparableConvs:!0,iouThreshold:Je,classes:["face"],anchors:Ze,meanRgb:tn,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)||this}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return Object(o.b)(this,void 0,void 0,function(){return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new x(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(De),nn={ssdMobilenetv1:new be,tinyFaceDetector:new en,tinyYolov2:new Ne,mtcnn:new $e,faceLandmark68Net:new Xt,faceLandmark68TinyNet:new Qt,faceRecognitionNet:new oe,faceExpressionNet:new Mt,ageGenderNet:new qt},rn=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parentTask=e,i.input=n,i.extractedFaces=r,i}return Object(o.c)(e,t),e}(Me),on=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(o.d)(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Fe(t=r.sent(),this.input,function(t){return Object(o.b)(n,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return nn.faceExpressionNet.predictExpressions(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){return Ft(t,e[n])})]}})})},e.prototype.withAgeAndGender=function(){return new ln(this,this.input)},e}(rn),an=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e;return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Le(t,this.input,function(t){return nn.faceExpressionNet.predictExpressions(t)},this.extractedFaces)]:[2];case 2:return e=n.sent(),[2,Ft(t,e)]}})})},e.prototype.withAgeAndGender=function(){return new fn(this,this.input)},e}(rn),un=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.withAgeAndGender=function(){return new hn(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vn(this,this.input)},e}(on),sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.withAgeAndGender=function(){return new dn(this,this.input)},e.prototype.withFaceDescriptor=function(){return new mn(this,this.input)},e}(an),cn=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parentTask=e,i.input=n,i.extractedFaces=r,i}return Object(o.c)(e,t),e}(Me),ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(o.d)(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Fe(t=r.sent(),this.input,function(t){return Object(o.b)(n,void 0,void 0,function(){return Object(o.d)(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return nn.ageGenderNet.predictAgeAndGender(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){var r=e[n],i=r.age;return ue(se(t,r.gender,r.genderProbability),i)})]}})})},e.prototype.withFaceExpressions=function(){return new on(this,this.input)},e}(cn),fn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(o.d)(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(t=o.sent())?[4,Le(t,this.input,function(t){return nn.ageGenderNet.predictAgeAndGender(t)},this.extractedFaces)]:[2];case 2:return e=o.sent(),n=e.age,r=e.gender,i=e.genderProbability,[2,ue(se(t,r,i),n)]}})})},e.prototype.withFaceExpressions=function(){return new an(this,this.input)},e}(cn),hn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.withFaceExpressions=function(){return new un(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vn(this,this.input)},e}(ln),dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.withFaceExpressions=function(){return new sn(this,this.input)},e.prototype.withFaceDescriptor=function(){return new mn(this,this.input)},e}(fn),pn=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return Object(o.c)(e,t),e}(Me),vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t;return Object(o.d)(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,Fe(t=e.sent(),this.input,function(t){return Promise.all(t.map(function(t){return nn.faceRecognitionNet.computeFaceDescriptor(t)}))},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,e.sent().map(function(e,n){return ae(t[n],e)})]}})})},e.prototype.withFaceExpressions=function(){return new un(this,this.input)},e.prototype.withAgeAndGender=function(){return new hn(this,this.input)},e}(pn),mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e;return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Le(t,this.input,function(t){return nn.faceRecognitionNet.computeFaceDescriptor(t)},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return e=n.sent(),[2,ae(t,e)]}})})},e.prototype.withFaceExpressions=function(){return new sn(this,this.input)},e.prototype.withAgeAndGender=function(){return new dn(this,this.input)},e}(pn),gn=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parentTask=e,i.input=n,i.useTinyLandmarkNet=r,i}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?nn.faceLandmark68TinyNet:nn.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Me),yn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e,n,i,a,u=this;return Object(o.d)(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),e=t.map(function(t){return t.detection}),this.input instanceof r.a?[4,at(this.input,e)]:[3,3];case 2:return i=o.sent(),[3,5];case 3:return[4,ot(this.input,e)];case 4:i=o.sent(),o.label=5;case 5:return n=i,[4,Promise.all(n.map(function(t){return u.landmarkNet.detectLandmarks(t)}))];case 6:return a=o.sent(),n.forEach(function(t){return t instanceof r.a&&t.dispose()}),[2,t.map(function(t,e){return jt(t,a[e])})]}})})},e.prototype.withFaceExpressions=function(){return new un(this,this.input)},e.prototype.withAgeAndGender=function(){return new hn(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vn(this,this.input)},e}(gn),bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e,n,i,a;return Object(o.d)(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(t=o.sent())?(e=t.detection,this.input instanceof r.a?[4,at(this.input,[e])]:[3,3]):[2];case 2:return i=o.sent(),[3,5];case 3:return[4,ot(this.input,[e])];case 4:i=o.sent(),o.label=5;case 5:return n=i,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return a=o.sent(),n.forEach(function(t){return t instanceof r.a&&t.dispose()}),[2,jt(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new sn(this,this.input)},e.prototype.withAgeAndGender=function(){return new dn(this,this.input)},e.prototype.withFaceDescriptor=function(){return new mn(this,this.input)},e}(gn),wn=function(t){function e(e,n){void 0===n&&(n=new ye);var r=t.call(this)||this;return r.input=e,r.options=n,r}return Object(o.c)(e,t),e}(Me),xn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(o.d)(this,function(i){switch(i.label){case 0:return e=(t=this).input,(n=t.options)instanceof ce?[4,nn.mtcnn.forward(e,n)]:[3,2];case 1:return[2,i.sent().map(function(t){return t.detection})];case 2:if(!(r=n instanceof Pe?function(t){return nn.tinyFaceDetector.locateFaces(t,n)}:n instanceof ye?function(t){return nn.ssdMobilenetv1.locateFaces(t,n)}:n instanceof Ae?function(t){return nn.tinyYolov2.locateFaces(t,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(e)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return Object(o.b)(t,void 0,void 0,function(){var t;return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t.map(function(t){return P({},t)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new yn(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new on(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new ln(this.runAndExtendWithFaceDetections(),this.input)},e}(wn),kn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.run=function(){return Object(o.b)(this,void 0,void 0,function(){var t,e;return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,new xn(this.input,this.options)];case 1:return t=n.sent(),e=t[0],t.forEach(function(t){t.score>e.score&&(e=t)}),[2,e]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return Object(o.b)(t,void 0,void 0,function(){var t;return Object(o.d)(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t?P({},t):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new bn(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new an(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new fn(this.runAndExtendWithFaceDetection(),this.input)},e}(wn);function En(t,e){return void 0===e&&(e=new ye),new kn(t,e)}function Cn(t,e){return void 0===e&&(e=new ye),new xn(t,e)}var _n=function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,i=function(){return"person "+r++};this._labeledDescriptors=n.map(function(t){if(t instanceof D)return t;if(t instanceof Float32Array)return new D(i(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new D(i(),[t.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map(function(e){return function(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map(function(t,e){return t-r[e]}).reduce(function(t,e){return t+Math.pow(e,2)},0))}(e,t)}).reduce(function(t,e){return t+e},0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,i=n.label;return new R(i,e.computeMeanDistance(t,r))}).reduce(function(t,e){return t.distance<e.distance?t:e})},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new R("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},t.fromJSON=function(e){return new t(e.labeledDescriptors.map(function(t){return D.fromJSON(t)}),e.distanceThreshold)},t}();function Sn(t,e){var n=new a(e.width,e.height),r=n.width,i=n.height;if(r<=0||i<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:i}));if(Array.isArray(t))return t.map(function(t){return Sn(t,{width:r,height:i})});if(Lt(t)){var o=t.detection.forSize(r,i),u=t.unshiftedLandmarks.forSize(o.box.width,o.box.height);return jt(P(t,o),u)}return N(t)?P(t,t.detection.forSize(r,i)):t instanceof T||t instanceof x?t.forSize(r,i):t}n.d(e,"b",function(){return D}),n.d(e,"c",function(){return S}),n.d(e,"d",function(){return $}),n.d(e,"e",function(){return tt}),n.d(e,"h",function(){return ot}),n.d(e,"i",function(){return st}),n.d(e,"j",function(){return ht}),n.d(e,"g",function(){return En}),n.d(e,"f",function(){return Cn}),n.d(e,"a",function(){return _n}),n.d(e,"k",function(){return nn}),n.d(e,"l",function(){return Sn})},function(t,e,n){"use strict";n.d(e,"a",function(){return c}),n.d(e,"b",function(){return v}),n.d(e,"c",function(){return m}),n.d(e,"d",function(){return g});var r,i=n(2),o=n(3),a=n(10);function u(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var c,l=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(c||(c={}));var f={debug:c.DEBUG,verbose:c.VERBOSE,info:c.INFO,warn:c.WARN,error:c.ERROR,silent:c.SILENT},h=c.INFO,d=(r={},Object(a.a)(r,c.DEBUG,"log"),Object(a.a)(r,c.VERBOSE,"log"),Object(a.a)(r,c.INFO,"info"),Object(a.a)(r,c.WARN,"warn"),Object(a.a)(r,c.ERROR,"error"),r),p=function(t,e){if(!(e<t.logLevel)){var n=(new Date).toISOString(),r=d[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(e,")"));for(var i,o=arguments.length,a=new Array(o>2?o-2:0),u=2;u<o;u++)a[u-2]=arguments[u];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(t.name,":")].concat(a))}},v=function(){function t(e){Object(i.a)(this,t),this.name=e,this._logLevel=h,this._logHandler=p,this._userLogHandler=null,l.push(this)}return Object(o.a)(t,[{key:"setLogLevel",value:function(t){this._logLevel="string"===typeof t?f[t]:t}},{key:"debug",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,c.DEBUG].concat(e)),this._logHandler.apply(this,[this,c.DEBUG].concat(e))}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,c.VERBOSE].concat(e)),this._logHandler.apply(this,[this,c.VERBOSE].concat(e))}},{key:"info",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,c.INFO].concat(e)),this._logHandler.apply(this,[this,c.INFO].concat(e))}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,c.WARN].concat(e)),this._logHandler.apply(this,[this,c.WARN].concat(e))}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,c.ERROR].concat(e)),this._logHandler.apply(this,[this,c.ERROR].concat(e))}},{key:"logLevel",get:function(){return this._logLevel},set:function(t){if(!(t in c))throw new TypeError('Invalid value "'.concat(t,'" assigned to `logLevel`'));this._logLevel=t}},{key:"logHandler",get:function(){return this._logHandler},set:function(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t}}]),t}();function m(t){l.forEach(function(e){e.setLogLevel(t)})}function g(t,e){var n,r=u(l);try{var i=function(){var r=n.value,i=null;e&&e.level&&(i=f[e.level]),r.userLogHandler=null===t?null:function(e,n){for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];var u=o.map(function(t){if(null==t)return null;if("string"===typeof t)return t;if("number"===typeof t||"boolean"===typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(e){return null}}).filter(function(t){return t}).join(" ");n>=(null!==i&&void 0!==i?i:e.logLevel)&&t({level:c[n].toLowerCase(),message:u,args:o,type:e.name})}};for(r.s();!(n=r.n()).done;)i()}catch(o){r.e(o)}finally{r.f()}}},function(t,e,n){"use strict";n(14);var r=n(5),i=n(11),o=n(2),a=n(3),u=n(9),s=n(6),c=n(8),l=n(21),f=n(13),h=n(7),d=n(20);function p(){p=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(T){u=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new C(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=x(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(T){return{type:"throw",arg:T}}}t.wrap=s;var l={};function f(){}function h(){}function d(){}var v={};u(v,i,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(_([])));g&&g!==e&&n.call(g,i)&&(v=g);var y=d.prototype=f.prototype=Object.create(v);function b(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function w(t,e){var r;this._invoke=function(i,o){function a(){return new e(function(r,a){!function r(i,o,a,u){var s=c(t[i],t,o);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then(function(t){r("next",t,a,u)},function(t){r("throw",t,a,u)}):e.resolve(f).then(function(t){l.value=t,a(l)},function(t){return r("throw",t,a,u)})}u(s.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=d,u(y,"constructor",d),u(d,"constructor",h),h.displayName=u(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,o,function(){return this}),t.AsyncIterator=w,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new w(s(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},b(y),u(y,a,"Generator"),u(y,i,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var v="firebasestorage.googleapis.com",m="storageBucket",g=12e4,y=6e5,b=function(t){function e(t,n){var r;return Object(o.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this,w(t),"Firebase Storage: ".concat(n," (").concat(w(t),")")))).customData={serverResponse:null},r._baseMessage=r.message,Object.setPrototypeOf(Object(l.a)(Object(l.a)(r)),e.prototype),r}return Object(c.a)(e,t),Object(a.a)(e,[{key:"_codeEquals",value:function(t){return w(t)===this.code}},{key:"serverResponse",get:function(){return this.customData.serverResponse},set:function(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}]),e}(h.c);function w(t){return"storage/"+t}function x(){return new b("unknown","An unknown error occurred, please check the error payload for server response.")}function k(){return new b("canceled","User canceled the upload/download.")}function E(){return new b("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function C(t){return new b("invalid-argument",t)}function _(){return new b("app-deleted","The Firebase app was deleted.")}function S(t,e){return new b("invalid-format","String does not match format '"+t+"': "+e)}function T(t){throw new b("internal-error","Internal error: "+t)}var O,I=function(){function t(e,n){Object(o.a)(this,t),this.bucket=e,this.path_=n}return Object(a.a)(t,[{key:"fullServerUrl",value:function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}},{key:"bucketOnlyServerUrl",value:function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}},{key:"path",get:function(){return this.path_}},{key:"isRoot",get:function(){return 0===this.path.length}}],[{key:"makeFromBucketSpec",value:function(e,n){var r;try{r=t.makeFromUrl(e,n)}catch(i){return new t(e,"")}if(""===r.path)return r;throw new b("invalid-default-bucket","Invalid default bucket '"+e+"'.")}},{key:"makeFromUrl",value:function(e,n){var r=null;var i=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");function o(t){t.path_=decodeURIComponent(t.path)}for(var a=n.replace(/[.]/g,"\\."),u=[{regex:i,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(a,"/").concat("v[A-Za-z0-9_]+","/b/").concat("([A-Za-z0-9.\\-_]+)","/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:o},{regex:new RegExp("^https?://".concat(n===v?"(?:storage.googleapis.com|storage.cloud.google.com)":n,"/").concat("([A-Za-z0-9.\\-_]+)","/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:o}],s=0;s<u.length;s++){var c=u[s],l=c.regex.exec(e);if(l){var f=l[c.indices.bucket],h=l[c.indices.path];h||(h=""),r=new t(f,h),c.postModify(r);break}}if(null==r)throw function(t){return new b("invalid-url","Invalid URL '"+t+"'.")}(e);return r}}]),t}(),R=function(){function t(e){Object(o.a)(this,t),this.promise_=Promise.reject(e)}return Object(a.a)(t,[{key:"getPromise",value:function(){return this.promise_}},{key:"cancel",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}}]),t}();function A(t){return"string"===typeof t||t instanceof String}function D(t){return N()&&t instanceof Blob}function N(){return"undefined"!==typeof Blob}function P(t,e,n,r){if(r<e)throw C("Invalid value for '".concat(t,"'. Expected ").concat(e," or greater."));if(r>n)throw C("Invalid value for '".concat(t,"'. Expected ").concat(n," or less."))}function M(t,e,n){var r=e;return null==n&&(r="https://".concat(e)),"".concat(n,"://").concat(r,"/v0").concat(t)}function F(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(O||(O={}));var L=function(){function t(e,n,r,i,a,u,s,c,l,f,h){var d=this;Object(o.a)(this,t),this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=a,this.additionalRetryCodes_=u,this.callback_=s,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=f,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(function(t,e){d.resolve_=t,d.reject_=e,d.start_()})}return Object(a.a)(t,[{key:"start_",value:function(){var t=this,e=function(e,n){var r=t.resolve_,i=t.reject_,o=n.connection;if(n.wasSuccessCode)try{var a=t.callback_(o,o.getResponse());void 0!==a?r(a):r()}catch(s){i(s)}else if(null!==o){var u=x();u.serverResponse=o.getErrorText(),t.errorCallback_?i(t.errorCallback_(o,u)):i(u)}else{if(n.canceled)i(t.appDelete_?_():k());else i(new b("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?e(0,new j(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=null,a=!1,u=0;function s(){return 2===u}var c=!1;function l(){if(!c){c=!0;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];e.apply(null,n)}}function f(e){i=setTimeout(function(){i=null,t(d,s())},e)}function h(){o&&clearTimeout(o)}function d(t){if(c)h();else{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if(t)return h(),void l.call.apply(l,[null,t].concat(n));var o;if(s()||a)return h(),void l.call.apply(l,[null,t].concat(n));r<64&&(r*=2),1===u?(u=2,o=0):o=1e3*(r+Math.random()),f(o)}}var p=!1;function v(t){p||(p=!0,h(),c||(null!==i?(t||(u=2),clearTimeout(i),f(0)):t||(u=1)))}return f(0),o=setTimeout(function(){a=!0,v(!0)},n),v}(function(e,n){if(n)e(!1,new j(!1,null,!0));else{var r=t.connectionFactory_();t.pendingConnection_=r;var i=function(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)};null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(){null!==t.progressCallback_&&r.removeUploadProgressListener(i),t.pendingConnection_=null;var n=r.getErrorCode()===O.NO_ERROR,o=r.getStatus();if(n&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new j(a,r))}else{var u=r.getErrorCode()===O.ABORT;e(!1,new j(!1,null,u))}})}},e,this.timeout_)}},{key:"getPromise",value:function(){return this.promise_}},{key:"cancel",value:function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}},{key:"isRetryStatusCode_",value:function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r}}]),t}(),j=function t(e,n,r){Object(o.a)(this,t),this.wasSuccessCode=e,this.connection=n,this.canceled=!!r};function B(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}var V={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},U=function t(e,n){Object(o.a)(this,t),this.data=e,this.contentType=n||null};function z(t,e){switch(t){case V.RAW:return new U(W(e));case V.BASE64:case V.BASE64URL:return new U(G(t,e));case V.DATA_URL:return new U(function(t){var e=new H(t);return e.base64?G(V.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(n){throw S(V.DATA_URL,"Malformed data URL.")}return W(e)}(e.rest)}(e),new H(e).contentType)}throw x()}function W(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296===(64512&r))if(n<t.length-1&&56320===(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320===(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function G(t,e){switch(t){case V.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw S(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case V.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw S(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(c){throw S(t,"Invalid character found")}for(var u=new Uint8Array(a.length),s=0;s<a.length;s++)u[s]=a.charCodeAt(s);return u}var H=function t(e){Object(o.a)(this,t),this.base64=!1,this.contentType=null;var n=e.match(/^data:([^,]+)?,/);if(null===n)throw S(V.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var r=n[1]||null;null!=r&&(this.base64=function(t,e){if(!(t.length>=e.length))return!1;return t.substring(t.length-e.length)===e}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)};var q=function(){function t(e,n){Object(o.a)(this,t);var r=0,i="";D(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}return Object(a.a)(t,[{key:"size",value:function(){return this.size_}},{key:"type",value:function(){return this.type_}},{key:"slice",value:function(e,n){if(D(this.data_)){var r=this.data_,i=(a=e,u=n,(o=r).webkitSlice?o.webkitSlice(a,u):o.mozSlice?o.mozSlice(a,u):o.slice?o.slice(a,u):null);return null===i?null:new t(i)}var o,a,u,s=new Uint8Array(this.data_.buffer,e,n-e);return new t(s,!0)}},{key:"uploadData",value:function(){return this.data_}}],[{key:"getBlob",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(N()){var i=n.map(function(e){return e instanceof t?e.data_:e});return new t(function(){for(var t=B(),e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(void 0!==t){for(var i=new t,o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}if(N())return new Blob(n);throw new b("unsupported-environment","This browser doesn't seem to support creating Blobs")}.apply(null,i))}var o=n.map(function(t){return A(t)?z(V.RAW,t).data:t.data_}),a=0;o.forEach(function(t){a+=t.byteLength});var u=new Uint8Array(a),s=0;return o.forEach(function(t){for(var e=0;e<t.length;e++)u[s++]=t[e]}),new t(u,!0)}}]),t}();function K(t){var e,n;try{e=JSON.parse(t)}catch(r){return null}return"object"!==typeof(n=e)||Array.isArray(n)?null:e}function X(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Y(t,e){return e}var Q=function t(e,n,r,i){Object(o.a)(this,t),this.server=e,this.local=n||e,this.writable=!!r,this.xform=i||Y},$=null;function J(){if($)return $;var t=[];t.push(new Q("bucket")),t.push(new Q("generation")),t.push(new Q("metageneration")),t.push(new Q("name","fullPath",!0));var e=new Q("name");e.xform=function(t,e){return function(t){return!A(t)||t.length<2?t:X(t)}(e)},t.push(e);var n=new Q("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new Q("timeCreated")),t.push(new Q("updated")),t.push(new Q("md5Hash",null,!0)),t.push(new Q("cacheControl",null,!0)),t.push(new Q("contentDisposition",null,!0)),t.push(new Q("contentEncoding",null,!0)),t.push(new Q("contentLanguage",null,!0)),t.push(new Q("contentType",null,!0)),t.push(new Q("metadata","customMetadata",!0)),$=t}function Z(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new I(n,r);return e._makeStorageReference(i)}})}(r,t),r}function tt(t,e,n){var r=K(e);return null===r?null:Z(t,r,n)}function et(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}var nt=function t(e,n,r,i){Object(o.a)(this,t),this.url=e,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function rt(t){if(!t)throw x()}function it(t,e){return function(n,r){var i=tt(t,r,e);return rt(null!==i),i}}function ot(t,e){return function(n,r){var i=tt(t,r,e);return rt(null!==i),function(t,e,n,r){var i=K(e);if(null===i)return null;if(!A(i.downloadTokens))return null;var o=i.downloadTokens;if(0===o.length)return null;var a=encodeURIComponent;return o.split(",").map(function(e){var i=t.bucket,o=t.fullPath;return M("/b/"+a(i)+"/o/"+a(o),n,r)+F({alt:"media",token:e})})[0]}(i,r,t.host,t._protocol)}}function at(t){return function(e,n){var r,i,o;return 401===e.getStatus()?r=e.getErrorText().includes("Firebase App Check token is invalid")?new b("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new b("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,r=new b("quota-exceeded","Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new b("unauthorized","User does not have permission to access '"+i+"'.")):r=n,r.serverResponse=n.serverResponse,r}}function ut(t){var e=at(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new b("object-not-found","Object '"+i+"' does not exist.")),o.serverResponse=r.serverResponse,o}}function st(t,e,n){var r=M(e.fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,o=new nt(r,"GET",it(t,n),i);return o.errorHandler=ut(e),o}function ct(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}function lt(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var u=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+u;var s=ct(e,r,i),c="--"+u+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+et(s,n)+"\r\n--"+u+"\r\nContent-Type: "+s.contentType+"\r\n\r\n",l="\r\n--"+u+"--",f=q.getBlob(c,r,l);if(null===f)throw E();var h={name:s.fullPath},d=M(o,t.host,t._protocol),p=t.maxUploadRetryTime,v=new nt(d,"POST",it(t,n),p);return v.urlParams=h,v.headers=a,v.body=f.uploadData(),v.errorHandler=at(e),v}var ft=function t(e,n,r,i){Object(o.a)(this,t),this.current=e,this.total=n,this.finalized=!!r,this.metadata=i||null};function ht(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(r){rt(!1)}return rt(!!n&&-1!==(e||["active"]).indexOf(n)),n}function dt(t,e,n,r,i,o,a,u){var s=new ft(0,0);if(a?(s.current=a.current,s.total=a.total):(s.current=0,s.total=r.size()),r.size()!==s.total)throw new b("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var c=s.total-s.current,l=c;i>0&&(l=Math.min(l,i));var f=s.current,h=f+l,d={"X-Goog-Upload-Command":l===c?"upload, finalize":"upload","X-Goog-Upload-Offset":"".concat(s.current)},p=r.slice(f,h);if(null===p)throw E();var v=e.maxUploadRetryTime,m=new nt(n,"POST",function(t,n){var i,a=ht(t,["active","final"]),u=s.current+l,c=r.size();return i="final"===a?it(e,o)(t,n):null,new ft(u,c,"final"===a,i)},v);return m.headers=d,m.body=p.uploadData(),m.progressCallback=u||null,m.errorHandler=at(t),m}var pt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function vt(t){switch(t){case"running":case"pausing":case"canceling":return pt.RUNNING;case"paused":return pt.PAUSED;case"success":return pt.SUCCESS;case"canceled":return pt.CANCELED;case"error":default:return pt.ERROR}}var mt=function t(e,n,r){if(Object(o.a)(this,t),"function"===typeof e||null!=n||null!=r)this.next=e,this.error=null!==n&&void 0!==n?n:void 0,this.complete=null!==r&&void 0!==r?r:void 0;else{var i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}};function gt(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];Promise.resolve().then(function(){return t.apply(void 0,n)})}}var yt=null,bt=function(){function t(){var e=this;Object(o.a)(this,t),this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=O.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=O.ABORT,t()}),e.xhr_.addEventListener("error",function(){e.errorCode_=O.NETWORK_ERROR,t()}),e.xhr_.addEventListener("load",function(){t()})})}return Object(a.a)(t,[{key:"send",value:function(t,e,n,r){if(this.sent_)throw T("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==r)for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}},{key:"getErrorCode",value:function(){if(!this.sent_)throw T("cannot .getErrorCode() before sending");return this.errorCode_}},{key:"getStatus",value:function(){if(!this.sent_)throw T("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}},{key:"getResponse",value:function(){if(!this.sent_)throw T("cannot .getResponse() before sending");return this.xhr_.response}},{key:"getErrorText",value:function(){if(!this.sent_)throw T("cannot .getErrorText() before sending");return this.xhr_.statusText}},{key:"abort",value:function(){this.xhr_.abort()}},{key:"getResponseHeader",value:function(t){return this.xhr_.getResponseHeader(t)}},{key:"addUploadProgressListener",value:function(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)}},{key:"removeUploadProgressListener",value:function(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)}}]),t}(),wt=function(t){function e(){return Object(o.a)(this,e),Object(u.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(a.a)(e,[{key:"initXhr",value:function(){this.xhr_.responseType="text"}}]),e}(bt);function xt(){return yt?yt():new wt}var kt=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(o.a)(this,t),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=i,this._mappings=J(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(t){r._request=void 0,r._chunkMultiplier=1,t._codeEquals("canceled")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=t,r._transition("error"))},this._metadataErrorHandler=function(t){r._request=void 0,t._codeEquals("canceled")?r.completeTransitions_():(r._error=t,r._transition("error"))},this._promise=new Promise(function(t,e){r._resolve=t,r._reject=e,r._start()}),this._promise.then(null,function(){})}return Object(a.a)(t,[{key:"_makeProgressCallback",value:function(){var t=this,e=this._transferred;return function(n){return t._updateProgress(e+n)}}},{key:"_shouldDoResumable",value:function(t){return t.size()>262144}},{key:"_start",value:function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}},{key:"_resolveToken",value:function(t){var e=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(n){var r=Object(i.a)(n,2),o=r[0],a=r[1];switch(e._state){case"running":t(o,a);break;case"canceling":e._transition("canceled");break;case"pausing":e._transition("paused")}})}},{key:"_createResumable",value:function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=ct(e,r,i),u={name:a.fullPath},s=M(o,t.host,t._protocol),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":"".concat(r.size()),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},l=et(a,n),f=t.maxUploadRetryTime,h=new nt(s,"POST",function(t){var e;ht(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(n){rt(!1)}return rt(A(e)),e},f);return h.urlParams=u,h.headers=c,h.body=l,h.errorHandler=at(e),h}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,xt,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._uploadUrl=e,t._needToFetchStatus=!1,t.completeTransitions_()},t._errorHandler)})}},{key:"_fetchStatus",value:function(){var t=this,e=this._uploadUrl;this._resolveToken(function(n,r){var i=function(t,e,n,r){var i=t.maxUploadRetryTime,o=new nt(n,"POST",function(t){var e=ht(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(o){rt(!1)}n||rt(!1);var i=Number(n);return rt(!isNaN(i)),new ft(i,r.size(),"final"===e)},i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=at(e),o}(t._ref.storage,t._ref._location,e,t._blob),o=t._ref.storage._makeRequest(i,xt,n,r);t._request=o,o.getPromise().then(function(e){e=e,t._request=void 0,t._updateProgress(e.current),t._needToFetchStatus=!1,e.finalized&&(t._needToFetchMetadata=!0),t.completeTransitions_()},t._errorHandler)})}},{key:"_continueUpload",value:function(){var t=this,e=262144*this._chunkMultiplier,n=new ft(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken(function(i,o){var a;try{a=dt(t._ref._location,t._ref.storage,r,t._blob,e,t._mappings,n,t._makeProgressCallback())}catch(s){return t._error=s,void t._transition("error")}var u=t._ref.storage._makeRequest(a,xt,i,o);t._request=u,u.getPromise().then(function(e){t._increaseMultiplier(),t._request=void 0,t._updateProgress(e.current),e.finalized?(t._metadata=e.metadata,t._transition("success")):t.completeTransitions_()},t._errorHandler)})}},{key:"_increaseMultiplier",value:function(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}},{key:"_fetchMetadata",value:function(){var t=this;this._resolveToken(function(e,n){var r=st(t._ref.storage,t._ref._location,t._mappings),i=t._ref.storage._makeRequest(r,xt,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._transition("success")},t._metadataErrorHandler)})}},{key:"_oneShotUpload",value:function(){var t=this;this._resolveToken(function(e,n){var r=lt(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,xt,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._updateProgress(t._blob.size()),t._transition("success")},t._errorHandler)})}},{key:"_updateProgress",value:function(t){var e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()}},{key:"_transition",value:function(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,void 0!==this._request&&this._request.cancel();break;case"running":var e="paused"===this._state;this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=k(),this._state=t,this._notifyObservers();break;case"error":case"success":this._state=t,this._notifyObservers()}}},{key:"completeTransitions_",value:function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}},{key:"on",value:function(t,e,n,r){var i=this,o=new mt(e||void 0,n||void 0,r||void 0);return this._addObserver(o),function(){i._removeObserver(o)}}},{key:"then",value:function(t,e){return this._promise.then(t,e)}},{key:"catch",value:function(t){return this.then(null,t)}},{key:"_addObserver",value:function(t){this._observers.push(t),this._notifyObserver(t)}},{key:"_removeObserver",value:function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)}},{key:"_notifyObservers",value:function(){var t=this;this._finishPromise(),this._observers.slice().forEach(function(e){t._notifyObserver(e)})}},{key:"_finishPromise",value:function(){if(void 0!==this._resolve){var t=!0;switch(vt(this._state)){case pt.SUCCESS:gt(this._resolve.bind(null,this.snapshot))();break;case pt.CANCELED:case pt.ERROR:gt(this._reject.bind(null,this._error))();break;default:t=!1}t&&(this._resolve=void 0,this._reject=void 0)}}},{key:"_notifyObserver",value:function(t){switch(vt(this._state)){case pt.RUNNING:case pt.PAUSED:t.next&&gt(t.next.bind(t,this.snapshot))();break;case pt.SUCCESS:t.complete&&gt(t.complete.bind(t))();break;case pt.CANCELED:case pt.ERROR:t.error&&gt(t.error.bind(t,this._error))();break;default:t.error&&gt(t.error.bind(t,this._error))()}}},{key:"resume",value:function(){var t="paused"===this._state||"pausing"===this._state;return t&&this._transition("running"),t}},{key:"pause",value:function(){var t="running"===this._state;return t&&this._transition("pausing"),t}},{key:"cancel",value:function(){var t="running"===this._state||"pausing"===this._state;return t&&this._transition("canceling"),t}},{key:"snapshot",get:function(){var t=vt(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}}]),t}(),Et=function(){function t(e,n){Object(o.a)(this,t),this._service=e,this._location=n instanceof I?n:I.makeFromUrl(n,e.host)}return Object(a.a)(t,[{key:"toString",value:function(){return"gs://"+this._location.bucket+"/"+this._location.path}},{key:"_newRef",value:function(e,n){return new t(e,n)}},{key:"_throwIfRoot",value:function(t){if(""===this._location.path)throw function(t){return new b("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}},{key:"root",get:function(){var t=new I(this._location.bucket,"");return this._newRef(this._service,t)}},{key:"bucket",get:function(){return this._location.bucket}},{key:"fullPath",get:function(){return this._location.path}},{key:"name",get:function(){return X(this._location.path)}},{key:"storage",get:function(){return this._service}},{key:"parent",get:function(){var e=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===e)return null;var n=new I(this._location.bucket,e);return new t(this._service,n)}}]),t}();function Ct(t,e,n){t._throwIfRoot("uploadBytes");var r=lt(t.storage,t._location,J(),new q(e,!0),n);return t.storage.makeRequestWithTokens(r,xt).then(function(e){return{metadata:e,ref:t}})}function _t(t){t._throwIfRoot("getDownloadURL");var e=function(t,e,n){var r=M(e.fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,o=new nt(r,"GET",ot(t,n),i);return o.errorHandler=ut(e),o}(t.storage,t._location,J());return t.storage.makeRequestWithTokens(e,xt).then(function(t){if(null===t)throw new b("no-download-url","The given file does not have any download URLs.");return t})}function St(t,e){var n=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),r=new I(t._location.bucket,n);return new Et(t.storage,r)}function Tt(t,e){if(t instanceof Rt){var n=t;if(null==n._bucket)throw new b("no-default-bucket","No default bucket found. Did you set the '"+m+"' property when initializing the app?");var r=new Et(n,n._bucket);return null!=e?Tt(r,e):r}return void 0!==e?St(t,e):t}function Ot(t,e){if(e&&/^[A-Za-z]+:\/\//.test(e)){if(t instanceof Rt)return new Et(t,e);throw C("To use ref(service, url), the first argument must be a Storage instance.")}return Tt(t,e)}function It(t,e){var n=null===e||void 0===e?void 0:e[m];return null==n?null:I.makeFromBucketSpec(n,t)}var Rt=function(){function t(e,n,r,i,a){Object(o.a)(this,t),this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=a,this._bucket=null,this._host=v,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=g,this._maxUploadRetryTime=y,this._requests=new Set,this._bucket=null!=i?I.makeFromBucketSpec(i,this._host):It(this._host,this.app.options)}return Object(a.a)(t,[{key:"_getAuthToken",value:function(){var t=Object(r.a)(p().mark(function t(){var e,n;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._overrideAuthToken){t.next=2;break}return t.abrupt("return",this._overrideAuthToken);case 2:if(!(e=this._authProvider.getImmediate({optional:!0}))){t.next=9;break}return t.next=6,e.getToken();case 6:if(null===(n=t.sent)){t.next=9;break}return t.abrupt("return",n.accessToken);case 9:return t.abrupt("return",null);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_getAppCheckToken",value:function(){var t=Object(r.a)(p().mark(function t(){var e,n;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this._appCheckProvider.getImmediate({optional:!0}))){t.next=6;break}return t.next=4,e.getToken();case 4:return n=t.sent,t.abrupt("return",n.token);case 6:return t.abrupt("return",null);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_delete",value:function(){return this._deleted||(this._deleted=!0,this._requests.forEach(function(t){return t.cancel()}),this._requests.clear()),Promise.resolve()}},{key:"_makeStorageReference",value:function(t){return new Et(this,t)}},{key:"_makeRequest",value:function(t,e,n,r){var i=this;if(this._deleted)return new R(_());var o=function(t,e,n,r,i,o){var a=F(t.urlParams),u=t.url+a,s=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(s,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(s,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!==e&&void 0!==e?e:"AppManager")}(s,o),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(s,r),new L(u,t.method,s,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}(t,this._appId,n,r,e,this._firebaseVersion);return this._requests.add(o),o.getPromise().then(function(){return i._requests.delete(o)},function(){return i._requests.delete(o)}),o}},{key:"makeRequestWithTokens",value:function(){var t=Object(r.a)(p().mark(function t(e,n){var r,o,a,u;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this._getAuthToken(),this._getAppCheckToken()]);case 2:return r=t.sent,o=Object(i.a)(r,2),a=o[0],u=o[1],t.abrupt("return",this._makeRequest(e,n,a,u).getPromise());case 7:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"host",get:function(){return this._host},set:function(t){this._host=t,null!=this._url?this._bucket=I.makeFromBucketSpec(this._url,t):this._bucket=It(t,this.app.options)}},{key:"maxUploadRetryTime",get:function(){return this._maxUploadRetryTime},set:function(t){P("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}},{key:"maxOperationRetryTime",get:function(){return this._maxOperationRetryTime},set:function(t){P("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}}]),t}(),At="@firebase/storage",Dt="0.9.8",Nt="storage";function Pt(t,e,n,r){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.RAW,r=arguments.length>3?arguments[3]:void 0;t._throwIfRoot("uploadString");var i=z(n,e),o=Object.assign({},r);return null==o.contentType&&null!=i.contentType&&(o.contentType=i.contentType),Ct(t,i.data,o)}(t=Object(h.g)(t),e,n,r)}function Mt(t,e,n){return function(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new kt(t,new q(e),n)}(t=Object(h.g)(t),e,n)}function Ft(t){return _t(t=Object(h.g)(t))}function Lt(t,e){return Ot(t=Object(h.g)(t),e)}function jt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(f.e)(),e=arguments.length>1?arguments[1]:void 0;return t=Object(h.g)(t),Object(f.b)(t,Nt).getImmediate({identifier:e})}function Bt(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return new Rt(r,i,o,n,f.a)}Object(f.c)(new d.a(Nt,Bt,"PUBLIC").setMultipleInstances(!0)),Object(f.g)(At,Dt,""),Object(f.g)(At,Dt,"esm2017"),n.d(e,"a",function(){return Ft}),n.d(e,"b",function(){return jt}),n.d(e,"c",function(){return Lt}),n.d(e,"d",function(){return Mt}),n.d(e,"e",function(){return Pt})},function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(10);function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){Object(r.a)(t,e,n[e])})}return t}},function(t,e,n){"use strict";n.d(e,"a",function(){return h}),n.d(e,"b",function(){return v});var r=n(14),i=n(5),o=n(11),a=n(2),u=n(3),s=n(7);function c(){c=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(T){u=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new C(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=x(a,n);if(u){if(u===f)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=l(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,a),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(T){return{type:"throw",arg:T}}}t.wrap=s;var f={};function h(){}function d(){}function p(){}var v={};u(v,i,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(_([])));g&&g!==e&&n.call(g,i)&&(v=g);var y=p.prototype=h.prototype=Object.create(v);function b(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function w(t,e){var r;this._invoke=function(i,o){function a(){return new e(function(r,a){!function r(i,o,a,u){var s=l(t[i],t,o);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then(function(t){r("next",t,a,u)},function(t){r("throw",t,a,u)}):e.resolve(f).then(function(t){c.value=t,a(c)},function(t){return r("throw",t,a,u)})}u(s.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=l(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=p,u(y,"constructor",p),u(p,"constructor",d),d.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,o,function(){return this}),t.AsyncIterator=w,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new w(s(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},b(y),u(y,a,"Generator"),u(y,i,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function l(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var h=function(){function t(e,n,r){Object(a.a)(this,t),this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return Object(u.a)(t,[{key:"setInstantiationMode",value:function(t){return this.instantiationMode=t,this}},{key:"setMultipleInstances",value:function(t){return this.multipleInstances=t,this}},{key:"setServiceProps",value:function(t){return this.serviceProps=t,this}},{key:"setInstanceCreatedCallback",value:function(t){return this.onInstanceCreated=t,this}}]),t}(),d="[DEFAULT]",p=function(){function t(e,n){Object(a.a)(this,t),this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return Object(u.a)(t,[{key:"get",value:function(t){var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new s.a;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(e).promise}},{key:"getImmediate",value:function(t){var e,n=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),r=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(t){if(t.name!==this.name)throw Error("Mismatching Component ".concat(t.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:d})}catch(c){}var e,n=l(this.instancesDeferred.entries());try{for(n.s();!(e=n.n()).done;){var r=Object(o.a)(e.value,2),i=r[0],a=r[1],u=this.normalizeInstanceIdentifier(i);try{var s=this.getOrInitializeService({instanceIdentifier:u});a.resolve(s)}catch(c){}}}catch(f){n.e(f)}finally{n.f()}}}},{key:"clearInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}},{key:"delete",value:function(){var t=Object(i.a)(c().mark(function t(){var e;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=Array.from(this.instances.values()),t.next=3,Promise.all([].concat(Object(r.a)(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()})),Object(r.a)(e.filter(function(t){return"_delete"in t}).map(function(t){return t._delete()}))));case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.instances.has(t)}},{key:"getOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.instancesOptions.get(t)||{}}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.options,n=void 0===e?{}:e,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,a=this.getOrInitializeService({instanceIdentifier:r,options:n}),u=l(this.instancesDeferred.entries());try{for(u.s();!(i=u.n()).done;){var s=Object(o.a)(i.value,2),c=s[0],f=s[1];r===this.normalizeInstanceIdentifier(c)&&f.resolve(a)}}catch(h){u.e(h)}finally{u.f()}return a}},{key:"onInit",value:function(t,e){var n,r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);var o=this.instances.get(r);return o&&t(o,r),function(){i.delete(t)}}},{key:"invokeOnInitCallbacks",value:function(t,e){var n=this.onInitCallbacks.get(e);if(n){var r,i=l(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;try{o(t,e)}catch(a){}}}catch(u){i.e(u)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,e===d?void 0:e),options:i}),this.instances.set(n,o),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(a){}return o||null}},{key:"normalizeInstanceIdentifier",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.component?this.component.multipleInstances?t:d:t}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),t}();var v=function(){function t(e){Object(a.a)(this,t),this.name=e,this.providers=new Map}return Object(u.a)(t,[{key:"addComponent",value:function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component ".concat(t.name," has already been registered with ").concat(this.name));e.setComponent(t)}},{key:"addOrOverwriteComponent",value:function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}},{key:"getProvider",value:function(t){if(this.providers.has(t))return this.providers.get(t);var e=new p(t,this);return this.providers.set(t,e),e}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),t}()},function(t,e,n){"use strict";function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";var r=n(6);function i(t,e,n){return(i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Object(r.a)(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}n.d(e,"a",function(){return i})},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(r){"object"===typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";var r={};n.r(r),n.d(r,"reversed",function(){return tt}),n.d(r,"mirrored",function(){return et}),n.d(r,"createReversedEasing",function(){return nt}),n.d(r,"createMirroredEasing",function(){return rt}),n.d(r,"createExpoIn",function(){return it}),n.d(r,"createBackIn",function(){return ot}),n.d(r,"createAnticipateEasing",function(){return at}),n.d(r,"linear",function(){return ut}),n.d(r,"easeIn",function(){return st}),n.d(r,"easeOut",function(){return ct}),n.d(r,"easeInOut",function(){return lt}),n.d(r,"circIn",function(){return ft}),n.d(r,"circOut",function(){return ht}),n.d(r,"circInOut",function(){return dt}),n.d(r,"backIn",function(){return pt}),n.d(r,"backOut",function(){return vt}),n.d(r,"backInOut",function(){return mt}),n.d(r,"anticipate",function(){return gt}),n.d(r,"bounceOut",function(){return yt}),n.d(r,"bounceIn",function(){return bt}),n.d(r,"bounceInOut",function(){return wt}),n.d(r,"cubicBezier",function(){return Nt});var i=n(0),o=function(){},a=function(){};var u,s=0,c="undefined"!==typeof window&&void 0!==window.requestAnimationFrame?function(t){return window.requestAnimationFrame(t)}:function(t){var e=Date.now(),n=Math.max(0,16.7-(e-s));s=e+n,setTimeout(function(){return t(s)},n)};!function(t){t.Read="read",t.Update="update",t.Render="render",t.PostRender="postRender",t.FixedUpdate="fixedUpdate"}(u||(u={}));var l=1/60*1e3,f=!0,h=!1,d=!1,p={delta:0,timestamp:0},v=[u.Read,u.Update,u.Render,u.PostRender],m=function(t){return h=t},g=v.reduce(function(t,e){var n=function(t){var e=[],n=[],r=0,i=!1,o=0,u=new WeakSet,s=new WeakSet,c={cancel:function(t){var e=n.indexOf(t);u.add(t),-1!==e&&n.splice(e,1)},process:function(a){var l,f;if(i=!0,e=(l=[n,e])[0],(n=l[1]).length=0,r=e.length)for(o=0;o<r;o++)(f=e[o])(a),!0!==s.has(f)||u.has(f)||(c.schedule(f),t(!0));i=!1},schedule:function(t,o,c){void 0===o&&(o=!1),void 0===c&&(c=!1),a("function"===typeof t,"Argument must be a function");var l=c&&i,f=l?e:n;u.delete(t),o&&s.add(t),-1===f.indexOf(t)&&(f.push(t),l&&(r=e.length))}};return c}(m);return t.sync[e]=function(t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),h||E(),n.schedule(t,e,r),t},t.cancelSync[e]=function(t){return n.cancel(t)},t.steps[e]=n,t},{steps:{},sync:{},cancelSync:{}}),y=g.steps,b=g.sync,w=g.cancelSync,x=function(t){return y[t].process(p)},k=function t(e){h=!1,p.delta=f?l:Math.max(Math.min(e-p.timestamp,40),1),f||(l=p.delta),p.timestamp=e,d=!0,v.forEach(x),d=!1,h&&(f=!1,c(t))},E=function(){h=!0,f=!0,d||c(k)},C=function(){return p},_=b,S=function(t,e){return function(n){return Math.max(Math.min(n,e),t)}},T=function(t){return t%1?Number(t.toFixed(5)):t},O=/(-)?(\d[\d\.]*)/g,I=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,R=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,A={test:function(t){return"number"===typeof t},parse:parseFloat,transform:function(t){return t}},D=Object(i.a)(Object(i.a)({},A),{transform:S(0,1)}),N=Object(i.a)(Object(i.a)({},A),{default:1}),P=function(t){return{test:function(e){return"string"===typeof e&&e.endsWith(t)&&1===e.split(" ").length},parse:parseFloat,transform:function(e){return""+e+t}}},M=P("deg"),F=P("%"),L=P("px"),j=P("vh"),B=P("vw"),V=Object(i.a)(Object(i.a)({},F),{parse:function(t){return F.parse(t)/100},transform:function(t){return F.transform(100*t)}}),U=function(t){return t.substring(t.indexOf("(")+1,t.lastIndexOf(")"))},z=S(0,255),W=function(t){return void 0!==t.red},G=function(t){return void 0!==t.hue};var H=function(t){return function(e){if("string"!==typeof e)return e;for(var n={},r=U(e).replace(/(,|\/)/g," ").split(/ \s*/),i=0;i<4;i++)n[t[i]]=void 0!==r[i]?parseFloat(r[i]):1;return n}},q=Object(i.a)(Object(i.a)({},A),{transform:function(t){return Math.round(z(t))}});function K(t,e){return t.startsWith(e)&&R.test(t)}var X={test:function(t){return"string"===typeof t?K(t,"rgb"):W(t)},parse:H(["red","green","blue","alpha"]),transform:function(t){var e=t.red,n=t.green,r=t.blue,i=t.alpha,o=void 0===i?1:i;return function(t){var e=t.red,n=t.green,r=t.blue,i=t.alpha;return"rgba("+e+", "+n+", "+r+", "+(void 0===i?1:i)+")"}({red:q.transform(e),green:q.transform(n),blue:q.transform(r),alpha:T(D.transform(o))})}},Y={test:function(t){return"string"===typeof t?K(t,"hsl"):G(t)},parse:H(["hue","saturation","lightness","alpha"]),transform:function(t){var e=t.hue,n=t.saturation,r=t.lightness,i=t.alpha,o=void 0===i?1:i;return function(t){var e=t.hue,n=t.saturation,r=t.lightness,i=t.alpha;return"hsla("+e+", "+n+", "+r+", "+(void 0===i?1:i)+")"}({hue:Math.round(e),saturation:F.transform(T(n)),lightness:F.transform(T(r)),alpha:T(D.transform(o))})}},Q=Object(i.a)(Object(i.a)({},X),{test:function(t){return"string"===typeof t&&K(t,"#")},parse:function(t){var e="",n="",r="";return t.length>4?(e=t.substr(1,2),n=t.substr(3,2),r=t.substr(5,2)):(e=t.substr(1,1),n=t.substr(2,1),r=t.substr(3,1),e+=e,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:1}}}),$={test:function(t){return"string"===typeof t&&R.test(t)||W(t)||G(t)},parse:function(t){return X.test(t)?X.parse(t):Y.test(t)?Y.parse(t):Q.test(t)?Q.parse(t):t},transform:function(t){return W(t)?X.transform(t):G(t)?Y.transform(t):t}},J=function(t){return"number"===typeof t?0:t},Z={test:function(t){if("string"!==typeof t||!isNaN(t))return!1;var e=0,n=t.match(O),r=t.match(I);return n&&(e+=n.length),r&&(e+=r.length),e>0},parse:function(t){var e=t,n=[],r=e.match(I);r&&(e=e.replace(I,"${c}"),n.push.apply(n,r.map($.parse)));var i=e.match(O);return i&&n.push.apply(n,i.map(A.parse)),n},createTransformer:function(t){var e=t,n=0,r=t.match(I),i=r?r.length:0;if(r)for(var o=0;o<i;o++)e=e.replace(r[o],"${c}"),n++;var a=e.match(O),u=a?a.length:0;if(a)for(o=0;o<u;o++)e=e.replace(a[o],"${n}"),n++;return function(t){for(var r=e,o=0;o<n;o++)r=r.replace(o<i?"${c}":"${n}",o<i?$.transform(t[o]):T(t[o]));return r}},getAnimatableNone:function(t){var e=Z.parse(t);return Z.createTransformer(t)(e.map(J))}},tt=function(t){return function(e){return 1-t(1-e)}},et=function(t){return function(e){return e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2}},nt=tt,rt=et,it=function(t){return function(e){return Math.pow(e,t)}},ot=function(t){return function(e){return e*e*((t+1)*e-t)}},at=function(t){var e=ot(t);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},ut=function(t){return t},st=it(2),ct=tt(st),lt=et(st),ft=function(t){return 1-Math.sin(Math.acos(t))},ht=tt(ft),dt=et(ht),pt=ot(1.525),vt=tt(pt),mt=et(pt),gt=at(1.525),yt=function(t){var e=t*t;return t<4/11?7.5625*e:t<8/11?9.075*e-9.9*t+3.4:t<.9?4356/361*e-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},bt=function(t){return 1-yt(1-t)},wt=function(t){return t<.5?.5*(1-yt(1-2*t)):.5*yt(2*t-1)+.5},xt=8,kt=.001,Et=1e-7,Ct=10,_t=11,St=1/(_t-1),Tt="undefined"!==typeof Float32Array,Ot=function(t,e){return 1-3*e+3*t},It=function(t,e){return 3*e-6*t},Rt=function(t){return 3*t},At=function(t,e,n){return 3*Ot(e,n)*t*t+2*It(e,n)*t+Rt(e)},Dt=function(t,e,n){return((Ot(e,n)*t+It(e,n))*t+Rt(e))*t};function Nt(t,e,n,r){var i=Tt?new Float32Array(_t):new Array(_t),o=function(e){for(var r,o,a,u=0,s=1,c=_t-1;s!==c&&i[s]<=e;++s)u+=St;return r=(e-i[--s])/(i[s+1]-i[s]),(a=At(o=u+r*St,t,n))>=kt?function(e,r){for(var i=0,o=0;i<xt;++i){if(0===(o=At(r,t,n)))return r;r-=(Dt(r,t,n)-e)/o}return r}(e,o):0===a?o:function(e,r,i){var o,a,u=0;do{(o=Dt(a=r+(i-r)/2,t,n)-e)>0?i=a:r=a}while(Math.abs(o)>Et&&++u<Ct);return a}(e,u,u+St)};!function(){for(var e=0;e<_t;++e)i[e]=Dt(e*St,t,n)}();return function(i){return t===e&&n===r?i:0===i?0:1===i?1:Dt(o(i),e,r)}}var Pt={x:0,y:0,z:0},Mt=function(t){return"number"===typeof t},Ft=function(t){return function(e,n,r){return void 0!==r?t(e,n,r):function(r){return t(e,n,r)}}},Lt=Ft(function(t,e,n){return Math.min(Math.max(n,t),e)}),jt=function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")},Bt=function(t){return jt(t)&&t.hasOwnProperty("z")},Vt=function(t,e){return Math.abs(t-e)},Ut=function(t,e){if(void 0===e&&(e=Pt),Mt(t)&&Mt(e))return Vt(t,e);if(jt(t)&&jt(e)){var n=Vt(t.x,e.x),r=Vt(t.y,e.y),i=Bt(t)&&Bt(e)?Vt(t.z,e.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(r,2)+Math.pow(i,2))}return 0},zt=function(t,e,n){var r=e-t;return 0===r?1:(n-t)/r},Wt=function(t,e,n){return-n*t+n*e+t},Gt=function(){return(Gt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Ht=function(t,e,n){var r=t*t,i=e*e;return Math.sqrt(Math.max(0,n*(i-r)+r))},qt=[Q,X,Y],Kt=function(t){return qt.find(function(e){return e.test(t)})},Xt=function(t){return"'"+t+"' is not an animatable color. Use the equivalent color code instead."},Yt=function(t,e){var n=Kt(t),r=Kt(e);a(!!n,Xt(t)),a(!!r,Xt(e)),a(n.transform===r.transform,"Both colors must be hex/RGBA, OR both must be HSLA.");var i=n.parse(t),o=r.parse(e),u=Gt({},i),s=n===Y?Wt:Ht;return function(t){for(var e in u)"alpha"!==e&&(u[e]=s(i[e],o[e],t));return u.alpha=Wt(i.alpha,o.alpha,t),n.transform(u)}},Qt=function(t,e){return function(n){return e(t(n))}},$t=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce(Qt)};function Jt(t,e){return Mt(t)?function(n){return Wt(t,e,n)}:$.test(t)?Yt(t,e):ee(t,e)}var Zt=function(t,e){var n=t.slice(),r=n.length,i=t.map(function(t,n){return Jt(t,e[n])});return function(t){for(var e=0;e<r;e++)n[e]=i[e](t);return n}};function te(t){for(var e=Z.parse(t),n=e.length,r=0,i=0,o=0,a=0;a<n;a++)r||"number"===typeof e[a]?r++:void 0!==e[a].hue?o++:i++;return{parsed:e,numNumbers:r,numRGB:i,numHSL:o}}var ee=function(t,e){var n=Z.createTransformer(e),r=te(t),i=te(e);return a(r.numHSL===i.numHSL&&r.numRGB===i.numRGB&&r.numNumbers>=i.numNumbers,"Complex values '"+t+"' and '"+e+"' too different to mix. Ensure all colors are of the same type."),$t(Zt(r.parsed,i.parsed),n)};var ne=function(t){return t},re=function(t){return void 0===t&&(t=ne),Ft(function(e,n,r){var i=n-r,o=-(0-e+1)*(0-t(Math.abs(i)));return i<=0?n+o:n-o})},ie=(re(),re(Math.sqrt),function(t,e){return e?t*(1e3/e):0}),oe=(Ft(function(t,e,n){var r=e-t;return((n-t)%r+r)%r+t}),Lt(0,1),function(){return function(t,e){var n=this,r=t.middleware,i=t.onComplete;this.isActive=!0,this.update=function(t){n.observer.update&&n.updateObserver(t)},this.complete=function(){n.observer.complete&&n.isActive&&n.observer.complete(),n.onComplete&&n.onComplete(),n.isActive=!1},this.error=function(t){n.observer.error&&n.isActive&&n.observer.error(t),n.isActive=!1},this.observer=e,this.updateObserver=function(t){return e.update(t)},this.onComplete=i,e.update&&r&&r.length&&r.forEach(function(t){return n.updateObserver=t(n.updateObserver,n.complete)})}}()),ae=function(t,e,n){var r=e.middleware;return new oe({middleware:r,onComplete:n},"function"===typeof t?{update:t}:t)},ue=function(){function t(t){void 0===t&&(t={}),this.props=t}return t.prototype.create=function(e){return new t(e)},t.prototype.start=function(t){void 0===t&&(t={});var e=!1,n={stop:function(){}},r=this.props,o=r.init,a=Object(i.e)(r,["init"]),u=o(ae(t,a,function(){e=!0,n.stop()}));return n=u?Object(i.a)({},n,u):n,e&&n.stop(),n},t.prototype.applyMiddleware=function(t){return this.create(Object(i.a)({},this.props,{middleware:this.props.middleware?[t].concat(this.props.middleware):[t]}))},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=1===t.length?t[0]:$t.apply(void 0,t);return this.applyMiddleware(function(t){return function(e){return t(n(e))}})},t}(),se=function(t){return new ue({init:t})},ce=[L,F,M,j,B],le=function(t){return ce.find(function(e){return e.test(t)})},fe=function(t,e){return t(e)},he=function(t,e){var n=e.from,r=e.to,o=Object(i.e)(e,["from","to"]),a=le(n)||le(r),u=a.transform,s=a.parse;return t(Object(i.a)({},o,{from:"string"===typeof n?s(n):n,to:"string"===typeof r?s(r):r})).pipe(u)},de=function(t){return function(e,n){var r=n.from,o=n.to,a=Object(i.e)(n,["from","to"]);return e(Object(i.a)({},a,{from:0,to:1})).pipe(t(r,o))}},pe=de(Yt),ve=de(ee),me=function(t,e){var n=function(t){var e=Object.keys(t),n=function(e,n){return void 0!==e&&!t[n](e)};return{getVectorKeys:function(t){return e.reduce(function(e,r){return n(t[r],r)&&e.push(r),e},[])},testVectorProps:function(t){return t&&e.some(function(e){return n(t[e],e)})}}}(e),r=n.testVectorProps,i=n.getVectorKeys;return function(e){if(!r(e))return t(e);var n=i(e),o=e[n[0]];return ge(o)(t,e,n)}},ge=function(t){return"number"===typeof t?fe:function(t){return Boolean(le(t))}(t)?he:$.test(t)?pe:Z.test(t)?ve:fe},ye=me(function(t){return void 0===t&&(t={}),se(function(e){var n=e.complete,r=e.update,i=t.velocity,o=void 0===i?0:i,a=t.from,u=void 0===a?0:a,s=t.power,c=void 0===s?.8:s,l=t.timeConstant,f=void 0===l?350:l,h=t.restDelta,d=void 0===h?.5:h,p=t.modifyTarget,v=0,m=c*o,g=Math.round(u+m),y="undefined"===typeof p?g:p(g),b=_.update(function(t){var e=t.delta;v+=e;var i=-m*Math.exp(-v/f),o=i>d||i<-d;r(o?y+i:y),o||(w.update(b),n())},!0);return{stop:function(){return w.update(b)}}})},{from:A.test,modifyTarget:function(t){return"function"===typeof t},velocity:A.test}),be=me(function(t){return void 0===t&&(t={}),se(function(e){var n=e.update,r=e.complete,i=t.velocity,o=void 0===i?0:i,a=t.from,u=void 0===a?0:a,s=t.to,c=void 0===s?0:s,l=t.stiffness,f=void 0===l?100:l,h=t.damping,d=void 0===h?10:h,p=t.mass,v=void 0===p?1:p,m=t.restSpeed,g=void 0===m?.01:m,y=t.restDelta,b=void 0===y?.01:y,x=o?-o/1e3:0,k=0,E=c-u,C=u,S=C,T=_.update(function(t){var e=t.delta;k+=e;var i=d/(2*Math.sqrt(f*v)),a=Math.sqrt(f/v)/1e3;if(S=C,i<1){var u=Math.exp(-i*a*k),s=a*Math.sqrt(1-i*i);C=c-u*((x+i*a*E)/s*Math.sin(s*k)+E*Math.cos(s*k))}else{u=Math.exp(-a*k);C=c-u*(E+(x+a*E)*k)}o=ie(C-S,e);var l=Math.abs(o)<=g,h=Math.abs(c-C)<=b;l&&h?(n(C=c),w.update(T),r()):n(C)},!0);return{stop:function(){return w.update(T)}}})},{from:A.test,to:A.test,stiffness:A.test,damping:A.test,mass:A.test,velocity:A.test}),we=me(function(t){var e=t.from,n=void 0===e?0:e,r=t.velocity,o=void 0===r?0:r,a=t.min,u=t.max,s=t.power,c=void 0===s?.8:s,l=t.timeConstant,f=void 0===l?700:l,h=t.bounceStiffness,d=void 0===h?500:h,p=t.bounceDamping,v=void 0===p?10:p,m=t.restDelta,g=void 0===m?1:m,y=t.modifyTarget;return se(function(t){var e,r=t.update,s=t.complete,l=n,h=n,p=!1,m=function(t){return void 0!==a&&t<=a},b=function(t){return void 0!==u&&t>=u},w=function(t){return m(t)||b(t)},x=function(t){r(t),l=h,o=ie((h=t)-l,C().delta),e&&!p&&function(t,e){return m(t)&&e<0||b(t)&&e>0}(t,o)&&E({from:t,velocity:o})},k=function(t,n){e&&e.stop(),e=t.start({update:x,complete:function(){n?n():s()}})},E=function(t){p=!0,k(be(Object(i.a)({},t,{to:m(t.from)?a:u,stiffness:d,damping:v,restDelta:g})))};if(w(n))E({from:n,velocity:o});else if(0!==o){var _=ye({from:n,velocity:o,timeConstant:f,power:c,restDelta:w(n)?20:g,modifyTarget:y});k(_,function(){w(h)?E({from:h,velocity:o}):s()})}else s();return{stop:function(){return e&&e.stop()}}})},{from:A.test,velocity:A.test,min:A.test,max:A.test,damping:A.test,stiffness:A.test,modifyTarget:function(t){return"function"===typeof t}}),xe=me(function(t){var e=t.from,n=void 0===e?0:e,r=t.to,i=void 0===r?1:r,o=t.ease,a=void 0===o?ut:o,u=t.reverseEase;return void 0!==u&&u&&(a=nt(a)),se(function(t){var e=t.update;return{seek:function(t){return e(t)}}}).pipe(a,function(t){return Wt(n,i,t)})},{ease:function(t){return"function"===typeof t},from:A.test,to:A.test}),ke=Lt(0,1),Ee=function(t){return void 0===t&&(t={}),se(function(e){var n,r=e.update,i=e.complete,o=t.duration,a=void 0===o?300:o,u=t.ease,s=void 0===u?ct:u,c=t.flip,l=void 0===c?0:c,f=t.loop,h=void 0===f?0:f,d=t.yoyo,p=void 0===d?0:d,v=t.repeatDelay,m=void 0===v?0:v,g=t.from,y=void 0===g?0:g,b=t.to,x=void 0===b?1:b,k=t.elapsed,E=void 0===k?0:k,C=t.flipCount,S=void 0===C?0:C,T=t.yoyoCount,O=void 0===T?0:T,I=t.loopCount,R=void 0===I?0:I,A=xe({from:y,to:x,ease:s}).start(r),D=0,N=!1,P=function(t){var e;void 0===t&&(t=!1),A=xe({from:y=(e=[x,y])[0],to:x=e[1],ease:s,reverseEase:t}).start(r)},M=function(){D=ke(zt(0,a,E)),A.seek(D)},F=function(){N=!0,n=_.update(function(t){var e=t.delta;E+=e,M(),function(){var t=N&&E>a+m;return!!t&&(!(!t||h||l||p)||(E=E-a-m,h&&R<h?(R++,!1):l&&S<l?(S++,P(),!1):!(p&&O<p)||(P(++O%2!==0),!1)))}()&&(w.update(n),i&&_.update(i,!1,!0))},!0)},L=function(){N=!1,n&&w.update(n)};return F(),{isActive:function(){return N},getElapsed:function(){return Lt(0,a,E)},getProgress:function(){return D},stop:function(){L()},pause:function(){return L(),this},resume:function(){return N||F(),this},seek:function(t){return E=Wt(0,a,t),_.update(M,!1,!0),this},reverse:function(){return P(),this}}})},Ce=Lt(0,1),_e=function(t){var e=t.easings,n=t.ease,r=void 0===n?ut:n,o=t.times,a=t.values,u=Object(i.e)(t,["easings","ease","times","values"]);e=Array.isArray(e)?e:function(t,e){return t.map(function(){return e||ct}).splice(0,t.length-1)}(a,e),o=o||function(t){var e=t.length;return t.map(function(t,n){return 0!==n?n/(e-1):0})}(a);var s=e.map(function(t,e){return xe({from:a[e],to:a[e+1],ease:t})});return Ee(Object(i.a)({},u,{ease:r})).applyMiddleware(function(t){return function(t,e,n){var r=t.length,i=r-1,o=i-1,a=e.map(function(t){return t.start(n)});return function(e){e<=t[0]&&a[0].seek(0),e>=t[i]&&a[o].seek(1);for(var n=1;n<r&&!(t[n]>e||n===i);n++);var u=zt(t[n-1],t[n],e);a[n-1].seek(Ce(u))}}(o,s,t)})},Se=function(t,e,n){return se(function(r){var i=r.update,o=e.split(" ").map(function(e){return t.addEventListener(e,i,n),e});return{stop:function(){return o.forEach(function(e){return t.removeEventListener(e,i,n)})}}})},Te=function(){return{clientX:0,clientY:0,pageX:0,pageY:0,x:0,y:0}},Oe=function(t,e){return void 0===e&&(e={clientX:0,clientY:0,pageX:0,pageY:0,x:0,y:0}),e.clientX=e.x=t.clientX,e.clientY=e.y=t.clientY,e.pageX=t.pageX,e.pageY=t.pageY,e},Ie=[Te()];if("undefined"!==typeof document){Se(document,"touchstart touchmove",{passive:!0,capture:!0}).start(function(t){var e=t.touches;!0;var n=e.length;Ie.length=0;for(var r=0;r<n;r++){var i=e[r];Ie.push(Oe(i))}})}var Re=Te();if("undefined"!==typeof document){Se(document,"mousedown mousemove",!0).start(function(t){!0,Oe(t,Re)})}var Ae=function(t){return se(function(e){var n=e.complete,r=setTimeout(n,t);return{stop:function(){return clearTimeout(r)}}})},De=n(4),Ne=n.n(De);n.d(e,"a",function(){return _o});var Pe=function(t){return"object"===typeof t&&t.hasOwnProperty("current")},Me=function(t){return!isNaN(parseFloat(t))},Fe=function(){function t(t){var e=this;this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.updateAndNotify=function(t,n){void 0===n&&(n=!0),e.prev=e.current,e.current=t,e.updateSubscribers&&e.prev!==e.current&&e.updateSubscribers.forEach(e.notifySubscriber),n&&e.renderSubscribers&&e.renderSubscribers.forEach(e.notifySubscriber);var r=C(),i=r.delta,o=r.timestamp;e.lastUpdated!==o&&(e.timeDelta=i,e.lastUpdated=o,_.postRender(e.scheduleVelocityCheck))},this.notifySubscriber=function(t){t(e.current)},this.scheduleVelocityCheck=function(){return _.postRender(e.velocityCheck)},this.velocityCheck=function(t){t.timestamp!==e.lastUpdated&&(e.prev=e.current)},this.set(t,!1),this.canTrackVelocity=Me(this.current)}return t.prototype.subscribeTo=function(t,e){var n=this,r=function(){return e(n.current)};return t.add(r),function(){return t.delete(r)}},t.prototype.onChange=function(t){return this.updateSubscribers||(this.updateSubscribers=new Set),this.subscribeTo(this.updateSubscribers,t)},t.prototype.clearListeners=function(){var t;null===(t=this.updateSubscribers)||void 0===t||t.clear()},t.prototype.onRenderRequest=function(t){return this.renderSubscribers||(this.renderSubscribers=new Set),this.notifySubscriber(t),this.subscribeTo(this.renderSubscribers,t)},t.prototype.attach=function(t){this.passiveEffect=t},t.prototype.set=function(t,e){void 0===e&&(e=!0),e&&this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t,e)},t.prototype.get=function(){return this.current},t.prototype.getPrevious=function(){return this.prev},t.prototype.getVelocity=function(){return this.canTrackVelocity?ie(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0},t.prototype.start=function(t){var e=this;return this.stop(),new Promise(function(n){e.stopAnimation=t(n)}).then(function(){return e.clearAnimation()})},t.prototype.stop=function(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()},t.prototype.isAnimating=function(){return!!this.stopAnimation},t.prototype.clearAnimation=function(){this.stopAnimation=null},t.prototype.destroy=function(){this.updateSubscribers&&this.updateSubscribers.clear(),this.renderSubscribers&&this.renderSubscribers.clear(),this.stop()},t}();function Le(t){return new Fe(t)}var je=function(){function t(t,e){var n=this;this.children=new Set,this.latest={},this.values=new Map,this.valueSubscriptions=new Map,this.config={},this.update=function(){return n.config.onUpdate(n.latest)},this.triggerRender=function(){return n.render()},this.scheduleRender=function(){return _.render(n.triggerRender,!1,!0)},this.ref=function(t){t?n.mount(t):n.unmount(),n.externalRef&&("function"===typeof n.externalRef?n.externalRef(t):Pe(n.externalRef)&&(n.externalRef.current=t))},this.parent=t,this.rootParent=t?t.rootParent:this,this.treePath=t?Object(i.f)(t.treePath,[t]):[],this.depth=t?t.depth+1:0,this.externalRef=e}return t.prototype.subscribe=function(t){var e=this;return this.children.add(t),function(){return e.children.delete(t)}},t.prototype.hasValue=function(t){return this.values.has(t)},t.prototype.addValue=function(t,e){this.hasValue(t)&&this.removeValue(t),this.values.set(t,e),this.latest[t]=e.get(),this.element&&this.subscribeToValue(t,e)},t.prototype.removeValue=function(t){var e=this.valueSubscriptions.get(t);e&&e(),this.values.delete(t),delete this.latest[t],this.valueSubscriptions.delete(t)},t.prototype.getValue=function(t,e){var n=this.values.get(t);return void 0===n&&void 0!==e&&(n=new Fe(e),this.addValue(t,n)),n},t.prototype.forEachValue=function(t){this.values.forEach(t)},t.prototype.getInstance=function(){return this.element},t.prototype.updateConfig=function(t){void 0===t&&(t={}),this.config=Object(i.a)({},t)},t.prototype.setSingleStaticValue=function(t,e){this.latest[t]=e},t.prototype.setStaticValues=function(t,e){if("string"===typeof t)this.setSingleStaticValue(t,e);else for(var n in t)this.setSingleStaticValue(n,t[n])},t.prototype.scheduleUpdateLayoutDelta=function(){_.update(this.rootParent.updateLayoutDelta,!1,!0)},t.prototype.subscribeToValue=function(t,e){var n=this,r=e.onChange(function(e){n.setSingleStaticValue(t,e),n.latest[t]=e,n.config.onUpdate&&_.update(n.update,!1,!0)}),i=e.onRenderRequest(this.scheduleRender);this.valueSubscriptions.set(t,function(){r(),i()})},t.prototype.mount=function(t){var e=this;a(!!t,"No ref found. Ensure components created with motion.custom forward refs using React.forwardRef"),this.parent&&(this.removeFromParent=this.parent.subscribe(this)),this.element=this.current=t,this.forEachValue(function(t,n){return e.subscribeToValue(n,t)})},t.prototype.unmount=function(){var t=this;this.forEachValue(function(e,n){return t.removeValue(n)}),w.update(this.update),w.render(this.render),this.removeFromParent&&this.removeFromParent()},t}();function Be(t){return t}function Ve(t){var e=t.top;return{x:{min:t.left,max:t.right},y:{min:e,max:t.bottom}}}function Ue(t){return{x:Object(i.a)({},t.x),y:Object(i.a)({},t.y)}}var ze={translate:0,scale:1,origin:0,originPoint:0};function We(){return{x:Object(i.a)({},ze),y:Object(i.a)({},ze)}}var Ge=Object(i.a)(Object(i.a)({},A),{transform:Math.round}),He={color:$,backgroundColor:$,outlineColor:$,fill:$,stroke:$,borderColor:$,borderTopColor:$,borderRightColor:$,borderBottomColor:$,borderLeftColor:$,borderWidth:L,borderTopWidth:L,borderRightWidth:L,borderBottomWidth:L,borderLeftWidth:L,borderRadius:L,radius:L,borderTopLeftRadius:L,borderTopRightRadius:L,borderBottomRightRadius:L,borderBottomLeftRadius:L,width:L,maxWidth:L,height:L,maxHeight:L,size:L,top:L,right:L,bottom:L,left:L,padding:L,paddingTop:L,paddingRight:L,paddingBottom:L,paddingLeft:L,margin:L,marginTop:L,marginRight:L,marginBottom:L,marginLeft:L,rotate:M,rotateX:M,rotateY:M,rotateZ:M,scale:N,scaleX:N,scaleY:N,scaleZ:N,skew:M,skewX:M,skewY:M,distance:L,translateX:L,translateY:L,translateZ:L,x:L,y:L,z:L,perspective:L,opacity:D,originX:V,originY:V,originZ:L,zIndex:Ge,fillOpacity:D,strokeOpacity:D,numOctaves:Ge},qe=[A,L,F,M,B,j,{test:function(t){return"auto"===t},parse:function(t){return t}}],Ke=function(t){return function(e){return e.test(t)}},Xe=function(t){return qe.find(Ke(t))},Ye=Object(i.f)(qe,[$,Z]),Qe=function(t){return Ye.find(Ke(t))},$e=function(t){return He[t]},Je=function(t,e){return e&&"number"===typeof t?e.transform(t):t},Ze=["","X","Y","Z"],tn=["x","y","z"];function en(t,e){return tn.indexOf(t)-tn.indexOf(e)}["translate","scale","rotate","skew","transformPerspective"].forEach(function(t){Ze.forEach(function(e){return tn.push(t+e)})});var nn=new Set(tn);function rn(t){return nn.has(t)}var on=new Set(["originX","originY","originZ"]);function an(t){return on.has(t)}var un={x:"translateX",y:"translateY",z:"translateZ"};function sn(t){return t.startsWith("--")}function cn(t,e){return t/(e.max-e.min)*100}var ln={process:function(t,e){return"number"!==typeof t?t:cn(t,e.x)+"% "+cn(t,e.y)+"%"}},fn={borderRadius:Object(i.a)(Object(i.a)({},ln),{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:ln,borderTopRightRadius:ln,borderBottomLeftRadius:ln,borderBottomRightRadius:ln,boxShadow:{process:function(t,e,n,r){var i=Z.parse(t),o=Z.createTransformer(t),a=n.x.scale*r.x,u=n.y.scale*r.y;i[1]/=a,i[2]/=u;var s=Wt(a,u,.5);return"number"===typeof i[3]&&(i[3]/=s),"number"===typeof i[4]&&(i[4]/=s),o(i)}}};function hn(t,e){return"translate3d("+t.x.translate/e.x+"px, "+t.y.translate/e.y+"px, 0) scale("+t.x.scale+", "+t.y.scale+")"}function dn(t,e,n,r,i,o,a,u,s,c,l,f){var h=a.enableHardwareAcceleration,d=a.transformTemplate,p=a.allowTransformNone;o.length=0;var v=!!u,m=!!u,g=!0;for(var y in t){var b=t[y],w=$e(y),x=Je(b,w);if(rn(y)){if(v=!0,r[y]=x,o.push(y),!g)continue;b!==(void 0!==w.default?w.default:0)&&(g=!1)}else if(an(y))i[y]=x,m=!0;else if("transform"!==y||"function"!==typeof b){var k=sn(y)?n:e;if(u&&fn[y]){var E=fn[y].process(b,f,s,l),C=fn[y].applyTo;if(C)for(var _=C.length,S=0;S<_;S++)k[C[S]]=E;else k[y]=E}else k[y]=x}}if((v||d)&&(u?(e.transform=hn(c,l),d&&(e.transform=d(r,e.transform))):e.transform=function(t,e,n,r,i,o){void 0===i&&(i=!0),void 0===o&&(o=!0);var a="",u=!1;e.sort(en);for(var s=e.length,c=0;c<s;c++){var l=e[c];a+=(un[l]||l)+"("+t[l]+") ","z"===l&&(u=!0)}return!u&&i?a+="translateZ(0)":a=a.trim(),n?a=n(t,r?"":a):o&&r&&(a="none"),a}(r,o,d,g,h,p)),m){var T=u?100*c.x.origin+"%":i.originX||"50%",O=u?100*c.y.origin+"%":i.originY||"50%",I=i.originZ||"0";e.transformOrigin=T+" "+O+" "+I}}function pn(t,e){t.min=e.min,t.max=e.max}function vn(t,e,n){return n+e*(t-n)}function mn(t,e,n,r,i){return void 0!==i&&(t=vn(t,i,r)),vn(t,n,r)+e}function gn(t,e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=1),t.min=mn(t.min,e,n,r,i),t.max=mn(t.max,e,n,r,i)}function yn(t,e){var n=e.x,r=e.y;gn(t.x,n.translate,n.scale,n.originPoint),gn(t.y,r.translate,r.scale,r.originPoint)}function bn(t,e,n,r){var i=r[0],o=r[1],a=r[2];t.min=e.min,t.max=e.max;var u=Wt(e.min,e.max,n[a]||.5);gn(t,n[i],n[o],u,n.scale)}var wn=["x","scaleX","originX"],xn=["y","scaleY","originY"];function kn(t,e,n,r,i){return t=vn(t-=e,1/n,r),void 0!==i&&(t=vn(t,1/i,r)),t}function En(t,e,n){var r=n[0],i=n[1],o=n[2];!function(t,e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=.5);var o=Wt(t.min,t.max,r)-e;t.min=kn(t.min,e,n,o,i),t.max=kn(t.max,e,n,o,i)}(t,e[r],e[i],e[o],e.scale)}var Cn=Lt(0,1);function _n(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=.01),Ut(t,e)<n}function Sn(t,e){var n=.5,r=t.max-t.min,i=e.max-e.min;return i>r?n=zt(e.min,e.max-r,t.min):r>i&&(n=zt(t.min,t.max-i,e.min)),Cn(n)}function Tn(t,e,n,r){var i=e.max-e.min,o=n.max-n.min;t.origin=void 0===r?Sn(e,n):r,t.originPoint=Wt(e.min,e.max,t.origin),t.scale=o/i,_n(t.scale,1,1e-4)&&(t.scale=1),t.translate=function(t,e,n){var r=Wt(t.min,t.max,n);return Wt(e.min,e.max,n)-r}(e,n,t.origin),_n(t.translate)&&(t.translate=0)}function On(t,e,n,r){Tn(t.x,e.x,n.x,r),Tn(t.y,e.y,n.y,r)}function In(t){return[t("x"),t("y")]}var Rn=function(t){return Array.isArray(t)},An=function(){return{type:"spring",stiffness:500,damping:25,restDelta:.5,restSpeed:10}},Dn=function(t){return{type:"spring",stiffness:700,damping:0===t?100:35}},Nn=function(){return{ease:"linear",duration:.3}},Pn=function(t){return{type:"keyframes",duration:.8,values:t}},Mn={x:An,y:An,z:An,rotate:An,rotateX:An,rotateY:An,rotateZ:An,scaleX:Dn,scaleY:Dn,scale:Dn,opacity:Nn,backgroundColor:Nn,color:Nn,default:Dn},Fn=function(t){var e=t.to,n=t.duration;return se(function(t){var r=t.update,i=t.complete;r(e),n?Ae(n).start({complete:i}):i()})},Ln=function(t){return Array.isArray(t)?(a(4===t.length,"Cubic bezier arrays must contain four numerical values."),Nt(t[0],t[1],t[2],t[3])):"string"===typeof t?(a(void 0!==r[t],"Invalid easing type '"+t+"'"),r[t]):t},jn=function(t){return Array.isArray(t)&&"number"!==typeof t[0]},Bn=function(t,e){return"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!Z.test(e)||e.startsWith("url(")))},Vn=function(t){return 1e3*t},Un={tween:Ee,spring:be,keyframes:_e,inertia:we,just:Fn},zn={tween:function(t){if(t.ease){var e=jn(t.ease)?t.ease[0]:t.ease;t.ease=Ln(e)}return t},keyframes:function(t){var e=t.from,n=(t.to,t.velocity,Object(i.e)(t,["from","to","velocity"]));if(n.values&&null===n.values[0]){var r=Object(i.f)(n.values);r[0]=e,n.values=r}return n.ease&&(n.easings=jn(n.ease)?n.ease.map(Ln):Ln(n.ease)),n.ease=ut,n}},Wn=function(t,e,n){var r=n?n.delay:0;if(void 0===n||!function(t){t.when,t.delay,t.delayChildren,t.staggerChildren,t.staggerDirection;var e=Object(i.e)(t,["when","delay","delayChildren","staggerChildren","staggerDirection"]);return Object.keys(e).length}(n))return Object(i.a)({delay:r},function(t,e){var n;return n=Rn(e)?Pn:Mn[t]||Mn.default,Object(i.a)({to:e},n(e))}(t,e));var o=n[t]||n.default||n;return!1===o.type?{delay:o.hasOwnProperty("delay")?o.delay:r,to:Rn(e)?e[e.length-1]:e,type:"just"}:Rn(e)?Object(i.a)(Object(i.a)({values:e,duration:.8,delay:r,ease:"linear"},o),{type:"keyframes"}):Object(i.a)({type:"tween",to:e,delay:r},o)},Gn=function(t,e,n,r){var a=e.get(),u=Bn(t,a),s=Bn(t,n);o(u===s,"You are trying to animate "+t+' from "'+a+'" to "'+n+'". '+a+" is not an animatable value - to enable this animation set "+a+" to a value animatable to "+n+" via the `style` property.");var c,l=Wn(t,n,r),f=l.type,h=void 0===f?"tween":f,d=Object(i.e)(l,["type"]),p=u&&s?Un[h]:Fn,v=function(t,e){return zn[t]?zn[t](e):e}(h,Object(i.a)({from:a,velocity:e.getVelocity()},d));return((c=v).hasOwnProperty("duration")||c.hasOwnProperty("repeatDelay"))&&(v.duration&&(v.duration=Vn(v.duration)),v.repeatDelay&&(v.repeatDelay=Vn(v.repeatDelay))),[p,v]};function Hn(t,e,n,r){void 0===r&&(r={});var o=r.delay,a=void 0===o?0:o,u=Object(i.e)(r,["delay"]);return e.start(function(r){var o,s=Gn(t,e,n,u),c=s[0],l=s[1],f=l.delay,h=Object(i.e)(l,["delay"]);void 0!==f&&(a=f);var d=function(){var t=c(h);o=t.start({update:function(t){return e.set(t)},complete:r})};return a?o=Ae(Vn(a)).start({complete:d}):d(),function(){o&&o.stop()}})}function qn(t,e){return Ve(function(t,e){var n=t.top,r=t.left,i=t.bottom,o=t.right;void 0===e&&(e=Be);var a=e({x:r,y:n}),u=e({x:o,y:i});return{top:a.y,left:a.x,bottom:u.y,right:u.x}}(t.getBoundingClientRect(),e))}var Kn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultConfig={enableHardwareAcceleration:!0,allowTransformNone:!0},e.style={},e.reactStyle={},e.vars={},e.transform={},e.transformOrigin={},e.transformKeys=[],e.config=e.defaultConfig,e.isLayoutProjectionEnabled=!1,e.layoutUpdateListeners=new Set,e.hasViewportBoxUpdated=!1,e.targetBoxFinal={x:{min:0,max:1},y:{min:0,max:1}},e.treeScale={x:1,y:1},e.delta=We(),e.deltaFinal=We(),e.stopLayoutAxisAnimation={x:function(){},y:function(){}},e.isTargetBoxLocked=!1,e.axisProgress={x:Le(0),y:Le(0)},e.updateLayoutDelta=function(){e.isLayoutProjectionEnabled&&e.box&&e.updateDeltas(),e.children.forEach(Xn)},e}return Object(i.c)(e,t),e.prototype.removeValue=function(e){t.prototype.removeValue.call(this,e),delete this.vars[e],delete this.style[e]},e.prototype.clean=function(){this.style={},this.vars={},this.transform={}},e.prototype.updateConfig=function(t){void 0===t&&(t={}),this.config=Object(i.a)(Object(i.a)({},this.defaultConfig),t)},e.prototype.read=function(t){return this.getComputedStyle()[t]||0},e.prototype.readNativeValue=function(t){if(rn(t)){var e=$e(t);return e&&e.default||0}return this.read(t)},e.prototype.enableLayoutProjection=function(){this.isLayoutProjectionEnabled=!0},e.prototype.hide=function(){!1!==this.isVisible&&(this.isVisible=!1,this.scheduleRender())},e.prototype.show=function(){!0!==this.isVisible&&(this.isVisible=!0,this.scheduleRender())},e.prototype.onLayoutUpdate=function(t){var e=this;return this.layoutUpdateListeners.add(t),function(){return e.layoutUpdateListeners.delete(t)}},e.prototype.layoutReady=function(t){var e=this;this.layoutUpdateListeners.forEach(function(n){n(e.box,e.prevViewportBox||e.box,t)})},e.prototype.getBoundingBox=function(){var t=this.config.transformPagePoint;return qn(this.element,t)},e.prototype.getBoundingBoxWithoutTransforms=function(){var t,e,n=this.getBoundingBox();return t=n,e=this.latest,En(t.x,e,wn),En(t.y,e,xn),n},e.prototype.getComputedStyle=function(){return window.getComputedStyle(this.element)},e.prototype.snapshotBoundingBox=function(){this.prevViewportBox=this.getBoundingBoxWithoutTransforms();var t=this.axisProgress,e=t.x,n=t.y;this.isTargetBoxLocked||e.isAnimating()||n.isAnimating()||(this.targetBox=Ue(this.prevViewportBox))},e.prototype.measureLayout=function(){this.box=this.getBoundingBox(),this.boxCorrected=Ue(this.box),this.targetBox||(this.targetBox=Ue(this.box))},e.prototype.refreshTargetBox=function(){this.targetBox=this.getBoundingBoxWithoutTransforms()},e.prototype.lockTargetBox=function(){this.isTargetBoxLocked=!0},e.prototype.unlockTargetBox=function(){this.stopLayoutAnimation(),this.isTargetBoxLocked=!1},e.prototype.resetTransform=function(){var t=this.config.transformTemplate;this.element.style.transform=t?t({},""):"none",this.scheduleRender()},e.prototype.setAxisTarget=function(t,e,n){var r=this.targetBox[t];r.min=e,r.max=n,this.hasViewportBoxUpdated=!0,this.rootParent.scheduleUpdateLayoutDelta()},e.prototype.startLayoutAxisAnimation=function(t,e){var n=this,r=this.axisProgress[t],i=this.targetBox[t],o=i.min,a=i.max-o;return r.clearListeners(),r.set(o),r.set(o),r.onChange(function(e){return n.setAxisTarget(t,e,e+a)}),Hn(t,r,0,e)},e.prototype.stopLayoutAnimation=function(){var t=this;In(function(e){return t.axisProgress[e].stop()})},e.prototype.updateDeltas=function(){var t,e,n,r,i,o,a;n=this.boxCorrected,r=this.box,pn(n.x,r.x),pn(n.y,r.y),this.parent&&(i=this.treeScale,o=this.parent.treeScale,a=this.parent.delta,i.x=o.x*a.x.scale,i.y=o.y*a.y.scale),function(t,e){for(var n=e.length,r=0;r<n;r++)yn(t,e[r].delta)}(this.boxCorrected,this.treePath),function(t,e,n){bn(t.x,e.x,n,wn),bn(t.y,e.y,n,xn)}(this.targetBoxFinal,this.targetBox,this.latest),On(this.delta,this.boxCorrected,this.targetBox),On(this.deltaFinal,this.boxCorrected,this.targetBoxFinal),this.hasViewportBoxUpdated&&(null===(e=(t=this.config).onViewportBoxUpdate)||void 0===e||e.call(t,this.targetBox,this.delta)),this.hasViewportBoxUpdated=!1;var u=hn(this.deltaFinal,this.treeScale);u!==this.deltaTransform&&this.scheduleRender(),this.deltaTransform=u},e.prototype.build=function(){void 0!==this.isVisible&&(this.style.visibility=this.isVisible?"visible":"hidden"),dn(this.latest,this.style,this.vars,this.transform,this.transformOrigin,this.transformKeys,this.config,this.isLayoutProjectionEnabled&&!!this.box,this.delta,this.deltaFinal,this.treeScale,this.targetBoxFinal)},e.prototype.render=function(){for(var t in this.build(),Object.assign(this.element.style,this.style),this.vars)this.element.style.setProperty(t,this.vars[t])},e}(je),Xn=function(t){return t.updateLayoutDelta()};function Yn(t){var e=Object(De.useRef)(null);return null===e.current&&(e.current=t()),e.current}function Qn(t,e,n){return"string"===typeof t?t:L.transform(e+n*t)}var $n=function(t,e){return L.transform(t*e)},Jn={offset:"stroke-dashoffset",array:"stroke-dasharray"},Zn={offset:"strokeDashoffset",array:"strokeDasharray"};var tr={x:0,y:0,width:0,height:0};function er(t,e,n,r,o,a,u,s,c,l){var f=t.attrX,h=t.attrY,d=t.originX,p=t.originY,v=t.pathLength,m=t.pathSpacing,g=void 0===m?1:m,y=t.pathOffset,b=void 0===y?0:y;return dn(Object(i.e)(t,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]),r,n,o,a,u,s),r.transform&&(e.transform=r.transform,delete r.transform),(void 0!==d||void 0!==p||e.transform)&&(e.transformOrigin=function(t,e,n){return Qn(e,t.x,t.width)+" "+Qn(n,t.y,t.height)}(c||tr,void 0!==d?d:.5,void 0!==p?p:.5)),void 0!==f&&(r.x=f),void 0!==h&&(r.y=h),void 0!==l&&void 0!==v&&function(t,e,n,r,i,o){void 0===r&&(r=1),void 0===i&&(i=0),void 0===o&&(o=!0);var a=o?Jn:Zn;t[a.offset]=$n(-i,e);var u=$n(n,e),s=$n(r,e);t[a.array]=u+" "+s}(r,l,v,g,b,!1),r}var nr=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues"]),rr=/([a-z])([A-Z])/g,ir=function(t){return t.replace(rr,"$1-$2").toLowerCase()},or=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.attrs={},e.defaultConfig={enableHardwareAcceleration:!1},e.config=e.defaultConfig,e}return Object(i.c)(e,t),e.prototype.mount=function(e){t.prototype.mount.call(this,e),this.measure()},e.prototype.measure=function(){try{this.dimensions="function"===typeof this.element.getBBox?this.element.getBBox():this.element.getBoundingClientRect()}catch(t){this.dimensions={x:0,y:0,width:0,height:0}}"path"===this.element.tagName&&(this.totalPathLength=this.element.getTotalLength())},e.prototype.clean=function(){t.prototype.clean.call(this),this.attrs={}},e.prototype.read=function(t){return t=nr.has(t)?t:ir(t),this.element.getAttribute(t)},e.prototype.build=function(){er(this.latest,this.style,this.vars,this.attrs,this.transform,this.transformOrigin,this.transformKeys,this.config,this.dimensions,this.totalPathLength)},e.prototype.render=function(){for(var e in t.prototype.render.call(this),this.attrs)this.element.setAttribute(ir(e),this.attrs[e])},e}(Kn);var ar=new Set(["animate","circle","clipPath","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","foreignObject","g","image","line","linearGradient","marker","mask","metadata","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","switch","symbol","text","textPath","tspan","use","view"]);function ur(t){return"string"===typeof t&&ar.has(t)}var sr=Object(De.createContext)(null);function cr(){var t=Object(De.useContext)(sr);if(null===t)return[!0,null];var e=t.isPresent,n=t.onExitComplete,r=t.register,i=hr();Object(De.useEffect)(function(){return r(i)},[]);return!e&&n?[!1,function(){return null===n||void 0===n?void 0:n(i)}]:[!0]}var lr=0,fr=function(){return lr++},hr=function(){return Yn(fr)},dr=function(t,e,n,r,o){var a=Yn(function(){return new(ur(t)?or:Kn)(n,o)});a.updateConfig(Object(i.a)({enableHardwareAcceleration:!r},e)),a.layoutId=e.layoutId;var u=function(){var t=Object(De.useContext)(sr);return null===t||t.isPresent}();return a.isPresent=void 0!==e.isPresent?e.isPresent:u,a},pr=new Set(["initial","animate","exit","style","variants","transition","transformTemplate","transformValues","custom","inherit","static","layout","layoutId","onLayoutAnimationComplete","onViewportBoxUpdate","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","drag","dragControls","dragListener","dragConstraints","dragDirectionLock","dragElastic","dragMomentum","dragPropagation","dragTransition","onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","whileHover","whileTap","onHoverEnd","onHoverStart"]);function vr(t){return pr.has(t)}var mr=function(t){return!vr(t)};try{var gr=n(55).default;mr=function(t){return t.startsWith("on")?!vr(t):gr(t)}}catch(No){}function yr(t,e,n){var r="string"===typeof t?function(t){var e={};for(var n in t)mr(n)&&(e[n]=t[n]);return e}(e):e;n.clean(),n.build();var o=ur(t)?function(t){return Object(i.a)(Object(i.a)({},t.attrs),{style:Object(i.a)({},t.reactStyle)})}(n):function(t,e){var n=e.drag,r={style:Object(i.a)(Object(i.a)(Object(i.a)({},t.reactStyle),t.style),t.vars)};return n&&(r.style.userSelect="none",r.draggable=!1),r}(n,e);return Object(De.createElement)(t,Object(i.a)(Object(i.a)(Object(i.a)({},r),{ref:n.ref}),o))}function br(t){return"string"===typeof t&&t.startsWith("var(--")}var wr=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;var xr=4;function kr(t,e,n){void 0===n&&(n=1),a(n<=xr,'Max CSS variable fallback depth detected in property "'+t+'". This may indicate a circular fallback dependency.');var r=function(t){var e=wr.exec(t);return e?[e[1],e[2]]:[,]}(t),i=r[0],o=r[1];if(i){var u=window.getComputedStyle(e).getPropertyValue(i);return u||(br(o)?kr(o,e,n+1):o)}}var Er,Cr=new Set(["width","height","top","left","right","bottom","x","y"]),_r=function(t){return Cr.has(t)},Sr=function(t){return Object.keys(t).some(_r)},Tr=function(t,e){t.set(e,!1),t.set(e)},Or=function(t){return t===A||t===L};!function(t){t.width="width",t.height="height",t.left="left",t.right="right",t.top="top",t.bottom="bottom"}(Er||(Er={}));var Ir=function(t,e){return parseFloat(t.split(", ")[e])},Rr=function(t,e){return function(n,r){var i=r.transform;if("none"===i||!i)return 0;var o=i.match(/^matrix3d\((.+)\)$/);if(o)return Ir(o[1],e);var a=i.match(/^matrix\((.+)\)$/);return a?Ir(a[1],t):0}},Ar=new Set(["x","y","z"]),Dr=tn.filter(function(t){return!Ar.has(t)});var Nr={width:function(t){var e=t.x;return e.max-e.min},height:function(t){var e=t.y;return e.max-e.min},top:function(t,e){var n=e.top;return parseFloat(n)},left:function(t,e){var n=e.left;return parseFloat(n)},bottom:function(t,e){var n=t.y,r=e.top;return parseFloat(r)+(n.max-n.min)},right:function(t,e){var n=t.x,r=e.left;return parseFloat(r)+(n.max-n.min)},x:Rr(4,13),y:Rr(5,14)},Pr=function(t,e,n,r){void 0===n&&(n={}),void 0===r&&(r={}),e=Object(i.a)({},e),r=Object(i.a)({},r);var o=Object.keys(e).filter(_r),u=[],s=!1,c=[];if(o.forEach(function(i){var o=t.getValue(i);if(t.hasValue(i)){var l,f=n[i],h=e[i],d=Xe(f);if(Rn(h))for(var p=h.length,v=null===h[0]?1:0;v<p;v++)l?a(Xe(h[v])===l,"All keyframes must be of the same type"):(l=Xe(h[v]),a(l===d||Or(d)&&Or(l),"Keyframes must be of the same dimension as the current value"));else l=Xe(h);if(d!==l)if(Or(d)&&Or(l)){var m=o.get();"string"===typeof m&&o.set(parseFloat(m)),"string"===typeof h?e[i]=parseFloat(h):Array.isArray(h)&&l===L&&(e[i]=h.map(parseFloat))}else s||(u=function(t){var e=[];return Dr.forEach(function(n){var r=t.getValue(n);void 0!==r&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}(t),s=!0),c.push(i),r[i]=void 0!==r[i]?r[i]:e[i],Tr(o,h)}}),c.length){var l=function(t,e,n){var r=e.getBoundingBox(),i=e.getComputedStyle(),o=i.display,a={top:i.top,left:i.left,bottom:i.bottom,right:i.right,transform:i.transform};"none"===o&&e.setStaticValues("display",t.display||"block"),e.render();var u=e.getBoundingBox();return n.forEach(function(n){var o=e.getValue(n);Tr(o,Nr[n](r,a)),t[n]=Nr[n](u,i)}),t}(e,t,c);return u.length&&u.forEach(function(e){var n=e[0],r=e[1];t.getValue(n).set(r)}),t.render(),{target:l,transitionEnd:r}}return{target:e,transitionEnd:r}};var Mr=function(t,e,n,r){var o=function(t,e,n){var r=Object(i.e)(e,[]),o=t.getInstance();if(!(o instanceof HTMLElement))return{target:r,transitionEnd:n};for(var a in n&&(n=Object(i.a)({},n)),t.forEachValue(function(t){var e=t.get();if(br(e)){var n=kr(e,o);n&&t.set(n)}}),r){var u=r[a];if(br(u)){var s=kr(u,o);s&&(r[a]=s,n&&void 0===n[a]&&(n[a]=u))}}return{target:r,transitionEnd:n}}(t,e,r);return function(t,e,n,r){return Sr(e)?Pr(t,e,n,r):{target:e,transitionEnd:r}}(t,e=o.target,n,r=o.transitionEnd)};var Fr=function(){function t(){this.hasMounted=!1,this.pendingAnimations=[],this.componentControls=new Set}return t.prototype.setVariants=function(t){this.variants=t,this.componentControls.forEach(function(e){return e.setVariants(t)})},t.prototype.setDefaultTransition=function(t){this.defaultTransition=t,this.componentControls.forEach(function(e){return e.setDefaultTransition(t)})},t.prototype.subscribe=function(t){var e=this;return this.componentControls.add(t),this.variants&&t.setVariants(this.variants),this.defaultTransition&&t.setDefaultTransition(this.defaultTransition),function(){return e.componentControls.delete(t)}},t.prototype.start=function(t,e){var n=this;if(this.hasMounted){var r=[];return this.componentControls.forEach(function(n){var i=n.start(t,{transitionOverride:e});r.push(i)}),Promise.all(r)}return new Promise(function(r){n.pendingAnimations.push({animation:[t,e],resolve:r})})},t.prototype.set=function(t){return a(this.hasMounted,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),this.componentControls.forEach(function(e){return e.apply(t)})},t.prototype.stop=function(){this.componentControls.forEach(function(t){return t.stop()})},t.prototype.mount=function(){var t=this;this.hasMounted=!0,this.pendingAnimations.forEach(function(e){var n=e.animation,r=e.resolve;return t.start.apply(t,n).then(r)})},t.prototype.unmount=function(){this.hasMounted=!1,this.stop()},t}(),Lr=Object(De.createContext)({static:!1}),jr=function(t){return"string"===typeof t||Array.isArray(t)},Br=function(t){return t instanceof Fr},Vr=function(t,e,n,r,i){void 0===r&&(r=!1);var o,a=i.initial,u=i.animate,s=i.variants,c=i.whileTap,l=i.whileHover,f=i.layoutId,h=Object(De.useContext)(sr),d=null===h||void 0===h?void 0:h.id;n.isPresenceRoot=t.presenceId!==d,void 0!==(null===h||void 0===h?void 0:h.initial)&&(a=h.initial),!1!==a||Br(u)?"boolean"!==typeof a&&(o=a):o=u;var p=Object(De.useRef)(!1),v=s||jr(u)||jr(c)||jr(l)||Br(u),m=jr(o)?o:t.initial,g=jr(u)?u:t.animate,y=r?m:null,b=v&&jr(g)?g:null,w=Object(De.useMemo)(function(){return{controls:v?e:t.controls,initial:m,animate:g,visualElement:n,hasMounted:p,isReducedMotion:t.isReducedMotion,presenceId:d}},[y,b,t.isReducedMotion,u,f,d]);return w.static=r,function(t,e){void 0===e&&(e=!1);var n=Object(De.useRef)(!0);(!e||e&&n.current)&&t(),n.current=!1}(function(){var n=o||t.initial;n&&e.apply(n)},!r),Object(De.useEffect)(function(){p.current=!0},[]),w},Ur=function(t){var e=t.animate,n=t.variants,r=t.inherit;return(void 0===r||r)&&!!n&&(!e||e instanceof Fr)},zr=function(t){return t instanceof Fe};function Wr(t,e,n,r){for(var i in void 0===r&&(r=!1),r&&(t.reactStyle={}),n){var o=n[i],a=!1;if(zr(o))Gr.has(i)||(t.addValue(i,o),a=!0);else if(rn(i)||an(i)){if(t.hasValue(i)){if(o!==e[i]){t.getValue(i).set(o)}}else t.addValue(i,Le(o));a=!0}else r&&(t.reactStyle[i]=o);a&&(e[i]=o)}}var Gr=new Set([]),Hr=function(){return{}},qr=function(t){return Rn(t)?t[t.length-1]||0:t},Kr=function(){function t(t,e){var n=this,r=e.makeTargetAnimatable;this.props={},this.variants={},this.baseTarget={},this.overrides=[],this.resolvedOverrides=[],this.activeOverrides=new Set,this.isAnimating=new Set,this.hasValue=function(t){return!n.visualElement.hasValue(t)},this.visualElement=t,this.makeTargetAnimatable=r,this.visualElement.forEachValue(function(t,e){return n.baseTarget[e]=t.get()})}return t.prototype.setProps=function(t){this.props=t},t.prototype.setVariants=function(t){t&&(this.variants=t)},t.prototype.setDefaultTransition=function(t){t&&(this.defaultTransition=t)},t.prototype.setValues=function(t,e){var n=void 0===e?{}:e,r=n.isActive,o=void 0===r?new Set:r,a=n.priority,u=this.resolveVariant(t),s=u.target,c=u.transitionEnd;for(var l in s=this.transformValues(Object(i.a)(Object(i.a)({},s),c))){if(o.has(l))return;if(o.add(l),s){var f=qr(s[l]);if(this.visualElement.hasValue(l)){var h=this.visualElement.getValue(l);h&&h.set(f)}else this.visualElement.addValue(l,Le(f));a||(this.baseTarget[l]=f)}}},t.prototype.transformValues=function(t){var e=this.props.transformValues;return e?e(t):t},t.prototype.checkForNewValues=function(t){var e=Object.keys(t).filter(this.hasValue),n=e.length;if(n)for(var r=0;r<n;r++){var i=e[r],o=t[i],u=null;if(Array.isArray(o)&&(u=o[0]),null===u){var s=this.visualElement.readNativeValue(i);u=void 0!==s?s:t[i],a(null!==u,'No initial value for "'+i+'" can be inferred. Ensure an initial value for "'+i+'" is defined on the component.')}"string"===typeof u&&/^\-?\d*\.?\d+$/.test(u)?u=parseFloat(u):!Qe(u)&&Z.test(o)&&(u=Z.getAnimatableNone(o)),this.visualElement.addValue(i,Le(u)),this.baseTarget[i]=u}},t.prototype.resolveVariant=function(t){if(!t)return{target:void 0,transition:void 0,transitionEnd:void 0};"function"===typeof t&&(t=t(this.props.custom,function(t){var e={};return t.forEachValue(function(t,n){return e[n]=t.get()}),e}(this.visualElement),function(t){var e={};return t.forEachValue(function(t,n){return e[n]=t.getVelocity()}),e}(this.visualElement)));var e=t.transition;return{transition:void 0===e?this.defaultTransition:e,transitionEnd:t.transitionEnd,target:Object(i.e)(t,["transition","transitionEnd"])}},t.prototype.getHighestPriority=function(){return this.activeOverrides.size?Math.max.apply(Math,Array.from(this.activeOverrides)):0},t.prototype.setOverride=function(t,e){this.overrides[e]=t,this.children&&this.children.forEach(function(n){return n.setOverride(t,e)})},t.prototype.startOverride=function(t){var e=this.overrides[t];if(e)return this.start(e,{priority:t})},t.prototype.clearOverride=function(t){var e=this;if(this.children&&this.children.forEach(function(e){return e.clearOverride(t)}),this.overrides[t]){this.activeOverrides.delete(t);var n=this.getHighestPriority();if(this.resetIsAnimating(),n)this.overrides[n]&&this.startOverride(n);var r=this.resolvedOverrides[t];if(r){var i={};for(var o in this.baseTarget)void 0!==r[o]&&(i[o]=this.baseTarget[o]);this.onStart(),this.animate(i).then(function(){return e.onComplete()})}}},t.prototype.apply=function(t){return Array.isArray(t)?this.applyVariantLabels(t):"string"===typeof t?this.applyVariantLabels([t]):void this.setValues(t)},t.prototype.applyVariantLabels=function(t){var e=this,n=new Set;Object(i.f)(t).reverse().forEach(function(r){var i=e.resolveVariant(e.variants[r]),o=i.target,a=i.transitionEnd;a&&e.setValues(a,{isActive:n}),o&&e.setValues(o,{isActive:n}),e.children&&e.children.size&&e.children.forEach(function(e){return e.applyVariantLabels(t)})})},t.prototype.start=function(t,e){var n,r,i=this;return void 0===e&&(e={}),e.priority&&this.activeOverrides.add(e.priority),this.resetIsAnimating(e.priority),r=t,n=Array.isArray(r)?this.animateVariantLabels(t,e):"string"===typeof t?this.animateVariant(t,e):this.animate(t,e),this.onStart(),n.then(function(){return i.onComplete()})},t.prototype.animate=function(t,e){var n=this,r=void 0===e?{}:e,o=r.delay,a=void 0===o?0:o,u=r.priority,s=void 0===u?0:u,c=r.transitionOverride,l=this.resolveVariant(t),f=l.target,h=l.transition,d=l.transitionEnd;if(c&&(h=c),!f)return Promise.resolve();f=this.transformValues(f),d&&(d=this.transformValues(d)),this.checkForNewValues(f);var p=this.transformValues(function(t,e,n){var r,i,o={};for(var a in t)o[a]=null!==(r=Xr(a,e))&&void 0!==r?r:null===(i=n.getValue(a))||void 0===i?void 0:i.get();return o}(f,h,this.visualElement));if(this.makeTargetAnimatable){var v=this.makeTargetAnimatable(this.visualElement,f,p,d);f=v.target,d=v.transitionEnd}s&&(this.resolvedOverrides[s]=f),this.checkForNewValues(f);var m=[];for(var g in f){var y=this.visualElement.getValue(g);if(y&&f&&void 0!==f[g]){var b=f[g];s||(this.baseTarget[g]=qr(b)),this.isAnimating.has(g)||(this.isAnimating.add(g),m.push(Hn(g,y,b,Object(i.a)({delay:a},h))))}}var w=Promise.all(m);return d?w.then(function(){n.setValues(d,{priority:s})}):w},t.prototype.animateVariantLabels=function(t,e){var n=this,r=Object(i.f)(t).reverse().map(function(t){return n.animateVariant(t,e)});return Promise.all(r)},t.prototype.animateVariant=function(t,e){var n=this,r=!1,i=0,o=0,a=1,u=e&&e.priority||0,s=this.variants[t],c=s?function(){return n.animate(s,e)}:function(){return Promise.resolve()},l=this.children?function(){return n.animateChildren(t,i,o,a,u)}:function(){return Promise.resolve()};if(s&&this.children){var f=this.resolveVariant(s).transition;f&&(r=f.when||r,i=f.delayChildren||i,o=f.staggerChildren||o,a=f.staggerDirection||a)}if(r){var h="beforeChildren"===r?[c,l]:[l,c],d=h[1];return(0,h[0])().then(d)}return Promise.all([c(),l()])},t.prototype.animateChildren=function(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=0),!this.children)return Promise.resolve();var o=[],a=(this.children.size-1)*n,u=1===r?function(t){return t*n}:function(t){return a-t*n};return Array.from(this.children).forEach(function(n,r){var a=n.animateVariant(t,{priority:i,delay:e+u(r)});o.push(a)}),Promise.all(o)},t.prototype.onStart=function(){var t=this.props.onAnimationStart;t&&t()},t.prototype.onComplete=function(){var t=this.props.onAnimationComplete;t&&t()},t.prototype.checkOverrideIsAnimating=function(t){for(var e=this.overrides.length,n=t+1;n<e;n++){var r=this.resolvedOverrides[n];if(r)for(var i in r)this.isAnimating.add(i)}},t.prototype.resetIsAnimating=function(t){void 0===t&&(t=0),this.isAnimating.clear(),t<this.getHighestPriority()&&this.checkOverrideIsAnimating(t),this.children&&this.children.forEach(function(e){return e.resetIsAnimating(t)})},t.prototype.stop=function(){this.visualElement.forEachValue(function(t){return t.stop()})},t.prototype.addChild=function(t){this.children||(this.children=new Set),this.children.add(t),this.overrides.forEach(function(e,n){e&&t.setOverride(e,n)})},t.prototype.removeChild=function(t){this.children&&this.children.delete(t)},t.prototype.resetChildren=function(){this.children&&this.children.clear()},t}();function Xr(t,e){if(e)return(e[t]||e.default||e).from}function Yr(t,e,n){var r=Ur(e),o=e.variants,a=e.transition,u=Object(De.useContext)(Lr).controls,s=Object(De.useContext)(sr),c=Yn(function(){return new Kr(t,n)});return s&&!s.isPresent||(c.resetChildren(),c.setProps(e),c.setVariants(o),c.setDefaultTransition(a)),Object(De.useEffect)(function(){r&&u&&u.addChild(c)}),Object(De.useEffect)(function(){return function(){e.onAnimationComplete;var t=Object(i.e)(e,["onAnimationComplete"]);c.setProps(t),u&&u.removeChild(c)}},[]),c}var Qr,$r=Object(De.createContext)({transformPagePoint:function(t){return t},features:[]});!function(t){t.Target="Target",t.VariantLabel="VariantLabel",t.AnimationSubscription="AnimationSubscription"}(Qr||(Qr={}));var Jr=function(t){return function(e){return t(e),null}};var Zr=function(t,e){return void 0!==e&&(Array.isArray(t)&&Array.isArray(e)?!function(t,e){if(null===e)return!1;var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}(e,t):t!==e)};function ti(t,e){void 0===e&&(e=!1);t.transition;var n=t.transitionEnd,r=Object(i.e)(t,["transition","transitionEnd"]);return e?Object(i.a)(Object(i.a)({},r),n):r}var ei,ni,ri=function(t){var e,n=t instanceof Fe?t.get():t;return Array.from(new Set((e=n)?Array.isArray(e)?e:[e]:[]))},ii=function(t){return[t.join(",")]},oi=function(t,e){return t.join(",")!==e.join(",")};var ai,ui,si=((ei={})[Qr.Target]=Jr(function(t){return function(t,e,n,r){var o=Object(De.useRef)(!0),a=Object(De.useRef)(null);a.current||(a.current=ti(t,!0)),Object(De.useEffect)(function(){var u={},s=ti(t),c=ti(t,!0);for(var l in s){var f=o.current&&(!n.hasValue(l)||n.getValue(l).get()!==c[l]),h=null!==c[l],d=Zr(a.current[l],c[l]);h&&(d||f)&&(u[l]=s[l])}o.current=!1,a.current=Object(i.a)(Object(i.a)({},a.current),c),Object.keys(u).length&&e.start(Object(i.a)(Object(i.a)({},u),{transition:t.transition||r,transitionEnd:t.transitionEnd}))},[t])}(t.animate,t.controls,t.visualElement,t.transition)}),ei[Qr.VariantLabel]=Jr(function(t){var e=t.animate,n=t.inherit,r=void 0===n||n,i=t.controls;return function(t,e,n,r){var i=ri(e),o=Object(De.useContext)(Lr),a=o.hasMounted&&o.hasMounted.current,u=Object(De.useRef)(!1);Object(De.useEffect)(function(){var e=!1;n?(e=!!a,i=ri(o.animate)):e=u.current||oi(ri(t),i),e&&r.start(i),u.current=!0},ii(i))}(t.initial,e,r,i)}),ei[Qr.AnimationSubscription]=Jr(function(t){return function(t,e){var n=Object(De.useMemo)(function(){return t.subscribe(e)},[t]);Object(De.useEffect)(function(){return function(){n&&n()}},[n])}(t.animate,t.controls)}),ei),ci=function(t){return t.animate instanceof Fr},li=["initial","animate","whileTap","whileHover"],fi=((ni={})[Qr.Target]=function(t){return void 0!==t.animate&&(e=t.animate,!(Array.isArray(e)||"string"===typeof e))&&!ci(t);var e},ni[Qr.VariantLabel]=function(t){return void 0!==t.variants||li.some(function(e){return"string"===typeof t[e]})},ni[Qr.AnimationSubscription]=ci,ni),hi=function(t){var e=void 0;for(var n in Qr)fi[n](t)&&(e=n);return e?si[e]:void 0};!function(t){t[t.Entering=0]="Entering",t[t.Present=1]="Present",t[t.Exiting=2]="Exiting"}(ai||(ai={})),function(t){t[t.Hide=0]="Hide",t[t.Show=1]="Show"}(ui||(ui={}));var di={measureLayout:function(t){return t.measureLayout()},layoutReady:function(t){return t.layoutReady()}},pi=function(t,e){return t.depth-e.depth};function vi(){var t=new Set;return{add:function(e){return t.add(e)},flush:function(e){var n=void 0===e?di:e,r=n.measureLayout,i=n.layoutReady,o=Array.from(t).sort(pi);o.forEach(function(t){return t.resetTransform()}),o.forEach(r),o.forEach(i),o.forEach(function(t){t.isPresent&&(t.presence=ai.Present)}),t.clear()}}}function mi(t){return!!t.forceUpdate}var gi=Object(De.createContext)(vi());function yi(t){return Object(De.useEffect)(function(){return function(){return t()}},[])}function bi(t,e){var n=e.defaultFeatures,r=e.useVisualElement,o=e.render,a=e.animationControlsConfig;return Object(De.forwardRef)(function(e,u){var s=Object(De.useContext)(Lr),c=Ur(e),l=s.static||e.static||!1,f=r(t,e,s.visualElement,l,u);!function(t,e){var n=Yn(Hr);for(var r in n){var i=rn(r)||an(r),o=e[r],a=e.style&&e.style[r],u=o&&zr(e[r]),s=a&&zr(e.style[r]);(i&&!o&&!a||!i&&!u&&!s)&&(t.removeValue(r),delete n[r])}Wr(t,n,e),e.style&&Wr(t,n,e.style,!0),e.transformValues&&(t.reactStyle=e.transformValues(t.reactStyle))}(f,e);var h=Yr(f,e,a),d=Vr(s,h,f,l,e),p=function(t,e,n,r,o,a,u,s){var c=Object(De.useContext)($r);if(e||"undefined"===typeof window)return null;var l=Object(i.f)(t,c.features),f=l.length,h=[],d=hi(o);d&&h.push(Object(De.createElement)(d,{key:"animation",initial:o.initial,animate:o.animate,variants:o.variants,transition:o.transition,controls:r,inherit:s,visualElement:n}));for(var p=0;p<f;p++){var v=l[p],m=v.shouldRender,g=v.key,y=v.Component;m(o,u)&&h.push(Object(De.createElement)(y,Object(i.a)({key:g},o,{localContext:a,parentContext:u,visualElement:n,controls:r})))}return h}(n,l,f,h,e,d,s,c),v=o(t,e,f);return function(t){var e=Object(De.useContext)(gi);yi(function(){mi(e)&&e.remove(t)})}(f),Object(De.createElement)(De.Fragment,null,Object(De.createElement)(Lr.Provider,{value:d},v),p)})}function wi(t){var e=null;return function(){return null===e&&(e=t,function(){e=null})}}var xi=wi("dragHorizontal"),ki=wi("dragVertical");function Ei(t){var e=!1;if("y"===t)e=ki();else if("x"===t)e=xi();else{var n=xi(),r=ki();n&&r?e=function(){n(),r()}:(n&&n(),r&&r())}return e}var Ci=!1;"undefined"!==typeof window&&document.addEventListener("touchmove",function(t){Ci&&t.preventDefault()},{passive:!1});var _i=function(){return Ci=!1};function Si(t,e,n,r){if(n)return t.addEventListener(e,n,r),function(){return t.removeEventListener(e,n,r)}}function Ti(t){return"undefined"!==typeof PointerEvent&&t instanceof PointerEvent?!("mouse"!==t.pointerType):t instanceof MouseEvent}function Oi(t){return!!t.touches}var Ii={pageX:0,pageY:0};function Ri(t,e){void 0===e&&(e="page");var n=t.touches[0]||t.changedTouches[0]||Ii;return{x:n[e+"X"],y:n[e+"Y"]}}function Ai(t,e){return void 0===e&&(e="page"),{x:t[e+"X"],y:t[e+"Y"]}}function Di(t,e){return void 0===e&&(e="page"),{point:Oi(t)?Ri(t,e):Ai(t,e)}}function Ni(t){return Di(t,"client")}var Pi,Mi=function(t,e){if(void 0===e&&(e=!1),t){var n=function(e){return t(e,Di(e))};return e?function(t){if(t)return function(e){var n=e instanceof MouseEvent;(!n||n&&0===e.button)&&t(e)}}(n):n}},Fi="undefined"!==typeof window,Li=function(){return Fi&&null===window.onpointerdown},ji=function(){return Fi&&null===window.ontouchstart},Bi=function(){return Fi&&null===window.onmousedown},Vi={pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mousecancel",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"},Ui={pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"};function zi(t){return Li()?t:ji()?Ui[t]:Bi()?Vi[t]:t}function Wi(t,e,n,r){return Si(t,zi(e),Mi(n,"pointerdown"===e),r)}function Gi(t,e,n,r){return function(t,e,n,r){Object(De.useEffect)(function(){var i=t.current;if(n&&i)return Si(i,e,n,r)},[t,e,n,r])}(t,zi(e),Mi(n,"pointerdown"===e),r)}!function(t){t.subtract=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},t.relativeTo=function(t){var e;return function(n){var r=n.x,i=n.y,o=void 0!==e?e:e="string"===typeof t?document.getElementById(t):t;if(o){var a=o.getBoundingClientRect();return{x:r-a.left-window.scrollX,y:i-a.top-window.scrollY}}}}}(Pi||(Pi={}));var Hi=function(){function t(t,e,n){var r=this,o=(void 0===n?{}:n).transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(r.lastMoveEvent&&r.lastMoveEventInfo){var t=Ki(r.lastMoveEventInfo,r.history),e=null!==r.startEvent,n=Ut(t.offset,{x:0,y:0})>=3;if(e||n){var o=t.point,a=C().timestamp;r.history.push(Object(i.a)(Object(i.a)({},o),{timestamp:a}));var u=r.handlers,s=u.onStart,c=u.onMove;e||(s&&s(r.lastMoveEvent,t),r.startEvent=r.lastMoveEvent),c&&c(r.lastMoveEvent,t)}}},!(Oi(t)&&t.touches.length>1)){this.handlers=e,this.transformPagePoint=o;var a=qi(Di(t),this.transformPagePoint),u=a.point,s=C().timestamp;this.history=[Object(i.a)(Object(i.a)({},u),{timestamp:s})];var c=e.onSessionStart;c&&c(t,Ki(a,this.history));var l=Wi(window,"pointermove",function(t,e){return r.handlePointerMove(t,e)}),f=Wi(window,"pointerup",function(t,e){return r.handlePointerUp(t,e)});this.removeListeners=function(){l&&l(),f&&f()}}}return t.prototype.handlePointerMove=function(t,e){this.lastMoveEvent=t,this.lastMoveEventInfo=qi(e,this.transformPagePoint),Ti(t)&&0===t.buttons?this.handlePointerUp(t,e):_.update(this.updatePoint,!0)},t.prototype.handlePointerUp=function(t,e){this.end();var n=this.handlers.onEnd;if(n){var r=Ki(qi(e,this.transformPagePoint),this.history);n&&n(t,r)}},t.prototype.updateHandlers=function(t){this.handlers=t},t.prototype.end=function(){this.removeListeners&&this.removeListeners(),w.update(this.updatePoint),_i()},t}();function qi(t,e){return e?{point:e(t.point)}:t}function Ki(t,e){var n=t.point;return{point:n,delta:Pi.subtract(n,Yi(e)),offset:Pi.subtract(n,Xi(e)),velocity:Qi(e,.1)}}function Xi(t){return t[0]}function Yi(t){return t[t.length-1]}function Qi(t,e){if(t.length<2)return{x:0,y:0};for(var n=t.length-1,r=null,i=Yi(t);n>=0&&(r=t[n],!(i.timestamp-r.timestamp>Vn(e)));)n--;if(!r)return{x:0,y:0};var o=(i.timestamp-r.timestamp)/1e3;if(0===o)return{x:0,y:0};var a={x:(i.x-r.x)/o,y:(i.y-r.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function $i(t,e,n,r,i){var o=t-e*n;return r?function(t,e,n){var r=e.min,i=e.max;return void 0!==r&&t<r?t=n?Wt(r,t,n):Math.max(t,r):void 0!==i&&t>i&&(t=n?Wt(i,t,n):Math.min(t,i)),t}(o,r,i):o}function Ji(t,e,n){var r={},i=t.max-t.min;return void 0!==e&&(r.min=t.min+e),void 0!==n&&(r.max=Math.max(t.min+n-i,t.min+n)),r}function Zi(t,e){var n,r=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&(r=(n=[i,r])[0],i=n[1]),{min:t.min+r,max:t.min+i}}var to,eo=new WeakMap,no=function(){function t(t){var e=t.visualElement;this.isDragging=!1,this.currentDirection=null,this.constraints=!1,this.props={},this.cursorProgress={x:.5,y:.5},this.openGlobalLock=null,this.panSession=null,this.visualElement=e,this.visualElement.enableLayoutProjection(),eo.set(e,this)}return t.prototype.start=function(t,e){var n=this,r=void 0===e?{}:e,i=r.snapToCursor,o=void 0!==i&&i,a=r.cursorProgress;o&&this.snapToCursor(t);var u=this.props.transformPagePoint;this.panSession=new Hi(t,{onSessionStart:function(){Ci=!0,n.stopMotion()},onStart:function(t,e){var r,i,o=n.props,u=o.drag,s=o.dragPropagation;if(!u||s||(n.openGlobalLock&&n.openGlobalLock(),n.openGlobalLock=Ei(u),n.openGlobalLock)){n.prepareBoundingBox(),n.visualElement.lockTargetBox(),n.resolveDragConstraints();var c=Ni(t).point;In(function(t){var e=n.visualElement.targetBox[t],r=e.min,i=e.max;n.cursorProgress[t]=a?a[t]:zt(r,i,c[t])}),n.isDragging=!0,n.currentDirection=null,null===(i=(r=n.props).onDragStart)||void 0===i||i.call(r,t,e)}},onMove:function(t,e){var r,i,o,a,u=n.props,s=u.dragPropagation,c=u.dragDirectionLock;if(s||n.openGlobalLock){var l=e.offset;if(c&&null===n.currentDirection)return n.currentDirection=function(t,e){void 0===e&&(e=10);var n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}(l),void(null!==n.currentDirection&&(null===(i=(r=n.props).onDirectionLock)||void 0===i||i.call(r,n.currentDirection)));n.updateAxis("x",t),n.updateAxis("y",t),null===(a=(o=n.props).onDrag)||void 0===a||a.call(o,t,e),to=t}},onEnd:function(t,e){return n.stop(t,e)}},{transformPagePoint:u})},t.prototype.prepareBoundingBox=function(){var t=this.visualElement.getInstance(),e=t.style.transform;this.visualElement.resetTransform(),this.visualElement.measureLayout(),t.style.transform=e,this.visualElement.refreshTargetBox()},t.prototype.resolveDragConstraints=function(){var t=this.props.dragConstraints;this.constraints=!!t&&(Pe(t)?this.resolveRefConstraints(this.visualElement.box,t):function(t,e){var n=e.top,r=e.left,i=e.bottom,o=e.right;return{x:Ji(t.x,r,o),y:Ji(t.y,n,i)}}(this.visualElement.box,t))},t.prototype.resolveRefConstraints=function(t,e){var n=this.props,r=n.onMeasureDragConstraints,i=n.transformPagePoint,o=e.current;a(null!==o,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop."),this.constraintsBox=qn(o,i);var u=function(t,e){return{x:Zi(t.x,e.x),y:Zi(t.y,e.y)}}(t,this.constraintsBox);if(r){var s=r(function(t){var e=t.x,n=t.y;return{top:n.min,bottom:n.max,left:e.min,right:e.max}}(u));s&&(u=Ve(s))}return u},t.prototype.cancelDrag=function(){_i(),this.isDragging=!1,this.panSession&&this.panSession.end(),this.panSession=null,!this.props.dragPropagation&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null)},t.prototype.stop=function(t,e){var n;this.visualElement.unlockTargetBox(),null===(n=this.panSession)||void 0===n||n.end(),this.panSession=null;var r=this.isDragging;if(this.cancelDrag(),r){var i=this.props,o=i.dragMomentum,a=i.dragElastic,u=i.onDragEnd;if(o||a){var s=e.velocity;this.animateDragEnd(s)}null===u||void 0===u||u(t,e)}},t.prototype.snapToCursor=function(t){this.prepareBoundingBox(),this.cursorProgress.x=.5,this.cursorProgress.y=.5,this.updateAxis("x",t),this.updateAxis("y",t)},t.prototype.updateAxis=function(t,e){var n,r=this.props,i=r.drag,o=r.dragElastic;if(ro(t,i,this.currentDirection)){var a=this.visualElement.box[t],u=a.max-a.min,s=this.cursorProgress[t],c=$i(Ni(e).point[t],u,s,null===(n=this.constraints)||void 0===n?void 0:n[t],o);this.visualElement.setAxisTarget(t,c,c+u)}},t.prototype.updateProps=function(t){var e=t.drag,n=void 0!==e&&e,r=t.dragDirectionLock,o=void 0!==r&&r,a=t.dragPropagation,u=void 0!==a&&a,s=t.dragConstraints,c=void 0!==s&&s,l=t.dragElastic,f=void 0===l?.35:l,h=t.dragMomentum,d=void 0===h||h,p=Object(i.e)(t,["drag","dragDirectionLock","dragPropagation","dragConstraints","dragElastic","dragMomentum"]);this.props=Object(i.a)({drag:n,dragDirectionLock:o,dragPropagation:u,dragConstraints:c,dragElastic:f,dragMomentum:d},p)},t.prototype.animateDragEnd=function(t){var e=this,n=this.props,r=n.drag,o=n.dragMomentum,a=n.dragElastic,u=n.dragTransition,s=In(function(n){if(ro(n,r,e.currentDirection)){var s=e.constraints?e.constraints[n]:{},c=a?200:1e6,l=a?40:1e7,f=Object(i.a)(Object(i.a)({type:"inertia",velocity:o?t[n]:0,bounceStiffness:c,bounceDamping:l,timeConstant:750,restDelta:1,restSpeed:10},u),s);return e.visualElement.startLayoutAxisAnimation(n,f)}});return Promise.all(s).then(function(){var t,n;null===(n=(t=e.props).onDragTransitionEnd)||void 0===n||n.call(t)})},t.prototype.stopMotion=function(){this.visualElement.stopLayoutAnimation()},t.prototype.scalePoint=function(){var t=this,e=this.props,n=e.drag,r=e.dragConstraints;if(Pe(r)&&this.constraintsBox){this.stopMotion();var i={x:0,y:0};In(function(e){i[e]=Sn(t.visualElement.targetBox[e],t.constraintsBox[e])}),this.prepareBoundingBox(),this.resolveDragConstraints(),In(function(e){if(ro(e,n,null)){var r=function(t,e,n){var r=t.max-t.min,i=Wt(e.min,e.max-r,n);return{min:i,max:i+r}}(t.visualElement.targetBox[e],t.constraintsBox[e],i[e]),o=r.min,a=r.max;t.visualElement.setAxisTarget(e,o,a)}})}},t.prototype.mount=function(t){var e=this,n=Wi(t.getInstance(),"pointerdown",function(t){var n=e.props,r=n.drag,i=n.dragListener;r&&(void 0===i||i)&&e.start(t)}),r=Si(window,"resize",function(){e.scalePoint()}),i=t.onLayoutUpdate(function(){e.isDragging&&e.resolveDragConstraints()}),o=t.prevSnapshot;return(null===o||void 0===o?void 0:o.isDragging)&&this.start(to,{cursorProgress:o.cursorProgress}),function(){null===n||void 0===n||n(),null===r||void 0===r||r(),null===i||void 0===i||i(),e.cancelDrag()}},t}();function ro(t,e,n){return(!0===e||e===t)&&(null===n||n===t)}var io={key:"drag",shouldRender:function(t){return!!t.drag},Component:Jr(function(t){var e=t.visualElement;return function(t,e){var n=t.dragControls,r=Object(De.useContext)($r).transformPagePoint,o=Yn(function(){return new no({visualElement:e})});o.updateProps(Object(i.a)(Object(i.a)({},t),{transformPagePoint:r})),Object(De.useEffect)(function(){return n&&n.subscribe(o)},[o]),Object(De.useEffect)(function(){return o.mount(e)},[])}(Object(i.e)(t,["visualElement"]),e)})};var oo=function t(e,n){return!!n&&(e===n||t(e,n.parentElement))},ao=["whileHover","whileTap","whileDrag"],uo=function(t){return ao.indexOf(t)+1},so=uo("whileTap");var co=uo("whileHover"),lo=function(t){return function(e,n){Ti(e)&&t(e,n)}};function fo(t,e){!function(t,e){var n=t.onPan,r=t.onPanStart,i=t.onPanEnd,o=t.onPanSessionStart,a=n||r||i||o,u=Object(De.useRef)(null),s=Object(De.useContext)($r).transformPagePoint,c={onSessionStart:o,onStart:r,onMove:n,onEnd:function(t,e){u.current=null,i&&i(t,e)}};Object(De.useEffect)(function(){null!==u.current&&u.current.updateHandlers(c)}),Gi(e,"pointerdown",a&&function(t){u.current=new Hi(t,c,{transformPagePoint:s})}),yi(function(){return u.current&&u.current.end()})}(t,e),function(t,e){var n=t.onTap,r=t.onTapStart,i=t.onTapCancel,o=t.whileTap,a=t.controls,u=n||r||i||o,s=Object(De.useRef)(!1),c=Object(De.useRef)(null);function l(){c.current&&c.current(),c.current=null}o&&a&&a.setOverride(o,so);var f=Object(De.useRef)(null);f.current=function(t,r){var u=e.current;if(l(),s.current&&u){s.current=!1,a&&o&&a.clearOverride(so);var c=Ei(!0);c&&(c(),oo(u,t.target)?n&&n(t,r):i&&i(t,r))}},Gi(e,"pointerdown",u?function(t,n){l(),c.current=Wi(window,"pointerup",function(t,e){return f.current(t,e)}),e.current&&!s.current&&(s.current=!0,r&&r(t,n),a&&o&&a.startOverride(so))}:void 0),yi(l)}(t,e),function(t,e){var n=t.whileHover,r=t.onHoverStart,i=t.onHoverEnd,o=t.controls;n&&o&&o.setOverride(n,co),Gi(e,"pointerenter",lo(function(t,e){r&&r(t,e),n&&o&&o.startOverride(co)})),Gi(e,"pointerleave",lo(function(t,e){i&&i(t,e),n&&o&&o.clearOverride(co)}))}(t,e)}var ho=["onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","whileTap","whileHover","onHoverStart","onHoverEnd"],po={key:"gestures",shouldRender:function(t){return ho.some(function(e){return t.hasOwnProperty(e)})},Component:Jr(function(t){var e=t.visualElement;fo(Object(i.e)(t,["visualElement"]),e)})},vo={key:"exit",shouldRender:function(t){return!!t.exit&&!Ur(t)},Component:Jr(function(t){var e=t.animate,n=t.controls,r=t.exit,o=cr(),a=o[0],u=o[1],s=Object(De.useContext)(sr),c=Object(De.useRef)(!1),l=void 0!==(null===s||void 0===s?void 0:s.custom)?s.custom:t.custom;Object(De.useEffect)(function(){a?!c.current||!e||"boolean"===typeof e||e instanceof Fr||n.start(e):(!c.current&&r&&(n.setProps(Object(i.a)(Object(i.a)({},t),{custom:l})),n.start(r).then(u)),c.current=!0),a&&(c.current=!1)},[e,n,l,r,a,u,t])})};var mo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameTarget={x:{min:0,max:0},y:{min:0,max:0}},e.stopAxisAnimation={x:void 0,y:void 0},e.animate=function(t,n,r){void 0===r&&(r={});var o,a,u=r.originBox,s=r.targetBox,c=r.visibilityAction,l=Object(i.e)(r,["originBox","targetBox","visibilityAction"]),f=e.props,h=f.visualElement,d=f.layout,p=(a=t=s||t,yo((o=n=u||n).x,a.x)||yo(o.y,a.y)),v=In(function(r){if("position"===d){var i=t[r].max-t[r].min;n[r].max=n[r].min+i}if(!h.isTargetBoxLocked)return void 0===c?p?e.animateAxis(r,t[r],n[r],l):h.setAxisTarget(r,t[r].min,t[r].max):void(c===ui.Hide?h.hide():h.show())});return h.render(),Promise.all(v).then(function(){var t,n;null===(t=l.onLayoutAnimationComplete)||void 0===t||t.call(l),h.isPresent?h.presence=ai.Present:(null===(n=l.onLayoutAnimationComplete)||void 0===n||n.call(l),e.safeToRemove())})},e}return Object(i.c)(e,t),e.prototype.componentDidMount=function(){var t=this.props.visualElement;t.enableLayoutProjection(),this.unsubLayoutReady=t.onLayoutUpdate(this.animate)},e.prototype.componentWillUnmount=function(){var t=this;this.unsubLayoutReady(),In(function(e){var n,r;return null===(r=(n=t.stopAxisAnimation)[e])||void 0===r?void 0:r.call(n)})},e.prototype.animateAxis=function(t,e,n,r){var i,o,a=void 0===r?{}:r,u=a.transition,s=a.crossfadeOpacity;null===(o=(i=this.stopAxisAnimation)[t])||void 0===o||o.call(i);var c=this.props.visualElement,l=this.frameTarget[t],f=c.axisProgress[t];f.clearListeners(),f.set(0),f.set(0);var h=s&&this.createCrossfadeAnimation(s),d=function(){var r=f.get()/1e3;!function(t,e,n,r){t.min=Wt(e.min,n.min,r),t.max=Wt(e.max,n.max,r)}(l,n,e,r),c.setAxisTarget(t,l.min,l.max),null===h||void 0===h||h(r)};d();var p=Hn("x"===t?"layoutX":"layoutY",f,1e3,u||this.props.transition||bo),v=f.onChange(d);return this.stopAxisAnimation[t]=function(){f.stop(),v()},p},e.prototype.createCrossfadeAnimation=function(t){var e=this.props.visualElement.getValue("opacity",0);return function(n){e.set(xo(Wt(0,1,n))),t.set(ko(Wt(1,0,n)))}},e.prototype.safeToRemove=function(){var t,e;null===(e=(t=this.props).safeToRemove)||void 0===e||e.call(t)},e.prototype.render=function(){return null},e}(De.Component),go={key:"animate-layout",shouldRender:function(t){return!!t.layout||!!t.layoutId},Component:function(t){var e=cr()[1];return Object(De.createElement)(mo,Object(i.a)({},t,{safeToRemove:e}))}};function yo(t,e){return t.min!==e.min||t.max!==e.max}var bo={duration:.45,ease:[.4,0,.1,1]};function wo(t,e,n){return function(r){return r<t?0:r>e?1:n(zt(t,e,r))}}var xo=wo(0,.5,ht),ko=wo(.5,.95,ut),Eo=function(t){function e(e){var n=t.call(this,e)||this,r=e.syncLayout;return mi(r)||(n.componentDidUpdate=function(){return r.flush()}),n}return Object(i.c)(e,t),e.prototype.componentDidMount=function(){var t=this.props,e=t.syncLayout,n=t.visualElement;mi(e)&&e.register(n)},e.prototype.getSnapshotBeforeUpdate=function(){var t=this.props,e=t.syncLayout,n=t.visualElement;return mi(e)?e.syncUpdate():(n.snapshotBoundingBox(),e.add(n)),null},e.prototype.componentDidUpdate=function(){},e.prototype.render=function(){return null},e}(Ne.a.Component);function Co(t){var e={defaultFeatures:t,useVisualElement:dr,render:yr,animationControlsConfig:{makeTargetAnimatable:Mr}};var n=new Map;return new Proxy({custom:function(t){return bi(t,e)}},{get:function(t,r){return"custom"===r?t.custom:(n.has(r)||n.set(r,bi(r,e)),n.get(r))}})}var _o=Co([{key:"measure-layout",shouldRender:function(t){return!!t.drag||!!t.layout||!!t.layoutId},Component:function(t){var e=Object(De.useContext)(gi);return Ne.a.createElement(Eo,Object(i.a)({},t,{syncLayout:e}))}},io,po,vo,go]);function So(t,e){return e&&t!==e.lead?{visibilityAction:ui.Hide}:e&&t.presence!==ai.Entering&&t===e.lead&&e.lead!==e.prevLead?{visibilityAction:ui.Show}:(t.presence===ai.Entering?n=null===e||void 0===e?void 0:e.getFollowOrigin():t.presence===ai.Exiting&&(r=null===e||void 0===e?void 0:e.getFollowTarget()),{originBox:n,targetBox:r});var n,r}function To(t,e){var n,r,i,o={},a=e&&e.lead,u=null===a||void 0===a?void 0:a.presence;return e&&t===a?t.presence===ai.Entering?o.originBox=e.getFollowOrigin():t.presence===ai.Exiting&&(o.targetBox=e.getFollowTarget()):e&&t===e.follow&&(o.transition=e.getLeadTransition(),u===ai.Entering?o.targetBox=e.getLeadTarget():u===ai.Exiting&&(o.originBox=e.getLeadOrigin())),(null===(n=null===e||void 0===e?void 0:e.follow)||void 0===n?void 0:n.isPresenceRoot)||(null===a||void 0===a?void 0:a.isPresenceRoot)?(e&&t!==a?e&&t===e.follow?a&&u!==ai.Entering&&u===ai.Exiting&&(o.crossfadeOpacity=null===(i=null===e||void 0===e?void 0:e.lead)||void 0===i?void 0:i.getValue("opacity",1)):o.visibilityAction=ui.Hide:t.presence===ai.Entering&&(o.crossfadeOpacity=null===(r=null===e||void 0===e?void 0:e.follow)||void 0===r?void 0:r.getValue("opacity",0)),o):o}var Oo=function(){function t(){this.order=[],this.hasChildren=!1}return t.prototype.add=function(t){var e,n=t.config.layoutOrder;if(void 0===n)this.order.push(t);else{var r=this.order.findIndex(function(t){return n<=(t.config.layoutOrder||0)});-1===r&&(t.presence=this.hasChildren?ai.Entering:ai.Present,r=this.order.length),this.order.splice(r,0,t)}if(this.snapshot){t.prevSnapshot=this.snapshot,t.prevViewportBox=this.snapshot.boundingBox;var i=this.snapshot.latestMotionValues;for(var o in i)t.hasValue(o)?null===(e=t.getValue(o))||void 0===e||e.set(i[o]):t.addValue(o,Le(i[o]))}this.hasChildren=!0},t.prototype.remove=function(t){var e=this.order.findIndex(function(e){return t===e});-1!==e&&this.order.splice(e,1)},t.prototype.updateLeadAndFollow=function(){this.prevLead=this.lead,this.prevFollow=this.follow;var t=function(t,e){for(var n=e[0],r=e[1],i=void 0,o=0,a=void 0,u=t.length,s=!1,c=u-1;c>=0;c--){var l=t[c];if(c===u-1&&(s=l.isPresent),s)i=l;else{var f=t[c-1];f&&f.isPresent&&(i=l)}if(i){o=c;break}}if(i||(i=t[0]),a=t[o-1],i)for(c=o-1;c>=0;c--)if((l=t[c]).isPresent){a=l;break}return i!==n&&!s&&a===r&&t.find(function(t){return t===n})&&(i=n),[i,a]}(this.order,[this.lead,this.follow]),e=t[0],n=t[1];this.lead=e,this.follow=n},t.prototype.updateSnapshot=function(){if(this.lead){var t={boundingBox:this.lead.prevViewportBox,latestMotionValues:{}};this.lead.forEachValue(function(e,n){var r=e.get();rn(r)||(t.latestMotionValues[n]=r)});var e=eo.get(this.lead);e&&e.isDragging&&(t.isDragging=!0,t.cursorProgress=e.cursorProgress),this.snapshot=t}},t.prototype.isLeadPresent=function(){var t;return this.lead&&(null===(t=this.lead)||void 0===t?void 0:t.presence)!==ai.Exiting},t.prototype.shouldStackAnimate=function(){return!0},t.prototype.getFollowOrigin=function(){var t;return this.follow?this.follow.prevViewportBox:null===(t=this.snapshot)||void 0===t?void 0:t.boundingBox},t.prototype.getFollowTarget=function(){var t;return null===(t=this.follow)||void 0===t?void 0:t.box},t.prototype.getLeadOrigin=function(){var t;return null===(t=this.lead)||void 0===t?void 0:t.prevViewportBox},t.prototype.getLeadTarget=function(){var t;return null===(t=this.lead)||void 0===t?void 0:t.box},t.prototype.getLeadTransition=function(){var t;return null===(t=this.lead)||void 0===t?void 0:t.config.transition},t}();!function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.children=new Set,e.stacks=new Map,e.hasMounted=!1,e.updateScheduled=!1,e.renderScheduled=!1,e.syncContext=Object(i.a)(Object(i.a)({},vi()),{syncUpdate:function(t){return e.scheduleUpdate(t)},forceUpdate:function(){e.syncContext=Object(i.a)({},e.syncContext),e.scheduleUpdate(!0)},register:function(t){return e.addChild(t)},remove:function(t){return e.removeChild(t)}}),e}Object(i.c)(e,t),e.prototype.componentDidMount=function(){this.hasMounted=!0,this.updateStacks()},e.prototype.componentDidUpdate=function(){this.startLayoutAnimation()},e.prototype.shouldComponentUpdate=function(){return this.renderScheduled=!0,!0},e.prototype.startLayoutAnimation=function(){var t=this;this.renderScheduled=this.updateScheduled=!1;var e=this.props.type;this.children.forEach(function(t){t.isPresent?t.presence!==ai.Entering&&(t.presence=t.presence===ai.Exiting?ai.Entering:ai.Present):t.presence=ai.Exiting}),this.updateStacks();var n="crossfade"===e?To:So,r={measureLayout:function(t){return t.measureLayout()},layoutReady:function(e){var r=e.layoutId;e.layoutReady(n(e,t.getStack(r)))}};this.children.forEach(function(e){return t.syncContext.add(e)}),this.syncContext.flush(r),this.stacks.forEach(function(t){return t.snapshot=void 0})},e.prototype.updateStacks=function(){this.stacks.forEach(function(t){return t.updateLeadAndFollow()})},e.prototype.scheduleUpdate=function(t){void 0===t&&(t=!1),!t&&this.updateScheduled||(this.updateScheduled=!0,this.children.forEach(function(t){return t.snapshotBoundingBox()}),this.stacks.forEach(function(t){return t.updateSnapshot()}),!t&&this.renderScheduled||(this.renderScheduled=!0,this.forceUpdate()))},e.prototype.addChild=function(t){this.children.add(t),this.addToStack(t),t.presence=this.hasMounted?ai.Entering:ai.Present},e.prototype.removeChild=function(t){this.scheduleUpdate(),this.children.delete(t),this.removeFromStack(t)},e.prototype.addToStack=function(t){var e=this.getStack(t.layoutId);null===e||void 0===e||e.add(t)},e.prototype.removeFromStack=function(t){var e=this.getStack(t.layoutId);null===e||void 0===e||e.remove(t)},e.prototype.getStack=function(t){if(void 0!==t)return!this.stacks.has(t)&&this.stacks.set(t,new Oo),this.stacks.get(t)},e.prototype.render=function(){return Object(De.createElement)(gi.Provider,{value:this.syncContext},this.props.children)}}(De.Component);function Io(){return{scrollX:Le(0),scrollY:Le(0),scrollXProgress:Le(0),scrollYProgress:Le(0)}}"undefined"!==typeof window?De.useLayoutEffect:De.useEffect;Io();var Ro=Le(null);if("undefined"!==typeof window)if(window.matchMedia){var Ao=window.matchMedia("(prefers-reduced-motion)"),Do=function(){return Ro.set(Ao.matches)};Ao.addListener(Do),Do()}else Ro.set(!1);!function(){function t(){this.componentControls=new Set}t.prototype.subscribe=function(t){var e=this;return this.componentControls.add(t),function(){return e.componentControls.delete(t)}},t.prototype.start=function(t,e){this.componentControls.forEach(function(n){n.start(t.nativeEvent||t,e)})}}();!function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.initialState={},e}Object(i.c)(e,t),e.prototype.updateLayoutDelta=function(){},e.prototype.build=function(){},e.prototype.clean=function(){},e.prototype.getBoundingBox=function(){return{x:{min:0,max:0},y:{min:0,max:0}}},e.prototype.readNativeValue=function(t){return this.initialState[t]||0},e.prototype.render=function(){this.build()}}(je)},function(t,e,n){"use strict";function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.d(e,"a",function(){return r})},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"===typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var s,c=[],l=!1,f=-1;function h(){l&&s&&(l=!1,s.length?c=s.concat(c):f=-1,c.length&&d())}function d(){if(!l){var t=u(h);l=!0;for(var e=c.length;e;){for(s=c,c=[];++f<e;)s&&s[f].run();f=-1,e=c.length}s=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||l||u(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(25);function i(t,e,n){return(i=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&Object(r.a)(o,n.prototype),o}).apply(null,arguments)}},function(t,e,n){"use strict";function r(t){var e="";if(!t)try{t=n(53)}catch(r){e=r.toString()}return{readFile:t?function(e){return new Promise(function(n,r){t.readFile(e,function(t,e){return t?r(t):n(e)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return o});var r=n(0),i=n(28);function o(){var e=t.Canvas||t.HTMLCanvasElement,n=t.Image||t.HTMLImageElement,o=t.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=Object(i.a)();return Object(r.a)({Canvas:e||function(){return function(){}}(),CanvasRenderingContext2D:t.CanvasRenderingContext2D||function(){return function(){}}(),Image:n||function(){return function(){}}(),ImageData:t.ImageData||function(){return function(){}}(),Video:t.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},a)}}).call(this,n(23))},function(t,e,n){"use strict";(function(r,i){function o(){return"object"===typeof r&&"undefined"!==typeof t&&"undefined"!==typeof i&&!!i.version}n.d(e,"a",function(){return o})}).call(this,n(23),n(26))},function(t,e,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(t,e){for(var n,a,u=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),s=1;s<arguments.length;s++){for(var c in n=Object(arguments[s]))i.call(n,c)&&(u[c]=n[c]);if(r){a=r(n);for(var l=0;l<a.length;l++)o.call(n,a[l])&&(u[a[l]]=n[a[l]])}}return u}},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return _a}),n.d(e,"b",function(){return Sa}),n.d(e,"c",function(){return _u}),n.d(e,"d",function(){return Ra}),n.d(e,"e",function(){return Ou}),n.d(e,"f",function(){return yu}),n.d(e,"g",function(){return pu}),n.d(e,"h",function(){return Su}),n.d(e,"i",function(){return Tu}),n.d(e,"j",function(){return mu});var r=n(27),i=n(22),o=n(11),a=n(5),u=n(9),s=n(6),c=n(8),l=n(14),f=n(2),h=n(3),d=n(13),p=n(20),v=n(17),m=n(7),g=n(15);function y(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function w(){w=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(T){u=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new C(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=x(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(T){return{type:"throw",arg:T}}}t.wrap=s;var l={};function f(){}function h(){}function d(){}var p={};u(p,i,function(){return this});var v=Object.getPrototypeOf,m=v&&v(v(_([])));m&&m!==e&&n.call(m,i)&&(p=m);var g=d.prototype=f.prototype=Object.create(p);function y(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var r;this._invoke=function(i,o){function a(){return new e(function(r,a){!function r(i,o,a,u){var s=c(t[i],t,o);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then(function(t){r("next",t,a,u)},function(t){r("throw",t,a,u)}):e.resolve(f).then(function(t){l.value=t,a(l)},function(t){return r("throw",t,a,u)})}u(s.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=d,u(g,"constructor",d),u(d,"constructor",h),h.displayName=u(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},y(b.prototype),u(b.prototype,o,function(){return this}),t.AsyncIterator=b,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new b(s(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},y(g),u(g,a,"Generator"),u(g,i,function(){return this}),u(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var x="@firebase/firestore",k=function(){function t(e){Object(f.a)(this,t),this.uid=e}return Object(h.a)(t,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(t){return t.uid===this.uid}}]),t}();k.UNAUTHENTICATED=new k(null),k.GOOGLE_CREDENTIALS=new k("google-credentials-uid"),k.FIRST_PARTY=new k("first-party-uid"),k.MOCK_USER=new k("mock-user");var E="9.8.4",C=new v.b("@firebase/firestore");function _(){return C.logLevel}function S(t){if(C.logLevel<=v.a.DEBUG){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=n.map(I);C.debug.apply(C,["Firestore (".concat(E,"): ").concat(t)].concat(Object(l.a)(i)))}}function T(t){if(C.logLevel<=v.a.ERROR){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=n.map(I);C.error.apply(C,["Firestore (".concat(E,"): ").concat(t)].concat(Object(l.a)(i)))}}function O(t){if(C.logLevel<=v.a.WARN){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=n.map(I);C.warn.apply(C,["Firestore (".concat(E,"): ").concat(t)].concat(Object(l.a)(i)))}}function I(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function R(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",e="FIRESTORE (".concat(E,") INTERNAL ASSERTION FAILED: ")+t;throw T(e),new Error(e)}function A(t,e){t||R()}function D(t,e){return t}var N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},P=function(t){function e(t,n){var r;return Object(f.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this,t,n))).code=t,r.message=n,r.toString=function(){return"".concat(r.name,": [code=").concat(r.code,"]: ").concat(r.message)},r}return Object(c.a)(e,t),e}(m.c),M=function t(){var e=this;Object(f.a)(this,t),this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})},F=function t(e,n){Object(f.a)(this,t),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))},L=function(){function t(){Object(f.a)(this,t)}return Object(h.a)(t,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(t,e){t.enqueueRetryable(function(){return e(k.UNAUTHENTICATED)})}},{key:"shutdown",value:function(){}}]),t}(),j=function(){function t(e){Object(f.a)(this,t),this.t=e,this.currentUser=k.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return Object(h.a)(t,[{key:"start",value:function(t,e){var n=this,r=this.i,i=function(t){return n.i!==r?(r=n.i,e(t)):Promise.resolve()},o=new M;this.o=function(){n.i++,n.currentUser=n.u(),o.resolve(),o=new M,t.enqueueRetryable(function(){return i(n.currentUser)})};var u=function(){var e=o;t.enqueueRetryable(Object(a.a)(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.promise;case 2:return t.next=4,i(n.currentUser);case 4:case"end":return t.stop()}},t)})))},s=function(t){S("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=t,n.auth.addAuthTokenListener(n.o),u()};this.t.onInit(function(t){return s(t)}),setTimeout(function(){if(!n.auth){var t=n.t.getImmediate({optional:!0});t?s(t):(S("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new M)}},0),u()}},{key:"getToken",value:function(){var t=this,e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.i!==e?(S("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(A("string"==typeof n.accessToken),new F(n.accessToken,t.currentUser)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var t=this.auth&&this.auth.getUid();return A(null===t||"string"==typeof t),new k(t)}}]),t}(),B=function t(e,n,r){Object(f.a)(this,t),this.type="FirstParty",this.user=k.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=e.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)},V=function(){function t(e,n,r){Object(f.a)(this,t),this.h=e,this.l=n,this.m=r}return Object(h.a)(t,[{key:"getToken",value:function(){return Promise.resolve(new B(this.h,this.l,this.m))}},{key:"start",value:function(t,e){t.enqueueRetryable(function(){return e(k.FIRST_PARTY)})}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),t}(),U=function t(e){Object(f.a)(this,t),this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)},z=function(){function t(e){Object(f.a)(this,t),this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}return Object(h.a)(t,[{key:"start",value:function(t,e){var n=this,r=function(t){null!=t.error&&S("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(t.error.message));var r=t.token!==n.p;return n.p=t.token,S("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?e(t.token):Promise.resolve()};this.o=function(e){t.enqueueRetryable(function(){return r(e)})};var i=function(t){S("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=t,n.appCheck.addTokenListener(n.o)};this.g.onInit(function(t){return i(t)}),setTimeout(function(){if(!n.appCheck){var t=n.g.getImmediate({optional:!0});t?i(t):S("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}},{key:"getToken",value:function(){var t=this,e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(function(e){return e?(A("string"==typeof e.token),t.p=e.token,new U(e.token)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),t}();function W(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var G=function(){function t(){Object(f.a)(this,t)}return Object(h.a)(t,null,[{key:"I",value:function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=W(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n}}]),t}();function H(t,e){return t<e?-1:t>e?1:0}function q(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}var K=function(){function t(e,n){if(Object(f.a)(this,t),this.seconds=e,this.nanoseconds=n,n<0)throw new P(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new P(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new P(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new P(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}return Object(h.a)(t,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(t){return this.seconds===t.seconds?H(this.nanoseconds,t.nanoseconds):H(this.seconds,t.seconds)}},{key:"isEqual",value:function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return t.fromMillis(Date.now())}},{key:"fromDate",value:function(e){return t.fromMillis(e.getTime())}},{key:"fromMillis",value:function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))}}]),t}(),X=function(){function t(e){Object(f.a)(this,t),this.timestamp=e}return Object(h.a)(t,[{key:"compareTo",value:function(t){return this.timestamp._compareTo(t.timestamp)}},{key:"isEqual",value:function(t){return this.timestamp.isEqual(t.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(e){return new t(e)}},{key:"min",value:function(){return new t(new K(0,0))}},{key:"max",value:function(){return new t(new K(253402300799,999999999))}}]),t}(),Y=function(){function t(e,n,r){Object(f.a)(this,t),void 0===n?n=0:n>e.length&&R(),void 0===r?r=e.length-n:r>e.length-n&&R(),this.segments=e,this.offset=n,this.len=r}return Object(h.a)(t,[{key:"isEqual",value:function(e){return 0===t.comparator(this,e)}},{key:"child",value:function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(t){return this.segments[this.offset+t]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}},{key:"isImmediateParentOf",value:function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}},{key:"forEach",value:function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}},{key:"length",get:function(){return this.len}}],[{key:"comparator",value:function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}]),t}(),Q=function(t){function e(){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"construct",value:function(t,n,r){return new e(t,n,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var t=[],n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var o=0,a=r;o<a.length;o++){var u=a[o];if(u.indexOf("//")>=0)throw new P(N.INVALID_ARGUMENT,"Invalid segment (".concat(u,"). Paths must not contain // in them."));t.push.apply(t,Object(l.a)(u.split("/").filter(function(t){return t.length>0})))}return new e(t)}},{key:"emptyPath",value:function(){return new e([])}}]),e}(Y),$=/^[_a-zA-Z][_a-zA-Z0-9]*$/,J=function(t){function e(){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"construct",value:function(t,n,r){return new e(t,n,r)}},{key:"canonicalString",value:function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(t){return $.test(t)}},{key:"keyField",value:function(){return new e(["__name__"])}},{key:"fromServerFormat",value:function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new P(N.INVALID_ARGUMENT,"Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));n.push(r),r=""},a=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new P(N.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new P(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=s,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new P(N.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)}},{key:"emptyPath",value:function(){return new e([])}}]),e}(Y),Z=function(){function t(e){Object(f.a)(this,t),this.path=e}return Object(h.a)(t,[{key:"hasCollectionId",value:function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(t){return null!==t&&0===Q.comparator(this.path,t.path)}},{key:"toString",value:function(){return this.path.toString()}},{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}}],[{key:"fromPath",value:function(e){return new t(Q.fromString(e))}},{key:"fromName",value:function(e){return new t(Q.fromString(e).popFirst(5))}},{key:"empty",value:function(){return new t(Q.emptyPath())}},{key:"comparator",value:function(t,e){return Q.comparator(t.path,e.path)}},{key:"isDocumentKey",value:function(t){return t.length%2==0}},{key:"fromSegments",value:function(e){return new t(new Q(e.slice()))}}]),t}(),tt=function t(e,n,r,i){Object(f.a)(this,t),this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i};tt.UNKNOWN_ID=-1;function et(t,e){var n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=X.fromTimestamp(1e9===r?new K(n+1,0):new K(n,r));return new rt(i,Z.empty(),e)}function nt(t){return new rt(t.readTime,t.key,-1)}var rt=function(){function t(e,n,r){Object(f.a)(this,t),this.readTime=e,this.documentKey=n,this.largestBatchId=r}return Object(h.a)(t,null,[{key:"min",value:function(){return new t(X.min(),Z.empty(),-1)}},{key:"max",value:function(){return new t(X.max(),Z.empty(),-1)}}]),t}();function it(t,e){var n=t.readTime.compareTo(e.readTime);return 0!==n?n:0!==(n=Z.comparator(t.documentKey,e.documentKey))?n:H(t.largestBatchId,e.largestBatchId)}var ot="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",at=function(){function t(){Object(f.a)(this,t),this.onCommittedListeners=[]}return Object(h.a)(t,[{key:"addOnCommittedListener",value:function(t){this.onCommittedListeners.push(t)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach(function(t){return t()})}}]),t}();function ut(t){return st.apply(this,arguments)}function st(){return(st=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.code===N.FAILED_PRECONDITION&&e.message===ot){t.next=2;break}throw e;case 2:S("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return t.stop()}},t)}))).apply(this,arguments)}var ct=function(){function t(e){var n=this;Object(f.a)(this,t),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(t){n.isDone=!0,n.result=t,n.nextCallback&&n.nextCallback(t)},function(t){n.isDone=!0,n.error=t,n.catchCallback&&n.catchCallback(t)})}return Object(h.a)(t,[{key:"catch",value:function(t){return this.next(void 0,t)}},{key:"next",value:function(e,n){var r=this;return this.callbackAttached&&R(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})}},{key:"toPromise",value:function(){var t=this;return new Promise(function(e,n){t.next(e,n)})}},{key:"wrapUserFunction",value:function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}}},{key:"wrapSuccess",value:function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)}},{key:"wrapFailure",value:function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)}}],[{key:"resolve",value:function(e){return new t(function(t,n){t(e)})}},{key:"reject",value:function(e){return new t(function(t,n){n(e)})}},{key:"waitFor",value:function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})}},{key:"or",value:function(e){var n,r=t.resolve(!1),i=y(e);try{var o=function(){var e=n.value;r=r.next(function(n){return n?t.resolve(n):e()})};for(i.s();!(n=i.n()).done;)o()}catch(a){i.e(a)}finally{i.f()}return r}},{key:"forEach",value:function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)}},{key:"mapArray",value:function(e,n){return new t(function(t,r){for(var i=e.length,o=new Array(i),a=0,u=function(u){var s=u;n(e[s]).next(function(e){o[s]=e,++a===i&&t(o)},function(t){return r(t)})},s=0;s<i;s++)u(s)})}},{key:"doWhile",value:function(e,n){return new t(function(t,r){!function i(){!0===e()?n().next(function(){i()},r):t()}()})}}]),t}();function lt(t){return"IndexedDbTransactionError"===t.name}var ft=function(){function t(e,n){var r=this;Object(f.a)(this,t),this.previousValue=e,n&&(n.sequenceNumberHandler=function(t){return r.it(t)},this.rt=function(t){return n.writeSequenceNumber(t)})}return Object(h.a)(t,[{key:"it",value:function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}},{key:"next",value:function(){var t=++this.previousValue;return this.rt&&this.rt(t),t}}]),t}();function ht(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function dt(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function pt(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}ft.ot=-1;var vt=function(){function t(e,n){Object(f.a)(this,t),this.comparator=e,this.root=n||gt.EMPTY}return Object(h.a)(t,[{key:"insert",value:function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,gt.BLACK,null,null))}},{key:"remove",value:function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,gt.BLACK,null,null))}},{key:"get",value:function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}},{key:"indexOf",value:function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(t){return this.root.inorderTraversal(t)}},{key:"forEach",value:function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})}},{key:"toString",value:function(){var t=[];return this.inorderTraversal(function(e,n){return t.push("".concat(e,":").concat(n)),!1}),"{".concat(t.join(", "),"}")}},{key:"reverseTraversal",value:function(t){return this.root.reverseTraversal(t)}},{key:"getIterator",value:function(){return new mt(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(t){return new mt(this.root,t,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new mt(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(t){return new mt(this.root,t,this.comparator,!0)}},{key:"size",get:function(){return this.root.size}}]),t}(),mt=function(){function t(e,n,r,i){Object(f.a)(this,t),this.isReverse=i,this.nodeStack=[];for(var o=1;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(0===o){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}return Object(h.a)(t,[{key:"getNext",value:function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}]),t}(),gt=function(){function t(e,n,r,i,o){Object(f.a)(this,t),this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return Object(h.a)(t,[{key:"copy",value:function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}},{key:"reverseTraversal",value:function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}},{key:"moveRedLeft",value:function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t}},{key:"moveRedRight",value:function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t}},{key:"rotateLeft",value:function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}},{key:"rotateRight",value:function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}},{key:"colorFlip",value:function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}},{key:"checkMaxDepth",value:function(){var t=this.check();return Math.pow(2,t)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw R();if(this.right.isRed())throw R();var t=this.left.check();if(t!==this.right.check())throw R();return t+(this.isRed()?0:1)}}]),t}();gt.EMPTY=null,gt.RED=!0,gt.BLACK=!1,gt.EMPTY=new(function(){function t(){Object(f.a)(this,t),this.size=0}return Object(h.a)(t,[{key:"copy",value:function(t,e,n,r,i){return this}},{key:"insert",value:function(t,e,n){return new gt(t,e)}},{key:"remove",value:function(t,e){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(t){return!1}},{key:"reverseTraversal",value:function(t){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}},{key:"key",get:function(){throw R()}},{key:"value",get:function(){throw R()}},{key:"color",get:function(){throw R()}},{key:"left",get:function(){throw R()}},{key:"right",get:function(){throw R()}}]),t}());var yt=function(){function t(e){Object(f.a)(this,t),this.comparator=e,this.data=new vt(this.comparator)}return Object(h.a)(t,[{key:"has",value:function(t){return null!==this.data.get(t)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"indexOf",value:function(t){return this.data.indexOf(t)}},{key:"forEach",value:function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})}},{key:"forEachInRange",value:function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}},{key:"forEachWhile",value:function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}},{key:"getIterator",value:function(){return new bt(this.data.getIterator())}},{key:"getIteratorFrom",value:function(t){return new bt(this.data.getIteratorFrom(t))}},{key:"add",value:function(t){return this.copy(this.data.remove(t).insert(t,!0))}},{key:"delete",value:function(t){return this.has(t)?this.copy(this.data.remove(t)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e}},{key:"isEqual",value:function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0}},{key:"toArray",value:function(){var t=[];return this.forEach(function(e){t.push(e)}),t}},{key:"toString",value:function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"}},{key:"copy",value:function(e){var n=new t(this.comparator);return n.data=e,n}},{key:"size",get:function(){return this.data.size}}]),t}(),bt=function(){function t(e){Object(f.a)(this,t),this.iter=e}return Object(h.a)(t,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),t}();var wt=function(){function t(e){Object(f.a)(this,t),this.fields=e,e.sort(J.comparator)}return Object(h.a)(t,[{key:"unionWith",value:function(e){var n,r=new yt(J.comparator),i=y(this.fields);try{for(i.s();!(n=i.n()).done;){var o=n.value;r=r.add(o)}}catch(c){i.e(c)}finally{i.f()}var a,u=y(e);try{for(u.s();!(a=u.n()).done;){var s=a.value;r=r.add(s)}}catch(c){u.e(c)}finally{u.f()}return new t(r.toArray())}},{key:"covers",value:function(t){var e,n=y(this.fields);try{for(n.s();!(e=n.n()).done;){if(e.value.isPrefixOf(t))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(t){return q(this.fields,t.fields,function(t,e){return t.isEqual(e)})}}],[{key:"empty",value:function(){return new t([])}}]),t}();var xt=function(){function t(e){Object(f.a)(this,t),this.binaryString=e}return Object(h.a)(t,[{key:Symbol.iterator,value:function(){var t=this,e=0;return{next:function(){return e<t.binaryString.length?{value:t.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return t=this.binaryString,btoa(t);var t}},{key:"toUint8Array",value:function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(t){return H(this.binaryString,t.binaryString)}},{key:"isEqual",value:function(t){return this.binaryString===t.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))}}]),t}();xt.EMPTY_BYTE_STRING=new xt("");var kt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Et(t){if(A(!!t),"string"==typeof t){var e=0,n=kt.exec(t);if(A(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ct(t.seconds),nanos:Ct(t.nanos)}}function Ct(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _t(t){return"string"==typeof t?xt.fromBase64String(t):xt.fromUint8Array(t)}function St(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Tt(t){var e=Et(t.mapValue.fields.__local_write_time__.timestampValue);return new K(e.seconds,e.nanos)}var Ot=function t(e,n,r,i,o,a,u,s){Object(f.a)(this,t),this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.useFetchStreams=s},It=function(){function t(e,n){Object(f.a)(this,t),this.projectId=e,this.database=n||"(default)"}return Object(h.a)(t,[{key:"isEqual",value:function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database}},{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}}],[{key:"empty",value:function(){return new t("","")}}]),t}();function Rt(t){return null==t}function At(t){return 0===t&&1/t==-1/0}function Dt(t){return"number"==typeof t&&Number.isInteger(t)&&!At(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Nt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Pt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?St(t)?4:Kt(t)?9007199254740991:10:R()}function Mt(t,e){if(t===e)return!0;var n=Pt(t);if(n!==Pt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Tt(t).isEqual(Tt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Et(t.timestampValue),r=Et(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return _t(t.bytesValue).isEqual(_t(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ct(t.geoPointValue.latitude)===Ct(e.geoPointValue.latitude)&&Ct(t.geoPointValue.longitude)===Ct(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ct(t.integerValue)===Ct(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ct(t.doubleValue),r=Ct(e.doubleValue);return n===r?At(n)===At(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return q(t.arrayValue.values||[],e.arrayValue.values||[],Mt);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ht(n)!==ht(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Mt(n[i],r[i])))return!1;return!0}(t,e);default:return R()}}function Ft(t,e){return void 0!==(t.values||[]).find(function(t){return Mt(t,e)})}function Lt(t,e){if(t===e)return 0;var n=Pt(t),r=Pt(e);if(n!==r)return H(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return H(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ct(t.integerValue||t.doubleValue),r=Ct(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return jt(t.timestampValue,e.timestampValue);case 4:return jt(Tt(t),Tt(e));case 5:return H(t.stringValue,e.stringValue);case 6:return function(t,e){var n=_t(t),r=_t(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=H(n[i],r[i]);if(0!==o)return o}return H(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=H(Ct(t.latitude),Ct(e.latitude));return 0!==n?n:H(Ct(t.longitude),Ct(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Lt(n[i],r[i]);if(o)return o}return H(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Nt.mapValue&&e===Nt.mapValue)return 0;if(t===Nt.mapValue)return 1;if(e===Nt.mapValue)return-1;var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var a=0;a<r.length&&a<o.length;++a){var u=H(r[a],o[a]);if(0!==u)return u;var s=Lt(n[r[a]],i[o[a]]);if(0!==s)return s}return H(r.length,o.length)}(t.mapValue,e.mapValue);default:throw R()}}function jt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return H(t,e);var n=Et(t),r=Et(e),i=H(n.seconds,r.seconds);return 0!==i?i:H(n.nanos,r.nanos)}function Bt(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Et(t);return"time(".concat(e.seconds,",").concat(e.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?_t(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,Z.fromName(r).toString()):"geoPointValue"in e?"geo(".concat((n=e.geoPointValue).latitude,",").concat(n.longitude,")"):"arrayValue"in e?function(e){var n,r="[",i=!0,o=y(e.values||[]);try{for(o.s();!(n=o.n()).done;){var a=n.value;i?i=!1:r+=",",r+=t(a)}}catch(u){o.e(u)}finally{o.f()}return r+"]"}(e.arrayValue):"mapValue"in e?function(e){var n,r=Object.keys(e.fields||{}).sort(),i="{",o=!0,a=y(r);try{for(a.s();!(n=a.n()).done;){var u=n.value;o?o=!1:i+=",",i+="".concat(u,":").concat(t(e.fields[u]))}}catch(s){a.e(s)}finally{a.f()}return i+"}"}(e.mapValue):R();var n,r}(t)}function Vt(t,e){return{referenceValue:"projects/".concat(t.projectId,"/databases/").concat(t.database,"/documents/").concat(e.path.canonicalString())}}function Ut(t){return!!t&&"integerValue"in t}function zt(t){return!!t&&"arrayValue"in t}function Wt(t){return!!t&&"nullValue"in t}function Gt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ht(t){return!!t&&"mapValue"in t}function qt(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return dt(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=qt(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=qt(t.arrayValue.values[r]);return n}return Object.assign({},t)}function Kt(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}var Xt=function(){function t(e){Object(f.a)(this,t),this.value=e}return Object(h.a)(t,[{key:"field",value:function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ht(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null}},{key:"set",value:function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=qt(e)}},{key:"setAll",value:function(t){var e=this,n=J.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var a=e.getFieldsMap(n);e.applyChanges(a,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=qt(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)}},{key:"delete",value:function(t){var e=this.field(t.popLast());Ht(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}},{key:"isEqual",value:function(t){return Mt(this.value,t.value)}},{key:"getFieldsMap",value:function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ht(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}},{key:"applyChanges",value:function(t,e,n){dt(e,function(e,n){return t[e]=n});var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;delete t[o]}}catch(a){i.e(a)}finally{i.f()}}},{key:"clone",value:function(){return new t(qt(this.value))}}],[{key:"empty",value:function(){return new t({mapValue:{}})}}]),t}();function Yt(t){var e=[];return dt(t.fields,function(t,n){var r=new J([t]);if(Ht(n)){var i=Yt(n.mapValue).fields;if(0===i.length)e.push(r);else{var o,a=y(i);try{for(a.s();!(o=a.n()).done;){var u=o.value;e.push(r.child(u))}}catch(s){a.e(s)}finally{a.f()}}}else e.push(r)}),new wt(e)}var Qt=function(){function t(e,n,r,i,o,a){Object(f.a)(this,t),this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.data=o,this.documentState=a}return Object(h.a)(t,[{key:"convertToFoundDocument",value:function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}},{key:"convertToNoDocument",value:function(t){return this.version=t,this.documentType=2,this.data=Xt.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(t){return this.version=t,this.documentType=3,this.data=Xt.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=X.min(),this}},{key:"setReadTime",value:function(t){return this.readTime=t,this}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}},{key:"mutableCopy",value:function(){return new t(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}}],[{key:"newInvalidDocument",value:function(e){return new t(e,0,X.min(),X.min(),Xt.empty(),0)}},{key:"newFoundDocument",value:function(e,n,r){return new t(e,1,n,X.min(),r,0)}},{key:"newNoDocument",value:function(e,n){return new t(e,2,n,X.min(),Xt.empty(),0)}},{key:"newUnknownDocument",value:function(e,n){return new t(e,3,n,X.min(),Xt.empty(),2)}}]),t}(),$t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;Object(f.a)(this,t),this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.ut=null};function Jt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new $t(t,e,n,r,i,o,a)}function Zt(t){var e=D(t);if(null===e.ut){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return(e=t).field.canonicalString()+e.op.toString()+Bt(e.value);var e}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Rt(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(function(t){return Bt(t)}).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(function(t){return Bt(t)}).join(",")),e.ut=n}return e.ut}function te(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!de(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Mt(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ve(t.startAt,e.startAt)&&ve(t.endAt,e.endAt)}function ee(t){return Z.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var ne=function(t){function e(t,n,r){var i;return Object(f.a)(this,e),(i=Object(u.a)(this,Object(s.a)(e).call(this))).field=t,i.op=n,i.value=r,i}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.at(Lt(e,this.value)):null!==e&&Pt(this.value)===Pt(e)&&this.at(Lt(e,this.value))}},{key:"at",value:function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return R()}}},{key:"ht",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.ct(t,n,r):new re(t,n,r):"array-contains"===n?new ue(t,r):"in"===n?new se(t,r):"not-in"===n?new ce(t,r):"array-contains-any"===n?new le(t,r):new e(t,n,r)}},{key:"ct",value:function(t,e,n){return"in"===e?new ie(t,n):new oe(t,n)}}]),e}(function(){return function t(){Object(f.a)(this,t)}}()),re=function(t){function e(t,n,r){var i;return Object(f.a)(this,e),(i=Object(u.a)(this,Object(s.a)(e).call(this,t,n,r))).key=Z.fromName(r.referenceValue),i}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){var e=Z.comparator(t.key,this.key);return this.at(e)}}]),e}(ne),ie=function(t){function e(t,n){var r;return Object(f.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this,t,"in",n))).keys=ae("in",n),r}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){return this.keys.some(function(e){return e.isEqual(t.key)})}}]),e}(ne),oe=function(t){function e(t,n){var r;return Object(f.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this,t,"not-in",n))).keys=ae("not-in",n),r}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})}}]),e}(ne);function ae(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Z.fromName(t.referenceValue)})}var ue=function(t){function e(t,n){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).call(this,t,"array-contains",n))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){var e=t.data.field(this.field);return zt(e)&&Ft(e.arrayValue,this.value)}}]),e}(ne),se=function(t){function e(t,n){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).call(this,t,"in",n))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){var e=t.data.field(this.field);return null!==e&&Ft(this.value.arrayValue,e)}}]),e}(ne),ce=function(t){function e(t,n){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).call(this,t,"not-in",n))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){if(Ft(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Ft(this.value.arrayValue,e)}}]),e}(ne),le=function(t){function e(t,n){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).call(this,t,"array-contains-any",n))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"matches",value:function(t){var e=this,n=t.data.field(this.field);return!(!zt(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Ft(e.value.arrayValue,t)})}}]),e}(ne),fe=function t(e,n){Object(f.a)(this,t),this.position=e,this.inclusive=n},he=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";Object(f.a)(this,t),this.field=e,this.dir=n};function de(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function pe(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],a=t.position[i];if(r=o.field.isKeyField()?Z.comparator(Z.fromName(a.referenceValue),n.key):Lt(a,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return r}function ve(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Mt(t.position[n],e.position[n]))return!1;return!0}var me=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;Object(f.a)(this,t),this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=s,this.lt=null,this.ft=null,this.startAt,this.endAt};function ge(t,e,n,r,i,o,a,u){return new me(t,e,n,r,i,o,a,u)}function ye(t){return new me(t)}function be(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function we(t){var e,n=y(t.filters);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.ht())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function xe(t){return null!==t.collectionGroup}function ke(t){var e=D(t);if(null===e.lt){e.lt=[];var n=we(e),r=be(e);if(null!==n&&null===r)n.isKeyField()||e.lt.push(new he(n)),e.lt.push(new he(J.keyField(),"asc"));else{var i,o=!1,a=y(e.explicitOrderBy);try{for(a.s();!(i=a.n()).done;){var u=i.value;e.lt.push(u),u.field.isKeyField()&&(o=!0)}}catch(c){a.e(c)}finally{a.f()}if(!o){var s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new he(J.keyField(),s))}}}return e.lt}function Ee(t){var e=D(t);if(!e.ft)if("F"===e.limitType)e.ft=Jt(e.path,e.collectionGroup,ke(e),e.filters,e.limit,e.startAt,e.endAt);else{var n,r=[],i=y(ke(e));try{for(i.s();!(n=i.n()).done;){var o=n.value,a="desc"===o.dir?"asc":"desc";r.push(new he(o.field,a))}}catch(c){i.e(c)}finally{i.f()}var u=e.endAt?new fe(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new fe(e.startAt.position,e.startAt.inclusive):null;e.ft=Jt(e.path,e.collectionGroup,r,e.filters,e.limit,u,s)}return e.ft}function Ce(t,e,n){return new me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function _e(t,e){return te(Ee(t),Ee(e))&&t.limitType===e.limitType}function Se(t){return"".concat(Zt(Ee(t)),"|lt:").concat(t.limitType)}function Te(t){return"Query(target=".concat(function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: [".concat(t.filters.map(function(t){return"".concat((e=t).field.canonicalString()," ").concat(e.op," ").concat(Bt(e.value));var e}).join(", "),"]")),Rt(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: [".concat(t.orderBy.map(function(t){return function(t){return"".concat(t.field.canonicalString()," (").concat(t.dir,")")}(t)}).join(", "),"]")),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(function(t){return Bt(t)}).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(function(t){return Bt(t)}).join(",")),"Target(".concat(e,")")}(Ee(t)),"; limitType=").concat(t.limitType,")")}function Oe(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Z.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){var n,r=y(t.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}}catch(o){r.e(o)}finally{r.f()}return!0}(t,e)&&function(t,e){var n,r=y(t.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(e))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){var r=pe(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,ke(t),e))&&!(t.endAt&&!function(t,e,n){var r=pe(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,ke(t),e))}(t,e)}function Ie(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Re(t){return function(e,n){var r,i=!1,o=y(ke(t));try{for(o.s();!(r=o.n()).done;){var a=r.value,u=Ae(a,e,n);if(0!==u)return u;i=i||a.field.isKeyField()}}catch(s){o.e(s)}finally{o.f()}return 0}}function Ae(t,e,n){var r=t.field.isKeyField()?Z.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Lt(r,i):R()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return R()}}function De(t,e){if(t.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:At(e)?"-0":e}}function Ne(t){return{integerValue:""+t}}function Pe(t,e){return Dt(e)?Ne(e):De(t,e)}var Me=function t(){Object(f.a)(this,t),this._=void 0};function Fe(t,e,n){return t instanceof Be?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ve?Ue(t,e):t instanceof ze?We(t,e):function(t,e){var n=je(t,e),r=He(n)+He(t._t);return Ut(n)&&Ut(t._t)?Ne(r):De(t.wt,r)}(t,e)}function Le(t,e,n){return t instanceof Ve?Ue(t,e):t instanceof ze?We(t,e):n}function je(t,e){return t instanceof Ge?Ut(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var Be=function(t){function e(){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(c.a)(e,t),e}(Me),Ve=function(t){function e(t){var n;return Object(f.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this))).elements=t,n}return Object(c.a)(e,t),e}(Me);function Ue(t,e){var n,r=qe(e),i=y(t.elements);try{var o=function(){var t=n.value;r.some(function(e){return Mt(e,t)})||r.push(t)};for(i.s();!(n=i.n()).done;)o()}catch(a){i.e(a)}finally{i.f()}return{arrayValue:{values:r}}}var ze=function(t){function e(t){var n;return Object(f.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this))).elements=t,n}return Object(c.a)(e,t),e}(Me);function We(t,e){var n,r=qe(e),i=y(t.elements);try{var o=function(){var t=n.value;r=r.filter(function(e){return!Mt(e,t)})};for(i.s();!(n=i.n()).done;)o()}catch(a){i.e(a)}finally{i.f()}return{arrayValue:{values:r}}}var Ge=function(t){function e(t,n){var r;return Object(f.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this))).wt=t,r._t=n,r}return Object(c.a)(e,t),e}(Me);function He(t){return Ct(t.integerValue||t.doubleValue)}function qe(t){return zt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ke=function t(e,n){Object(f.a)(this,t),this.version=e,this.transformResults=n},Xe=function(){function t(e,n){Object(f.a)(this,t),this.updateTime=e,this.exists=n}return Object(h.a)(t,[{key:"isEqual",value:function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}},{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}}],[{key:"none",value:function(){return new t}},{key:"exists",value:function(e){return new t(void 0,e)}},{key:"updateTime",value:function(e){return new t(e)}}]),t}();function Ye(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Qe=function t(){Object(f.a)(this,t)};function $e(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new ln(t.key,Xe.none()):new nn(t.key,t.data,Xe.none());var n,r=t.data,i=Xt.empty(),o=new yt(J.comparator),a=y(e.fields);try{for(a.s();!(n=a.n()).done;){var u=n.value;if(!o.has(u)){var s=r.field(u);null===s&&u.length>1&&(u=u.popLast(),s=r.field(u)),null===s?i.delete(u):i.set(u,s),o=o.add(u)}}}catch(c){a.e(c)}finally{a.f()}return new rn(t.key,i,new wt(o.toArray()),Xe.none())}function Je(t,e,n){t instanceof nn?function(t,e,n){var r=t.value.clone(),i=an(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof rn?function(t,e,n){if(Ye(t.precondition,e)){var r=an(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(on(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ze(t,e,n,r){return t instanceof nn?function(t,e,n,r){if(!Ye(t.precondition,e))return n;var i=t.value.clone(),o=un(t.fieldTransforms,r,e);return i.setAll(o),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof rn?function(t,e,n,r){if(!Ye(t.precondition,e))return n;var i=un(t.fieldTransforms,r,e),o=e.data;return o.setAll(on(t)),o.setAll(i),e.convertToFoundDocument(e.version,o).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(function(t){return t.field}))}(t,e,n,r):function(t,e,n){return Ye(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function tn(t,e){var n,r=null,i=y(t.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=e.data.field(o.field),u=je(o.transform,a||null);null!=u&&(null===r&&(r=Xt.empty()),r.set(o.field,u))}}catch(s){i.e(s)}finally{i.f()}return r||null}function en(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&q(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ve&&e instanceof Ve||t instanceof ze&&e instanceof ze?q(t.elements,e.elements,Mt):t instanceof Ge&&e instanceof Ge?Mt(t._t,e._t):t instanceof Be&&e instanceof Be}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}var nn=function(t){function e(t,n,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return Object(f.a)(this,e),(i=Object(u.a)(this,Object(s.a)(e).call(this))).key=t,i.value=n,i.precondition=r,i.fieldTransforms=o,i.type=0,i}return Object(c.a)(e,t),Object(h.a)(e,[{key:"getFieldMask",value:function(){return null}}]),e}(Qe),rn=function(t){function e(t,n,r,i){var o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return Object(f.a)(this,e),(o=Object(u.a)(this,Object(s.a)(e).call(this))).key=t,o.data=n,o.fieldMask=r,o.precondition=i,o.fieldTransforms=a,o.type=1,o}return Object(c.a)(e,t),Object(h.a)(e,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),e}(Qe);function on(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function an(t,e,n){var r=new Map;A(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,Le(a,u,n[i]))}return r}function un(t,e,n){var r,i=new Map,o=y(t);try{for(o.s();!(r=o.n()).done;){var a=r.value,u=a.transform,s=n.data.field(a.field);i.set(a.field,Fe(u,s,e))}}catch(c){o.e(c)}finally{o.f()}return i}var sn,cn,ln=function(t){function e(t,n){var r;return Object(f.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this))).key=t,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(c.a)(e,t),Object(h.a)(e,[{key:"getFieldMask",value:function(){return null}}]),e}(Qe),fn=function(t){function e(t,n){var r;return Object(f.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this))).key=t,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(c.a)(e,t),Object(h.a)(e,[{key:"getFieldMask",value:function(){return null}}]),e}(Qe),hn=function t(e){Object(f.a)(this,t),this.count=e};function dn(t){switch(t){default:return R();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0}}function pn(t){if(void 0===t)return T("GRPC error has no .code"),N.UNKNOWN;switch(t){case sn.OK:return N.OK;case sn.CANCELLED:return N.CANCELLED;case sn.UNKNOWN:return N.UNKNOWN;case sn.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case sn.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case sn.INTERNAL:return N.INTERNAL;case sn.UNAVAILABLE:return N.UNAVAILABLE;case sn.UNAUTHENTICATED:return N.UNAUTHENTICATED;case sn.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case sn.NOT_FOUND:return N.NOT_FOUND;case sn.ALREADY_EXISTS:return N.ALREADY_EXISTS;case sn.PERMISSION_DENIED:return N.PERMISSION_DENIED;case sn.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case sn.ABORTED:return N.ABORTED;case sn.OUT_OF_RANGE:return N.OUT_OF_RANGE;case sn.UNIMPLEMENTED:return N.UNIMPLEMENTED;case sn.DATA_LOSS:return N.DATA_LOSS;default:return R()}}(cn=sn||(sn={}))[cn.OK=0]="OK",cn[cn.CANCELLED=1]="CANCELLED",cn[cn.UNKNOWN=2]="UNKNOWN",cn[cn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",cn[cn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",cn[cn.NOT_FOUND=5]="NOT_FOUND",cn[cn.ALREADY_EXISTS=6]="ALREADY_EXISTS",cn[cn.PERMISSION_DENIED=7]="PERMISSION_DENIED",cn[cn.UNAUTHENTICATED=16]="UNAUTHENTICATED",cn[cn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",cn[cn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",cn[cn.ABORTED=10]="ABORTED",cn[cn.OUT_OF_RANGE=11]="OUT_OF_RANGE",cn[cn.UNIMPLEMENTED=12]="UNIMPLEMENTED",cn[cn.INTERNAL=13]="INTERNAL",cn[cn.UNAVAILABLE=14]="UNAVAILABLE",cn[cn.DATA_LOSS=15]="DATA_LOSS";var vn=function(){function t(e,n){Object(f.a)(this,t),this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}return Object(h.a)(t,[{key:"get",value:function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=Object(o.a)(r.value,2),u=a[0],s=a[1];if(this.equalsFn(u,t))return s}}catch(c){i.e(c)}finally{i.f()}}}},{key:"has",value:function(t){return void 0!==this.get(t)}},{key:"set",value:function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e]),this.innerSize++}},{key:"delete",value:function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(t){dt(this.inner,function(e,n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=Object(o.a)(r.value,2),u=a[0],s=a[1];t(u,s)}}catch(c){i.e(c)}finally{i.f()}})}},{key:"isEmpty",value:function(){return pt(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),t}(),mn=new vt(Z.comparator);function gn(){return mn}var yn=new vt(Z.comparator);function bn(){for(var t=yn,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];t=t.insert(a.key,a)}return t}function wn(t){var e=yn;return t.forEach(function(t,n){return e=e.insert(t,n.overlayedDocument)}),e}function xn(){return En()}function kn(){return En()}function En(){return new vn(function(t){return t.toString()},function(t,e){return t.isEqual(e)})}var Cn=new vt(Z.comparator),_n=new yt(Z.comparator);function Sn(){for(var t=_n,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];t=t.add(a)}return t}var Tn=new yt(H);function On(){return Tn}var In=function(){function t(e,n,r,i,o){Object(f.a)(this,t),this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}return Object(h.a)(t,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(e,n){var r=new Map;return r.set(e,Rn.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(X.min(),r,On(),gn(),Sn())}}]),t}(),Rn=function(){function t(e,n,r,i,o){Object(f.a)(this,t),this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}return Object(h.a)(t,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(e,n){return new t(xt.EMPTY_BYTE_STRING,n,Sn(),Sn(),Sn())}}]),t}(),An=function t(e,n,r,i){Object(f.a)(this,t),this.gt=e,this.removedTargetIds=n,this.key=r,this.yt=i},Dn=function t(e,n){Object(f.a)(this,t),this.targetId=e,this.It=n},Nn=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xt.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(f.a)(this,t),this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i},Pn=function(){function t(){Object(f.a)(this,t),this.Tt=0,this.Et=Ln(),this.At=xt.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}return Object(h.a)(t,[{key:"Vt",value:function(t){t.approximateByteSize()>0&&(this.bt=!0,this.At=t)}},{key:"St",value:function(){var t=Sn(),e=Sn(),n=Sn();return this.Et.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:R()}}),new Rn(this.At,this.Rt,t,e,n)}},{key:"Dt",value:function(){this.bt=!1,this.Et=Ln()}},{key:"Ct",value:function(t,e){this.bt=!0,this.Et=this.Et.insert(t,e)}},{key:"xt",value:function(t){this.bt=!0,this.Et=this.Et.remove(t)}},{key:"Nt",value:function(){this.Tt+=1}},{key:"kt",value:function(){this.Tt-=1}},{key:"Ot",value:function(){this.bt=!0,this.Rt=!0}},{key:"current",get:function(){return this.Rt}},{key:"resumeToken",get:function(){return this.At}},{key:"Pt",get:function(){return 0!==this.Tt}},{key:"vt",get:function(){return this.bt}}]),t}(),Mn=function(){function t(e){Object(f.a)(this,t),this.Mt=e,this.Ft=new Map,this.$t=gn(),this.Bt=Fn(),this.Lt=new yt(H)}return Object(h.a)(t,[{key:"Ut",value:function(t){var e,n=y(t.gt);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.yt&&t.yt.isFoundDocument()?this.qt(r,t.yt):this.Kt(r,t.key,t.yt)}}catch(u){n.e(u)}finally{n.f()}var i,o=y(t.removedTargetIds);try{for(o.s();!(i=o.n()).done;){var a=i.value;this.Kt(a,t.key,t.yt)}}catch(u){o.e(u)}finally{o.f()}}},{key:"Gt",value:function(t){var e=this;this.forEachTarget(t,function(n){var r=e.Qt(n);switch(t.state){case 0:e.jt(n)&&r.Vt(t.resumeToken);break;case 1:r.kt(),r.Pt||r.Dt(),r.Vt(t.resumeToken);break;case 2:r.kt(),r.Pt||e.removeTarget(n);break;case 3:e.jt(n)&&(r.Ot(),r.Vt(t.resumeToken));break;case 4:e.jt(n)&&(e.Wt(n),r.Vt(t.resumeToken));break;default:R()}})}},{key:"forEachTarget",value:function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Ft.forEach(function(t,r){n.jt(r)&&e(r)})}},{key:"zt",value:function(t){var e=t.targetId,n=t.It.count,r=this.Ht(e);if(r){var i=r.target;if(ee(i))if(0===n){var o=new Z(i.path);this.Kt(e,o,Qt.newNoDocument(o,X.min()))}else A(1===n);else this.Jt(e)!==n&&(this.Wt(e),this.Lt=this.Lt.add(e))}}},{key:"Yt",value:function(t){var e=this,n=new Map;this.Ft.forEach(function(r,i){var o=e.Ht(i);if(o){if(r.current&&ee(o.target)){var a=new Z(o.target.path);null!==e.$t.get(a)||e.Xt(i,a)||e.Kt(i,a,Qt.newNoDocument(a,t))}r.vt&&(n.set(i,r.St()),r.Dt())}});var r=Sn();this.Bt.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.Ht(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))}),this.$t.forEach(function(e,n){return n.setReadTime(t)});var i=new In(t,n,this.Lt,this.$t,r);return this.$t=gn(),this.Bt=Fn(),this.Lt=new yt(H),i}},{key:"qt",value:function(t,e){if(this.jt(t)){var n=this.Xt(t,e.key)?2:0;this.Qt(t).Ct(e.key,n),this.$t=this.$t.insert(e.key,e),this.Bt=this.Bt.insert(e.key,this.Zt(e.key).add(t))}}},{key:"Kt",value:function(t,e,n){if(this.jt(t)){var r=this.Qt(t);this.Xt(t,e)?r.Ct(e,1):r.xt(e),this.Bt=this.Bt.insert(e,this.Zt(e).delete(t)),n&&(this.$t=this.$t.insert(e,n))}}},{key:"removeTarget",value:function(t){this.Ft.delete(t)}},{key:"Jt",value:function(t){var e=this.Qt(t).St();return this.Mt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}},{key:"Nt",value:function(t){this.Qt(t).Nt()}},{key:"Qt",value:function(t){var e=this.Ft.get(t);return e||(e=new Pn,this.Ft.set(t,e)),e}},{key:"Zt",value:function(t){var e=this.Bt.get(t);return e||(e=new yt(H),this.Bt=this.Bt.insert(t,e)),e}},{key:"jt",value:function(t){var e=null!==this.Ht(t);return e||S("WatchChangeAggregator","Detected inactive target",t),e}},{key:"Ht",value:function(t){var e=this.Ft.get(t);return e&&e.Pt?null:this.Mt.te(t)}},{key:"Wt",value:function(t){var e=this;this.Ft.set(t,new Pn),this.Mt.getRemoteKeysForTarget(t).forEach(function(n){e.Kt(t,n,null)})}},{key:"Xt",value:function(t,e){return this.Mt.getRemoteKeysForTarget(t).has(e)}}]),t}();function Fn(){return new vt(Z.comparator)}function Ln(){return new vt(Z.comparator)}var jn={asc:"ASCENDING",desc:"DESCENDING"},Bn={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vn=function t(e,n){Object(f.a)(this,t),this.databaseId=e,this.dt=n};function Un(t,e){return t.dt?"".concat(new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+e.nanoseconds).slice(-9),"Z"):{seconds:""+e.seconds,nanos:e.nanoseconds}}function zn(t,e){return t.dt?e.toBase64():e.toUint8Array()}function Wn(t,e){return Un(t,e.toTimestamp())}function Gn(t){return A(!!t),X.fromTimestamp(function(t){var e=Et(t);return new K(e.seconds,e.nanos)}(t))}function Hn(t,e){return function(t){return new Q(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function qn(t){var e=Q.fromString(t);return A(fr(e)),e}function Kn(t,e){return Hn(t.databaseId,e.path)}function Xn(t,e){var n=qn(e);if(n.get(1)!==t.databaseId.projectId)throw new P(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new P(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Z(Jn(n))}function Yn(t,e){return Hn(t.databaseId,e)}function Qn(t){var e=qn(t);return 4===e.length?Q.emptyPath():Jn(e)}function $n(t){return new Q(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Jn(t){return A(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Zn(t,e,n){return{name:Kn(t,e),fields:n.value.mapValue.fields}}function tr(t,e){var n;if(e instanceof nn)n={update:Zn(t,e.key,e.value)};else if(e instanceof ln)n={delete:Kn(t,e.key)};else if(e instanceof rn)n={update:Zn(t,e.key,e.data),updateMask:lr(e.fieldMask)};else{if(!(e instanceof fn))return R();n={verify:Kn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Be)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ve)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ze)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ge)return{fieldPath:e.field.canonicalString(),increment:n._t};throw R()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Wn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:R()}(t,e.precondition)),n}function er(t,e){return{documents:[Yn(t,e.path)]}}function nr(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Yn(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Yn(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(Gt(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NAN"}};if(Wt(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Gt(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NOT_NAN"}};if(Wt(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ar(t.field),op:or(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:ar(t.field),direction:ir(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var a,u=function(t,e){return t.dt||Rt(e)?e:{value:e}}(t,e.limit);return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function rr(t){var e=Qn(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){A(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=function t(e){return e?void 0!==e.unaryFilter?[cr(e)]:void 0!==e.fieldFilter?[sr(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return t(e)}).reduce(function(t,e){return t.concat(e)}):R():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(t){return function(t){return new he(ur(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var s=null;n.limit&&(s=function(t){var e;return Rt(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=function(t){var e=!!t.before,n=t.values||[];return new fe(n,e)}(n.startAt));var l=null;return n.endAt&&(l=function(t){var e=!t.before,n=t.values||[];return new fe(n,e)}(n.endAt)),ge(e,i,u,a,s,"F",c,l)}function ir(t){return jn[t]}function or(t){return Bn[t]}function ar(t){return{fieldPath:t.canonicalString()}}function ur(t){return J.fromServerFormat(t.fieldPath)}function sr(t){return ne.create(ur(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return R()}}(t.fieldFilter.op),t.fieldFilter.value)}function cr(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ur(t.unaryFilter.field);return ne.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ur(t.unaryFilter.field);return ne.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ur(t.unaryFilter.field);return ne.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ur(t.unaryFilter.field);return ne.create(i,"!=",{nullValue:"NULL_VALUE"});default:return R()}}function lr(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function fr(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var hr=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),dr=([].concat(Object(l.a)(hr),["documentOverlays"]),["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"]),pr=dr;[].concat(pr,["indexConfiguration","indexState","indexEntries"]);var vr=function(){function t(e,n,r,i){Object(f.a)(this,t),this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return Object(h.a)(t,[{key:"applyToRemoteDocument",value:function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Je(i,t,n[r])}}},{key:"applyToLocalView",value:function(t,e){var n,r=y(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(t.key)&&(e=Ze(i,t,e,this.localWriteTime))}}catch(s){r.e(s)}finally{r.f()}var o,a=y(this.mutations);try{for(a.s();!(o=a.n()).done;){var u=o.value;u.key.isEqual(t.key)&&(e=Ze(u,t,e,this.localWriteTime))}}catch(s){a.e(s)}finally{a.f()}return e}},{key:"applyToLocalDocumentSet",value:function(t,e){var n=this,r=kn();return this.mutations.forEach(function(i){var o=t.get(i.key),a=o.overlayedDocument,u=n.applyToLocalView(a,o.mutatedFields),s=$e(a,u=e.has(i.key)?null:u);null!==s&&r.set(i.key,s),a.isValidDocument()||a.convertToNoDocument(X.min())}),r}},{key:"keys",value:function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Sn())}},{key:"isEqual",value:function(t){return this.batchId===t.batchId&&q(this.mutations,t.mutations,function(t,e){return en(t,e)})&&q(this.baseMutations,t.baseMutations,function(t,e){return en(t,e)})}}]),t}(),mr=function(){function t(e,n,r,i){Object(f.a)(this,t),this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return Object(h.a)(t,null,[{key:"from",value:function(e,n,r){A(e.mutations.length===r.length);for(var i=Cn,o=e.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new t(e,n,r,i)}}]),t}(),gr=function(){function t(e,n){Object(f.a)(this,t),this.largestBatchId=e,this.mutation=n}return Object(h.a)(t,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(t){return null!==t&&this.mutation===t.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),t}(),yr=function(){function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:X.min(),a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:X.min(),u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:xt.EMPTY_BYTE_STRING;Object(f.a)(this,t),this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u}return Object(h.a)(t,[{key:"withSequenceNumber",value:function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)}},{key:"withLastLimboFreeSnapshotVersion",value:function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}]),t}(),br=function t(e){Object(f.a)(this,t),this.ne=e};function wr(t){var e=rr({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ce(e,e.limit,"L"):e}var xr=function(){function t(){Object(f.a)(this,t)}return Object(h.a)(t,[{key:"re",value:function(t,e){this.oe(t,e),e.ue()}},{key:"oe",value:function(t,e){if("nullValue"in t)this.ce(e,5);else if("booleanValue"in t)this.ce(e,10),e.ae(t.booleanValue?1:0);else if("integerValue"in t)this.ce(e,15),e.ae(Ct(t.integerValue));else if("doubleValue"in t){var n=Ct(t.doubleValue);isNaN(n)?this.ce(e,13):(this.ce(e,15),At(n)?e.ae(0):e.ae(n))}else if("timestampValue"in t){var r=t.timestampValue;this.ce(e,20),"string"==typeof r?e.he(r):(e.he("".concat(r.seconds||"")),e.ae(r.nanos||0))}else if("stringValue"in t)this.le(t.stringValue,e),this.fe(e);else if("bytesValue"in t)this.ce(e,30),e.de(_t(t.bytesValue)),this.fe(e);else if("referenceValue"in t)this._e(t.referenceValue,e);else if("geoPointValue"in t){var i=t.geoPointValue;this.ce(e,45),e.ae(i.latitude||0),e.ae(i.longitude||0)}else"mapValue"in t?Kt(t)?this.ce(e,Number.MAX_SAFE_INTEGER):(this.we(t.mapValue,e),this.fe(e)):"arrayValue"in t?(this.me(t.arrayValue,e),this.fe(e)):R()}},{key:"le",value:function(t,e){this.ce(e,25),this.ge(t,e)}},{key:"ge",value:function(t,e){e.he(t)}},{key:"we",value:function(t,e){var n=t.fields||{};this.ce(e,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var o=i[r];this.le(o,e),this.oe(n[o],e)}}},{key:"me",value:function(t,e){var n=t.values||[];this.ce(e,50);var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.oe(o,e)}}catch(a){i.e(a)}finally{i.f()}}},{key:"_e",value:function(t,e){var n=this;this.ce(e,37),Z.fromName(t).path.forEach(function(t){n.ce(e,60),n.ge(t,e)})}},{key:"ce",value:function(t,e){t.ae(e)}},{key:"fe",value:function(t){t.ae(2)}}]),t}();xr.ye=new xr;var kr=function(){function t(){Object(f.a)(this,t),this.ze=new Er}return Object(h.a)(t,[{key:"addToCollectionParentIndex",value:function(t,e){return this.ze.add(e),ct.resolve()}},{key:"getCollectionParents",value:function(t,e){return ct.resolve(this.ze.getEntries(e))}},{key:"addFieldIndex",value:function(t,e){return ct.resolve()}},{key:"deleteFieldIndex",value:function(t,e){return ct.resolve()}},{key:"getDocumentsMatchingTarget",value:function(t,e){return ct.resolve(null)}},{key:"getIndexType",value:function(t,e){return ct.resolve(0)}},{key:"getFieldIndexes",value:function(t,e){return ct.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(t){return ct.resolve(null)}},{key:"getMinOffset",value:function(t,e){return ct.resolve(rt.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(t,e){return ct.resolve(rt.min())}},{key:"updateCollectionGroup",value:function(t,e,n){return ct.resolve()}},{key:"updateIndexEntries",value:function(t,e){return ct.resolve()}}]),t}(),Er=function(){function t(){Object(f.a)(this,t),this.index={}}return Object(h.a)(t,[{key:"add",value:function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new yt(Q.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}},{key:"has",value:function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}},{key:"getEntries",value:function(t){return(this.index[t]||new yt(Q.comparator)).toArray()}}]),t}();new Uint8Array(0);var Cr=function(){function t(e,n,r){Object(f.a)(this,t),this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return Object(h.a)(t,null,[{key:"withCacheSize",value:function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),t}();Cr.DEFAULT_COLLECTION_PERCENTILE=10,Cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Cr.DEFAULT=new Cr(41943040,Cr.DEFAULT_COLLECTION_PERCENTILE,Cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Cr.DISABLED=new Cr(-1,0,0);var _r=function(){function t(e){Object(f.a)(this,t),this.En=e}return Object(h.a)(t,[{key:"next",value:function(){return this.En+=2,this.En}}],[{key:"An",value:function(){return new t(0)}},{key:"Rn",value:function(){return new t(-1)}}]),t}();var Sr=function(){function t(){Object(f.a)(this,t),this.changes=new vn(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return Object(h.a)(t,[{key:"addEntry",value:function(t){this.assertNotApplied(),this.changes.set(t.key,t)}},{key:"removeEntry",value:function(t,e){this.assertNotApplied(),this.changes.set(t,Qt.newInvalidDocument(t).setReadTime(e))}},{key:"getEntry",value:function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ct.resolve(n):this.getFromCache(t,e)}},{key:"getEntries",value:function(t,e){return this.getAllFromCache(t,e)}},{key:"apply",value:function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}},{key:"assertNotApplied",value:function(){}}]),t}();var Tr=function t(e,n){Object(f.a)(this,t),this.overlayedDocument=e,this.mutatedFields=n},Or=function(){function t(e,n,r,i){Object(f.a)(this,t),this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return Object(h.a)(t,[{key:"getDocument",value:function(t,e){var n=this,r=null;return this.documentOverlayCache.getOverlay(t,e).next(function(i){return r=i,n.getBaseDocument(t,e,r)}).next(function(t){return null!==r&&Ze(r.mutation,t,wt.empty(),K.now()),t})}},{key:"getDocuments",value:function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e,Sn()).next(function(){return e})})}},{key:"getLocalViewOfDocuments",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Sn(),i=xn();return this.populateOverlays(t,i,e).next(function(){return n.computeViews(t,e,i,r).next(function(t){var e=bn();return t.forEach(function(t,n){e=e.insert(t,n.overlayedDocument)}),e})})}},{key:"getOverlayedDocuments",value:function(t,e){var n=this,r=xn();return this.populateOverlays(t,r,e).next(function(){return n.computeViews(t,e,r,Sn())})}},{key:"populateOverlays",value:function(t,e,n){var r=[];return n.forEach(function(t){e.has(t)||r.push(t)}),this.documentOverlayCache.getOverlays(t,r).next(function(t){t.forEach(function(t,n){e.set(t,n)})})}},{key:"computeViews",value:function(t,e,n,r){var i=gn(),o=En(),a=En();return e.forEach(function(t,e){var a=n.get(e.key);r.has(e.key)&&(void 0===a||a.mutation instanceof rn)?i=i.insert(e.key,e):void 0!==a&&(o.set(e.key,a.mutation.getFieldMask()),Ze(a.mutation,e,a.mutation.getFieldMask(),K.now()))}),this.recalculateAndSaveOverlays(t,i).next(function(t){return t.forEach(function(t,e){return o.set(t,e)}),e.forEach(function(t,e){var n;return a.set(t,new Tr(e,null!==(n=o.get(t))&&void 0!==n?n:null))}),a})}},{key:"recalculateAndSaveOverlays",value:function(t,e){var n=this,r=En(),i=new vt(function(t,e){return t-e}),o=Sn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){var n,o=y(t);try{var a=function(){var t=n.value;t.keys().forEach(function(n){var o=e.get(n);if(null!==o){var a=r.get(n)||wt.empty();a=t.applyToLocalView(o,a),r.set(n,a);var u=(i.get(t.batchId)||Sn()).add(n);i=i.insert(t.batchId,u)}})};for(o.s();!(n=o.n()).done;)a()}catch(u){o.e(u)}finally{o.f()}}).next(function(){for(var a=[],u=i.getReverseIterator(),s=function(){var i=u.getNext(),s=i.key,c=i.value,l=kn();c.forEach(function(t){if(!o.has(t)){var n=$e(e.get(t),r.get(t));null!==n&&l.set(t,n),o=o.add(t)}}),a.push(n.documentOverlayCache.saveOverlays(t,s,l))};u.hasNext();)s();return ct.waitFor(a)}).next(function(){return r})}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.recalculateAndSaveOverlays(t,e)})}},{key:"getDocumentsMatchingQuery",value:function(t,e,n){return function(t){return Z.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):xe(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}},{key:"getNextDocuments",value:function(t,e,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next(function(o){var a=r-o.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-o.size):ct.resolve(xn()),u=-1,s=o;return a.next(function(e){return ct.forEach(e,function(e,n){return u<n.largestBatchId&&(u=n.largestBatchId),o.get(e)?ct.resolve():i.getBaseDocument(t,e,n).next(function(t){s=s.insert(e,t)})}).next(function(){return i.populateOverlays(t,e,o)}).next(function(){return i.computeViews(t,s,e,Sn())}).next(function(t){return{batchId:u,changes:wn(t)}})})})}},{key:"getDocumentsMatchingDocumentQuery",value:function(t,e){return this.getDocument(t,new Z(e)).next(function(t){var e=bn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(t,e,n){var r=this,i=e.collectionGroup,o=bn();return this.indexManager.getCollectionParents(t,i).next(function(a){return ct.forEach(a,function(a){var u=function(t,e){return new me(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,a.child(i));return r.getDocumentsMatchingCollectionQuery(t,u,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})}},{key:"getDocumentsMatchingCollectionQuery",value:function(t,e,n){var r,i=this;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next(function(o){return r=o,i.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)}).next(function(t){t.forEach(function(t,e){var n=e.getKey();null===r.get(n)&&(r=r.insert(n,Qt.newInvalidDocument(n)))});var n=bn();return r.forEach(function(r,i){var o=t.get(r);void 0!==o&&Ze(o.mutation,i,wt.empty(),K.now()),Oe(e,i)&&(n=n.insert(r,i))}),n})}},{key:"getBaseDocument",value:function(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):ct.resolve(Qt.newInvalidDocument(e))}}]),t}(),Ir=function(){function t(e){Object(f.a)(this,t),this.wt=e,this.Jn=new Map,this.Yn=new Map}return Object(h.a)(t,[{key:"getBundleMetadata",value:function(t,e){return ct.resolve(this.Jn.get(e))}},{key:"saveBundleMetadata",value:function(t,e){var n;return this.Jn.set(e.id,{id:(n=e).id,version:n.version,createTime:Gn(n.createTime)}),ct.resolve()}},{key:"getNamedQuery",value:function(t,e){return ct.resolve(this.Yn.get(e))}},{key:"saveNamedQuery",value:function(t,e){return this.Yn.set(e.name,function(t){return{name:t.name,query:wr(t.bundledQuery),readTime:Gn(t.readTime)}}(e)),ct.resolve()}}]),t}(),Rr=function(){function t(){Object(f.a)(this,t),this.overlays=new vt(Z.comparator),this.Xn=new Map}return Object(h.a)(t,[{key:"getOverlay",value:function(t,e){return ct.resolve(this.overlays.get(e))}},{key:"getOverlays",value:function(t,e){var n=this,r=xn();return ct.forEach(e,function(e){return n.getOverlay(t,e).next(function(t){null!==t&&r.set(e,t)})}).next(function(){return r})}},{key:"saveOverlays",value:function(t,e,n){var r=this;return n.forEach(function(n,i){r.ie(t,e,i)}),ct.resolve()}},{key:"removeOverlaysForBatchId",value:function(t,e,n){var r=this,i=this.Xn.get(n);return void 0!==i&&(i.forEach(function(t){return r.overlays=r.overlays.remove(t)}),this.Xn.delete(n)),ct.resolve()}},{key:"getOverlaysForCollection",value:function(t,e,n){for(var r=xn(),i=e.length+1,o=new Z(e.child("")),a=this.overlays.getIteratorFrom(o);a.hasNext();){var u=a.getNext().value,s=u.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&u.largestBatchId>n&&r.set(u.getKey(),u)}return ct.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(t,e,n,r){for(var i=new vt(function(t,e){return t-e}),o=this.overlays.getIterator();o.hasNext();){var a=o.getNext().value;if(a.getKey().getCollectionGroup()===e&&a.largestBatchId>n){var u=i.get(a.largestBatchId);null===u&&(u=xn(),i=i.insert(a.largestBatchId,u)),u.set(a.getKey(),a)}}for(var s=xn(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach(function(t,e){return s.set(t,e)}),!(s.size()>=r)););return ct.resolve(s)}},{key:"ie",value:function(t,e,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.Xn.get(r.largestBatchId).delete(n.key);this.Xn.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new gr(e,n));var o=this.Xn.get(e);void 0===o&&(o=Sn(),this.Xn.set(e,o)),this.Xn.set(e,o.add(n.key))}}]),t}(),Ar=function(){function t(){Object(f.a)(this,t),this.Zn=new yt(Dr.ts),this.es=new yt(Dr.ns)}return Object(h.a)(t,[{key:"isEmpty",value:function(){return this.Zn.isEmpty()}},{key:"addReference",value:function(t,e){var n=new Dr(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}},{key:"ss",value:function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})}},{key:"removeReference",value:function(t,e){this.rs(new Dr(t,e))}},{key:"os",value:function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})}},{key:"us",value:function(t){var e=this,n=new Z(new Q([])),r=new Dr(n,t),i=new Dr(n,t+1),o=[];return this.es.forEachInRange([r,i],function(t){e.rs(t),o.push(t.key)}),o}},{key:"cs",value:function(){var t=this;this.Zn.forEach(function(e){return t.rs(e)})}},{key:"rs",value:function(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}},{key:"hs",value:function(t){var e=new Z(new Q([])),n=new Dr(e,t),r=new Dr(e,t+1),i=Sn();return this.es.forEachInRange([n,r],function(t){i=i.add(t.key)}),i}},{key:"containsKey",value:function(t){var e=new Dr(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}]),t}(),Dr=function(){function t(e,n){Object(f.a)(this,t),this.key=e,this.ls=n}return Object(h.a)(t,null,[{key:"ts",value:function(t,e){return Z.comparator(t.key,e.key)||H(t.ls,e.ls)}},{key:"ns",value:function(t,e){return H(t.ls,e.ls)||Z.comparator(t.key,e.key)}}]),t}(),Nr=function(){function t(e,n){Object(f.a)(this,t),this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.fs=1,this.ds=new yt(Dr.ts)}return Object(h.a)(t,[{key:"checkEmpty",value:function(t){return ct.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(t,e,n,r){var i=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var o=new vr(i,e,n,r);this.mutationQueue.push(o);var a,u=y(r);try{for(u.s();!(a=u.n()).done;){var s=a.value;this.ds=this.ds.add(new Dr(s.key,i)),this.indexManager.addToCollectionParentIndex(t,s.key.path.popLast())}}catch(c){u.e(c)}finally{u.f()}return ct.resolve(o)}},{key:"lookupMutationBatch",value:function(t,e){return ct.resolve(this._s(e))}},{key:"getNextMutationBatchAfterBatchId",value:function(t,e){var n=e+1,r=this.ws(n),i=r<0?0:r;return ct.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return ct.resolve(0===this.mutationQueue.length?-1:this.fs-1)}},{key:"getAllMutationBatches",value:function(t){return ct.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(t,e){var n=this,r=new Dr(e,0),i=new Dr(e,Number.POSITIVE_INFINITY),o=[];return this.ds.forEachInRange([r,i],function(t){var e=n._s(t.ls);o.push(e)}),ct.resolve(o)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(t,e){var n=this,r=new yt(H);return e.forEach(function(t){var e=new Dr(t,0),i=new Dr(t,Number.POSITIVE_INFINITY);n.ds.forEachInRange([e,i],function(t){r=r.add(t.ls)})}),ct.resolve(this.gs(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(t,e){var n=e.path,r=n.length+1,i=n;Z.isDocumentKey(i)||(i=i.child(""));var o=new Dr(new Z(i),0),a=new yt(H);return this.ds.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.ls)),!0)},o),ct.resolve(this.gs(a))}},{key:"gs",value:function(t){var e=this,n=[];return t.forEach(function(t){var r=e._s(t);null!==r&&n.push(r)}),n}},{key:"removeMutationBatch",value:function(t,e){var n=this;A(0===this.ys(e.batchId,"removed")),this.mutationQueue.shift();var r=this.ds;return ct.forEach(e.mutations,function(i){var o=new Dr(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.ds=r})}},{key:"In",value:function(t){}},{key:"containsKey",value:function(t,e){var n=new Dr(e,0),r=this.ds.firstAfterOrEqual(n);return ct.resolve(e.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(t){return this.mutationQueue.length,ct.resolve()}},{key:"ys",value:function(t,e){return this.ws(t)}},{key:"ws",value:function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}},{key:"_s",value:function(t){var e=this.ws(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}]),t}(),Pr=function(){function t(e){Object(f.a)(this,t),this.ps=e,this.docs=new vt(Z.comparator),this.size=0}return Object(h.a)(t,[{key:"setIndexManager",value:function(t){this.indexManager=t}},{key:"addEntry",value:function(t,e){var n=e.key,r=this.docs.get(n),i=r?r.size:0,o=this.ps(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}},{key:"removeEntry",value:function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}},{key:"getEntry",value:function(t,e){var n=this.docs.get(e);return ct.resolve(n?n.document.mutableCopy():Qt.newInvalidDocument(e))}},{key:"getEntries",value:function(t,e){var n=this,r=gn();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.mutableCopy():Qt.newInvalidDocument(t))}),ct.resolve(r)}},{key:"getAllFromCollection",value:function(t,e,n){for(var r=gn(),i=new Z(e.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),u=a.key,s=a.value.document;if(!e.isPrefixOf(u.path))break;u.path.length>e.length+1||it(nt(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return ct.resolve(r)}},{key:"getAllFromCollectionGroup",value:function(t,e,n,r){R()}},{key:"Is",value:function(t,e){return ct.forEach(this.docs,function(t){return e(t)})}},{key:"newChangeBuffer",value:function(t){return new Mr(this)}},{key:"getSize",value:function(t){return ct.resolve(this.size)}}]),t}(),Mr=function(t){function e(t){var n;return Object(f.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this))).zn=t,n}return Object(c.a)(e,t),Object(h.a)(e,[{key:"applyChanges",value:function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.isValidDocument()?n.push(e.zn.addEntry(t,i)):e.zn.removeEntry(r)}),ct.waitFor(n)}},{key:"getFromCache",value:function(t,e){return this.zn.getEntry(t,e)}},{key:"getAllFromCache",value:function(t,e){return this.zn.getEntries(t,e)}}]),e}(Sr),Fr=function(){function t(e){Object(f.a)(this,t),this.persistence=e,this.Ts=new vn(function(t){return Zt(t)},te),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.Es=0,this.As=new Ar,this.targetCount=0,this.Rs=_r.An()}return Object(h.a)(t,[{key:"forEachTarget",value:function(t,e){return this.Ts.forEach(function(t,n){return e(n)}),ct.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(t){return ct.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(t){return ct.resolve(this.Es)}},{key:"allocateTargetId",value:function(t){return this.highestTargetId=this.Rs.next(),ct.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Es&&(this.Es=e),ct.resolve()}},{key:"vn",value:function(t){this.Ts.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Rs=new _r(e),this.highestTargetId=e),t.sequenceNumber>this.Es&&(this.Es=t.sequenceNumber)}},{key:"addTargetData",value:function(t,e){return this.vn(e),this.targetCount+=1,ct.resolve()}},{key:"updateTargetData",value:function(t,e){return this.vn(e),ct.resolve()}},{key:"removeTargetData",value:function(t,e){return this.Ts.delete(e.target),this.As.us(e.targetId),this.targetCount-=1,ct.resolve()}},{key:"removeTargets",value:function(t,e,n){var r=this,i=0,o=[];return this.Ts.forEach(function(a,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.Ts.delete(a),o.push(r.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),ct.waitFor(o).next(function(){return i})}},{key:"getTargetCount",value:function(t){return ct.resolve(this.targetCount)}},{key:"getTargetData",value:function(t,e){var n=this.Ts.get(e)||null;return ct.resolve(n)}},{key:"addMatchingKeys",value:function(t,e,n){return this.As.ss(e,n),ct.resolve()}},{key:"removeMatchingKeys",value:function(t,e,n){this.As.os(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),ct.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(t,e){return this.As.us(e),ct.resolve()}},{key:"getMatchingKeysForTargetId",value:function(t,e){var n=this.As.hs(e);return ct.resolve(n)}},{key:"containsKey",value:function(t,e){return ct.resolve(this.As.containsKey(e))}}]),t}(),Lr=function(){function t(e,n){var r=this;Object(f.a)(this,t),this.bs={},this.overlays={},this.Ps=new ft(0),this.vs=!1,this.vs=!0,this.referenceDelegate=e(this),this.Vs=new Fr(this),this.indexManager=new kr,this.remoteDocumentCache=new Pr(function(t){return r.referenceDelegate.Ss(t)}),this.wt=new br(n),this.Ds=new Ir(this.wt)}return Object(h.a)(t,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.vs=!1,Promise.resolve()}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(t){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(t){var e=this.overlays[t.toKey()];return e||(e=new Rr,this.overlays[t.toKey()]=e),e}},{key:"getMutationQueue",value:function(t,e){var n=this.bs[t.toKey()];return n||(n=new Nr(e,this.referenceDelegate),this.bs[t.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Vs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Ds}},{key:"runTransaction",value:function(t,e,n){var r=this;S("MemoryPersistence","Starting transaction:",t);var i=new jr(this.Ps.next());return this.referenceDelegate.Cs(),n(i).next(function(t){return r.referenceDelegate.xs(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})}},{key:"Ns",value:function(t,e){return ct.or(Object.values(this.bs).map(function(n){return function(){return n.containsKey(t,e)}}))}},{key:"started",get:function(){return this.vs}}]),t}(),jr=function(t){function e(t){var n;return Object(f.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this))).currentSequenceNumber=t,n}return Object(c.a)(e,t),e}(at),Br=function(){function t(e){Object(f.a)(this,t),this.persistence=e,this.ks=new Ar,this.Os=null}return Object(h.a)(t,[{key:"addReference",value:function(t,e,n){return this.ks.addReference(n,e),this.Fs.delete(n.toString()),ct.resolve()}},{key:"removeReference",value:function(t,e,n){return this.ks.removeReference(n,e),this.Fs.add(n.toString()),ct.resolve()}},{key:"markPotentiallyOrphaned",value:function(t,e){return this.Fs.add(e.toString()),ct.resolve()}},{key:"removeTarget",value:function(t,e){var n=this;this.ks.us(e.targetId).forEach(function(t){return n.Fs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.Fs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})}},{key:"Cs",value:function(){this.Os=new Set}},{key:"xs",value:function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ct.forEach(this.Fs,function(r){var i=Z.fromPath(r);return e.$s(t,i).next(function(t){t||n.removeEntry(i,X.min())})}).next(function(){return e.Os=null,n.apply(t)})}},{key:"updateLimboDocument",value:function(t,e){var n=this;return this.$s(t,e).next(function(t){t?n.Fs.delete(e.toString()):n.Fs.add(e.toString())})}},{key:"Ss",value:function(t){return 0}},{key:"$s",value:function(t,e){var n=this;return ct.or([function(){return ct.resolve(n.ks.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Ns(t,e)}])}},{key:"Fs",get:function(){if(this.Os)return this.Os;throw R()}}],[{key:"Ms",value:function(e){return new t(e)}}]),t}();var Vr=function(){function t(e,n,r,i){Object(f.a)(this,t),this.targetId=e,this.fromCache=n,this.Pi=r,this.vi=i}return Object(h.a)(t,null,[{key:"Vi",value:function(e,n){var r,i=Sn(),o=Sn(),a=y(n.docChanges);try{for(a.s();!(r=a.n()).done;){var u=r.value;switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:o=o.add(u.doc.key)}}}catch(s){a.e(s)}finally{a.f()}return new t(e,n.fromCache,i,o)}}]),t}(),Ur=function(){function t(){Object(f.a)(this,t),this.Si=!1}return Object(h.a)(t,[{key:"initialize",value:function(t,e){this.Di=t,this.indexManager=e,this.Si=!0}},{key:"getDocumentsMatchingQuery",value:function(t,e,n,r){var i=this;return this.Ci(t,e).next(function(o){return o||i.xi(t,e,r,n)}).next(function(n){return n||i.Ni(t,e)})}},{key:"Ci",value:function(t,e){return ct.resolve(null)}},{key:"xi",value:function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||r.isEqual(X.min())?this.Ni(t,e):this.Di.getDocuments(t,n).next(function(o){var a=i.ki(e,o);return i.Oi(e,a,n,r)?i.Ni(t,e):(_()<=v.a.DEBUG&&S("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Te(e)),i.Mi(t,a,e,et(r,-1)))})}},{key:"ki",value:function(t,e){var n=new yt(Re(t));return e.forEach(function(e,r){Oe(t,r)&&(n=n.add(r))}),n}},{key:"Oi",value:function(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;var i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ni",value:function(t,e){return _()<=v.a.DEBUG&&S("QueryEngine","Using full collection scan to execute query:",Te(e)),this.Di.getDocumentsMatchingQuery(t,e,rt.min())}},{key:"Mi",value:function(t,e,n,r){return this.Di.getDocumentsMatchingQuery(t,n,r).next(function(t){return e.forEach(function(e){t=t.insert(e.key,e)}),t})}}]),t}(),zr=function(){function t(e,n,r,i){Object(f.a)(this,t),this.persistence=e,this.Fi=n,this.wt=i,this.$i=new vt(H),this.Bi=new vn(function(t){return Zt(t)},te),this.Li=new Map,this.Ui=e.getRemoteDocumentCache(),this.Vs=e.getTargetCache(),this.Ds=e.getBundleCache(),this.qi(r)}return Object(h.a)(t,[{key:"qi",value:function(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Or(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.$i)})}}]),t}();function Wr(t,e,n,r){return new zr(t,e,n,r)}function Gr(t,e){return Hr.apply(this,arguments)}function Hr(){return(Hr=Object(a.a)(w().mark(function t(e,n){var r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=D(e),t.next=3,r.persistence.runTransaction("Handle user change","readonly",function(t){var e;return r.mutationQueue.getAllMutationBatches(t).next(function(i){return e=i,r.qi(n),r.mutationQueue.getAllMutationBatches(t)}).next(function(n){var i,o=[],a=[],u=Sn(),s=y(e);try{for(s.s();!(i=s.n()).done;){var c=i.value;o.push(c.batchId);var l,f=y(c.mutations);try{for(f.s();!(l=f.n()).done;){var h=l.value;u=u.add(h.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){s.e(w)}finally{s.f()}var d,p=y(n);try{for(p.s();!(d=p.n()).done;){var v=d.value;a.push(v.batchId);var m,g=y(v.mutations);try{for(g.s();!(m=g.n()).done;){var b=m.value;u=u.add(b.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){p.e(w)}finally{p.f()}return r.localDocuments.getDocuments(t,u).next(function(t){return{Ki:t,removedBatchIds:o,addedBatchIds:a}})})});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function qr(t,e){var n=D(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.Ui.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),a=ct.resolve();return o.forEach(function(t){a=a.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);A(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))})}),a.next(function(){return t.mutationQueue.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n.mutationQueue.performConsistencyCheck(t)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){for(var e=Sn(),n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e))}).next(function(){return n.localDocuments.getDocuments(t,r)})})}function Kr(t){var e=D(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Vs.getLastRemoteSnapshotVersion(t)})}function Xr(t,e){var n=D(t),r=e.snapshotVersion,i=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.Ui.newChangeBuffer({trackRemovals:!0});i=n.$i;var a=[];e.targetChanges.forEach(function(o,u){var s=i.get(u);if(s){a.push(n.Vs.removeMatchingKeys(t,o.removedDocuments,u).next(function(){return n.Vs.addMatchingKeys(t,o.addedDocuments,u)}));var c=s.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(u)?c=c.withResumeToken(xt.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):o.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(o.resumeToken,r)),i=i.insert(u,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,o)&&a.push(n.Vs.updateTargetData(t,c))}});var u=gn(),s=Sn();if(e.documentUpdates.forEach(function(r){e.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),a.push(Yr(t,o,e.documentUpdates).next(function(t){u=t.Gi,s=t.Qi})),!r.isEqual(X.min())){var c=n.Vs.getLastRemoteSnapshotVersion(t).next(function(e){return n.Vs.setTargetsMetadata(t,t.currentSequenceNumber,r)});a.push(c)}return ct.waitFor(a).next(function(){return o.apply(t)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(t,u,s)}).next(function(){return u})}).then(function(t){return n.$i=i,t})}function Yr(t,e,n){var r=Sn(),i=Sn();return n.forEach(function(t){return r=r.add(t)}),e.getEntries(t,r).next(function(t){var r=gn();return n.forEach(function(n,o){var a=t.get(n);o.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),o.isNoDocument()&&o.version.isEqual(X.min())?(e.removeEntry(n,o.readTime),r=r.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(o),r=r.insert(n,o)):S("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),{Gi:r,Qi:i}})}function Qr(t,e){var n=D(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})}function $r(t,e){var n=D(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.Vs.getTargetData(t,e).next(function(i){return i?(r=i,ct.resolve(r)):n.Vs.allocateTargetId(t).next(function(i){return r=new yr(e,i,0,t.currentSequenceNumber),n.Vs.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.$i.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.$i=n.$i.insert(t.targetId,t),n.Bi.set(e,t.targetId)),t})}function Jr(t,e,n){return Zr.apply(this,arguments)}function Zr(){return(Zr=Object(a.a)(w().mark(function t(e,n,r){var i,o,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=D(e),o=i.$i.get(n),a=r?"readwrite":"readwrite-primary",t.prev=1,t.t0=r,t.t0){t.next=6;break}return t.next=6,i.persistence.runTransaction("Release target",a,function(t){return i.persistence.referenceDelegate.removeTarget(t,o)});case 6:t.next=13;break;case 8:if(t.prev=8,t.t1=t.catch(1),lt(t.t1)){t.next=12;break}throw t.t1;case 12:S("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(t.t1));case 13:i.$i=i.$i.remove(n),i.Bi.delete(o.target);case 14:case"end":return t.stop()}},t,null,[[1,8]])}))).apply(this,arguments)}function ti(t,e,n){var r=D(t),i=X.min(),o=Sn();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=D(t),i=r.Bi.get(n);return void 0!==i?ct.resolve(r.$i.get(i)):r.Vs.getTargetData(e,n)}(r,t,Ee(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.Fi.getDocumentsMatchingQuery(t,e,n?i:X.min(),n?o:Sn())}).next(function(t){return ei(r,Ie(e),t),{documents:t,ji:o}})})}function ei(t,e,n){var r=X.min();n.forEach(function(t,e){e.readTime.compareTo(r)>0&&(r=e.readTime)}),t.Li.set(e,r)}var ni=function(){function t(){Object(f.a)(this,t),this.activeTargetIds=On()}return Object(h.a)(t,[{key:"Xi",value:function(t){this.activeTargetIds=this.activeTargetIds.add(t)}},{key:"Zi",value:function(t){this.activeTargetIds=this.activeTargetIds.delete(t)}},{key:"Yi",value:function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}]),t}(),ri=function(){function t(){Object(f.a)(this,t),this.Fr=new ni,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return Object(h.a)(t,[{key:"addPendingMutation",value:function(t){}},{key:"updateMutationState",value:function(t,e,n){}},{key:"addLocalQueryTarget",value:function(t){return this.Fr.Xi(t),this.$r[t]||"not-current"}},{key:"updateQueryState",value:function(t,e,n){this.$r[t]=e}},{key:"removeLocalQueryTarget",value:function(t){this.Fr.Zi(t)}},{key:"isLocalQueryTarget",value:function(t){return this.Fr.activeTargetIds.has(t)}},{key:"clearQueryState",value:function(t){delete this.$r[t]}},{key:"getAllActiveQueryTargets",value:function(){return this.Fr.activeTargetIds}},{key:"isActiveQueryTarget",value:function(t){return this.Fr.activeTargetIds.has(t)}},{key:"start",value:function(){return this.Fr=new ni,Promise.resolve()}},{key:"handleUserChange",value:function(t,e,n){}},{key:"setOnlineState",value:function(t){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(t){}},{key:"notifyBundleLoaded",value:function(t){}}]),t}(),ii=function(){function t(){Object(f.a)(this,t)}return Object(h.a)(t,[{key:"Br",value:function(t){}},{key:"shutdown",value:function(){}}]),t}(),oi=function(){function t(){var e=this;Object(f.a)(this,t),this.Lr=function(){return e.Ur()},this.qr=function(){return e.Kr()},this.Gr=[],this.Qr()}return Object(h.a)(t,[{key:"Br",value:function(t){this.Gr.push(t)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}},{key:"Qr",value:function(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}},{key:"Ur",value:function(){S("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var t,e=y(this.Gr);try{for(e.s();!(t=e.n()).done;){(0,t.value)(0)}}catch(n){e.e(n)}finally{e.f()}}},{key:"Kr",value:function(){S("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var t,e=y(this.Gr);try{for(e.s();!(t=e.n()).done;){(0,t.value)(1)}}catch(n){e.e(n)}finally{e.f()}}}],[{key:"V",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),t}(),ai={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ui=function(){function t(e){Object(f.a)(this,t),this.jr=e.jr,this.Wr=e.Wr}return Object(h.a)(t,[{key:"zr",value:function(t){this.Hr=t}},{key:"Jr",value:function(t){this.Yr=t}},{key:"onMessage",value:function(t){this.Xr=t}},{key:"close",value:function(){this.Wr()}},{key:"send",value:function(t){this.jr(t)}},{key:"Zr",value:function(){this.Hr()}},{key:"eo",value:function(t){this.Yr(t)}},{key:"no",value:function(t){this.Xr(t)}}]),t}(),si=function(t){function e(t){var n;return Object(f.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this,t))).forceLongPolling=t.forceLongPolling,n.autoDetectLongPolling=t.autoDetectLongPolling,n.useFetchStreams=t.useFetchStreams,n}return Object(c.a)(e,t),Object(h.a)(e,[{key:"co",value:function(t,e,n,r){return new Promise(function(i,o){var a=new g.g;a.listenOnce(g.c.COMPLETE,function(){try{switch(a.getLastErrorCode()){case g.a.NO_ERROR:var e=a.getResponseJson();S("Connection","XHR received:",JSON.stringify(e)),i(e);break;case g.a.TIMEOUT:S("Connection",'RPC "'+t+'" timed out'),o(new P(N.DEADLINE_EXCEEDED,"Request time out"));break;case g.a.HTTP_ERROR:var n=a.getStatus();if(S("Connection",'RPC "'+t+'" failed with status:',n,"response text:",a.getResponseText()),n>0){var r=a.getResponseJson().error;if(r&&r.status&&r.message){var u=function(t){var e=r.status.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(e)>=0?e:N.UNKNOWN}();o(new P(u,r.message))}else o(new P(N.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new P(N.UNAVAILABLE,"Connection failed."));break;default:R()}}finally{S("Connection",'RPC "'+t+'" completed.')}});var u=JSON.stringify(r);a.send(e,"POST",u,n,15)})}},{key:"ho",value:function(t,e,n){var r=[this.so,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Object(g.h)(),o=Object(g.i)(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new g.d({})),this.uo(a.initMessageHeaders,e,n),Object(m.m)()||Object(m.n)()||Object(m.j)()||Object(m.k)()||Object(m.p)()||Object(m.i)()||(a.httpHeadersOverwriteParam="$httpHeaders");var u=r.join("");S("Connection","Creating WebChannel: "+u,a);var s=i.createWebChannel(u,a),c=!1,l=!1,f=new ui({jr:function(t){l?S("Connection","Not sending because WebChannel is closed:",t):(c||(S("Connection","Opening WebChannel transport."),s.open(),c=!0),S("Connection","WebChannel sending:",t),s.send(t))},Wr:function(){return s.close()}}),h=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(s,g.f.EventType.OPEN,function(){l||S("Connection","WebChannel transport opened.")}),h(s,g.f.EventType.CLOSE,function(){l||(l=!0,S("Connection","WebChannel transport closed"),f.eo())}),h(s,g.f.EventType.ERROR,function(t){l||(l=!0,O("Connection","WebChannel transport errored:",t),f.eo(new P(N.UNAVAILABLE,"The operation could not be completed")))}),h(s,g.f.EventType.MESSAGE,function(t){var e;if(!l){var n=t.data[0];A(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){S("Connection","WebChannel received error:",i);var o=i.status,a=function(t){var e=sn[o];if(void 0!==e)return pn(e)}(),u=i.message;void 0===a&&(a=N.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),l=!0,f.eo(new P(a,u)),s.close()}else S("Connection","WebChannel received:",n),f.no(n)}}),h(o,g.b.STAT_EVENT,function(t){t.stat===g.e.PROXY?S("Connection","Detected buffering proxy"):t.stat===g.e.NOPROXY&&S("Connection","Detected no buffering proxy")}),setTimeout(function(){f.Zr()},0),f}}]),e}(function(){function t(e){Object(f.a)(this,t),this.databaseInfo=e,this.databaseId=e.databaseId;var n=e.ssl?"https":"http";this.so=n+"://"+e.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return Object(h.a)(t,[{key:"ro",value:function(t,e,n,r,i){var o=this.oo(t,e);S("RestConnection","Sending: ",o,n);var a={};return this.uo(a,r,i),this.co(t,o,a,n).then(function(t){return S("RestConnection","Received: ",t),t},function(e){throw O("RestConnection","".concat(t," failed with error: "),e,"url: ",o,"request:",n),e})}},{key:"ao",value:function(t,e,n,r,i,o){return this.ro(t,e,n,r,i)}},{key:"uo",value:function(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+E,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(function(e,n){return t[n]=e}),n&&n.headers.forEach(function(e,n){return t[n]=e})}},{key:"oo",value:function(t,e){var n=ai[t];return"".concat(this.so,"/v1/").concat(e,":").concat(n)}}]),t}());function ci(){return"undefined"!=typeof document?document:null}function li(t){return new Vn(t,!0)}var fi=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;Object(f.a)(this,t),this.js=e,this.timerId=n,this.lo=r,this.fo=i,this._o=o,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}return Object(h.a)(t,[{key:"reset",value:function(){this.wo=0}},{key:"po",value:function(){this.wo=this._o}},{key:"Io",value:function(t){var e=this;this.cancel();var n=Math.floor(this.wo+this.To()),r=Math.max(0,Date.now()-this.yo),i=Math.max(0,n-r);i>0&&S("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.wo," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.mo=this.js.enqueueAfterDelay(this.timerId,i,function(){return e.yo=Date.now(),t()}),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}},{key:"Eo",value:function(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}},{key:"cancel",value:function(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}},{key:"To",value:function(){return(Math.random()-.5)*this.wo}}]),t}(),hi=function(){function t(e,n,r,i,o,a,u,s){Object(f.a)(this,t),this.js=e,this.Ao=r,this.Ro=i,this.bo=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=s,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new fi(e,n)}return Object(h.a)(t,[{key:"Do",value:function(){return 1===this.state||5===this.state||this.Co()}},{key:"Co",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.xo()}},{key:"stop",value:function(){var t=Object(a.a)(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.Do(),!t.t0){t.next=4;break}return t.next=4,this.close(0);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"No",value:function(){this.state=0,this.So.reset()}},{key:"ko",value:function(){var t=this;this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,function(){return t.Oo()}))}},{key:"Mo",value:function(t){this.Fo(),this.stream.send(t)}},{key:"Oo",value:function(){var t=Object(a.a)(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.Co()){t.next=2;break}return t.abrupt("return",this.close(0));case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"Fo",value:function(){this.vo&&(this.vo.cancel(),this.vo=null)}},{key:"$o",value:function(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}},{key:"close",value:function(){var t=Object(a.a)(w().mark(function t(e,n){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==e?this.So.reset():n&&n.code===N.RESOURCE_EXHAUSTED?(T(n.toString()),T("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):n&&n.code===N.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=e,t.next=9,this.listener.Jr(n);case 9:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"Bo",value:function(){}},{key:"auth",value:function(){var t=this;this.state=1;var e=this.Lo(this.Po),n=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(e){var r=Object(o.a)(e,2),i=r[0],a=r[1];t.Po===n&&t.Uo(i,a)},function(n){e(function(){var e=new P(N.UNKNOWN,"Fetching auth token failed: "+n.message);return t.qo(e)})})}},{key:"Uo",value:function(t,e){var n=this,r=this.Lo(this.Po);this.stream=this.Ko(t,e),this.stream.zr(function(){r(function(){return n.state=2,n.Vo=n.js.enqueueAfterDelay(n.Ro,1e4,function(){return n.Co()&&(n.state=3),Promise.resolve()}),n.listener.zr()})}),this.stream.Jr(function(t){r(function(){return n.qo(t)})}),this.stream.onMessage(function(t){r(function(){return n.onMessage(t)})})}},{key:"xo",value:function(){var t=this;this.state=5,this.So.Io(Object(a.a)(w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.state=0,t.start();case 1:case"end":return e.stop()}},e)})))}},{key:"qo",value:function(t){return S("PersistentStream","close with error: ".concat(t)),this.stream=null,this.close(4,t)}},{key:"Lo",value:function(t){var e=this;return function(n){e.js.enqueueAndForget(function(){return e.Po===t?n():(S("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}}}]),t}(),di=function(t){function e(t,n,r,i,o,a){var c;return Object(f.a)(this,e),(c=Object(u.a)(this,Object(s.a)(e).call(this,t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,a))).wt=o,c}return Object(c.a)(e,t),Object(h.a)(e,[{key:"Ko",value:function(t,e){return this.bo.ho("Listen",t,e)}},{key:"onMessage",value:function(t){this.So.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:R()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.dt?(A(void 0===e||"string"==typeof e),xt.fromBase64String(e||"")):(A(void 0===e||e instanceof Uint8Array),xt.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(t){var e=void 0===t.code?N.UNKNOWN:pn(t.code);return new P(e,t.message||"")}(a);n=new Nn(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;var s=e.documentChange;s.document,s.document.name,s.document.updateTime;var c=Xn(t,s.document.name),l=Gn(s.document.updateTime),f=new Xt({mapValue:{fields:s.document.fields}}),h=Qt.newFoundDocument(c,l,f),d=s.targetIds||[],p=s.removedTargetIds||[];n=new An(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;var v=e.documentDelete;v.document;var m=Xn(t,v.document),g=v.readTime?Gn(v.readTime):X.min(),y=Qt.newNoDocument(m,g),b=v.removedTargetIds||[];n=new An([],b,y.key,y)}else if("documentRemove"in e){e.documentRemove;var w=e.documentRemove;w.document;var x=Xn(t,w.document),k=w.removedTargetIds||[];n=new An([],k,x,null)}else{if(!("filter"in e))return R();e.filter;var E=e.filter;E.targetId;var C=E.count||0,_=new hn(C),S=E.targetId;n=new Dn(S,_)}return n}(this.wt,t),n=function(t){if(!("targetChange"in t))return X.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?X.min():e.readTime?Gn(e.readTime):X.min()}(t);return this.listener.Go(e,n)}},{key:"Qo",value:function(t){var e={};e.database=$n(this.wt),e.addTarget=function(t,e){var n,r=e.target;return(n=ee(r)?{documents:er(t,r)}:{query:nr(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=zn(t,e.resumeToken):e.snapshotVersion.compareTo(X.min())>0&&(n.readTime=Un(t,e.snapshotVersion.toTimestamp())),n}(this.wt,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return R()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.wt,t);n&&(e.labels=n),this.Mo(e)}},{key:"jo",value:function(t){var e={};e.database=$n(this.wt),e.removeTarget=t,this.Mo(e)}}]),e}(hi),pi=function(t){function e(t,n,r,i,o,a){var c;return Object(f.a)(this,e),(c=Object(u.a)(this,Object(s.a)(e).call(this,t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,a))).wt=o,c.Wo=!1,c}return Object(c.a)(e,t),Object(h.a)(e,[{key:"start",value:function(){this.Wo=!1,this.lastStreamToken=void 0,Object(i.a)(Object(s.a)(e.prototype),"start",this).call(this)}},{key:"Bo",value:function(){this.Wo&&this.Ho([])}},{key:"Ko",value:function(t,e){return this.bo.ho("Write",t,e)}},{key:"onMessage",value:function(t){if(A(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Wo){this.So.reset();var e=function(t,e){return t&&t.length>0?(A(void 0!==e),t.map(function(t){return function(t,e){var n=t.updateTime?Gn(t.updateTime):Gn(e);return n.isEqual(X.min())&&(n=Gn(e)),new Ke(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Gn(t.commitTime);return this.listener.Jo(n,e)}return A(!t.writeResults||0===t.writeResults.length),this.Wo=!0,this.listener.Yo()}},{key:"Xo",value:function(){var t={};t.database=$n(this.wt),this.Mo(t)}},{key:"Ho",value:function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return tr(e.wt,t)})};this.Mo(n)}},{key:"zo",get:function(){return this.Wo}}]),e}(hi),vi=function(t){function e(t,n,r,i){var o;return Object(f.a)(this,e),(o=Object(u.a)(this,Object(s.a)(e).call(this))).authCredentials=t,o.appCheckCredentials=n,o.bo=r,o.wt=i,o.Zo=!1,o}return Object(c.a)(e,t),Object(h.a)(e,[{key:"tu",value:function(){if(this.Zo)throw new P(N.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"ro",value:function(t,e,n){var r=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(i){var a=Object(o.a)(i,2),u=a[0],s=a[1];return r.bo.ro(t,e,n,u,s)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===N.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),t):new P(N.UNKNOWN,t.toString())})}},{key:"ao",value:function(t,e,n,r){var i=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(a){var u=Object(o.a)(a,2),s=u[0],c=u[1];return i.bo.ao(t,e,n,s,c,r)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===N.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),t):new P(N.UNKNOWN,t.toString())})}},{key:"terminate",value:function(){this.Zo=!0}}]),e}(function(){return function t(){Object(f.a)(this,t)}}()),mi=function(){function t(e,n){Object(f.a)(this,t),this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}return Object(h.a)(t,[{key:"iu",value:function(){var t=this;0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.nu=null,t.ou("Backend didn't respond within 10 seconds."),t.ru("Offline"),Promise.resolve()}))}},{key:"uu",value:function(t){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou("Connection failed 1 times. Most recent error: ".concat(t.toString())),this.ru("Offline")))}},{key:"set",value:function(t){this.cu(),this.eu=0,"Online"===t&&(this.su=!1),this.ru(t)}},{key:"ru",value:function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}},{key:"ou",value:function(t){var e="Could not reach Cloud Firestore backend. ".concat(t,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.su?(T(e),this.su=!1):S("OnlineStateTracker",e)}},{key:"cu",value:function(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}]),t}(),gi=function t(e,n,r,i,o){var u=this;Object(f.a)(this,t),this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=o,this.du.Br(function(t){r.enqueueAndForget(Object(a.a)(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=Oi(u),!t.t0){t.next=5;break}return S("RemoteStore","Restarting streams for network reachability change."),t.next=5,function(){var t=Object(a.a)(w().mark(function t(e){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(n=D(e)).lu.add(4),t.next=4,wi(n);case 4:return n._u.set("Unknown"),n.lu.delete(4),t.next=8,yi(n);case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()(u);case 5:case"end":return t.stop()}},t)})))}),this._u=new mi(r,i)};function yi(t){return bi.apply(this,arguments)}function bi(){return(bi=Object(a.a)(w().mark(function t(e){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!Oi(e)){t.next=18;break}n=y(e.fu),t.prev=2,n.s();case 4:if((r=n.n()).done){t.next=10;break}return i=r.value,t.next=8,i(!0);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),n.e(t.t0);case 15:return t.prev=15,n.f(),t.finish(15);case 18:case"end":return t.stop()}},t,null,[[2,12,15,18]])}))).apply(this,arguments)}function wi(t){return xi.apply(this,arguments)}function xi(){return(xi=Object(a.a)(w().mark(function t(e){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=y(e.fu),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return i=r.value,t.next=7,i(!1);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}},t,null,[[1,11,14,17]])}))).apply(this,arguments)}function ki(t,e){var n=D(t);n.hu.has(e.targetId)||(n.hu.set(e.targetId,e),Ti(n)?Si(n):ro(n).Co()&&Ci(n,e))}function Ei(t,e){var n=D(t),r=ro(n);n.hu.delete(e),r.Co()&&_i(n,e),0===n.hu.size&&(r.Co()?r.ko():Oi(n)&&n._u.set("Unknown"))}function Ci(t,e){t.wu.Nt(e.targetId),ro(t).Qo(e)}function _i(t,e){t.wu.Nt(e),ro(t).jo(e)}function Si(t){t.wu=new Mn({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},te:function(e){return t.hu.get(e)||null}}),ro(t).start(),t._u.iu()}function Ti(t){return Oi(t)&&!ro(t).Do()&&t.hu.size>0}function Oi(t){return 0===D(t).lu.size}function Ii(t){t.wu=void 0}function Ri(t){return Ai.apply(this,arguments)}function Ai(){return(Ai=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.hu.forEach(function(t,n){Ci(e,t)});case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Di(t,e){return Ni.apply(this,arguments)}function Ni(){return(Ni=Object(a.a)(w().mark(function t(e,n){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:Ii(e),Ti(e)?(e._u.uu(n),Si(e)):e._u.set("Unknown");case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Pi(t,e,n){return Mi.apply(this,arguments)}function Mi(){return(Mi=Object(a.a)(w().mark(function t(e,n,r){var i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e._u.set("Online"),!(n instanceof Nn&&2===n.state&&n.cause)){t.next=13;break}return t.prev=1,t.next=4,function(){var t=Object(a.a)(w().mark(function t(e,n){var r,i,o,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n.cause,i=y(n.targetIds),t.prev=2,i.s();case 4:if((o=i.n()).done){t.next=14;break}if(a=o.value,t.t0=e.hu.has(a),!t.t0){t.next=12;break}return t.next=10,e.remoteSyncer.rejectListen(a,r);case 10:e.hu.delete(a),e.wu.removeTarget(a);case 12:t.next=4;break;case 14:t.next=19;break;case 16:t.prev=16,t.t1=t.catch(2),i.e(t.t1);case 19:return t.prev=19,i.f(),t.finish(19);case 22:case"end":return t.stop()}},t,null,[[2,16,19,22]])}));return function(e,n){return t.apply(this,arguments)}}()(e,n);case 4:t.next=11;break;case 6:return t.prev=6,t.t0=t.catch(1),S("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),t.t0),t.next=11,Fi(e,t.t0);case 11:t.next=29;break;case 13:if(n instanceof An?e.wu.Ut(n):n instanceof Dn?e.wu.zt(n):e.wu.Gt(n),r.isEqual(X.min())){t.next=29;break}return t.prev=14,t.next=17,Kr(e.localStore);case 17:if(i=t.sent,t.t1=r.compareTo(i)>=0,!t.t1){t.next=22;break}return t.next=22,function(t,e){var n=t.wu.Yt(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.hu.get(r);i&&t.hu.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.hu.get(e);if(n){t.hu.set(e,n.withResumeToken(xt.EMPTY_BYTE_STRING,n.snapshotVersion)),_i(t,e);var r=new yr(n.target,e,1,n.sequenceNumber);Ci(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(e,r);case 22:t.next=29;break;case 24:return t.prev=24,t.t2=t.catch(14),S("RemoteStore","Failed to raise snapshot:",t.t2),t.next=29,Fi(e,t.t2);case 29:case"end":return t.stop()}},t,null,[[1,6],[14,24]])}))).apply(this,arguments)}function Fi(t,e,n){return Li.apply(this,arguments)}function Li(){return(Li=Object(a.a)(w().mark(function t(e,n,r){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(lt(n)){t.next=2;break}throw n;case 2:return e.lu.add(1),t.next=5,wi(e);case 5:e._u.set("Offline"),r||(r=function(){return Kr(e.localStore)}),e.asyncQueue.enqueueRetryable(Object(a.a)(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return S("RemoteStore","Retrying IndexedDB access"),t.next=3,r();case 3:return e.lu.delete(1),t.next=6,yi(e);case 6:case"end":return t.stop()}},t)})));case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function ji(t,e){return e().catch(function(n){return Fi(t,n,e)})}function Bi(t){return Vi.apply(this,arguments)}function Vi(){return(Vi=Object(a.a)(w().mark(function t(e){var n,r,i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=D(e),r=io(n),i=n.au.length>0?n.au[n.au.length-1].batchId:-1;case 2:if(!Ui(n)){t.next=19;break}return t.prev=3,t.next=6,Qr(n.localStore,i);case 6:if(null!==(o=t.sent)){t.next=10;break}return 0===n.au.length&&r.ko(),t.abrupt("break",19);case 10:i=o.batchId,zi(n,o),t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(3),t.next=17,Fi(n,t.t0);case 17:t.next=2;break;case 19:Wi(n)&&Gi(n);case 20:case"end":return t.stop()}},t,null,[[3,13]])}))).apply(this,arguments)}function Ui(t){return Oi(t)&&t.au.length<10}function zi(t,e){t.au.push(e);var n=io(t);n.Co()&&n.zo&&n.Ho(e.mutations)}function Wi(t){return Oi(t)&&!io(t).Do()&&t.au.length>0}function Gi(t){io(t).start()}function Hi(t){return qi.apply(this,arguments)}function qi(){return(qi=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:io(e).Xo();case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Ki(t){return Xi.apply(this,arguments)}function Xi(){return(Xi=Object(a.a)(w().mark(function t(e){var n,r,i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=io(e),r=y(e.au);try{for(r.s();!(i=r.n()).done;)o=i.value,n.Ho(o.mutations)}catch(a){r.e(a)}finally{r.f()}case 3:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Yi(t,e,n){return Qi.apply(this,arguments)}function Qi(){return(Qi=Object(a.a)(w().mark(function t(e,n,r){var i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.au.shift(),o=mr.from(i,n,r),t.next=3,ji(e,function(){return e.remoteSyncer.applySuccessfulWrite(o)});case 3:return t.next=5,Bi(e);case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}function $i(t,e){return Ji.apply(this,arguments)}function Ji(){return(Ji=Object(a.a)(w().mark(function t(e,n){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=n&&io(e).zo,!t.t0){t.next=4;break}return t.next=4,function(){var t=Object(a.a)(w().mark(function t(e,n){var r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!dn(i=n.code)||i===N.ABORTED){t.next=7;break}return r=e.au.shift(),io(e).No(),t.next=5,ji(e,function(){return e.remoteSyncer.rejectFailedWrite(r.batchId,n)});case 5:return t.next=7,Bi(e);case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()(e,n);case 4:Wi(e)&&Gi(e);case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Zi(t,e){return to.apply(this,arguments)}function to(){return(to=Object(a.a)(w().mark(function t(e,n){var r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(r=D(e)).asyncQueue.verifyOperationInProgress(),S("RemoteStore","RemoteStore received new credentials"),i=Oi(r),r.lu.add(3),t.next=6,wi(r);case 6:return i&&r._u.set("Unknown"),t.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.lu.delete(3),t.next=12,yi(r);case 12:case"end":return t.stop()}},t)}))).apply(this,arguments)}function eo(t,e){return no.apply(this,arguments)}function no(){return(no=Object(a.a)(w().mark(function t(e,n){var r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=D(e),!n){t.next=7;break}return r.lu.delete(2),t.next=5,yi(r);case 5:t.next=13;break;case 7:if(t.t0=n,t.t0){t.next=13;break}return r.lu.add(2),t.next=12,wi(r);case 12:r._u.set("Unknown");case 13:case"end":return t.stop()}},t)}))).apply(this,arguments)}function ro(t){return t.mu||(t.mu=function(t,e,n){var r=D(t);return r.tu(),new di(e,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(t.datastore,t.asyncQueue,{zr:Ri.bind(null,t),Jr:Di.bind(null,t),Go:Pi.bind(null,t)}),t.fu.push(function(){var e=Object(a.a)(w().mark(function e(n){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}t.mu.No(),Ti(t)?Si(t):t._u.set("Unknown"),e.next=7;break;case 4:return e.next=6,t.mu.stop();case 6:Ii(t);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),t.mu}function io(t){return t.gu||(t.gu=function(t,e,n){var r=D(t);return r.tu(),new pi(e,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(t.datastore,t.asyncQueue,{zr:Hi.bind(null,t),Jr:$i.bind(null,t),Yo:Ki.bind(null,t),Jo:Yi.bind(null,t)}),t.fu.push(function(){var e=Object(a.a)(w().mark(function e(n){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return t.gu.No(),e.next=4,Bi(t);case 4:e.next=9;break;case 6:return e.next=8,t.gu.stop();case 8:t.au.length>0&&(S("RemoteStore","Stopping write stream with ".concat(t.au.length," pending writes")),t.au=[]);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),t.gu}var oo=function(){function t(e,n,r,i,o){Object(f.a)(this,t),this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new M,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return Object(h.a)(t,[{key:"start",value:function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(N.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}},{key:"handleDelayElapsed",value:function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})}},{key:"clearTimeout",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)})}],[{key:"createAndSchedule",value:function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a}}]),t}();function ao(t,e){if(T("AsyncQueue","".concat(e,": ").concat(t)),lt(t))return new P(N.UNAVAILABLE,"".concat(e,": ").concat(t));throw t}var uo=function(){function t(e){Object(f.a)(this,t),this.comparator=e?function(t,n){return e(t,n)||Z.comparator(t.key,n.key)}:function(t,e){return Z.comparator(t.key,e.key)},this.keyedMap=bn(),this.sortedSet=new vt(this.comparator)}return Object(h.a)(t,[{key:"has",value:function(t){return null!=this.keyedMap.get(t)}},{key:"get",value:function(t){return this.keyedMap.get(t)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}},{key:"forEach",value:function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})}},{key:"add",value:function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}},{key:"delete",value:function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}},{key:"isEqual",value:function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}},{key:"toString",value:function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}},{key:"copy",value:function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}},{key:"size",get:function(){return this.sortedSet.size}}],[{key:"emptySet",value:function(e){return new t(e.comparator)}}]),t}(),so=function(){function t(){Object(f.a)(this,t),this.yu=new vt(Z.comparator)}return Object(h.a)(t,[{key:"track",value:function(t){var e=t.doc.key,n=this.yu.get(e);n?0!==t.type&&3===n.type?this.yu=this.yu.insert(e,t):3===t.type&&1!==n.type?this.yu=this.yu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.yu=this.yu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.yu=this.yu.remove(e):1===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):R():this.yu=this.yu.insert(e,t)}},{key:"pu",value:function(){var t=[];return this.yu.inorderTraversal(function(e,n){t.push(n)}),t}}]),t}(),co=function(){function t(e,n,r,i,o,a,u,s){Object(f.a)(this,t),this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=s}return Object(h.a)(t,[{key:"isEqual",value:function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&_e(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}},{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}}],[{key:"fromInitialDocuments",value:function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,uo.emptySet(n),o,r,i,!0,!1)}}]),t}(),lo=function t(){Object(f.a)(this,t),this.Iu=void 0,this.listeners=[]},fo=function t(){Object(f.a)(this,t),this.queries=new vn(function(t){return Se(t)},_e),this.onlineState="Unknown",this.Tu=new Set};function ho(t,e){return po.apply(this,arguments)}function po(){return(po=Object(a.a)(w().mark(function t(e,n){var r,i,o,a,u;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=D(e),i=n.query,o=!1,(a=r.queries.get(i))||(o=!0,a=new lo),!o){t.next=13;break}return t.prev=3,t.next=6,r.onListen(i);case 6:a.Iu=t.sent,t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(3),u=ao(t.t0,"Initialization of query '".concat(Te(n.query),"' failed")),t.abrupt("return",void n.onError(u));case 13:r.queries.set(i,a),a.listeners.push(n),n.Eu(r.onlineState),a.Iu&&n.Au(a.Iu)&&go(r);case 14:case"end":return t.stop()}},t,null,[[3,9]])}))).apply(this,arguments)}function vo(t,e){return mo.apply(this,arguments)}function mo(){return(mo=Object(a.a)(w().mark(function t(e,n){var r,i,o,a,u;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=D(e),i=n.query,o=!1,(a=r.queries.get(i))&&(u=a.listeners.indexOf(n))>=0&&(a.listeners.splice(u,1),o=0===a.listeners.length),!o){t.next=6;break}return t.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}function go(t){t.Tu.forEach(function(t){t.next()})}var yo=function(){function t(e,n,r){Object(f.a)(this,t),this.query=e,this.Ru=n,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=r||{}}return Object(h.a)(t,[{key:"Au",value:function(t){if(!this.options.includeMetadataChanges){var e,n=[],r=y(t.docChanges);try{for(r.s();!(e=r.n()).done;){var i=e.value;3!==i.type&&n.push(i)}}catch(a){r.e(a)}finally{r.f()}t=new co(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.bu?this.vu(t)&&(this.Ru.next(t),o=!0):this.Vu(t,this.onlineState)&&(this.Su(t),o=!0),this.Pu=t,o}},{key:"onError",value:function(t){this.Ru.error(t)}},{key:"Eu",value:function(t){this.onlineState=t;var e=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,t)&&(this.Su(this.Pu),e=!0),e}},{key:"Vu",value:function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return(!this.options.Du||!n)&&(!t.docs.isEmpty()||"Offline"===e)}},{key:"vu",value:function(t){if(t.docChanges.length>0)return!0;var e=this.Pu&&this.Pu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}},{key:"Su",value:function(t){t=co.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.bu=!0,this.Ru.next(t)}}]),t}();var bo=function t(e){Object(f.a)(this,t),this.key=e},wo=function t(e){Object(f.a)(this,t),this.key=e},xo=function(){function t(e,n){Object(f.a)(this,t),this.query=e,this.Fu=n,this.$u=null,this.current=!1,this.Bu=Sn(),this.mutatedKeys=Sn(),this.Lu=Re(e),this.Uu=new uo(this.Lu)}return Object(h.a)(t,[{key:"Ku",value:function(t,e){var n=this,r=e?e.Gu:new so,i=e?e.Uu:this.Uu,o=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,s="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var l=i.get(t),f=Oe(n.query,e)?e:null,h=!!l&&n.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),p=!1;l&&f?l.data.isEqual(f.data)?h!==d&&(r.track({type:3,doc:f}),p=!0):n.Qu(l,f)||(r.track({type:2,doc:f}),p=!0,(s&&n.Lu(f,s)>0||c&&n.Lu(f,c)<0)&&(u=!0)):!l&&f?(r.track({type:0,doc:f}),p=!0):l&&!f&&(r.track({type:1,doc:l}),p=!0,(s||c)&&(u=!0)),p&&(f?(a=a.add(f),o=d?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),null!==this.query.limit)for(;a.size>this.query.limit;){var l="F"===this.query.limitType?a.last():a.first();a=a.delete(l.key),o=o.delete(l.key),r.track({type:1,doc:l})}return{Uu:a,Gu:r,Oi:u,mutatedKeys:o}}},{key:"Qu",value:function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}},{key:"applyChanges",value:function(t,e,n){var r=this,i=this.Uu;this.Uu=t.Uu,this.mutatedKeys=t.mutatedKeys;var o=t.Gu.pu();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R()}};return n(t)-n(e)}(t.type,e.type)||r.Lu(t.doc,e.doc)}),this.ju(n);var a=e?this.Wu():[],u=0===this.Bu.size&&this.current?1:0,s=u!==this.$u;return this.$u=u,0!==o.length||s?{snapshot:new co(this.query,t.Uu,i,o,t.mutatedKeys,0===u,s,!1),zu:a}:{zu:a}}},{key:"Eu",value:function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new so,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}},{key:"Hu",value:function(t){return!this.Fu.has(t)&&!!this.Uu.has(t)&&!this.Uu.get(t).hasLocalMutations}},{key:"ju",value:function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.Fu=e.Fu.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.Fu=e.Fu.delete(t)}),this.current=t.current)}},{key:"Wu",value:function(){var t=this;if(!this.current)return[];var e=this.Bu;this.Bu=Sn(),this.Uu.forEach(function(e){t.Hu(e.key)&&(t.Bu=t.Bu.add(e.key))});var n=[];return e.forEach(function(e){t.Bu.has(e)||n.push(new wo(e))}),this.Bu.forEach(function(t){e.has(t)||n.push(new bo(t))}),n}},{key:"Ju",value:function(t){this.Fu=t.ji,this.Bu=Sn();var e=this.Ku(t.documents);return this.applyChanges(e,!0)}},{key:"Yu",value:function(){return co.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}},{key:"qu",get:function(){return this.Fu}}]),t}(),ko=function t(e,n,r){Object(f.a)(this,t),this.query=e,this.targetId=n,this.view=r},Eo=function t(e){Object(f.a)(this,t),this.key=e,this.Xu=!1},Co=function(){function t(e,n,r,i,o,a){Object(f.a)(this,t),this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Zu={},this.tc=new vn(function(t){return Se(t)},_e),this.ec=new Map,this.nc=new Set,this.sc=new vt(Z.comparator),this.ic=new Map,this.rc=new Ar,this.oc={},this.uc=new Map,this.cc=_r.Rn(),this.onlineState="Unknown",this.ac=void 0}return Object(h.a)(t,[{key:"isPrimaryClient",get:function(){return!0===this.ac}}]),t}();function _o(t,e){return So.apply(this,arguments)}function So(){return(So=Object(a.a)(w().mark(function t(e,n){var r,i,o,a,u,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Qo(e),!(a=r.tc.get(n))){t.next=6;break}i=a.targetId,r.sharedClientState.addLocalQueryTarget(i),o=a.view.Yu(),t.next=15;break;case 6:return t.next=8,$r(r.localStore,Ee(n));case 8:return u=t.sent,r.isPrimaryClient&&ki(r.remoteStore,u),s=r.sharedClientState.addLocalQueryTarget(u.targetId),i=u.targetId,t.next=14,To(r,n,i,"current"===s);case 14:o=t.sent;case 15:return t.abrupt("return",o);case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}function To(t,e,n,r){return Oo.apply(this,arguments)}function Oo(){return(Oo=Object(a.a)(w().mark(function t(e,n,r,i){var o,u,s,c,l,f;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.hc=function(t,n,r){return function(){var t=Object(a.a)(w().mark(function t(e,n,r,i){var o,a,u;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.view.Ku(r),t.t0=o.Oi,!t.t0){t.next=6;break}return t.next=5,ti(e.localStore,n.query,!1).then(function(t){var e=t.documents;return n.view.Ku(e,o)});case 5:o=t.sent;case 6:return a=i&&i.targetChanges.get(n.targetId),u=n.view.applyChanges(o,e.isPrimaryClient,a),t.abrupt("return",(Wo(e,n.targetId,u.zu),u.snapshot));case 8:case"end":return t.stop()}},t)}));return function(e,n,r,i){return t.apply(this,arguments)}}()(e,t,n,r)},t.next=3,ti(e.localStore,n,!0);case 3:return o=t.sent,u=new xo(n,o.ji),s=u.Ku(o.documents),c=Rn.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==e.onlineState),l=u.applyChanges(s,e.isPrimaryClient,c),Wo(e,r,l.zu),f=new ko(n,r,u),t.abrupt("return",(e.tc.set(n,f),e.ec.has(r)?e.ec.get(r).push(n):e.ec.set(r,[n]),l.snapshot));case 11:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Io(t,e){return Ro.apply(this,arguments)}function Ro(){return(Ro=Object(a.a)(w().mark(function t(e,n){var r,i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=D(e),i=r.tc.get(n),!((o=r.ec.get(i.targetId)).length>1)){t.next=3;break}return t.abrupt("return",(r.ec.set(i.targetId,o.filter(function(t){return!_e(t,n)})),void r.tc.delete(n)));case 3:if(!r.isPrimaryClient){t.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),t.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),t.t0){t.next=9;break}return t.next=9,Jr(r.localStore,i.targetId,!1).then(function(){r.sharedClientState.clearQueryState(i.targetId),Ei(r.remoteStore,i.targetId),Uo(r,i.targetId)}).catch(ut);case 9:t.next=14;break;case 11:return Uo(r,i.targetId),t.next=14,Jr(r.localStore,i.targetId,!0);case 14:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Ao(t,e,n){return Do.apply(this,arguments)}function Do(){return(Do=Object(a.a)(w().mark(function t(e,n,r){var i,o,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=$o(e),t.prev=1,t.next=4,function(t,e){var n,r,i=D(t),o=K.now(),a=e.reduce(function(t,e){return t.add(e.key)},Sn());return i.persistence.runTransaction("Locally write mutations","readwrite",function(t){var u=gn(),s=Sn();return i.Ui.getEntries(t,a).next(function(t){(u=t).forEach(function(t,e){e.isValidDocument()||(s=s.add(t))})}).next(function(){return i.localDocuments.getOverlayedDocuments(t,u)}).next(function(r){n=r;var a,u=[],s=y(e);try{for(s.s();!(a=s.n()).done;){var c=a.value,l=tn(c,n.get(c.key).overlayedDocument);null!=l&&u.push(new rn(c.key,l,Yt(l.value.mapValue),Xe.exists(!0)))}}catch(f){s.e(f)}finally{s.f()}return i.mutationQueue.addMutationBatch(t,o,u,e)}).next(function(e){r=e;var o=e.applyToLocalDocumentSet(n,s);return i.documentOverlayCache.saveOverlays(t,e.batchId,o)})}).then(function(){return{batchId:r.batchId,changes:wn(n)}})}(i.localStore,n);case 4:return o=t.sent,i.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.oc[t.currentUser.toKey()];r||(r=new vt(H)),r=r.insert(e,n),t.oc[t.currentUser.toKey()]=r}(i,o.batchId,r),t.next=9,qo(i,o.changes);case 9:return t.next=11,Bi(i.remoteStore);case 11:t.next=17;break;case 13:t.prev=13,t.t0=t.catch(1),a=ao(t.t0,"Failed to persist write"),r.reject(a);case 17:case"end":return t.stop()}},t,null,[[1,13]])}))).apply(this,arguments)}function No(t,e){return Po.apply(this,arguments)}function Po(){return(Po=Object(a.a)(w().mark(function t(e,n){var r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=D(e),t.prev=1,t.next=4,Xr(r.localStore,n);case 4:return i=t.sent,n.targetChanges.forEach(function(t,e){var n=r.ic.get(e);n&&(A(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?n.Xu=!0:t.modifiedDocuments.size>0?A(n.Xu):t.removedDocuments.size>0&&(A(n.Xu),n.Xu=!1))}),t.next=8,qo(r,i,n);case 8:t.next=14;break;case 10:return t.prev=10,t.t0=t.catch(1),t.next=14,ut(t.t0);case 14:case"end":return t.stop()}},t,null,[[1,10]])}))).apply(this,arguments)}function Mo(t,e,n){var r=D(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.tc.forEach(function(t,n){var r=n.view.Eu(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=D(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){var i,o=y(n.listeners);try{for(o.s();!(i=o.n()).done;){i.value.Eu(e)&&(r=!0)}}catch(a){o.e(a)}finally{o.f()}}),r&&go(n)}(r.eventManager,e),i.length&&r.Zu.Go(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Fo(){return(Fo=Object(a.a)(w().mark(function t(e,n,r){var i,o,a,u,s,c;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((i=D(e)).sharedClientState.updateQueryState(n,"rejected",r),o=i.ic.get(n),!(a=o&&o.key)){t.next=14;break}return u=(u=new vt(Z.comparator)).insert(a,Qt.newNoDocument(a,X.min())),s=Sn().add(a),c=new In(X.min(),new Map,new yt(H),u,s),t.next=9,No(i,c);case 9:i.sc=i.sc.remove(a),i.ic.delete(n),Ho(i),t.next=16;break;case 14:return t.next=16,Jr(i.localStore,n,!1).then(function(){return Uo(i,n,r)}).catch(ut);case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Lo(){return(Lo=Object(a.a)(w().mark(function t(e,n){var r,i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=D(e),i=n.batch.batchId,t.prev=1,t.next=4,qr(r.localStore,n);case 4:return o=t.sent,Vo(r,i,null),Bo(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),t.next=10,qo(r,o);case 10:t.next=16;break;case 12:return t.prev=12,t.t0=t.catch(1),t.next=16,ut(t.t0);case 16:case"end":return t.stop()}},t,null,[[1,12]])}))).apply(this,arguments)}function jo(){return(jo=Object(a.a)(w().mark(function t(e,n,r){var i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=D(e),t.prev=1,t.next=4,function(t,e){var n=D(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n.mutationQueue.lookupMutationBatch(t,e).next(function(e){return A(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)}).next(function(){return n.mutationQueue.performConsistencyCheck(t)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(t,r,e)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r)}).next(function(){return n.localDocuments.getDocuments(t,r)})})}(i.localStore,n);case 4:return o=t.sent,Vo(i,n,r),Bo(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),t.next=10,qo(i,o);case 10:t.next=16;break;case 12:return t.prev=12,t.t0=t.catch(1),t.next=16,ut(t.t0);case 16:case"end":return t.stop()}},t,null,[[1,12]])}))).apply(this,arguments)}function Bo(t,e){(t.uc.get(e)||[]).forEach(function(t){t.resolve()}),t.uc.delete(e)}function Vo(t,e,n){var r=D(t),i=r.oc[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.oc[r.currentUser.toKey()]=i}}function Uo(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.sharedClientState.removeLocalQueryTarget(e);var r,i=y(t.ec.get(e));try{for(i.s();!(r=i.n()).done;){var o=r.value;t.tc.delete(o),n&&t.Zu.lc(o,n)}}catch(a){i.e(a)}finally{i.f()}t.ec.delete(e),t.isPrimaryClient&&t.rc.us(e).forEach(function(e){t.rc.containsKey(e)||zo(t,e)})}function zo(t,e){t.nc.delete(e.path.canonicalString());var n=t.sc.get(e);null!==n&&(Ei(t.remoteStore,n),t.sc=t.sc.remove(e),t.ic.delete(n),Ho(t))}function Wo(t,e,n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;o instanceof bo?(t.rc.addReference(o.key,e),Go(t,o)):o instanceof wo?(S("SyncEngine","Document no longer in limbo: "+o.key),t.rc.removeReference(o.key,e),t.rc.containsKey(o.key)||zo(t,o.key)):R()}}catch(a){i.e(a)}finally{i.f()}}function Go(t,e){var n=e.key,r=n.path.canonicalString();t.sc.get(n)||t.nc.has(r)||(S("SyncEngine","New document in limbo: "+n),t.nc.add(r),Ho(t))}function Ho(t){for(;t.nc.size>0&&t.sc.size<t.maxConcurrentLimboResolutions;){var e=t.nc.values().next().value;t.nc.delete(e);var n=new Z(Q.fromString(e)),r=t.cc.next();t.ic.set(r,new Eo(n)),t.sc=t.sc.insert(n,r),ki(t.remoteStore,new yr(Ee(ye(n.path)),r,2,ft.ot))}}function qo(t,e,n){return Ko.apply(this,arguments)}function Ko(){return(Ko=Object(a.a)(w().mark(function t(e,n,r){var i,o,u,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=D(e),o=[],u=[],s=[],t.t0=i.tc.isEmpty(),t.t0){t.next=9;break}return i.tc.forEach(function(t,e){s.push(i.hc(e,n,r).then(function(t){if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),o.push(t);var n=Vr.Vi(e.targetId,t);u.push(n)}}))}),t.next=6,Promise.all(s);case 6:return i.Zu.Go(o),t.next=9,function(){var t=Object(a.a)(w().mark(function t(e,n){var r,i,o,a,u,s,c,l;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=D(e),t.prev=1,t.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return ct.forEach(n,function(e){return ct.forEach(e.Pi,function(n){return r.persistence.referenceDelegate.addReference(t,e.targetId,n)}).next(function(){return ct.forEach(e.vi,function(n){return r.persistence.referenceDelegate.removeReference(t,e.targetId,n)})})})});case 4:t.next=11;break;case 6:if(t.prev=6,t.t0=t.catch(1),lt(t.t0)){t.next=10;break}throw t.t0;case 10:S("LocalStore","Failed to update sequence numbers: "+t.t0);case 11:i=y(n);try{for(i.s();!(o=i.n()).done;)a=o.value,u=a.targetId,a.fromCache||(s=r.$i.get(u),c=s.snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.$i=r.$i.insert(u,l))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return t.stop()}},t,null,[[1,6]])}));return function(e,n){return t.apply(this,arguments)}}()(i.localStore,u);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Xo(t,e){return Yo.apply(this,arguments)}function Yo(){return(Yo=Object(a.a)(w().mark(function t(e,n){var r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((r=D(e)).currentUser.isEqual(n)){t.next=11;break}return S("SyncEngine","User change. New user:",n.toKey()),t.next=5,Gr(r.localStore,n);case 5:return i=t.sent,r.currentUser=n,function(t,e){t.uc.forEach(function(t){t.forEach(function(t){t.reject(new P(N.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.uc.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),t.next=11,qo(r,i.Ki);case 11:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Qo(t){var e=D(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=No.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=D(t),r=n.ic.get(e);if(r&&r.Xu)return Sn().add(r.key);var i=Sn(),o=n.ec.get(e);if(!o)return i;var a,u=y(o);try{for(u.s();!(a=u.n()).done;){var s=a.value,c=n.tc.get(s);i=i.unionWith(c.view.qu)}}catch(l){u.e(l)}finally{u.f()}return i}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=function(t,e,n){return Fo.apply(this,arguments)}.bind(null,e),e.Zu.Go=function(t,e){var n,r=D(t),i=!1,o=y(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,u=a.query,s=r.queries.get(u);if(s){var c,l=y(s.listeners);try{for(l.s();!(c=l.n()).done;)c.value.Au(a)&&(i=!0)}catch(f){l.e(f)}finally{l.f()}s.Iu=a}}}catch(f){o.e(f)}finally{o.f()}i&&go(r)}.bind(null,e.eventManager),e.Zu.lc=function(t,e,n){var r=D(t),i=r.queries.get(e);if(i){var o,a=y(i.listeners);try{for(a.s();!(o=a.n()).done;)o.value.onError(n)}catch(u){a.e(u)}finally{a.f()}}r.queries.delete(e)}.bind(null,e.eventManager),e}function $o(t){var e=D(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=function(t,e){return Lo.apply(this,arguments)}.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=function(t,e,n){return jo.apply(this,arguments)}.bind(null,e),e}var Jo=function(){function t(){Object(f.a)(this,t),this.synchronizeTabs=!1}return Object(h.a)(t,[{key:"initialize",value:function(){var t=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.wt=li(e.databaseInfo.databaseId),this.sharedClientState=this.dc(e),this.persistence=this._c(e),t.next=5,this.persistence.start();case 5:this.localStore=this.wc(e),this.gcScheduler=this.mc(e,this.localStore),this.indexBackfillerScheduler=this.gc(e,this.localStore);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"mc",value:function(t,e){return null}},{key:"gc",value:function(t,e){return null}},{key:"wc",value:function(t){return Wr(this.persistence,new Ur,t.initialUser,this.wt)}},{key:"_c",value:function(t){return new Lr(Br.Ms,this.wt)}},{key:"dc",value:function(t){return new ri}},{key:"terminate",value:function(){var t=Object(a.a)(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),t.next=3,this.sharedClientState.shutdown();case 3:return t.next=5,this.persistence.shutdown();case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),t}(),Zo=function(){function t(){Object(f.a)(this,t)}return Object(h.a)(t,[{key:"initialize",value:function(){var t=Object(a.a)(w().mark(function t(e,n){var r=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.localStore,t.t0){t.next=12;break}return this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Mo(r.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Xo.bind(null,this.syncEngine),t.next=12,eo(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"createEventManager",value:function(t){return new fo}},{key:"createDatastore",value:function(t){var e,n=li(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new si(e));return function(t,e,n,r){return new vi(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(t){var e,n,r,i,o,a=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Mo(a.syncEngine,t,0)},o=oi.V()?new oi:new ii,new gi(e,n,r,i,o)}},{key:"createSyncEngine",value:function(t,e){return function(t,e,n,r,i,o,a){var u=new Co(t,e,n,r,i,o);return a&&(u.ac=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}},{key:"terminate",value:function(){return function(){var t=Object(a.a)(w().mark(function t(e){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=D(e),S("RemoteStore","RemoteStore shutting down."),n.lu.add(5),t.next=5,wi(n);case 5:n.du.shutdown(),n._u.set("Unknown");case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()(this.remoteStore)}}]),t}();var ta=function(){function t(e){Object(f.a)(this,t),this.observer=e,this.muted=!1}return Object(h.a)(t,[{key:"next",value:function(t){this.observer.next&&this.Ic(this.observer.next,t)}},{key:"error",value:function(t){this.observer.error?this.Ic(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}},{key:"Tc",value:function(){this.muted=!0}},{key:"Ic",value:function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)}}]),t}(),ea=function(){function t(e,n,r,i){var o=this;Object(f.a)(this,t),this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=k.UNAUTHENTICATED,this.clientId=G.I(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var t=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return S("FirestoreClient","Received user=",e.uid),t.next=3,o.authCredentialListener(e);case 3:o.user=e;case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),this.appCheckCredentials.start(r,function(t){return S("FirestoreClient","Received new app check token=",t),o.appCheckCredentialListener(t,o.user)})}return Object(h.a)(t,[{key:"getConfiguration",value:function(){var t=Object(a.a)(w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(t){this.authCredentialListener=t}},{key:"setAppCheckTokenChangeListener",value:function(t){this.appCheckCredentialListener=t}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new P(N.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new M;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(Object(a.a)(w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=t.onlineComponents,!n.t0){n.next=5;break}return n.next=5,t.onlineComponents.terminate();case 5:if(n.t1=t.offlineComponents,!n.t1){n.next=9;break}return n.next=9,t.offlineComponents.terminate();case 9:t.authCredentials.shutdown(),t.appCheckCredentials.shutdown(),e.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=ao(n.t2,"Failed to shutdown persistence"),e.reject(r);case 18:case"end":return n.stop()}},n,null,[[0,14]])}))),e.promise}}]),t}();function na(t,e){return ra.apply(this,arguments)}function ra(){return(ra=Object(a.a)(w().mark(function t(e,n){var r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.asyncQueue.verifyOperationInProgress(),S("FirestoreClient","Initializing OfflineComponentProvider"),t.next=3,e.getConfiguration();case 3:return r=t.sent,t.next=6,n.initialize(r);case 6:i=r.initialUser,e.setCredentialChangeListener(function(){var t=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=i.isEqual(e),t.t0){t.next=5;break}return t.next=4,Gr(n.localStore,e);case 4:i=e;case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=n;case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function ia(t,e){return oa.apply(this,arguments)}function oa(){return(oa=Object(a.a)(w().mark(function t(e,n){var r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.asyncQueue.verifyOperationInProgress(),t.next=3,aa(e);case 3:return r=t.sent,S("FirestoreClient","Initializing OnlineComponentProvider"),t.next=7,e.getConfiguration();case 7:return i=t.sent,t.next=10,n.initialize(r,i);case 10:e.setCredentialChangeListener(function(t){return Zi(n.remoteStore,t)}),e.setAppCheckTokenChangeListener(function(t,e){return Zi(n.remoteStore,e)}),e.onlineComponents=n;case 13:case"end":return t.stop()}},t)}))).apply(this,arguments)}function aa(t){return ua.apply(this,arguments)}function ua(){return(ua=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.offlineComponents,t.t0){t.next=5;break}return S("FirestoreClient","Using default OfflineComponentProvider"),t.next=5,na(e,new Jo);case 5:return t.abrupt("return",e.offlineComponents);case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}function sa(t){return ca.apply(this,arguments)}function ca(){return(ca=Object(a.a)(w().mark(function t(e){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.onlineComponents,t.t0){t.next=5;break}return S("FirestoreClient","Using default OnlineComponentProvider"),t.next=5,ia(e,new Zo);case 5:return t.abrupt("return",e.onlineComponents);case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}function la(t){return sa(t).then(function(t){return t.syncEngine})}function fa(t){return ha.apply(this,arguments)}function ha(){return(ha=Object(a.a)(w().mark(function t(e){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,sa(e);case 2:return n=t.sent,r=n.eventManager,t.abrupt("return",(r.onListen=_o.bind(null,n.syncEngine),r.onUnlisten=Io.bind(null,n.syncEngine),r));case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}function da(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new M;return t.asyncQueue.enqueueAndForget(Object(a.a)(w().mark(function i(){return w().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(t,e,n,r,i){var o=new ta({next:function(n){e.enqueueAndForget(function(){return vo(t,a)}),n.fromCache&&"server"===r.source?i.reject(new P(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),a=new yo(n,o,{includeMetadataChanges:!0,Du:!0});return ho(t,a)},i.next=3,fa(t);case 3:return i.t1=i.sent,i.t2=t.asyncQueue,i.t3=e,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise}var pa=new Map;function va(t,e,n){if(!n)throw new P(N.INVALID_ARGUMENT,"Function ".concat(t,"() cannot be called with an empty ").concat(e,"."))}function ma(t){if(!Z.isDocumentKey(t))throw new P(N.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(t," has ").concat(t.length,"."))}function ga(t){if(Z.isDocumentKey(t))throw new P(N.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(t," has ").concat(t.length,"."))}function ya(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t="".concat(t.substring(0,20),"...")),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){return t.constructor?t.constructor.name:null}(t);return e?"a custom ".concat(e," object"):"an object"}return"function"==typeof t?"a function":R()}function ba(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new P(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ya(t);throw new P(N.INVALID_ARGUMENT,"Expected type '".concat(e.name,"', but it was: ").concat(n))}return t}var wa=function(){function t(e){var n;if(Object(f.a)(this,t),void 0===e.host){if(void 0!==e.ssl)throw new P(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(n=e.ssl)||void 0===n||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new P(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(t,e,n,r){if(!0===e&&!0===r)throw new P(N.INVALID_ARGUMENT,"".concat(t," and ").concat(n," cannot be used together."))}("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}return Object(h.a)(t,[{key:"isEqual",value:function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}]),t}(),xa=function(){function t(e,n,r){Object(f.a)(this,t),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new wa({}),this._settingsFrozen=!1,e instanceof It?this._databaseId=e:(this._app=e,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new P(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new It(t.options.projectId)}(e))}return Object(h.a)(t,[{key:"_setSettings",value:function(t){if(this._settingsFrozen)throw new P(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new wa(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new L;switch(t.type){case"gapi":var e=t.client;return A(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new V(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new P(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(t){var e=pa.get(t);e&&(S("ComponentProvider","Removing Datastore"),pa.delete(t),e.terminate())}(this),Promise.resolve()}},{key:"app",get:function(){if(!this._app)throw new P(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}}]),t}();var ka=function(){function t(e,n,r){Object(f.a)(this,t),this.converter=n,this._key=r,this.type="document",this.firestore=e}return Object(h.a)(t,[{key:"withConverter",value:function(e){return new t(this.firestore,e,this._key)}},{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Ca(this.firestore,this.converter,this._key.path.popLast())}}]),t}(),Ea=function(){function t(e,n,r){Object(f.a)(this,t),this.converter=n,this._query=r,this.type="query",this.firestore=e}return Object(h.a)(t,[{key:"withConverter",value:function(e){return new t(this.firestore,e,this._query)}}]),t}(),Ca=function(t){function e(t,n,r){var i;return Object(f.a)(this,e),(i=Object(u.a)(this,Object(s.a)(e).call(this,t,n,ye(r))))._path=r,i.type="collection",i}return Object(c.a)(e,t),Object(h.a)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._path)}},{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var t=this._path.popLast();return t.isEmpty()?null:new ka(this.firestore,null,new Z(t))}}]),e}(Ea);function _a(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(t=Object(m.g)(t),va("collection","path",e),t instanceof xa){var o=Q.fromString.apply(Q,[e].concat(r));return ga(o),new Ca(t,null,o)}if(!(t instanceof ka||t instanceof Ca))throw new P(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var a=t._path.child(Q.fromString.apply(Q,[e].concat(r)));return ga(a),new Ca(t.firestore,null,a)}function Sa(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(t=Object(m.g)(t),1===arguments.length&&(e=G.I()),va("doc","path",e),t instanceof xa){var o=Q.fromString.apply(Q,[e].concat(r));return ma(o),new ka(t,null,new Z(o))}if(!(t instanceof ka||t instanceof Ca))throw new P(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var a=t._path.child(Q.fromString.apply(Q,[e].concat(r)));return ma(a),new ka(t.firestore,t instanceof Ca?t.converter:null,new Z(a))}var Ta=function(){function t(){var e=this;Object(f.a)(this,t),this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new fi(this,"async_queue_retry"),this.Kc=function(){var t=ci();t&&S("AsyncQueue","Visibility state changed to "+t.visibilityState),e.So.Eo()};var n=ci();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Kc)}return Object(h.a)(t,[{key:"enqueueAndForget",value:function(t){this.enqueue(t)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(t){this.Gc(),this.Qc(t)}},{key:"enterRestrictedMode",value:function(t){if(!this.Fc){this.Fc=!0,this.Uc=t||!1;var e=ci();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Kc)}}},{key:"enqueue",value:function(t){var e=this;if(this.Gc(),this.Fc)return new Promise(function(){});var n=new M;return this.Qc(function(){return e.Fc&&e.Uc?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})}},{key:"enqueueRetryable",value:function(t){var e=this;this.enqueueAndForget(function(){return e.Mc.push(t),e.jc()})}},{key:"jc",value:function(){var t=Object(a.a)(w().mark(function t(){var e=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0===this.Mc.length){t.next=14;break}return t.prev=1,t.next=4,this.Mc[0]();case 4:this.Mc.shift(),this.So.reset(),t.next=13;break;case 8:if(t.prev=8,t.t0=t.catch(1),lt(t.t0)){t.next=12;break}throw t.t0;case 12:S("AsyncQueue","Operation failed with retryable error: "+t.t0);case 13:this.Mc.length>0&&this.So.Io(function(){return e.jc()});case 14:case"end":return t.stop()}},t,this,[[1,8]])}));return function(){return t.apply(this,arguments)}}()},{key:"Qc",value:function(t){var e=this,n=this.Oc.then(function(){return e.Lc=!0,t().catch(function(t){throw e.Bc=t,e.Lc=!1,T("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.Lc=!1,t})});return this.Oc=n,n}},{key:"enqueueAfterDelay",value:function(t,e,n){var r=this;this.Gc(),this.qc.indexOf(t)>-1&&(e=0);var i=oo.createAndSchedule(this,t,e,n,function(t){return r.Wc(t)});return this.$c.push(i),i}},{key:"Gc",value:function(){this.Bc&&R()}},{key:"verifyOperationInProgress",value:function(){}},{key:"zc",value:function(){var t=Object(a.a)(w().mark(function t(){var e;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.Oc,t.next=3,e;case 3:if(e!==this.Oc){t.next=0;break}case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"Hc",value:function(t){var e,n=y(this.$c);try{for(n.s();!(e=n.n()).done;){if(e.value.timerId===t)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Jc",value:function(t){var e=this;return this.zc().then(function(){e.$c.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});var n,r=y(e.$c);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==t&&i.timerId===t)break}}catch(o){r.e(o)}finally{r.f()}return e.zc()})}},{key:"Yc",value:function(t){this.qc.push(t)}},{key:"Wc",value:function(t){var e=this.$c.indexOf(t);this.$c.splice(e,1)}},{key:"isShuttingDown",get:function(){return this.Fc}}]),t}();function Oa(t){return function(t,e){if("object"!=typeof t||null===t)return!1;var n,r=t,i=y(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o in r&&"function"==typeof r[o])return!0}}catch(a){i.e(a)}finally{i.f()}return!1}(t)}var Ia=function(t){function e(t,n,r){var i;return Object(f.a)(this,e),(i=Object(u.a)(this,Object(s.a)(e).call(this,t,n,r))).type="firestore",i._queue=new Ta,i._persistenceKey="name"in t?t.name:"[DEFAULT]",i}return Object(c.a)(e,t),Object(h.a)(e,[{key:"_terminate",value:function(){return this._firestoreClient||Da(this),this._firestoreClient.terminate()}}]),e}(xa);function Ra(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(d.e)();return Object(d.b)(t,"firestore").getImmediate()}function Aa(t){return t._firestoreClient||Da(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Da(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Ot(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ea(t._authCredentials,t._appCheckCredentials,t._queue,r)}var Na=function(){function t(){Object(f.a)(this,t);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new P(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new J(n)}return Object(h.a)(t,[{key:"isEqual",value:function(t){return this._internalPath.isEqual(t._internalPath)}}]),t}();var Pa=function(){function t(e){Object(f.a)(this,t),this._byteString=e}return Object(h.a)(t,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(t){return this._byteString.isEqual(t._byteString)}}],[{key:"fromBase64String",value:function(e){try{return new t(xt.fromBase64String(e))}catch(e){throw new P(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}},{key:"fromUint8Array",value:function(e){return new t(xt.fromUint8Array(e))}}]),t}(),Ma=function t(e){Object(f.a)(this,t),this._methodName=e},Fa=function(){function t(e,n){if(Object(f.a)(this,t),!isFinite(e)||e<-90||e>90)throw new P(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new P(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}return Object(h.a)(t,[{key:"isEqual",value:function(t){return this._lat===t._lat&&this._long===t._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(t){return H(this._lat,t._lat)||H(this._long,t._long)}},{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}}]),t}(),La=/^__.*__$/,ja=function(){function t(e,n,r){Object(f.a)(this,t),this.data=e,this.fieldMask=n,this.fieldTransforms=r}return Object(h.a)(t,[{key:"toMutation",value:function(t,e){return null!==this.fieldMask?new rn(t,this.data,this.fieldMask,e,this.fieldTransforms):new nn(t,this.data,e,this.fieldTransforms)}}]),t}(),Ba=function(){function t(e,n,r){Object(f.a)(this,t),this.data=e,this.fieldMask=n,this.fieldTransforms=r}return Object(h.a)(t,[{key:"toMutation",value:function(t,e){return new rn(t,this.data,this.fieldMask,e,this.fieldTransforms)}}]),t}();function Va(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R()}}var Ua=function(){function t(e,n,r,i,o,a){Object(f.a)(this,t),this.settings=e,this.databaseId=n,this.wt=r,this.ignoreUndefinedProperties=i,void 0===o&&this.Xc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}return Object(h.a)(t,[{key:"ta",value:function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"ea",value:function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ta({path:n,na:!1});return r.sa(t),r}},{key:"ia",value:function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ta({path:n,na:!1});return r.Xc(),r}},{key:"ra",value:function(t){return this.ta({path:void 0,na:!0})}},{key:"oa",value:function(t){return nu(t,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}},{key:"contains",value:function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})}},{key:"Xc",value:function(){if(this.path)for(var t=0;t<this.path.length;t++)this.sa(this.path.get(t))}},{key:"sa",value:function(t){if(0===t.length)throw this.oa("Document fields must not be empty");if(Va(this.Zc)&&La.test(t))throw this.oa('Document fields cannot begin and end with "__"')}},{key:"path",get:function(){return this.settings.path}},{key:"Zc",get:function(){return this.settings.Zc}}]),t}(),za=function(){function t(e,n,r){Object(f.a)(this,t),this.databaseId=e,this.ignoreUndefinedProperties=n,this.wt=r||li(e)}return Object(h.a)(t,[{key:"aa",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Ua({Zc:t,methodName:e,ca:n,path:J.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}]),t}();function Wa(t){var e=t._freezeSettings(),n=li(t._databaseId);return new za(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Ga(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=t.aa(o.merge||o.mergeFields?2:0,e,n,i);Ja("Data must be an object, but it was:",a,r);var u,s,c=Qa(r,a);if(o.merge)u=new wt(a.fieldMask),s=a.fieldTransforms;else if(o.mergeFields){var l,f=[],h=y(o.mergeFields);try{for(h.s();!(l=h.n()).done;){var d=Za(e,l.value,n);if(!a.contains(d))throw new P(N.INVALID_ARGUMENT,"Field '".concat(d,"' is specified in your field mask but missing from your input data."));ru(f,d)||f.push(d)}}catch(p){h.e(p)}finally{h.f()}u=new wt(f),s=a.fieldTransforms.filter(function(t){return u.covers(t.field)})}else u=null,s=a.fieldTransforms;return new ja(new Xt(c),u,s)}var Ha=function(t){function e(){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"_toFieldTransform",value:function(t){if(2!==t.Zc)throw 1===t.Zc?t.oa("".concat(this._methodName,"() can only appear at the top level of your update data")):t.oa("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return t.fieldMask.push(t.path),null}},{key:"isEqual",value:function(t){return t instanceof e}}]),e}(Ma);function qa(t,e,n,r){var i=t.aa(1,e,n);Ja("Data must be an object, but it was:",i,r);var o=[],a=Xt.empty();dt(r,function(t,r){var u=eu(e,t,n);r=Object(m.g)(r);var s=i.ia(u);if(r instanceof Ha)o.push(u);else{var c=Ya(r,s);null!=c&&(o.push(u),a.set(u,c))}});var u=new wt(o);return new Ba(a,u,i.fieldTransforms)}function Ka(t,e,n,r,i,o){var a=t.aa(1,e,n),u=[Za(e,r,n)],s=[i];if(o.length%2!=0)throw new P(N.INVALID_ARGUMENT,"Function ".concat(e,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<o.length;c+=2)u.push(Za(e,o[c])),s.push(o[c+1]);for(var l=[],f=Xt.empty(),h=u.length-1;h>=0;--h)if(!ru(l,u[h])){var d=u[h],p=s[h];p=Object(m.g)(p);var v=a.ia(d);if(p instanceof Ha)l.push(d);else{var g=Ya(p,v);null!=g&&(l.push(d),f.set(d,g))}}var y=new wt(l);return new Ba(f,y,a.fieldTransforms)}function Xa(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Ya(n,t.aa(r?4:3,e))}function Ya(t,e){if($a(t=Object(m.g)(t)))return Ja("Unsupported field value:",e,t),Qa(t,e);if(t instanceof Ma)return function(t,e){if(!Va(e.Zc))throw e.oa("".concat(t._methodName,"() can only be used with update() and set()"));if(!e.path)throw e.oa("".concat(t._methodName,"() is not currently supported inside arrays"));var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.na&&4!==e.Zc)throw e.oa("Nested arrays are not supported");return function(t,e){var n,r=[],i=0,o=y(t);try{for(o.s();!(n=o.n()).done;){var a=Ya(n.value,e.ra(i));null==a&&(a={nullValue:"NULL_VALUE"}),r.push(a),i++}}catch(u){o.e(u)}finally{o.f()}return{arrayValue:{values:r}}}(t,e)}return function(t,e){if(null===(t=Object(m.g)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Pe(e.wt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=K.fromDate(t);return{timestampValue:Un(e.wt,n)}}if(t instanceof K){var r=new K(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Un(e.wt,r)}}if(t instanceof Fa)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Pa)return{bytesValue:zn(e.wt,t._byteString)};if(t instanceof ka){var i=e.databaseId,o=t.firestore._databaseId;if(!o.isEqual(i))throw e.oa("Document reference is for database ".concat(o.projectId,"/").concat(o.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Hn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.oa("Unsupported field value: ".concat(ya(t)))}(t,e)}function Qa(t,e){var n={};return pt(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):dt(t,function(t,r){var i=Ya(r,e.ea(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function $a(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof K||t instanceof Fa||t instanceof Pa||t instanceof ka||t instanceof Ma)}function Ja(t,e,n){if(!$a(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=ya(n);throw"an object"===r?e.oa(t+" a custom object"):e.oa(t+" "+r)}}function Za(t,e,n){if((e=Object(m.g)(e))instanceof Na)return e._internalPath;if("string"==typeof e)return eu(t,e);throw nu("Field path arguments must be of type string or ",t,!1,void 0,n)}var tu=new RegExp("[~\\*/\\[\\]]");function eu(t,e,n){if(e.search(tu)>=0)throw nu("Invalid field path (".concat(e,"). Paths must not contain '~', '*', '/', '[', or ']'"),t,!1,void 0,n);try{return Object(r.a)(Na,Object(l.a)(e.split(".")))._internalPath}catch(i){throw nu("Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),t,!1,void 0,n)}}function nu(t,e,n,r,i){var o=r&&!r.isEmpty(),a=void 0!==i,u="Function ".concat(e,"() called with invalid data");n&&(u+=" (via `toFirestore()`)"),u+=". ";var s="";return(o||a)&&(s+=" (found",o&&(s+=" in field ".concat(r)),a&&(s+=" in document ".concat(i)),s+=")"),new P(N.INVALID_ARGUMENT,u+t+s)}function ru(t,e){return t.some(function(t){return t.isEqual(e)})}var iu=function(){function t(e,n,r,i,o){Object(f.a)(this,t),this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}return Object(h.a)(t,[{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var t=new ou(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(t){if(this._document){var e=this._document.data.field(au("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new ka(this._firestore,this._converter,this._key)}}]),t}(),ou=function(t){function e(){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"data",value:function(){return Object(i.a)(Object(s.a)(e.prototype),"data",this).call(this)}}]),e}(iu);function au(t,e){return"string"==typeof e?eu(t,e):e instanceof Na?e._internalPath:e._delegate._internalPath}var uu=function(){function t(e,n){Object(f.a)(this,t),this.hasPendingWrites=e,this.fromCache=n}return Object(h.a)(t,[{key:"isEqual",value:function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}]),t}(),su=function(t){function e(t,n,r,i,o,a){var c;return Object(f.a)(this,e),(c=Object(u.a)(this,Object(s.a)(e).call(this,t,n,r,i,a)))._firestore=t,c._firestoreImpl=t,c.metadata=o,c}return Object(c.a)(e,t),Object(h.a)(e,[{key:"exists",value:function(){return Object(i.a)(Object(s.a)(e.prototype),"exists",this).call(this)}},{key:"data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var e=new cu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(au("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}]),e}(iu),cu=function(t){function e(){return Object(f.a)(this,e),Object(u.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(h.a)(e,[{key:"data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)(Object(s.a)(e.prototype),"data",this).call(this,t)}}]),e}(su),lu=function(){function t(e,n,r,i){Object(f.a)(this,t),this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new uu(i.hasPendingWrites,i.fromCache),this.query=r}return Object(h.a)(t,[{key:"forEach",value:function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new cu(n._firestore,n._userDataWriter,r.key,r,new uu(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})}},{key:"docChanges",value:function(){var t=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new cu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new uu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new cu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new uu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:fu(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}},{key:"docs",get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}}]),t}();function fu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R()}}function hu(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new P(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var du=function t(){Object(f.a)(this,t)};function pu(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){t=o[i]._apply(t)}return t}var vu=function(t){function e(t,n,r){var i;return Object(f.a)(this,e),(i=Object(u.a)(this,Object(s.a)(e).call(this))).fa=t,i.da=n,i._a=r,i.type="where",i}return Object(c.a)(e,t),Object(h.a)(e,[{key:"_apply",value:function(t){var e=Wa(t.firestore),n=function(t,e,n,r,i,o,a){var u;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new P(N.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(o,"' queries on documentId()."));if("in"===o||"not-in"===o){wu(a,o);var s,c=[],l=y(a);try{for(l.s();!(s=l.n()).done;){var f=s.value;c.push(bu(r,t,f))}}catch(d){l.e(d)}finally{l.f()}u={arrayValue:{values:c}}}else u=bu(r,t,a)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||wu(a,o),u=Xa(n,"where",a,"in"===o||"not-in"===o);var h=ne.create(i,o,u);return function(t,e){if(e.ht()){var n=we(t);if(null!==n&&!n.isEqual(e.field))throw new P(N.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(e.field.toString(),"'"));var r=be(t);null!==r&&xu(t,e.field,r)}var i=function(t,e){var n,r=y(t.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(e.indexOf(i.op)>=0)return i.op}}catch(d){r.e(d)}finally{r.f()}return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new P(N.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(e.op.toString(),"' filter.")):new P(N.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(e.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(t,h),h}(t._query,0,e,t.firestore._databaseId,this.fa,this.da,this._a);return new Ea(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}]),e}(du);function mu(t,e,n){var r=e,i=au("where",t);return new vu(i,r,n)}var gu=function(t){function e(t,n){var r;return Object(f.a)(this,e),(r=Object(u.a)(this,Object(s.a)(e).call(this))).fa=t,r.wa=n,r.type="orderBy",r}return Object(c.a)(e,t),Object(h.a)(e,[{key:"_apply",value:function(t){var e=function(t,e,n){if(null!==t.startAt)throw new P(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new P(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new he(e,n);return function(t,e){if(null===be(t)){var n=we(t);null!==n&&xu(t,n,e.field)}}(t,r),r}(t._query,this.fa,this.wa);return new Ea(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new me(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}]),e}(du);function yu(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=au("orderBy",t);return new gu(n,e)}function bu(t,e,n){if("string"==typeof(n=Object(m.g)(n))){if(""===n)throw new P(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xe(e)&&-1!==n.indexOf("/"))throw new P(N.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=e.path.child(Q.fromString(n));if(!Z.isDocumentKey(r))throw new P(N.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Vt(t,new Z(r))}if(n instanceof ka)return Vt(t,n._key);throw new P(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(ya(n),"."))}function wu(t,e){if(!Array.isArray(t)||0===t.length)throw new P(N.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(e.toString(),"' filters."));if(t.length>10)throw new P(N.INVALID_ARGUMENT,"Invalid Query. '".concat(e.toString(),"' filters support a maximum of 10 elements in the value array."))}function xu(t,e,n){if(!n.isEqual(e))throw new P(N.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(e.toString(),"' and so you must also use '").concat(e.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var ku=function(){function t(){Object(f.a)(this,t)}return Object(h.a)(t,[{key:"convertValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Pt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ct(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(_t(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw R()}}},{key:"convertObject",value:function(t,e){var n=this,r={};return dt(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r}},{key:"convertGeoPoint",value:function(t){return new Fa(Ct(t.latitude),Ct(t.longitude))}},{key:"convertArray",value:function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})}},{key:"convertServerTimestamp",value:function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return St(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Tt(t));default:return null}}},{key:"convertTimestamp",value:function(t){var e=Et(t);return new K(e.seconds,e.nanos)}},{key:"convertDocumentKey",value:function(t,e){var n=Q.fromString(t);A(fr(n));var r=new It(n.get(1),n.get(3)),i=new Z(n.popFirst(5));return r.isEqual(e)||T("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(e.projectId,"/").concat(e.database,") instead.")),i}}]),t}();function Eu(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Cu=function(t){function e(t){var n;return Object(f.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this))).firestore=t,n}return Object(c.a)(e,t),Object(h.a)(e,[{key:"convertBytes",value:function(t){return new Pa(t)}},{key:"convertReference",value:function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new ka(this.firestore,null,e)}}]),e}(ku);function _u(t){t=ba(t,Ea);var e=ba(t.firestore,Ia),n=Aa(e),r=new Cu(e);return hu(t._query),da(n,t._query).then(function(n){return new lu(e,r,t,n)})}function Su(t,e,n){t=ba(t,ka);var r=ba(t.firestore,Ia),i=Eu(t.converter,e,n);return Iu(r,[Ga(Wa(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Xe.none())])}function Tu(t,e,n){t=ba(t,ka);for(var r=ba(t.firestore,Ia),i=Wa(r),o=arguments.length,a=new Array(o>3?o-3:0),u=3;u<o;u++)a[u-3]=arguments[u];return Iu(r,[("string"==typeof(e=Object(m.g)(e))||e instanceof Na?Ka(i,"updateDoc",t._key,e,n,a):qa(i,"updateDoc",t._key,e)).toMutation(t._key,Xe.exists(!0))])}function Ou(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i,o,u;t=Object(m.g)(t);var s={includeMetadataChanges:!1},c=0;"object"!=typeof n[c]||Oa(n[c])||(s=n[c],c++);var l,f,h,d={includeMetadataChanges:s.includeMetadataChanges};if(Oa(n[c])){var p=n[c];n[c]=null===(i=p.next)||void 0===i?void 0:i.bind(p),n[c+1]=null===(o=p.error)||void 0===o?void 0:o.bind(p),n[c+2]=null===(u=p.complete)||void 0===u?void 0:u.bind(p)}if(t instanceof ka)f=ba(t.firestore,Ia),h=ye(t._key.path),l={next:function(e){n[c]&&n[c](Ru(f,t,e))},error:n[c+1],complete:n[c+2]};else{var v=ba(t,Ea);f=ba(v.firestore,Ia),h=v._query;var g=new Cu(f);l={next:function(t){n[c]&&n[c](new lu(f,g,v,t))},error:n[c+1],complete:n[c+2]},hu(t._query)}return function(t,e,n,r){var i=new ta(l),o=new yo(e,i,n);return t.asyncQueue.enqueueAndForget(Object(a.a)(w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ho,e.next=3,fa(t);case 3:return e.t1=e.sent,e.t2=o,e.abrupt("return",(0,e.t0)(e.t1,e.t2));case 6:case"end":return e.stop()}},e)}))),function(){i.Tc(),t.asyncQueue.enqueueAndForget(Object(a.a)(w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=vo,e.next=3,fa(t);case 3:return e.t1=e.sent,e.t2=o,e.abrupt("return",(0,e.t0)(e.t1,e.t2));case 6:case"end":return e.stop()}},e)})))}}(Aa(f),h,d)}function Iu(t,e){return function(t,e){var n=new M;return t.asyncQueue.enqueueAndForget(Object(a.a)(w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Ao,r.next=3,la(t);case 3:return r.t1=r.sent,r.t2=e,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}},r)}))),n.promise}(Aa(t),e)}function Ru(t,e,n){var r=n.docs.get(e._key),i=new Cu(t);return new su(t,i,e._key,r,new uu(n.hasPendingWrites,n.fromCache),e.converter)}!function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(t){E=t}(d.a),Object(d.c)(new p.a("firestore",function(t,n){var r=n.options,i=t.getProvider("app").getImmediate(),o=new Ia(i,new j(t.getProvider("auth-internal")),new z(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC")),Object(d.g)(x,"3.4.11",void 0),Object(d.g)(x,"3.4.11","esm2017")}()}).call(this,n(26))},function(t,e,n){"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(38)},function(t,e,n){"use strict";var r=n(13);n.d(e,"a",function(){return r.f});Object(r.g)("firebase","9.8.4","app")},function(t,e,n){"use strict";var r=n(6),i=n(25);var o=n(27);function a(t){var e="function"===typeof Map?new Map:void 0;return(a=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,a)}function a(){return Object(o.a)(t,arguments,Object(r.a)(this).constructor)}return a.prototype=Object.create(t.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),Object(i.a)(a,t)})(t)}n.d(e,"a",function(){return a})},,function(t,e,n){"use strict";var r=n(31),i="function"===typeof Symbol&&Symbol.for,o=i?Symbol.for("react.element"):60103,a=i?Symbol.for("react.portal"):60106,u=i?Symbol.for("react.fragment"):60107,s=i?Symbol.for("react.strict_mode"):60108,c=i?Symbol.for("react.profiler"):60114,l=i?Symbol.for("react.provider"):60109,f=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.forward_ref"):60112,d=i?Symbol.for("react.suspense"):60113,p=i?Symbol.for("react.memo"):60115,v=i?Symbol.for("react.lazy"):60116,m="function"===typeof Symbol&&Symbol.iterator;function g(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function w(t,e,n){this.props=t,this.context=e,this.refs=b,this.updater=n||y}function x(){}function k(t,e,n){this.props=t,this.context=e,this.refs=b,this.updater=n||y}w.prototype.isReactComponent={},w.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error(g(85));this.updater.enqueueSetState(this,t,e,"setState")},w.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},x.prototype=w.prototype;var E=k.prototype=new x;E.constructor=k,r(E,w.prototype),E.isPureReactComponent=!0;var C={current:null},_=Object.prototype.hasOwnProperty,S={key:!0,ref:!0,__self:!0,__source:!0};function T(t,e,n){var r,i={},a=null,u=null;if(null!=e)for(r in void 0!==e.ref&&(u=e.ref),void 0!==e.key&&(a=""+e.key),e)_.call(e,r)&&!S.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in s=t.defaultProps)void 0===i[r]&&(i[r]=s[r]);return{$$typeof:o,type:t,key:a,ref:u,props:i,_owner:C.current}}function O(t){return"object"===typeof t&&null!==t&&t.$$typeof===o}var I=/\/+/g,R=[];function A(t,e,n,r){if(R.length){var i=R.pop();return i.result=t,i.keyPrefix=e,i.func=n,i.context=r,i.count=0,i}return{result:t,keyPrefix:e,func:n,context:r,count:0}}function D(t){t.result=null,t.keyPrefix=null,t.func=null,t.context=null,t.count=0,10>R.length&&R.push(t)}function N(t,e,n){return null==t?0:function t(e,n,r,i){var u=typeof e;"undefined"!==u&&"boolean"!==u||(e=null);var s=!1;if(null===e)s=!0;else switch(u){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case o:case a:s=!0}}if(s)return r(i,e,""===n?"."+P(e,0):n),1;if(s=0,n=""===n?".":n+":",Array.isArray(e))for(var c=0;c<e.length;c++){var l=n+P(u=e[c],c);s+=t(u,l,r,i)}else if(l=null===e||"object"!==typeof e?null:"function"===typeof(l=m&&e[m]||e["@@iterator"])?l:null,"function"===typeof l)for(e=l.call(e),c=0;!(u=e.next()).done;)s+=t(u=u.value,l=n+P(u,c++),r,i);else if("object"===u)throw r=""+e,Error(g(31,"[object Object]"===r?"object with keys {"+Object.keys(e).join(", ")+"}":r,""));return s}(t,"",e,n)}function P(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+(""+t).replace(/[=:]/g,function(t){return e[t]})}(t.key):e.toString(36)}function M(t,e){t.func.call(t.context,e,t.count++)}function F(t,e,n){var r=t.result,i=t.keyPrefix;t=t.func.call(t.context,e,t.count++),Array.isArray(t)?L(t,r,n,function(t){return t}):null!=t&&(O(t)&&(t=function(t,e){return{$$typeof:o,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(t,i+(!t.key||e&&e.key===t.key?"":(""+t.key).replace(I,"$&/")+"/")+n)),r.push(t))}function L(t,e,n,r,i){var o="";null!=n&&(o=(""+n).replace(I,"$&/")+"/"),N(t,F,e=A(e,o,r,i)),D(e)}var j={current:null};function B(){var t=j.current;if(null===t)throw Error(g(321));return t}var V={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:C,IsSomeRendererActing:{current:!1},assign:r};e.Children={map:function(t,e,n){if(null==t)return t;var r=[];return L(t,r,null,e,n),r},forEach:function(t,e,n){if(null==t)return t;N(t,M,e=A(null,null,e,n)),D(e)},count:function(t){return N(t,function(){return null},null)},toArray:function(t){var e=[];return L(t,e,null,function(t){return t}),e},only:function(t){if(!O(t))throw Error(g(143));return t}},e.Component=w,e.Fragment=u,e.Profiler=c,e.PureComponent=k,e.StrictMode=s,e.Suspense=d,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,e.cloneElement=function(t,e,n){if(null===t||void 0===t)throw Error(g(267,t));var i=r({},t.props),a=t.key,u=t.ref,s=t._owner;if(null!=e){if(void 0!==e.ref&&(u=e.ref,s=C.current),void 0!==e.key&&(a=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(l in e)_.call(e,l)&&!S.hasOwnProperty(l)&&(i[l]=void 0===e[l]&&void 0!==c?c[l]:e[l])}var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){c=Array(l);for(var f=0;f<l;f++)c[f]=arguments[f+2];i.children=c}return{$$typeof:o,type:t.type,key:a,ref:u,props:i,_owner:s}},e.createContext=function(t,e){return void 0===e&&(e=null),(t={$$typeof:f,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:l,_context:t},t.Consumer=t},e.createElement=T,e.createFactory=function(t){var e=T.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:h,render:t}},e.isValidElement=O,e.lazy=function(t){return{$$typeof:v,_ctor:t,_status:-1,_result:null}},e.memo=function(t,e){return{$$typeof:p,type:t,compare:void 0===e?null:e}},e.useCallback=function(t,e){return B().useCallback(t,e)},e.useContext=function(t,e){return B().useContext(t,e)},e.useDebugValue=function(){},e.useEffect=function(t,e){return B().useEffect(t,e)},e.useImperativeHandle=function(t,e,n){return B().useImperativeHandle(t,e,n)},e.useLayoutEffect=function(t,e){return B().useLayoutEffect(t,e)},e.useMemo=function(t,e){return B().useMemo(t,e)},e.useReducer=function(t,e,n){return B().useReducer(t,e,n)},e.useRef=function(t){return B().useRef(t)},e.useState=function(t){return B().useState(t)},e.version="16.14.0"},function(t,e,n){"use strict";var r=n(4),i=n(31),o=n(39);function a(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(a(227));var u=!1,s=null,c=!1,l=null,f={onError:function(t){u=!0,s=t}};function h(t,e,n,r,i,o,a,c,l){u=!1,s=null,function(t,e,n,r,i,o,a,u,s){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(l){this.onError(l)}}.apply(f,arguments)}var d=null,p=null,v=null;function m(t,e,n){var r=t.type||"unknown-event";t.currentTarget=v(n),function(t,e,n,r,i,o,f,d,p){if(h.apply(this,arguments),u){if(!u)throw Error(a(198));var v=s;u=!1,s=null,c||(c=!0,l=v)}}(r,e,void 0,t),t.currentTarget=null}var g=null,y={};function b(){if(g)for(var t in y){var e=y[t],n=g.indexOf(t);if(!(-1<n))throw Error(a(96,t));if(!x[n]){if(!e.extractEvents)throw Error(a(97,t));for(var r in x[n]=e,n=e.eventTypes){var i=void 0,o=n[r],u=e,s=r;if(k.hasOwnProperty(s))throw Error(a(99,s));k[s]=o;var c=o.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&w(c[i],u,s);i=!0}else o.registrationName?(w(o.registrationName,u,s),i=!0):i=!1;if(!i)throw Error(a(98,r,t))}}}}function w(t,e,n){if(E[t])throw Error(a(100,t));E[t]=e,C[t]=e.eventTypes[n].dependencies}var x=[],k={},E={},C={};function _(t){var e,n=!1;for(e in t)if(t.hasOwnProperty(e)){var r=t[e];if(!y.hasOwnProperty(e)||y[e]!==r){if(y[e])throw Error(a(102,e));y[e]=r,n=!0}}n&&b()}var S=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),T=null,O=null,I=null;function R(t){if(t=p(t)){if("function"!==typeof T)throw Error(a(280));var e=t.stateNode;e&&(e=d(e),T(t.stateNode,t.type,e))}}function A(t){O?I?I.push(t):I=[t]:O=t}function D(){if(O){var t=O,e=I;if(I=O=null,R(t),e)for(t=0;t<e.length;t++)R(e[t])}}function N(t,e){return t(e)}function P(t,e,n,r,i){return t(e,n,r,i)}function M(){}var F=N,L=!1,j=!1;function B(){null===O&&null===I||(M(),D())}function V(t,e,n){if(j)return t(e,n);j=!0;try{return F(t,e,n)}finally{j=!1,B()}}var U=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,z=Object.prototype.hasOwnProperty,W={},G={};function H(t,e,n,r,i,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o}var q={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){q[t]=new H(t,0,!1,t,null,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];q[e]=new H(e,1,!1,t[1],null,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){q[t]=new H(t,2,!1,t.toLowerCase(),null,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){q[t]=new H(t,2,!1,t,null,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){q[t]=new H(t,3,!1,t.toLowerCase(),null,!1)}),["checked","multiple","muted","selected"].forEach(function(t){q[t]=new H(t,3,!0,t,null,!1)}),["capture","download"].forEach(function(t){q[t]=new H(t,4,!1,t,null,!1)}),["cols","rows","size","span"].forEach(function(t){q[t]=new H(t,6,!1,t,null,!1)}),["rowSpan","start"].forEach(function(t){q[t]=new H(t,5,!1,t.toLowerCase(),null,!1)});var K=/[\-:]([a-z])/g;function X(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(K,X);q[e]=new H(e,1,!1,t,null,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(K,X);q[e]=new H(e,1,!1,t,"http://www.w3.org/1999/xlink",!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(K,X);q[e]=new H(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1)}),["tabIndex","crossOrigin"].forEach(function(t){q[t]=new H(t,1,!1,t.toLowerCase(),null,!1)}),q.xlinkHref=new H("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach(function(t){q[t]=new H(t,1,!1,t.toLowerCase(),null,!0)});var Y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Q(t,e,n,r){var i=q.hasOwnProperty(e)?q[e]:null;(null!==i?0===i.type:!r&&(2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1])))||(function(t,e,n,r){if(null===e||"undefined"===typeof e||function(t,e,n,r){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,i,r)&&(n=null),r||null===i?function(t){return!!z.call(G,t)||!z.call(W,t)&&(U.test(t)?G[t]=!0:(W[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=null===n?3!==i.type&&"":n:(e=i.attributeName,r=i.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}Y.hasOwnProperty("ReactCurrentDispatcher")||(Y.ReactCurrentDispatcher={current:null}),Y.hasOwnProperty("ReactCurrentBatchConfig")||(Y.ReactCurrentBatchConfig={suspense:null});var $=/^(.*)[\\\/]/,J="function"===typeof Symbol&&Symbol.for,Z=J?Symbol.for("react.element"):60103,tt=J?Symbol.for("react.portal"):60106,et=J?Symbol.for("react.fragment"):60107,nt=J?Symbol.for("react.strict_mode"):60108,rt=J?Symbol.for("react.profiler"):60114,it=J?Symbol.for("react.provider"):60109,ot=J?Symbol.for("react.context"):60110,at=J?Symbol.for("react.concurrent_mode"):60111,ut=J?Symbol.for("react.forward_ref"):60112,st=J?Symbol.for("react.suspense"):60113,ct=J?Symbol.for("react.suspense_list"):60120,lt=J?Symbol.for("react.memo"):60115,ft=J?Symbol.for("react.lazy"):60116,ht=J?Symbol.for("react.block"):60121,dt="function"===typeof Symbol&&Symbol.iterator;function pt(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=dt&&t[dt]||t["@@iterator"])?t:null}function vt(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case et:return"Fragment";case tt:return"Portal";case rt:return"Profiler";case nt:return"StrictMode";case st:return"Suspense";case ct:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case ot:return"Context.Consumer";case it:return"Context.Provider";case ut:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case lt:return vt(t.type);case ht:return vt(t.render);case ft:if(t=1===t._status?t._result:null)return vt(t)}return null}function mt(t){var e="";do{t:switch(t.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break t;default:var r=t._debugOwner,i=t._debugSource,o=vt(t.type);n=null,r&&(n=vt(r.type)),r=o,o="",i?o=" (at "+i.fileName.replace($,"")+":"+i.lineNumber+")":n&&(o=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+o}e+=n,t=t.return}while(t);return e}function gt(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function yt(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function bt(t){t._valueTracker||(t._valueTracker=function(t){var e=yt(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(t){r=""+t,o.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(t){r=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function wt(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=yt(t)?t.checked?"true":"false":t.value),(t=r)!==n&&(e.setValue(t),!0)}function xt(t,e){var n=e.checked;return i({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function kt(t,e){var n=null==e.defaultValue?"":e.defaultValue,r=null!=e.checked?e.checked:e.defaultChecked;n=gt(null!=e.value?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function Et(t,e){null!=(e=e.checked)&&Q(t,"checked",e,!1)}function Ct(t,e){Et(t,e);var n=gt(e.value),r=e.type;if(null!=n)"number"===r?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===r||"reset"===r)return void t.removeAttribute("value");e.hasOwnProperty("value")?St(t,e.type,n):e.hasOwnProperty("defaultValue")&&St(t,e.type,gt(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function _t(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!("submit"!==r&&"reset"!==r||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function St(t,e,n){"number"===e&&t.ownerDocument.activeElement===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function Tt(t,e){return t=i({children:void 0},e),(e=function(t){var e="";return r.Children.forEach(t,function(t){null!=t&&(e+=t)}),e}(e.children))&&(t.children=e),t}function Ot(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+gt(n),e=null,i=0;i<t.length;i++){if(t[i].value===n)return t[i].selected=!0,void(r&&(t[i].defaultSelected=!0));null!==e||t[i].disabled||(e=t[i])}null!==e&&(e.selected=!0)}}function It(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(a(91));return i({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Rt(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(a(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(a(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:gt(n)}}function At(t,e){var n=gt(e.value),r=gt(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=r&&(t.defaultValue=""+r)}function Dt(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}var Nt="http://www.w3.org/1999/xhtml",Pt="http://www.w3.org/2000/svg";function Mt(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ft(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?Mt(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var Lt,jt,Bt=(jt=function(t,e){if(t.namespaceURI!==Pt||"innerHTML"in t)t.innerHTML=e;else{for((Lt=Lt||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Lt.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,r){MSApp.execUnsafeLocalFunction(function(){return jt(t,e)})}:jt);function Vt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}function Ut(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var zt={animationend:Ut("Animation","AnimationEnd"),animationiteration:Ut("Animation","AnimationIteration"),animationstart:Ut("Animation","AnimationStart"),transitionend:Ut("Transition","TransitionEnd")},Wt={},Gt={};function Ht(t){if(Wt[t])return Wt[t];if(!zt[t])return t;var e,n=zt[t];for(e in n)if(n.hasOwnProperty(e)&&e in Gt)return Wt[t]=n[e];return t}S&&(Gt=document.createElement("div").style,"AnimationEvent"in window||(delete zt.animationend.animation,delete zt.animationiteration.animation,delete zt.animationstart.animation),"TransitionEvent"in window||delete zt.transitionend.transition);var qt=Ht("animationend"),Kt=Ht("animationiteration"),Xt=Ht("animationstart"),Yt=Ht("transitionend"),Qt="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$t=new("function"===typeof WeakMap?WeakMap:Map);function Jt(t){var e=$t.get(t);return void 0===e&&(e=new Map,$t.set(t,e)),e}function Zt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(1026&(e=t).effectTag)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function te(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function ee(t){if(Zt(t)!==t)throw Error(a(188))}function ne(t){if(!(t=function(t){var e=t.alternate;if(!e){if(null===(e=Zt(t)))throw Error(a(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return ee(i),t;if(o===r)return ee(i),e;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var u=!1,s=i.child;s;){if(s===n){u=!0,n=i,r=o;break}if(s===r){u=!0,r=i,n=o;break}s=s.sibling}if(!u){for(s=o.child;s;){if(s===n){u=!0,n=o,r=i;break}if(s===r){u=!0,r=o,n=i;break}s=s.sibling}if(!u)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?t:e}(t)))return null;for(var e=t;;){if(5===e.tag||6===e.tag)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function re(t,e){if(null==e)throw Error(a(30));return null==t?e:Array.isArray(t)?Array.isArray(e)?(t.push.apply(t,e),t):(t.push(e),t):Array.isArray(e)?[t].concat(e):[t,e]}function ie(t,e,n){Array.isArray(t)?t.forEach(e,n):t&&e.call(n,t)}var oe=null;function ae(t){if(t){var e=t._dispatchListeners,n=t._dispatchInstances;if(Array.isArray(e))for(var r=0;r<e.length&&!t.isPropagationStopped();r++)m(t,e[r],n[r]);else e&&m(t,e,n);t._dispatchListeners=null,t._dispatchInstances=null,t.isPersistent()||t.constructor.release(t)}}function ue(t){if(null!==t&&(oe=re(oe,t)),t=oe,oe=null,t){if(ie(t,ae),oe)throw Error(a(95));if(c)throw t=l,c=!1,l=null,t}}function se(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}function ce(t){if(!S)return!1;var e=(t="on"+t)in document;return e||((e=document.createElement("div")).setAttribute(t,"return;"),e="function"===typeof e[t]),e}var le=[];function fe(t){t.topLevelType=null,t.nativeEvent=null,t.targetInst=null,t.ancestors.length=0,10>le.length&&le.push(t)}function he(t,e,n,r){if(le.length){var i=le.pop();return i.topLevelType=t,i.eventSystemFlags=r,i.nativeEvent=e,i.targetInst=n,i}return{topLevelType:t,eventSystemFlags:r,nativeEvent:e,targetInst:n,ancestors:[]}}function de(t){var e=t.targetInst,n=e;do{if(!n){t.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(e=n.tag)&&6!==e||t.ancestors.push(n),n=In(r)}while(n);for(n=0;n<t.ancestors.length;n++){e=t.ancestors[n];var i=se(t.nativeEvent);r=t.topLevelType;var o=t.nativeEvent,a=t.eventSystemFlags;0===n&&(a|=64);for(var u=null,s=0;s<x.length;s++){var c=x[s];c&&(c=c.extractEvents(r,e,o,i,a))&&(u=re(u,c))}ue(u)}}function pe(t,e,n){if(!n.has(t)){switch(t){case"scroll":Xe(e,"scroll",!0);break;case"focus":case"blur":Xe(e,"focus",!0),Xe(e,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":ce(t)&&Xe(e,t,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Qt.indexOf(t)&&Ke(t,e)}n.set(t,null)}}var ve,me,ge,ye=!1,be=[],we=null,xe=null,ke=null,Ee=new Map,Ce=new Map,_e=[],Se="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Te="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Oe(t,e,n,r,i){return{blockedOn:t,topLevelType:e,eventSystemFlags:32|n,nativeEvent:i,container:r}}function Ie(t,e){switch(t){case"focus":case"blur":we=null;break;case"dragenter":case"dragleave":xe=null;break;case"mouseover":case"mouseout":ke=null;break;case"pointerover":case"pointerout":Ee.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ce.delete(e.pointerId)}}function Re(t,e,n,r,i,o){return null===t||t.nativeEvent!==o?(t=Oe(e,n,r,i,o),null!==e&&(null!==(e=Rn(e))&&me(e)),t):(t.eventSystemFlags|=r,t)}function Ae(t){var e=In(t.target);if(null!==e){var n=Zt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=te(n)))return t.blockedOn=e,void o.unstable_runWithPriority(t.priority,function(){ge(n)})}else if(3===e&&n.stateNode.hydrate)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function De(t){if(null!==t.blockedOn)return!1;var e=Qe(t.topLevelType,t.eventSystemFlags,t.container,t.nativeEvent);if(null!==e){var n=Rn(e);return null!==n&&me(n),t.blockedOn=e,!1}return!0}function Ne(t,e,n){De(t)&&n.delete(e)}function Pe(){for(ye=!1;0<be.length;){var t=be[0];if(null!==t.blockedOn){null!==(t=Rn(t.blockedOn))&&ve(t);break}var e=Qe(t.topLevelType,t.eventSystemFlags,t.container,t.nativeEvent);null!==e?t.blockedOn=e:be.shift()}null!==we&&De(we)&&(we=null),null!==xe&&De(xe)&&(xe=null),null!==ke&&De(ke)&&(ke=null),Ee.forEach(Ne),Ce.forEach(Ne)}function Me(t,e){t.blockedOn===e&&(t.blockedOn=null,ye||(ye=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Pe)))}function Fe(t){function e(e){return Me(e,t)}if(0<be.length){Me(be[0],t);for(var n=1;n<be.length;n++){var r=be[n];r.blockedOn===t&&(r.blockedOn=null)}}for(null!==we&&Me(we,t),null!==xe&&Me(xe,t),null!==ke&&Me(ke,t),Ee.forEach(e),Ce.forEach(e),n=0;n<_e.length;n++)(r=_e[n]).blockedOn===t&&(r.blockedOn=null);for(;0<_e.length&&null===(n=_e[0]).blockedOn;)Ae(n),null===n.blockedOn&&_e.shift()}var Le={},je=new Map,Be=new Map,Ve=["abort","abort",qt,"animationEnd",Kt,"animationIteration",Xt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Yt,"transitionEnd","waiting","waiting"];function Ue(t,e){for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1],o="on"+(i[0].toUpperCase()+i.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[r],eventPriority:e},Be.set(r,e),je.set(r,o),Le[i]=o}}Ue("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ue("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ue(Ve,2);for(var ze="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),We=0;We<ze.length;We++)Be.set(ze[We],0);var Ge=o.unstable_UserBlockingPriority,He=o.unstable_runWithPriority,qe=!0;function Ke(t,e){Xe(e,t,!1)}function Xe(t,e,n){var r=Be.get(e);switch(void 0===r?2:r){case 0:r=function(t,e,n,r){L||M();var i=Ye,o=L;L=!0;try{P(i,t,e,n,r)}finally{(L=o)||B()}}.bind(null,e,1,t);break;case 1:r=function(t,e,n,r){He(Ge,Ye.bind(null,t,e,n,r))}.bind(null,e,1,t);break;default:r=Ye.bind(null,e,1,t)}n?t.addEventListener(e,r,!0):t.addEventListener(e,r,!1)}function Ye(t,e,n,r){if(qe)if(0<be.length&&-1<Se.indexOf(t))t=Oe(null,t,e,n,r),be.push(t);else{var i=Qe(t,e,n,r);if(null===i)Ie(t,r);else if(-1<Se.indexOf(t))t=Oe(i,t,e,n,r),be.push(t);else if(!function(t,e,n,r,i){switch(e){case"focus":return we=Re(we,t,e,n,r,i),!0;case"dragenter":return xe=Re(xe,t,e,n,r,i),!0;case"mouseover":return ke=Re(ke,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return Ee.set(o,Re(Ee.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Ce.set(o,Re(Ce.get(o)||null,t,e,n,r,i)),!0}return!1}(i,t,e,n,r)){Ie(t,r),t=he(t,r,null,e);try{V(de,t)}finally{fe(t)}}}}function Qe(t,e,n,r){if(null!==(n=In(n=se(r)))){var i=Zt(n);if(null===i)n=null;else{var o=i.tag;if(13===o){if(null!==(n=te(i)))return n;n=null}else if(3===o){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}t=he(t,r,n,e);try{V(de,t)}finally{fe(t)}return null}var $e={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Je=["Webkit","ms","Moz","O"];function Ze(t,e,n){return null==e||"boolean"===typeof e||""===e?"":n||"number"!==typeof e||0===e||$e.hasOwnProperty(t)&&$e[t]?(""+e).trim():e+"px"}function tn(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=Ze(n,e[n],r);"float"===n&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}Object.keys($e).forEach(function(t){Je.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),$e[e]=$e[t]})});var en=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function nn(t,e){if(e){if(en[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(a(137,t,""));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(a(60));if(!("object"===typeof e.dangerouslySetInnerHTML&&"__html"in e.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(a(62,""))}}function rn(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var on=Nt;function an(t,e){var n=Jt(t=9===t.nodeType||11===t.nodeType?t:t.ownerDocument);e=C[e];for(var r=0;r<e.length;r++)pe(e[r],t,n)}function un(){}function sn(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function cn(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ln(t,e){var n,r=cn(t);for(t=0;r;){if(3===r.nodeType){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=cn(r)}}function fn(){for(var t=window,e=sn();e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(r){n=!1}if(!n)break;e=sn((t=e.contentWindow).document)}return e}function hn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}var dn="$",pn="/$",vn="$?",mn="$!",gn=null,yn=null;function bn(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function wn(t,e){return"textarea"===t||"option"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var xn="function"===typeof setTimeout?setTimeout:void 0,kn="function"===typeof clearTimeout?clearTimeout:void 0;function En(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break}return t}function Cn(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if(n===dn||n===mn||n===vn){if(0===e)return t;e--}else n===pn&&e++}t=t.previousSibling}return null}var _n=Math.random().toString(36).slice(2),Sn="__reactInternalInstance$"+_n,Tn="__reactEventHandlers$"+_n,On="__reactContainere$"+_n;function In(t){var e=t[Sn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[On]||n[Sn]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=Cn(t);null!==t;){if(n=t[Sn])return n;t=Cn(t)}return e}n=(t=n).parentNode}return null}function Rn(t){return!(t=t[Sn]||t[On])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function An(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(a(33))}function Dn(t){return t[Tn]||null}function Nn(t){do{t=t.return}while(t&&5!==t.tag);return t||null}function Pn(t,e){var n=t.stateNode;if(!n)return null;var r=d(n);if(!r)return null;n=r[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!r;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(a(231,e,typeof n));return n}function Mn(t,e,n){(e=Pn(t,n.dispatchConfig.phasedRegistrationNames[e]))&&(n._dispatchListeners=re(n._dispatchListeners,e),n._dispatchInstances=re(n._dispatchInstances,t))}function Fn(t){if(t&&t.dispatchConfig.phasedRegistrationNames){for(var e=t._targetInst,n=[];e;)n.push(e),e=Nn(e);for(e=n.length;0<e--;)Mn(n[e],"captured",t);for(e=0;e<n.length;e++)Mn(n[e],"bubbled",t)}}function Ln(t,e,n){t&&n&&n.dispatchConfig.registrationName&&(e=Pn(t,n.dispatchConfig.registrationName))&&(n._dispatchListeners=re(n._dispatchListeners,e),n._dispatchInstances=re(n._dispatchInstances,t))}function jn(t){t&&t.dispatchConfig.registrationName&&Ln(t._targetInst,null,t)}function Bn(t){ie(t,Fn)}var Vn=null,Un=null,zn=null;function Wn(){if(zn)return zn;var t,e,n=Un,r=n.length,i="value"in Vn?Vn.value:Vn.textContent,o=i.length;for(t=0;t<r&&n[t]===i[t];t++);var a=r-t;for(e=1;e<=a&&n[r-e]===i[o-e];e++);return zn=i.slice(t,1<e?1-e:void 0)}function Gn(){return!0}function Hn(){return!1}function qn(t,e,n,r){for(var i in this.dispatchConfig=t,this._targetInst=e,this.nativeEvent=n,t=this.constructor.Interface)t.hasOwnProperty(i)&&((e=t[i])?this[i]=e(n):"target"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Gn:Hn,this.isPropagationStopped=Hn,this}function Kn(t,e,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,t,e,n,r),i}return new this(t,e,n,r)}function Xn(t){if(!(t instanceof this))throw Error(a(279));t.destructor(),10>this.eventPool.length&&this.eventPool.push(t)}function Yn(t){t.eventPool=[],t.getPooled=Kn,t.release=Xn}i(qn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=Gn)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=Gn)},persist:function(){this.isPersistent=Gn},isPersistent:Hn,destructor:function(){var t,e=this.constructor.Interface;for(t in e)this[t]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Hn,this._dispatchInstances=this._dispatchListeners=null}}),qn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},qn.extend=function(t){function e(){}function n(){return r.apply(this,arguments)}var r=this;e.prototype=r.prototype;var o=new e;return i(o,n.prototype),n.prototype=o,n.prototype.constructor=n,n.Interface=i({},r.Interface,t),n.extend=r.extend,Yn(n),n},Yn(qn);var Qn=qn.extend({data:null}),$n=qn.extend({data:null}),Jn=[9,13,27,32],Zn=S&&"CompositionEvent"in window,tr=null;S&&"documentMode"in document&&(tr=document.documentMode);var er=S&&"TextEvent"in window&&!tr,nr=S&&(!Zn||tr&&8<tr&&11>=tr),rr=String.fromCharCode(32),ir={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},or=!1;function ar(t,e){switch(t){case"keyup":return-1!==Jn.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function ur(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var sr=!1;var cr={eventTypes:ir,extractEvents:function(t,e,n,r){var i;if(Zn)t:{switch(t){case"compositionstart":var o=ir.compositionStart;break t;case"compositionend":o=ir.compositionEnd;break t;case"compositionupdate":o=ir.compositionUpdate;break t}o=void 0}else sr?ar(t,n)&&(o=ir.compositionEnd):"keydown"===t&&229===n.keyCode&&(o=ir.compositionStart);return o?(nr&&"ko"!==n.locale&&(sr||o!==ir.compositionStart?o===ir.compositionEnd&&sr&&(i=Wn()):(Un="value"in(Vn=r)?Vn.value:Vn.textContent,sr=!0)),o=Qn.getPooled(o,e,n,r),i?o.data=i:null!==(i=ur(n))&&(o.data=i),Bn(o),i=o):i=null,(t=er?function(t,e){switch(t){case"compositionend":return ur(e);case"keypress":return 32!==e.which?null:(or=!0,rr);case"textInput":return(t=e.data)===rr&&or?null:t;default:return null}}(t,n):function(t,e){if(sr)return"compositionend"===t||!Zn&&ar(t,e)?(t=Wn(),zn=Un=Vn=null,sr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return nr&&"ko"!==e.locale?null:e.data;default:return null}}(t,n))?((e=$n.getPooled(ir.beforeInput,e,n,r)).data=t,Bn(e)):e=null,null===i?e:null===e?i:[i,e]}},lr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fr(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!lr[t.type]:"textarea"===e}var hr={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function dr(t,e,n){return(t=qn.getPooled(hr.change,t,e,n)).type="change",A(n),Bn(t),t}var pr=null,vr=null;function mr(t){ue(t)}function gr(t){if(wt(An(t)))return t}function yr(t,e){if("change"===t)return e}var br=!1;function wr(){pr&&(pr.detachEvent("onpropertychange",xr),vr=pr=null)}function xr(t){if("value"===t.propertyName&&gr(vr))if(t=dr(vr,t,se(t)),L)ue(t);else{L=!0;try{N(mr,t)}finally{L=!1,B()}}}function kr(t,e,n){"focus"===t?(wr(),vr=n,(pr=e).attachEvent("onpropertychange",xr)):"blur"===t&&wr()}function Er(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return gr(vr)}function Cr(t,e){if("click"===t)return gr(e)}function _r(t,e){if("input"===t||"change"===t)return gr(e)}S&&(br=ce("input")&&(!document.documentMode||9<document.documentMode));var Sr={eventTypes:hr,_isInputEventSupported:br,extractEvents:function(t,e,n,r){var i=e?An(e):window,o=i.nodeName&&i.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===i.type)var a=yr;else if(fr(i))if(br)a=_r;else{a=Er;var u=kr}else(o=i.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(a=Cr);if(a&&(a=a(t,e)))return dr(a,n,r);u&&u(t,i,e),"blur"===t&&(t=i._wrapperState)&&t.controlled&&"number"===i.type&&St(i,"number",i.value)}},Tr=qn.extend({view:null,detail:null}),Or={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ir(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Or[t])&&!!e[t]}function Rr(){return Ir}var Ar=0,Dr=0,Nr=!1,Pr=!1,Mr=Tr.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Rr,button:null,buttons:null,relatedTarget:function(t){return t.relatedTarget||(t.fromElement===t.srcElement?t.toElement:t.fromElement)},movementX:function(t){if("movementX"in t)return t.movementX;var e=Ar;return Ar=t.screenX,Nr?"mousemove"===t.type?t.screenX-e:0:(Nr=!0,0)},movementY:function(t){if("movementY"in t)return t.movementY;var e=Dr;return Dr=t.screenY,Pr?"mousemove"===t.type?t.screenY-e:0:(Pr=!0,0)}}),Fr=Mr.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Lr={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},jr={eventTypes:Lr,extractEvents:function(t,e,n,r,i){var o="mouseover"===t||"pointerover"===t,a="mouseout"===t||"pointerout"===t;if(o&&0===(32&i)&&(n.relatedTarget||n.fromElement)||!a&&!o)return null;(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,a)?(a=e,null!==(e=(e=n.relatedTarget||n.toElement)?In(e):null)&&(e!==Zt(e)||5!==e.tag&&6!==e.tag)&&(e=null)):a=null;if(a===e)return null;if("mouseout"===t||"mouseover"===t)var u=Mr,s=Lr.mouseLeave,c=Lr.mouseEnter,l="mouse";else"pointerout"!==t&&"pointerover"!==t||(u=Fr,s=Lr.pointerLeave,c=Lr.pointerEnter,l="pointer");if(t=null==a?o:An(a),o=null==e?o:An(e),(s=u.getPooled(s,a,n,r)).type=l+"leave",s.target=t,s.relatedTarget=o,(n=u.getPooled(c,e,n,r)).type=l+"enter",n.target=o,n.relatedTarget=t,l=e,(r=a)&&l)t:{for(c=l,a=0,t=u=r;t;t=Nn(t))a++;for(t=0,e=c;e;e=Nn(e))t++;for(;0<a-t;)u=Nn(u),a--;for(;0<t-a;)c=Nn(c),t--;for(;a--;){if(u===c||u===c.alternate)break t;u=Nn(u),c=Nn(c)}u=null}else u=null;for(c=u,u=[];r&&r!==c&&(null===(a=r.alternate)||a!==c);)u.push(r),r=Nn(r);for(r=[];l&&l!==c&&(null===(a=l.alternate)||a!==c);)r.push(l),l=Nn(l);for(l=0;l<u.length;l++)Ln(u[l],"bubbled",s);for(l=r.length;0<l--;)Ln(r[l],"captured",n);return 0===(64&i)?[s]:[s,n]}};var Br="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e},Vr=Object.prototype.hasOwnProperty;function Ur(t,e){if(Br(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Vr.call(e,n[r])||!Br(t[n[r]],e[n[r]]))return!1;return!0}var zr=S&&"documentMode"in document&&11>=document.documentMode,Wr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Gr=null,Hr=null,qr=null,Kr=!1;function Xr(t,e){var n=e.window===e?e.document:9===e.nodeType?e:e.ownerDocument;return Kr||null==Gr||Gr!==sn(n)?null:("selectionStart"in(n=Gr)&&hn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},qr&&Ur(qr,n)?null:(qr=n,(t=qn.getPooled(Wr.select,Hr,t,e)).type="select",t.target=Gr,Bn(t),t))}var Yr={eventTypes:Wr,extractEvents:function(t,e,n,r,i,o){if(!(o=!(i=o||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){t:{i=Jt(i),o=C.onSelect;for(var a=0;a<o.length;a++)if(!i.has(o[a])){i=!1;break t}i=!0}o=!i}if(o)return null;switch(i=e?An(e):window,t){case"focus":(fr(i)||"true"===i.contentEditable)&&(Gr=i,Hr=e,qr=null);break;case"blur":qr=Hr=Gr=null;break;case"mousedown":Kr=!0;break;case"contextmenu":case"mouseup":case"dragend":return Kr=!1,Xr(n,r);case"selectionchange":if(zr)break;case"keydown":case"keyup":return Xr(n,r)}return null}},Qr=qn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),$r=qn.extend({clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Jr=Tr.extend({relatedTarget:null});function Zr(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}var ti={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ei={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ni=Tr.extend({key:function(t){if(t.key){var e=ti[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=Zr(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?ei[t.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Rr,charCode:function(t){return"keypress"===t.type?Zr(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?Zr(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),ri=Mr.extend({dataTransfer:null}),ii=Tr.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Rr}),oi=qn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),ai=Mr.extend({deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:null,deltaMode:null}),ui={eventTypes:Le,extractEvents:function(t,e,n,r){var i=je.get(t);if(!i)return null;switch(t){case"keypress":if(0===Zr(n))return null;case"keydown":case"keyup":t=ni;break;case"blur":case"focus":t=Jr;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":t=Mr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":t=ri;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":t=ii;break;case qt:case Kt:case Xt:t=Qr;break;case Yt:t=oi;break;case"scroll":t=Tr;break;case"wheel":t=ai;break;case"copy":case"cut":case"paste":t=$r;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":t=Fr;break;default:t=qn}return Bn(e=t.getPooled(i,e,n,r)),e}};if(g)throw Error(a(101));g=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),b(),d=Dn,p=Rn,v=An,_({SimpleEventPlugin:ui,EnterLeaveEventPlugin:jr,ChangeEventPlugin:Sr,SelectEventPlugin:Yr,BeforeInputEventPlugin:cr});var si=[],ci=-1;function li(t){0>ci||(t.current=si[ci],si[ci]=null,ci--)}function fi(t,e){si[++ci]=t.current,t.current=e}var hi={},di={current:hi},pi={current:!1},vi=hi;function mi(t,e){var n=t.type.contextTypes;if(!n)return hi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=e[i];return r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function gi(t){return null!==(t=t.childContextTypes)&&void 0!==t}function yi(){li(pi),li(di)}function bi(t,e,n){if(di.current!==hi)throw Error(a(168));fi(di,e),fi(pi,n)}function wi(t,e,n){var r=t.stateNode;if(t=e.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,vt(e)||"Unknown",o));return i({},n,{},r)}function xi(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hi,vi=di.current,fi(di,t),fi(pi,pi.current),!0}function ki(t,e,n){var r=t.stateNode;if(!r)throw Error(a(169));n?(t=wi(t,e,vi),r.__reactInternalMemoizedMergedChildContext=t,li(pi),li(di),fi(di,t)):li(pi),fi(pi,n)}var Ei=o.unstable_runWithPriority,Ci=o.unstable_scheduleCallback,_i=o.unstable_cancelCallback,Si=o.unstable_requestPaint,Ti=o.unstable_now,Oi=o.unstable_getCurrentPriorityLevel,Ii=o.unstable_ImmediatePriority,Ri=o.unstable_UserBlockingPriority,Ai=o.unstable_NormalPriority,Di=o.unstable_LowPriority,Ni=o.unstable_IdlePriority,Pi={},Mi=o.unstable_shouldYield,Fi=void 0!==Si?Si:function(){},Li=null,ji=null,Bi=!1,Vi=Ti(),Ui=1e4>Vi?Ti:function(){return Ti()-Vi};function zi(){switch(Oi()){case Ii:return 99;case Ri:return 98;case Ai:return 97;case Di:return 96;case Ni:return 95;default:throw Error(a(332))}}function Wi(t){switch(t){case 99:return Ii;case 98:return Ri;case 97:return Ai;case 96:return Di;case 95:return Ni;default:throw Error(a(332))}}function Gi(t,e){return t=Wi(t),Ei(t,e)}function Hi(t,e,n){return t=Wi(t),Ci(t,e,n)}function qi(t){return null===Li?(Li=[t],ji=Ci(Ii,Xi)):Li.push(t),Pi}function Ki(){if(null!==ji){var t=ji;ji=null,_i(t)}Xi()}function Xi(){if(!Bi&&null!==Li){Bi=!0;var t=0;try{var e=Li;Gi(99,function(){for(;t<e.length;t++){var n=e[t];do{n=n(!0)}while(null!==n)}}),Li=null}catch(n){throw null!==Li&&(Li=Li.slice(t+1)),Ci(Ii,Ki),n}finally{Bi=!1}}}function Yi(t,e,n){return 1073741821-(1+((1073741821-t+e/10)/(n/=10)|0))*n}function Qi(t,e){if(t&&t.defaultProps)for(var n in e=i({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}var $i={current:null},Ji=null,Zi=null,to=null;function eo(){to=Zi=Ji=null}function no(t){var e=$i.current;li($i),t.type._context._currentValue=e}function ro(t,e){for(;null!==t;){var n=t.alternate;if(t.childExpirationTime<e)t.childExpirationTime=e,null!==n&&n.childExpirationTime<e&&(n.childExpirationTime=e);else{if(!(null!==n&&n.childExpirationTime<e))break;n.childExpirationTime=e}t=t.return}}function io(t,e){Ji=t,to=Zi=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(t.expirationTime>=e&&(Da=!0),t.firstContext=null)}function oo(t,e){if(to!==t&&!1!==e&&0!==e)if("number"===typeof e&&1073741823!==e||(to=t,e=1073741823),e={context:t,observedBits:e,next:null},null===Zi){if(null===Ji)throw Error(a(308));Zi=e,Ji.dependencies={expirationTime:0,firstContext:e,responders:null}}else Zi=Zi.next=e;return t._currentValue}var ao=!1;function uo(t){t.updateQueue={baseState:t.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function so(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,baseQueue:t.baseQueue,shared:t.shared,effects:t.effects})}function co(t,e){return(t={expirationTime:t,suspenseConfig:e,tag:0,payload:null,callback:null,next:null}).next=t}function lo(t,e){if(null!==(t=t.updateQueue)){var n=(t=t.shared).pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function fo(t,e){var n=t.alternate;null!==n&&so(n,t),null===(n=(t=t.updateQueue).baseQueue)?(t.baseQueue=e.next=e,e.next=e):(e.next=n.next,n.next=e)}function ho(t,e,n,r){var o=t.updateQueue;ao=!1;var a=o.baseQueue,u=o.shared.pending;if(null!==u){if(null!==a){var s=a.next;a.next=u.next,u.next=s}a=u,o.shared.pending=null,null!==(s=t.alternate)&&(null!==(s=s.updateQueue)&&(s.baseQueue=u))}if(null!==a){s=a.next;var c=o.baseState,l=0,f=null,h=null,d=null;if(null!==s)for(var p=s;;){if((u=p.expirationTime)<r){var v={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===d?(h=d=v,f=c):d=d.next=v,u>l&&(l=u)}else{null!==d&&(d=d.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null}),vs(u,p.suspenseConfig);t:{var m=t,g=p;switch(u=e,v=n,g.tag){case 1:if("function"===typeof(m=g.payload)){c=m.call(v,c,u);break t}c=m;break t;case 3:m.effectTag=-4097&m.effectTag|64;case 0:if(null===(u="function"===typeof(m=g.payload)?m.call(v,c,u):m)||void 0===u)break t;c=i({},c,u);break t;case 2:ao=!0}}null!==p.callback&&(t.effectTag|=32,null===(u=o.effects)?o.effects=[p]:u.push(p))}if(null===(p=p.next)||p===s){if(null===(u=o.shared.pending))break;p=a.next=u.next,u.next=s,o.baseQueue=a=u,o.shared.pending=null}}null===d?f=c:d.next=h,o.baseState=f,o.baseQueue=d,ms(l),t.expirationTime=l,t.memoizedState=c}}function po(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(null!==i){if(r.callback=null,r=i,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var vo=Y.ReactCurrentBatchConfig,mo=(new r.Component).refs;function go(t,e,n,r){n=null===(n=n(r,e=t.memoizedState))||void 0===n?e:i({},e,n),t.memoizedState=n,0===t.expirationTime&&(t.updateQueue.baseState=n)}var yo={isMounted:function(t){return!!(t=t._reactInternalFiber)&&Zt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternalFiber;var r=rs(),i=vo.suspense;(i=co(r=is(r,t,i),i)).payload=e,void 0!==n&&null!==n&&(i.callback=n),lo(t,i),os(t,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternalFiber;var r=rs(),i=vo.suspense;(i=co(r=is(r,t,i),i)).tag=1,i.payload=e,void 0!==n&&null!==n&&(i.callback=n),lo(t,i),os(t,r)},enqueueForceUpdate:function(t,e){t=t._reactInternalFiber;var n=rs(),r=vo.suspense;(r=co(n=is(n,t,r),r)).tag=2,void 0!==e&&null!==e&&(r.callback=e),lo(t,r),os(t,n)}};function bo(t,e,n,r,i,o,a){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(r,o,a):!e.prototype||!e.prototype.isPureReactComponent||(!Ur(n,r)||!Ur(i,o))}function wo(t,e,n){var r=!1,i=hi,o=e.contextType;return"object"===typeof o&&null!==o?o=oo(o):(i=gi(e)?vi:di.current,o=(r=null!==(r=e.contextTypes)&&void 0!==r)?mi(t,i):hi),e=new e(n,o),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=yo,t.stateNode=e,e._reactInternalFiber=t,r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function xo(t,e,n,r){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&yo.enqueueReplaceState(e,e.state,null)}function ko(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=mo,uo(t);var o=e.contextType;"object"===typeof o&&null!==o?i.context=oo(o):(o=gi(e)?vi:di.current,i.context=mi(t,o)),ho(t,n,i,r),i.state=t.memoizedState,"function"===typeof(o=e.getDerivedStateFromProps)&&(go(t,e,o,n),i.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(e=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),e!==i.state&&yo.enqueueReplaceState(i,i.state,null),ho(t,n,i,r),i.state=t.memoizedState),"function"===typeof i.componentDidMount&&(t.effectTag|=4)}var Eo=Array.isArray;function Co(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,t));var i=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===i?e.ref:((e=function(t){var e=r.refs;e===mo&&(e=r.refs={}),null===t?delete e[i]:e[i]=t})._stringRef=i,e)}if("string"!==typeof t)throw Error(a(284));if(!n._owner)throw Error(a(290,t))}return t}function _o(t,e){if("textarea"!==t.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(e)?"object with keys {"+Object.keys(e).join(", ")+"}":e,""))}function So(t){function e(e,n){if(t){var r=e.lastEffect;null!==r?(r.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!t)return null;for(;null!==r;)e(n,r),r=r.sibling;return null}function r(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(t,e){return(t=Ps(t,e)).index=0,t.sibling=null,t}function o(e,n,r){return e.index=r,t?null!==(r=e.alternate)?(r=r.index)<n?(e.effectTag=2,n):r:(e.effectTag=2,n):n}function u(e){return t&&null===e.alternate&&(e.effectTag=2),e}function s(t,e,n,r){return null===e||6!==e.tag?((e=Ls(n,t.mode,r)).return=t,e):((e=i(e,n)).return=t,e)}function c(t,e,n,r){return null!==e&&e.elementType===n.type?((r=i(e,n.props)).ref=Co(t,e,n),r.return=t,r):((r=Ms(n.type,n.key,n.props,null,t.mode,r)).ref=Co(t,e,n),r.return=t,r)}function l(t,e,n,r){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=js(n,t.mode,r)).return=t,e):((e=i(e,n.children||[])).return=t,e)}function f(t,e,n,r,o){return null===e||7!==e.tag?((e=Fs(n,t.mode,r,o)).return=t,e):((e=i(e,n)).return=t,e)}function h(t,e,n){if("string"===typeof e||"number"===typeof e)return(e=Ls(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case Z:return(n=Ms(e.type,e.key,e.props,null,t.mode,n)).ref=Co(t,null,e),n.return=t,n;case tt:return(e=js(e,t.mode,n)).return=t,e}if(Eo(e)||pt(e))return(e=Fs(e,t.mode,n,null)).return=t,e;_o(t,e)}return null}function d(t,e,n,r){var i=null!==e?e.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:s(t,e,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case Z:return n.key===i?n.type===et?f(t,e,n.props.children,r,i):c(t,e,n,r):null;case tt:return n.key===i?l(t,e,n,r):null}if(Eo(n)||pt(n))return null!==i?null:f(t,e,n,r,null);_o(t,n)}return null}function p(t,e,n,r,i){if("string"===typeof r||"number"===typeof r)return s(e,t=t.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case Z:return t=t.get(null===r.key?n:r.key)||null,r.type===et?f(e,t,r.props.children,i,r.key):c(e,t,r,i);case tt:return l(e,t=t.get(null===r.key?n:r.key)||null,r,i)}if(Eo(r)||pt(r))return f(e,t=t.get(n)||null,r,i,null);_o(e,r)}return null}function v(i,a,u,s){for(var c=null,l=null,f=a,v=a=0,m=null;null!==f&&v<u.length;v++){f.index>v?(m=f,f=null):m=f.sibling;var g=d(i,f,u[v],s);if(null===g){null===f&&(f=m);break}t&&f&&null===g.alternate&&e(i,f),a=o(g,a,v),null===l?c=g:l.sibling=g,l=g,f=m}if(v===u.length)return n(i,f),c;if(null===f){for(;v<u.length;v++)null!==(f=h(i,u[v],s))&&(a=o(f,a,v),null===l?c=f:l.sibling=f,l=f);return c}for(f=r(i,f);v<u.length;v++)null!==(m=p(f,i,v,u[v],s))&&(t&&null!==m.alternate&&f.delete(null===m.key?v:m.key),a=o(m,a,v),null===l?c=m:l.sibling=m,l=m);return t&&f.forEach(function(t){return e(i,t)}),c}function m(i,u,s,c){var l=pt(s);if("function"!==typeof l)throw Error(a(150));if(null==(s=l.call(s)))throw Error(a(151));for(var f=l=null,v=u,m=u=0,g=null,y=s.next();null!==v&&!y.done;m++,y=s.next()){v.index>m?(g=v,v=null):g=v.sibling;var b=d(i,v,y.value,c);if(null===b){null===v&&(v=g);break}t&&v&&null===b.alternate&&e(i,v),u=o(b,u,m),null===f?l=b:f.sibling=b,f=b,v=g}if(y.done)return n(i,v),l;if(null===v){for(;!y.done;m++,y=s.next())null!==(y=h(i,y.value,c))&&(u=o(y,u,m),null===f?l=y:f.sibling=y,f=y);return l}for(v=r(i,v);!y.done;m++,y=s.next())null!==(y=p(v,i,m,y.value,c))&&(t&&null!==y.alternate&&v.delete(null===y.key?m:y.key),u=o(y,u,m),null===f?l=y:f.sibling=y,f=y);return t&&v.forEach(function(t){return e(i,t)}),l}return function(t,r,o,s){var c="object"===typeof o&&null!==o&&o.type===et&&null===o.key;c&&(o=o.props.children);var l="object"===typeof o&&null!==o;if(l)switch(o.$$typeof){case Z:t:{for(l=o.key,c=r;null!==c;){if(c.key===l){switch(c.tag){case 7:if(o.type===et){n(t,c.sibling),(r=i(c,o.props.children)).return=t,t=r;break t}break;default:if(c.elementType===o.type){n(t,c.sibling),(r=i(c,o.props)).ref=Co(t,c,o),r.return=t,t=r;break t}}n(t,c);break}e(t,c),c=c.sibling}o.type===et?((r=Fs(o.props.children,t.mode,s,o.key)).return=t,t=r):((s=Ms(o.type,o.key,o.props,null,t.mode,s)).ref=Co(t,r,o),s.return=t,t=s)}return u(t);case tt:t:{for(c=o.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(t,r.sibling),(r=i(r,o.children||[])).return=t,t=r;break t}n(t,r);break}e(t,r),r=r.sibling}(r=js(o,t.mode,s)).return=t,t=r}return u(t)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==r&&6===r.tag?(n(t,r.sibling),(r=i(r,o)).return=t,t=r):(n(t,r),(r=Ls(o,t.mode,s)).return=t,t=r),u(t);if(Eo(o))return v(t,r,o,s);if(pt(o))return m(t,r,o,s);if(l&&_o(t,o),"undefined"===typeof o&&!c)switch(t.tag){case 1:case 0:throw t=t.type,Error(a(152,t.displayName||t.name||"Component"))}return n(t,r)}}var To=So(!0),Oo=So(!1),Io={},Ro={current:Io},Ao={current:Io},Do={current:Io};function No(t){if(t===Io)throw Error(a(174));return t}function Po(t,e){switch(fi(Do,e),fi(Ao,t),fi(Ro,Io),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ft(null,"");break;default:e=Ft(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}li(Ro),fi(Ro,e)}function Mo(){li(Ro),li(Ao),li(Do)}function Fo(t){No(Do.current);var e=No(Ro.current),n=Ft(e,t.type);e!==n&&(fi(Ao,t),fi(Ro,n))}function Lo(t){Ao.current===t&&(li(Ro),li(Ao))}var jo={current:0};function Bo(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||n.data===vn||n.data===mn))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(64&e.effectTag))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function Vo(t,e){return{responder:t,props:e}}var Uo=Y.ReactCurrentDispatcher,zo=Y.ReactCurrentBatchConfig,Wo=0,Go=null,Ho=null,qo=null,Ko=!1;function Xo(){throw Error(a(321))}function Yo(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Br(t[n],e[n]))return!1;return!0}function Qo(t,e,n,r,i,o){if(Wo=o,Go=e,e.memoizedState=null,e.updateQueue=null,e.expirationTime=0,Uo.current=null===t||null===t.memoizedState?ba:wa,t=n(r,i),e.expirationTime===Wo){o=0;do{if(e.expirationTime=0,!(25>o))throw Error(a(301));o+=1,qo=Ho=null,e.updateQueue=null,Uo.current=xa,t=n(r,i)}while(e.expirationTime===Wo)}if(Uo.current=ya,e=null!==Ho&&null!==Ho.next,Wo=0,qo=Ho=Go=null,Ko=!1,e)throw Error(a(300));return t}function $o(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===qo?Go.memoizedState=qo=t:qo=qo.next=t,qo}function Jo(){if(null===Ho){var t=Go.alternate;t=null!==t?t.memoizedState:null}else t=Ho.next;var e=null===qo?Go.memoizedState:qo.next;if(null!==e)qo=e,Ho=t;else{if(null===t)throw Error(a(310));t={memoizedState:(Ho=t).memoizedState,baseState:Ho.baseState,baseQueue:Ho.baseQueue,queue:Ho.queue,next:null},null===qo?Go.memoizedState=qo=t:qo=qo.next=t}return qo}function Zo(t,e){return"function"===typeof e?e(t):e}function ta(t){var e=Jo(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var r=Ho,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var u=i.next;i.next=o.next,o.next=u}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var s=u=o=null,c=i;do{var l=c.expirationTime;if(l<Wo){var f={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===s?(u=s=f,o=r):s=s.next=f,l>Go.expirationTime&&(Go.expirationTime=l,ms(l))}else null!==s&&(s=s.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),vs(l,c.suspenseConfig),r=c.eagerReducer===t?c.eagerState:t(r,c.action);c=c.next}while(null!==c&&c!==i);null===s?o=r:s.next=u,Br(r,e.memoizedState)||(Da=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=s,n.lastRenderedState=r}return[e.memoizedState,n.dispatch]}function ea(t){var e=Jo(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(null!==i){n.pending=null;var u=i=i.next;do{o=t(o,u.action),u=u.next}while(u!==i);Br(o,e.memoizedState)||(Da=!0),e.memoizedState=o,null===e.baseQueue&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function na(t){var e=$o();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t=(t=e.queue={pending:null,dispatch:null,lastRenderedReducer:Zo,lastRenderedState:t}).dispatch=ga.bind(null,Go,t),[e.memoizedState,t]}function ra(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},null===(e=Go.updateQueue)?(e={lastEffect:null},Go.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t),t}function ia(){return Jo().memoizedState}function oa(t,e,n,r){var i=$o();Go.effectTag|=t,i.memoizedState=ra(1|e,n,void 0,void 0===r?null:r)}function aa(t,e,n,r){var i=Jo();r=void 0===r?null:r;var o=void 0;if(null!==Ho){var a=Ho.memoizedState;if(o=a.destroy,null!==r&&Yo(r,a.deps))return void ra(e,n,o,r)}Go.effectTag|=t,i.memoizedState=ra(1|e,n,o,r)}function ua(t,e){return oa(516,4,t,e)}function sa(t,e){return aa(516,4,t,e)}function ca(t,e){return aa(4,2,t,e)}function la(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function fa(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,aa(4,2,la.bind(null,e,t),n)}function ha(){}function da(t,e){return $o().memoizedState=[t,void 0===e?null:e],t}function pa(t,e){var n=Jo();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&Yo(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function va(t,e){var n=Jo();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&Yo(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function ma(t,e,n){var r=zi();Gi(98>r?98:r,function(){t(!0)}),Gi(97<r?97:r,function(){var r=zo.suspense;zo.suspense=void 0===e?null:e;try{t(!1),n()}finally{zo.suspense=r}})}function ga(t,e,n){var r=rs(),i=vo.suspense;i={expirationTime:r=is(r,t,i),suspenseConfig:i,action:n,eagerReducer:null,eagerState:null,next:null};var o=e.pending;if(null===o?i.next=i:(i.next=o.next,o.next=i),e.pending=i,o=t.alternate,t===Go||null!==o&&o===Go)Ko=!0,i.expirationTime=Wo,Go.expirationTime=Wo;else{if(0===t.expirationTime&&(null===o||0===o.expirationTime)&&null!==(o=e.lastRenderedReducer))try{var a=e.lastRenderedState,u=o(a,n);if(i.eagerReducer=o,i.eagerState=u,Br(u,a))return}catch(s){}os(t,r)}}var ya={readContext:oo,useCallback:Xo,useContext:Xo,useEffect:Xo,useImperativeHandle:Xo,useLayoutEffect:Xo,useMemo:Xo,useReducer:Xo,useRef:Xo,useState:Xo,useDebugValue:Xo,useResponder:Xo,useDeferredValue:Xo,useTransition:Xo},ba={readContext:oo,useCallback:da,useContext:oo,useEffect:ua,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,oa(4,2,la.bind(null,e,t),n)},useLayoutEffect:function(t,e){return oa(4,2,t,e)},useMemo:function(t,e){var n=$o();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$o();return e=void 0!==n?n(e):e,r.memoizedState=r.baseState=e,t=(t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e}).dispatch=ga.bind(null,Go,t),[r.memoizedState,t]},useRef:function(t){return t={current:t},$o().memoizedState=t},useState:na,useDebugValue:ha,useResponder:Vo,useDeferredValue:function(t,e){var n=na(t),r=n[0],i=n[1];return ua(function(){var n=zo.suspense;zo.suspense=void 0===e?null:e;try{i(t)}finally{zo.suspense=n}},[t,e]),r},useTransition:function(t){var e=na(!1),n=e[0];return e=e[1],[da(ma.bind(null,e,t),[e,t]),n]}},wa={readContext:oo,useCallback:pa,useContext:oo,useEffect:sa,useImperativeHandle:fa,useLayoutEffect:ca,useMemo:va,useReducer:ta,useRef:ia,useState:function(){return ta(Zo)},useDebugValue:ha,useResponder:Vo,useDeferredValue:function(t,e){var n=ta(Zo),r=n[0],i=n[1];return sa(function(){var n=zo.suspense;zo.suspense=void 0===e?null:e;try{i(t)}finally{zo.suspense=n}},[t,e]),r},useTransition:function(t){var e=ta(Zo),n=e[0];return e=e[1],[pa(ma.bind(null,e,t),[e,t]),n]}},xa={readContext:oo,useCallback:pa,useContext:oo,useEffect:sa,useImperativeHandle:fa,useLayoutEffect:ca,useMemo:va,useReducer:ea,useRef:ia,useState:function(){return ea(Zo)},useDebugValue:ha,useResponder:Vo,useDeferredValue:function(t,e){var n=ea(Zo),r=n[0],i=n[1];return sa(function(){var n=zo.suspense;zo.suspense=void 0===e?null:e;try{i(t)}finally{zo.suspense=n}},[t,e]),r},useTransition:function(t){var e=ea(Zo),n=e[0];return e=e[1],[pa(ma.bind(null,e,t),[e,t]),n]}},ka=null,Ea=null,Ca=!1;function _a(t,e){var n=Ds(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.effectTag=8,null!==t.lastEffect?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function Sa(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,!0);case 13:default:return!1}}function Ta(t){if(Ca){var e=Ea;if(e){var n=e;if(!Sa(t,e)){if(!(e=En(n.nextSibling))||!Sa(t,e))return t.effectTag=-1025&t.effectTag|2,Ca=!1,void(ka=t);_a(ka,n)}ka=t,Ea=En(e.firstChild)}else t.effectTag=-1025&t.effectTag|2,Ca=!1,ka=t}}function Oa(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;ka=t}function Ia(t){if(t!==ka)return!1;if(!Ca)return Oa(t),Ca=!0,!1;var e=t.type;if(5!==t.tag||"head"!==e&&"body"!==e&&!wn(e,t.memoizedProps))for(e=Ea;e;)_a(t,e),e=En(e.nextSibling);if(Oa(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(a(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if(n===pn){if(0===e){Ea=En(t.nextSibling);break t}e--}else n!==dn&&n!==mn&&n!==vn||e++}t=t.nextSibling}Ea=null}}else Ea=ka?En(t.stateNode.nextSibling):null;return!0}function Ra(){Ea=ka=null,Ca=!1}var Aa=Y.ReactCurrentOwner,Da=!1;function Na(t,e,n,r){e.child=null===t?Oo(e,null,n,r):To(e,t.child,n,r)}function Pa(t,e,n,r,i){n=n.render;var o=e.ref;return io(e,i),r=Qo(t,e,n,r,o,i),null===t||Da?(e.effectTag|=1,Na(t,e,r,i),e.child):(e.updateQueue=t.updateQueue,e.effectTag&=-517,t.expirationTime<=i&&(t.expirationTime=0),$a(t,e,i))}function Ma(t,e,n,r,i,o){if(null===t){var a=n.type;return"function"!==typeof a||Ns(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Ms(n.type,null,r,null,e.mode,o)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=a,Fa(t,e,a,r,i,o))}return a=t.child,i<o&&(i=a.memoizedProps,(n=null!==(n=n.compare)?n:Ur)(i,r)&&t.ref===e.ref)?$a(t,e,o):(e.effectTag|=1,(t=Ps(a,r)).ref=e.ref,t.return=e,e.child=t)}function Fa(t,e,n,r,i,o){return null!==t&&Ur(t.memoizedProps,r)&&t.ref===e.ref&&(Da=!1,i<o)?(e.expirationTime=t.expirationTime,$a(t,e,o)):ja(t,e,n,r,o)}function La(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.effectTag|=128)}function ja(t,e,n,r,i){var o=gi(n)?vi:di.current;return o=mi(e,o),io(e,i),n=Qo(t,e,n,r,o,i),null===t||Da?(e.effectTag|=1,Na(t,e,n,i),e.child):(e.updateQueue=t.updateQueue,e.effectTag&=-517,t.expirationTime<=i&&(t.expirationTime=0),$a(t,e,i))}function Ba(t,e,n,r,i){if(gi(n)){var o=!0;xi(e)}else o=!1;if(io(e,i),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.effectTag|=2),wo(e,n,r),ko(e,n,r,i),r=!0;else if(null===t){var a=e.stateNode,u=e.memoizedProps;a.props=u;var s=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=oo(c):c=mi(e,c=gi(n)?vi:di.current);var l=n.getDerivedStateFromProps,f="function"===typeof l||"function"===typeof a.getSnapshotBeforeUpdate;f||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(u!==r||s!==c)&&xo(e,a,r,c),ao=!1;var h=e.memoizedState;a.state=h,ho(e,r,a,i),s=e.memoizedState,u!==r||h!==s||pi.current||ao?("function"===typeof l&&(go(e,n,l,r),s=e.memoizedState),(u=ao||bo(e,n,u,r,h,s,c))?(f||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(e.effectTag|=4)):("function"===typeof a.componentDidMount&&(e.effectTag|=4),e.memoizedProps=r,e.memoizedState=s),a.props=r,a.state=s,a.context=c,r=u):("function"===typeof a.componentDidMount&&(e.effectTag|=4),r=!1)}else a=e.stateNode,so(t,e),u=e.memoizedProps,a.props=e.type===e.elementType?u:Qi(e.type,u),s=a.context,"object"===typeof(c=n.contextType)&&null!==c?c=oo(c):c=mi(e,c=gi(n)?vi:di.current),(f="function"===typeof(l=n.getDerivedStateFromProps)||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(u!==r||s!==c)&&xo(e,a,r,c),ao=!1,s=e.memoizedState,a.state=s,ho(e,r,a,i),h=e.memoizedState,u!==r||s!==h||pi.current||ao?("function"===typeof l&&(go(e,n,l,r),h=e.memoizedState),(l=ao||bo(e,n,u,r,s,h,c))?(f||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,h,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,h,c)),"function"===typeof a.componentDidUpdate&&(e.effectTag|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(e.effectTag|=256)):("function"!==typeof a.componentDidUpdate||u===t.memoizedProps&&s===t.memoizedState||(e.effectTag|=4),"function"!==typeof a.getSnapshotBeforeUpdate||u===t.memoizedProps&&s===t.memoizedState||(e.effectTag|=256),e.memoizedProps=r,e.memoizedState=h),a.props=r,a.state=h,a.context=c,r=l):("function"!==typeof a.componentDidUpdate||u===t.memoizedProps&&s===t.memoizedState||(e.effectTag|=4),"function"!==typeof a.getSnapshotBeforeUpdate||u===t.memoizedProps&&s===t.memoizedState||(e.effectTag|=256),r=!1);return Va(t,e,n,r,o,i)}function Va(t,e,n,r,i,o){La(t,e);var a=0!==(64&e.effectTag);if(!r&&!a)return i&&ki(e,n,!1),$a(t,e,o);r=e.stateNode,Aa.current=e;var u=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return e.effectTag|=1,null!==t&&a?(e.child=To(e,t.child,null,o),e.child=To(e,null,u,o)):Na(t,e,u,o),e.memoizedState=r.state,i&&ki(e,n,!0),e.child}function Ua(t){var e=t.stateNode;e.pendingContext?bi(0,e.pendingContext,e.pendingContext!==e.context):e.context&&bi(0,e.context,!1),Po(t,e.containerInfo)}var za,Wa,Ga,Ha,qa={dehydrated:null,retryTime:0};function Ka(t,e,n){var r,i=e.mode,o=e.pendingProps,a=jo.current,u=!1;if((r=0!==(64&e.effectTag))||(r=0!==(2&a)&&(null===t||null!==t.memoizedState)),r?(u=!0,e.effectTag&=-65):null!==t&&null===t.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(a|=1),fi(jo,1&a),null===t){if(void 0!==o.fallback&&Ta(e),u){if(u=o.fallback,(o=Fs(null,i,0,null)).return=e,0===(2&e.mode))for(t=null!==e.memoizedState?e.child.child:e.child,o.child=t;null!==t;)t.return=o,t=t.sibling;return(n=Fs(u,i,n,null)).return=e,o.sibling=n,e.memoizedState=qa,e.child=o,n}return i=o.children,e.memoizedState=null,e.child=Oo(e,null,i,n)}if(null!==t.memoizedState){if(i=(t=t.child).sibling,u){if(o=o.fallback,(n=Ps(t,t.pendingProps)).return=e,0===(2&e.mode)&&(u=null!==e.memoizedState?e.child.child:e.child)!==t.child)for(n.child=u;null!==u;)u.return=n,u=u.sibling;return(i=Ps(i,o)).return=e,n.sibling=i,n.childExpirationTime=0,e.memoizedState=qa,e.child=n,i}return n=To(e,t.child,o.children,n),e.memoizedState=null,e.child=n}if(t=t.child,u){if(u=o.fallback,(o=Fs(null,i,0,null)).return=e,o.child=t,null!==t&&(t.return=o),0===(2&e.mode))for(t=null!==e.memoizedState?e.child.child:e.child,o.child=t;null!==t;)t.return=o,t=t.sibling;return(n=Fs(u,i,n,null)).return=e,o.sibling=n,n.effectTag|=2,o.childExpirationTime=0,e.memoizedState=qa,e.child=o,n}return e.memoizedState=null,e.child=To(e,t,o.children,n)}function Xa(t,e){t.expirationTime<e&&(t.expirationTime=e);var n=t.alternate;null!==n&&n.expirationTime<e&&(n.expirationTime=e),ro(t.return,e)}function Ya(t,e,n,r,i,o){var a=t.memoizedState;null===a?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:i,lastEffect:o}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailExpiration=0,a.tailMode=i,a.lastEffect=o)}function Qa(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Na(t,e,r.children,n),0!==(2&(r=jo.current)))r=1&r|2,e.effectTag|=64;else{if(null!==t&&0!==(64&t.effectTag))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Xa(t,n);else if(19===t.tag)Xa(t,n);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(fi(jo,r),0===(2&e.mode))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;null!==n;)null!==(t=n.alternate)&&null===Bo(t)&&(i=n),n=n.sibling;null===(n=i)?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Ya(e,!1,i,n,o,e.lastEffect);break;case"backwards":for(n=null,i=e.child,e.child=null;null!==i;){if(null!==(t=i.alternate)&&null===Bo(t)){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Ya(e,!0,n,null,o,e.lastEffect);break;case"together":Ya(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function $a(t,e,n){null!==t&&(e.dependencies=t.dependencies);var r=e.expirationTime;if(0!==r&&ms(r),e.childExpirationTime<n)return null;if(null!==t&&e.child!==t.child)throw Error(a(153));if(null!==e.child){for(n=Ps(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Ps(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Ja(t,e){switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?e||null===t.tail?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Za(t,e,n){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return gi(e.type)&&yi(),null;case 3:return Mo(),li(pi),li(di),(n=e.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==t&&null!==t.child||!Ia(e)||(e.effectTag|=4),Wa(e),null;case 5:Lo(e),n=No(Do.current);var o=e.type;if(null!==t&&null!=e.stateNode)Ga(t,e,o,r,n),t.ref!==e.ref&&(e.effectTag|=128);else{if(!r){if(null===e.stateNode)throw Error(a(166));return null}if(t=No(Ro.current),Ia(e)){r=e.stateNode,o=e.type;var u=e.memoizedProps;switch(r[Sn]=e,r[Tn]=u,o){case"iframe":case"object":case"embed":Ke("load",r);break;case"video":case"audio":for(t=0;t<Qt.length;t++)Ke(Qt[t],r);break;case"source":Ke("error",r);break;case"img":case"image":case"link":Ke("error",r),Ke("load",r);break;case"form":Ke("reset",r),Ke("submit",r);break;case"details":Ke("toggle",r);break;case"input":kt(r,u),Ke("invalid",r),an(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!u.multiple},Ke("invalid",r),an(n,"onChange");break;case"textarea":Rt(r,u),Ke("invalid",r),an(n,"onChange")}for(var s in nn(o,u),t=null,u)if(u.hasOwnProperty(s)){var c=u[s];"children"===s?"string"===typeof c?r.textContent!==c&&(t=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(t=["children",""+c]):E.hasOwnProperty(s)&&null!=c&&an(n,s)}switch(o){case"input":bt(r),_t(r,u,!0);break;case"textarea":bt(r),Dt(r);break;case"select":case"option":break;default:"function"===typeof u.onClick&&(r.onclick=un)}n=t,e.updateQueue=n,null!==n&&(e.effectTag|=4)}else{switch(s=9===n.nodeType?n:n.ownerDocument,t===on&&(t=Mt(o)),t===on?"script"===o?((t=s.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof r.is?t=s.createElement(o,{is:r.is}):(t=s.createElement(o),"select"===o&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,o),t[Sn]=e,t[Tn]=r,za(t,e,!1,!1),e.stateNode=t,s=rn(o,r),o){case"iframe":case"object":case"embed":Ke("load",t),c=r;break;case"video":case"audio":for(c=0;c<Qt.length;c++)Ke(Qt[c],t);c=r;break;case"source":Ke("error",t),c=r;break;case"img":case"image":case"link":Ke("error",t),Ke("load",t),c=r;break;case"form":Ke("reset",t),Ke("submit",t),c=r;break;case"details":Ke("toggle",t),c=r;break;case"input":kt(t,r),c=xt(t,r),Ke("invalid",t),an(n,"onChange");break;case"option":c=Tt(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},c=i({},r,{value:void 0}),Ke("invalid",t),an(n,"onChange");break;case"textarea":Rt(t,r),c=It(t,r),Ke("invalid",t),an(n,"onChange");break;default:c=r}nn(o,c);var l=c;for(u in l)if(l.hasOwnProperty(u)){var f=l[u];"style"===u?tn(t,f):"dangerouslySetInnerHTML"===u?null!=(f=f?f.__html:void 0)&&Bt(t,f):"children"===u?"string"===typeof f?("textarea"!==o||""!==f)&&Vt(t,f):"number"===typeof f&&Vt(t,""+f):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(E.hasOwnProperty(u)?null!=f&&an(n,u):null!=f&&Q(t,u,f,s))}switch(o){case"input":bt(t),_t(t,r,!1);break;case"textarea":bt(t),Dt(t);break;case"option":null!=r.value&&t.setAttribute("value",""+gt(r.value));break;case"select":t.multiple=!!r.multiple,null!=(n=r.value)?Ot(t,!!r.multiple,n,!1):null!=r.defaultValue&&Ot(t,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof c.onClick&&(t.onclick=un)}bn(o,r)&&(e.effectTag|=4)}null!==e.ref&&(e.effectTag|=128)}return null;case 6:if(t&&null!=e.stateNode)Ha(t,e,t.memoizedProps,r);else{if("string"!==typeof r&&null===e.stateNode)throw Error(a(166));n=No(Do.current),No(Ro.current),Ia(e)?(n=e.stateNode,r=e.memoizedProps,n[Sn]=e,n.nodeValue!==r&&(e.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Sn]=e,e.stateNode=n)}return null;case 13:return li(jo),r=e.memoizedState,0!==(64&e.effectTag)?(e.expirationTime=n,e):(n=null!==r,r=!1,null===t?void 0!==e.memoizedProps.fallback&&Ia(e):(r=null!==(o=t.memoizedState),n||null===o||null!==(o=t.child.sibling)&&(null!==(u=e.firstEffect)?(e.firstEffect=o,o.nextEffect=u):(e.firstEffect=e.lastEffect=o,o.nextEffect=null),o.effectTag=8)),n&&!r&&0!==(2&e.mode)&&(null===t&&!0!==e.memoizedProps.unstable_avoidThisFallback||0!==(1&jo.current)?Lu===Tu&&(Lu=Ru):(Lu!==Tu&&Lu!==Ru||(Lu=Au),0!==zu&&null!==Pu&&(Us(Pu,Fu),zs(Pu,zu)))),(n||r)&&(e.effectTag|=4),null);case 4:return Mo(),Wa(e),null;case 10:return no(e),null;case 17:return gi(e.type)&&yi(),null;case 19:if(li(jo),null===(r=e.memoizedState))return null;if(o=0!==(64&e.effectTag),null===(u=r.rendering)){if(o)Ja(r,!1);else if(Lu!==Tu||null!==t&&0!==(64&t.effectTag))for(u=e.child;null!==u;){if(null!==(t=Bo(u))){for(e.effectTag|=64,Ja(r,!1),null!==(o=t.updateQueue)&&(e.updateQueue=o,e.effectTag|=4),null===r.lastEffect&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=e.child;null!==r;)u=n,(o=r).effectTag&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(t=o.alternate)?(o.childExpirationTime=0,o.expirationTime=u,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null):(o.childExpirationTime=t.childExpirationTime,o.expirationTime=t.expirationTime,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,u=t.dependencies,o.dependencies=null===u?null:{expirationTime:u.expirationTime,firstContext:u.firstContext,responders:u.responders}),r=r.sibling;return fi(jo,1&jo.current|2),e.child}u=u.sibling}}else{if(!o)if(null!==(t=Bo(u))){if(e.effectTag|=64,o=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.effectTag|=4),Ja(r,!0),null===r.tail&&"hidden"===r.tailMode&&!u.alternate)return null!==(e=e.lastEffect=r.lastEffect)&&(e.nextEffect=null),null}else 2*Ui()-r.renderingStartTime>r.tailExpiration&&1<n&&(e.effectTag|=64,o=!0,Ja(r,!1),e.expirationTime=e.childExpirationTime=n-1);r.isBackwards?(u.sibling=e.child,e.child=u):(null!==(n=r.last)?n.sibling=u:e.child=u,r.last=u)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=Ui()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=Ui(),n.sibling=null,e=jo.current,fi(jo,o?1&e|2:1&e),n):null}throw Error(a(156,e.tag))}function tu(t){switch(t.tag){case 1:gi(t.type)&&yi();var e=t.effectTag;return 4096&e?(t.effectTag=-4097&e|64,t):null;case 3:if(Mo(),li(pi),li(di),0!==(64&(e=t.effectTag)))throw Error(a(285));return t.effectTag=-4097&e|64,t;case 5:return Lo(t),null;case 13:return li(jo),4096&(e=t.effectTag)?(t.effectTag=-4097&e|64,t):null;case 19:return li(jo),null;case 4:return Mo(),null;case 10:return no(t),null;default:return null}}function eu(t,e){return{value:t,source:e,stack:mt(e)}}za=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Wa=function(){},Ga=function(t,e,n,r,o){var a=t.memoizedProps;if(a!==r){var u,s,c=e.stateNode;switch(No(Ro.current),t=null,n){case"input":a=xt(c,a),r=xt(c,r),t=[];break;case"option":a=Tt(c,a),r=Tt(c,r),t=[];break;case"select":a=i({},a,{value:void 0}),r=i({},r,{value:void 0}),t=[];break;case"textarea":a=It(c,a),r=It(c,r),t=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(c.onclick=un)}for(u in nn(n,r),n=null,a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&null!=a[u])if("style"===u)for(s in c=a[u])c.hasOwnProperty(s)&&(n||(n={}),n[s]="");else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(E.hasOwnProperty(u)?t||(t=[]):(t=t||[]).push(u,null));for(u in r){var l=r[u];if(c=null!=a?a[u]:void 0,r.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(s in c)!c.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&c[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(t||(t=[]),t.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(t=t||[]).push(u,l)):"children"===u?c===l||"string"!==typeof l&&"number"!==typeof l||(t=t||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(E.hasOwnProperty(u)?(null!=l&&an(o,u),t||c===l||(t=[])):(t=t||[]).push(u,l))}n&&(t=t||[]).push("style",n),o=t,(e.updateQueue=o)&&(e.effectTag|=4)}},Ha=function(t,e,n,r){n!==r&&(e.effectTag|=4)};var nu="function"===typeof WeakSet?WeakSet:Set;function ru(t,e){var n=e.source,r=e.stack;null===r&&null!==n&&(r=mt(n)),null!==n&&vt(n.type),e=e.value,null!==t&&1===t.tag&&vt(t.type);try{console.error(e)}catch(i){setTimeout(function(){throw i})}}function iu(t){var e=t.ref;if(null!==e)if("function"===typeof e)try{e(null)}catch(n){Ts(t,n)}else e.current=null}function ou(t,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&e.effectTag&&null!==t){var n=t.memoizedProps,r=t.memoizedState;e=(t=e.stateNode).getSnapshotBeforeUpdate(e.elementType===e.type?n:Qi(e.type,n),r),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(a(163))}function au(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==e)}}function uu(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function su(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:return void uu(3,n);case 1:if(t=n.stateNode,4&n.effectTag)if(null===e)t.componentDidMount();else{var r=n.elementType===n.type?e.memoizedProps:Qi(n.type,e.memoizedProps);t.componentDidUpdate(r,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate)}return void(null!==(e=n.updateQueue)&&po(n,e,t));case 3:if(null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}po(n,e,t)}return;case 5:return t=n.stateNode,void(null===e&&4&n.effectTag&&bn(n.type,n.memoizedProps)&&t.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Fe(n)))));case 19:case 17:case 20:case 21:return}throw Error(a(163))}function cu(t,e,n){switch("function"===typeof Rs&&Rs(e),e.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(t=e.updateQueue)&&null!==(t=t.lastEffect)){var r=t.next;Gi(97<n?97:n,function(){var t=r;do{var n=t.destroy;if(void 0!==n){var i=e;try{n()}catch(o){Ts(i,o)}}t=t.next}while(t!==r)})}break;case 1:iu(e),"function"===typeof(n=e.stateNode).componentWillUnmount&&function(t,e){try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(n){Ts(t,n)}}(e,n);break;case 5:iu(e);break;case 4:du(t,e,n)}}function lu(t){var e=t.alternate;t.return=null,t.child=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.alternate=null,t.firstEffect=null,t.lastEffect=null,t.pendingProps=null,t.memoizedProps=null,t.stateNode=null,null!==e&&lu(e)}function fu(t){return 5===t.tag||3===t.tag||4===t.tag}function hu(t){t:{for(var e=t.return;null!==e;){if(fu(e)){var n=e;break t}e=e.return}throw Error(a(160))}switch(e=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:e=e.containerInfo,r=!0;break;default:throw Error(a(161))}16&n.effectTag&&(Vt(e,""),n.effectTag&=-17);t:e:for(n=t;;){for(;null===n.sibling;){if(null===n.return||fu(n.return)){n=null;break t}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue e;if(null===n.child||4===n.tag)continue e;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break t}}r?function t(e,n,r){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,n?8===r.nodeType?r.parentNode.insertBefore(e,n):r.insertBefore(e,n):(8===r.nodeType?(n=r.parentNode,n.insertBefore(e,r)):(n=r,n.appendChild(e)),r=r._reactRootContainer,null!==r&&void 0!==r||null!==n.onclick||(n.onclick=un));else if(4!==i&&(e=e.child,null!==e))for(t(e,n,r),e=e.sibling;null!==e;)t(e,n,r),e=e.sibling}(t,n,e):function t(e,n,r){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,n?r.insertBefore(e,n):r.appendChild(e);else if(4!==i&&(e=e.child,null!==e))for(t(e,n,r),e=e.sibling;null!==e;)t(e,n,r),e=e.sibling}(t,n,e)}function du(t,e,n){for(var r,i,o=e,u=!1;;){if(!u){u=o.return;t:for(;;){if(null===u)throw Error(a(160));switch(r=u.stateNode,u.tag){case 5:i=!1;break t;case 3:case 4:r=r.containerInfo,i=!0;break t}u=u.return}u=!0}if(5===o.tag||6===o.tag){t:for(var s=t,c=o,l=n,f=c;;)if(cu(s,f,l),null!==f.child&&4!==f.tag)f.child.return=f,f=f.child;else{if(f===c)break t;for(;null===f.sibling;){if(null===f.return||f.return===c)break t;f=f.return}f.sibling.return=f.return,f=f.sibling}i?(s=r,c=o.stateNode,8===s.nodeType?s.parentNode.removeChild(c):s.removeChild(c)):r.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){r=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(cu(t,o,n),null!==o.child){o.child.return=o,o=o.child;continue}if(o===e)break;for(;null===o.sibling;){if(null===o.return||o.return===e)return;4===(o=o.return).tag&&(u=!1)}o.sibling.return=o.return,o=o.sibling}}function pu(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:return void au(3,e);case 1:return;case 5:var n=e.stateNode;if(null!=n){var r=e.memoizedProps,i=null!==t?t.memoizedProps:r;t=e.type;var o=e.updateQueue;if(e.updateQueue=null,null!==o){for(n[Tn]=r,"input"===t&&"radio"===r.type&&null!=r.name&&Et(n,r),rn(t,i),e=rn(t,r),i=0;i<o.length;i+=2){var u=o[i],s=o[i+1];"style"===u?tn(n,s):"dangerouslySetInnerHTML"===u?Bt(n,s):"children"===u?Vt(n,s):Q(n,u,s,e)}switch(t){case"input":Ct(n,r);break;case"textarea":At(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(t=r.value)?Ot(n,!!r.multiple,t,!1):e!==!!r.multiple&&(null!=r.defaultValue?Ot(n,!!r.multiple,r.defaultValue,!0):Ot(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===e.stateNode)throw Error(a(162));return void(e.stateNode.nodeValue=e.memoizedProps);case 3:return void((e=e.stateNode).hydrate&&(e.hydrate=!1,Fe(e.containerInfo)));case 12:return;case 13:if(n=e,null===e.memoizedState?r=!1:(r=!0,n=e.child,Gu=Ui()),null!==n)t:for(t=n;;){if(5===t.tag)o=t.stateNode,r?"function"===typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=t.stateNode,i=void 0!==(i=t.memoizedProps.style)&&null!==i&&i.hasOwnProperty("display")?i.display:null,o.style.display=Ze("display",i));else if(6===t.tag)t.stateNode.nodeValue=r?"":t.memoizedProps;else{if(13===t.tag&&null!==t.memoizedState&&null===t.memoizedState.dehydrated){(o=t.child.sibling).return=t,t=o;continue}if(null!==t.child){t.child.return=t,t=t.child;continue}}if(t===n)break;for(;null===t.sibling;){if(null===t.return||t.return===n)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}return void vu(e);case 19:return void vu(e);case 17:return}throw Error(a(163))}function vu(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new nu),e.forEach(function(e){var r=function(t,e){var n=t.stateNode;null!==n&&n.delete(e),0===(e=0)&&(e=is(e=rs(),t,null)),null!==(t=as(t,e))&&ss(t)}.bind(null,t,e);n.has(e)||(n.add(e),e.then(r,r))})}}var mu="function"===typeof WeakMap?WeakMap:Map;function gu(t,e,n){(n=co(n,null)).tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ku||(Ku=!0,Xu=r),ru(t,e)},n}function yu(t,e,n){(n=co(n,null)).tag=3;var r=t.type.getDerivedStateFromError;if("function"===typeof r){var i=e.value;n.payload=function(){return ru(t,e),r(i)}}var o=t.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Yu?Yu=new Set([this]):Yu.add(this),ru(t,e));var n=e.stack;this.componentDidCatch(e.value,{componentStack:null!==n?n:""})}),n}var bu,wu=Math.ceil,xu=Y.ReactCurrentDispatcher,ku=Y.ReactCurrentOwner,Eu=0,Cu=8,_u=16,Su=32,Tu=0,Ou=1,Iu=2,Ru=3,Au=4,Du=5,Nu=Eu,Pu=null,Mu=null,Fu=0,Lu=Tu,ju=null,Bu=1073741823,Vu=1073741823,Uu=null,zu=0,Wu=!1,Gu=0,Hu=500,qu=null,Ku=!1,Xu=null,Yu=null,Qu=!1,$u=null,Ju=90,Zu=null,ts=0,es=null,ns=0;function rs(){return(Nu&(_u|Su))!==Eu?1073741821-(Ui()/10|0):0!==ns?ns:ns=1073741821-(Ui()/10|0)}function is(t,e,n){if(0===(2&(e=e.mode)))return 1073741823;var r=zi();if(0===(4&e))return 99===r?1073741823:1073741822;if((Nu&_u)!==Eu)return Fu;if(null!==n)t=Yi(t,0|n.timeoutMs||5e3,250);else switch(r){case 99:t=1073741823;break;case 98:t=Yi(t,150,100);break;case 97:case 96:t=Yi(t,5e3,250);break;case 95:t=2;break;default:throw Error(a(326))}return null!==Pu&&t===Fu&&--t,t}function os(t,e){if(50<ts)throw ts=0,es=null,Error(a(185));if(null!==(t=as(t,e))){var n=zi();1073741823===e?(Nu&Cu)!==Eu&&(Nu&(_u|Su))===Eu?cs(t):(ss(t),Nu===Eu&&Ki()):ss(t),(4&Nu)===Eu||98!==n&&99!==n||(null===Zu?Zu=new Map([[t,e]]):(void 0===(n=Zu.get(t))||n>e)&&Zu.set(t,e))}}function as(t,e){t.expirationTime<e&&(t.expirationTime=e);var n=t.alternate;null!==n&&n.expirationTime<e&&(n.expirationTime=e);var r=t.return,i=null;if(null===r&&3===t.tag)i=t.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<e&&(r.childExpirationTime=e),null!==n&&n.childExpirationTime<e&&(n.childExpirationTime=e),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return null!==i&&(Pu===i&&(ms(e),Lu===Au&&Us(i,Fu)),zs(i,e)),i}function us(t){var e=t.lastExpiredTime;if(0!==e)return e;if(!Vs(t,e=t.firstPendingTime))return e;var n=t.lastPingedTime;return 2>=(t=n>(t=t.nextKnownPendingLevel)?n:t)&&e!==t?0:t}function ss(t){if(0!==t.lastExpiredTime)t.callbackExpirationTime=1073741823,t.callbackPriority=99,t.callbackNode=qi(cs.bind(null,t));else{var e=us(t),n=t.callbackNode;if(0===e)null!==n&&(t.callbackNode=null,t.callbackExpirationTime=0,t.callbackPriority=90);else{var r=rs();if(1073741823===e?r=99:1===e||2===e?r=95:r=0>=(r=10*(1073741821-e)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var i=t.callbackPriority;if(t.callbackExpirationTime===e&&i>=r)return;n!==Pi&&_i(n)}t.callbackExpirationTime=e,t.callbackPriority=r,e=1073741823===e?qi(cs.bind(null,t)):Hi(r,function t(e,n){ns=0;if(n)return n=rs(),Ws(e,n),ss(e),null;var r=us(e);if(0!==r){if(n=e.callbackNode,(Nu&(_u|Su))!==Eu)throw Error(a(327));if(Cs(),e===Pu&&r===Fu||hs(e,r),null!==Mu){var i=Nu;Nu|=_u;for(var o=ps();;)try{ys();break}catch(c){ds(e,c)}if(eo(),Nu=i,xu.current=o,Lu===Ou)throw n=ju,hs(e,r),Us(e,r),ss(e),n;if(null===Mu)switch(o=e.finishedWork=e.current.alternate,e.finishedExpirationTime=r,i=Lu,Pu=null,i){case Tu:case Ou:throw Error(a(345));case Iu:Ws(e,2<r?2:r);break;case Ru:if(Us(e,r),i=e.lastSuspendedTime,r===i&&(e.nextKnownPendingLevel=xs(o)),1073741823===Bu&&10<(o=Gu+Hu-Ui())){if(Wu){var u=e.lastPingedTime;if(0===u||u>=r){e.lastPingedTime=r,hs(e,r);break}}if(0!==(u=us(e))&&u!==r)break;if(0!==i&&i!==r){e.lastPingedTime=i;break}e.timeoutHandle=xn(ks.bind(null,e),o);break}ks(e);break;case Au:if(Us(e,r),i=e.lastSuspendedTime,r===i&&(e.nextKnownPendingLevel=xs(o)),Wu&&(0===(o=e.lastPingedTime)||o>=r)){e.lastPingedTime=r,hs(e,r);break}if(0!==(o=us(e))&&o!==r)break;if(0!==i&&i!==r){e.lastPingedTime=i;break}if(1073741823!==Vu?i=10*(1073741821-Vu)-Ui():1073741823===Bu?i=0:(i=10*(1073741821-Bu)-5e3,o=Ui(),r=10*(1073741821-r)-o,0>(i=o-i)&&(i=0),i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*wu(i/1960))-i,r<i&&(i=r)),10<i){e.timeoutHandle=xn(ks.bind(null,e),i);break}ks(e);break;case Du:if(1073741823!==Bu&&null!==Uu){u=Bu;var s=Uu;if(0>=(i=0|s.busyMinDurationMs)?i=0:(o=0|s.busyDelayMs,u=Ui()-(10*(1073741821-u)-(0|s.timeoutMs||5e3)),i=u<=o?0:o+i-u),10<i){Us(e,r),e.timeoutHandle=xn(ks.bind(null,e),i);break}}ks(e);break;default:throw Error(a(329))}if(ss(e),e.callbackNode===n)return t.bind(null,e)}}return null}.bind(null,t),{timeout:10*(1073741821-e)-Ui()}),t.callbackNode=e}}}function cs(t){var e=t.lastExpiredTime;if(e=0!==e?e:1073741823,(Nu&(_u|Su))!==Eu)throw Error(a(327));if(Cs(),t===Pu&&e===Fu||hs(t,e),null!==Mu){var n=Nu;Nu|=_u;for(var r=ps();;)try{gs();break}catch(i){ds(t,i)}if(eo(),Nu=n,xu.current=r,Lu===Ou)throw n=ju,hs(t,e),Us(t,e),ss(t),n;if(null!==Mu)throw Error(a(261));t.finishedWork=t.current.alternate,t.finishedExpirationTime=e,Pu=null,ks(t),ss(t)}return null}function ls(t,e){var n=Nu;Nu|=1;try{return t(e)}finally{(Nu=n)===Eu&&Ki()}}function fs(t,e){var n=Nu;Nu&=-2,Nu|=Cu;try{return t(e)}finally{(Nu=n)===Eu&&Ki()}}function hs(t,e){t.finishedWork=null,t.finishedExpirationTime=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,kn(n)),null!==Mu)for(n=Mu.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&yi();break;case 3:Mo(),li(pi),li(di);break;case 5:Lo(r);break;case 4:Mo();break;case 13:case 19:li(jo);break;case 10:no(r)}n=n.return}Pu=t,Mu=Ps(t.current,null),Fu=e,Lu=Tu,ju=null,Vu=Bu=1073741823,Uu=null,zu=0,Wu=!1}function ds(t,e){for(;;){try{if(eo(),Uo.current=ya,Ko)for(var n=Go.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}if(Wo=0,qo=Ho=Go=null,Ko=!1,null===Mu||null===Mu.return)return Lu=Ou,ju=e,Mu=null;t:{var i=t,o=Mu.return,a=Mu,u=e;if(e=Fu,a.effectTag|=2048,a.firstEffect=a.lastEffect=null,null!==u&&"object"===typeof u&&"function"===typeof u.then){var s=u;if(0===(2&a.mode)){var c=a.alternate;c?(a.updateQueue=c.updateQueue,a.memoizedState=c.memoizedState,a.expirationTime=c.expirationTime):(a.updateQueue=null,a.memoizedState=null)}var l=0!==(1&jo.current),f=o;do{var h;if(h=13===f.tag){var d=f.memoizedState;if(null!==d)h=null!==d.dehydrated;else{var p=f.memoizedProps;h=void 0!==p.fallback&&(!0!==p.unstable_avoidThisFallback||!l)}}if(h){var v=f.updateQueue;if(null===v){var m=new Set;m.add(s),f.updateQueue=m}else v.add(s);if(0===(2&f.mode)){if(f.effectTag|=64,a.effectTag&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var g=co(1073741823,null);g.tag=2,lo(a,g)}a.expirationTime=1073741823;break t}u=void 0,a=e;var y=i.pingCache;if(null===y?(y=i.pingCache=new mu,u=new Set,y.set(s,u)):void 0===(u=y.get(s))&&(u=new Set,y.set(s,u)),!u.has(a)){u.add(a);var b=Os.bind(null,i,s,a);s.then(b,b)}f.effectTag|=4096,f.expirationTime=e;break t}f=f.return}while(null!==f);u=Error((vt(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+mt(a))}Lu!==Du&&(Lu=Iu),u=eu(u,a),f=o;do{switch(f.tag){case 3:s=u,f.effectTag|=4096,f.expirationTime=e,fo(f,gu(f,s,e));break t;case 1:s=u;var w=f.type,x=f.stateNode;if(0===(64&f.effectTag)&&("function"===typeof w.getDerivedStateFromError||null!==x&&"function"===typeof x.componentDidCatch&&(null===Yu||!Yu.has(x)))){f.effectTag|=4096,f.expirationTime=e,fo(f,yu(f,s,e));break t}}f=f.return}while(null!==f)}Mu=ws(Mu)}catch(k){e=k;continue}break}}function ps(){var t=xu.current;return xu.current=ya,null===t?ya:t}function vs(t,e){t<Bu&&2<t&&(Bu=t),null!==e&&t<Vu&&2<t&&(Vu=t,Uu=e)}function ms(t){t>zu&&(zu=t)}function gs(){for(;null!==Mu;)Mu=bs(Mu)}function ys(){for(;null!==Mu&&!Mi();)Mu=bs(Mu)}function bs(t){var e=bu(t.alternate,t,Fu);return t.memoizedProps=t.pendingProps,null===e&&(e=ws(t)),ku.current=null,e}function ws(t){Mu=t;do{var e=Mu.alternate;if(t=Mu.return,0===(2048&Mu.effectTag)){if(e=Za(e,Mu,Fu),1===Fu||1!==Mu.childExpirationTime){for(var n=0,r=Mu.child;null!==r;){var i=r.expirationTime,o=r.childExpirationTime;i>n&&(n=i),o>n&&(n=o),r=r.sibling}Mu.childExpirationTime=n}if(null!==e)return e;null!==t&&0===(2048&t.effectTag)&&(null===t.firstEffect&&(t.firstEffect=Mu.firstEffect),null!==Mu.lastEffect&&(null!==t.lastEffect&&(t.lastEffect.nextEffect=Mu.firstEffect),t.lastEffect=Mu.lastEffect),1<Mu.effectTag&&(null!==t.lastEffect?t.lastEffect.nextEffect=Mu:t.firstEffect=Mu,t.lastEffect=Mu))}else{if(null!==(e=tu(Mu)))return e.effectTag&=2047,e;null!==t&&(t.firstEffect=t.lastEffect=null,t.effectTag|=2048)}if(null!==(e=Mu.sibling))return e;Mu=t}while(null!==Mu);return Lu===Tu&&(Lu=Du),null}function xs(t){var e=t.expirationTime;return e>(t=t.childExpirationTime)?e:t}function ks(t){var e=zi();return Gi(99,function(t,e){do{Cs()}while(null!==$u);if((Nu&(_u|Su))!==Eu)throw Error(a(327));var n=t.finishedWork,r=t.finishedExpirationTime;if(null===n)return null;if(t.finishedWork=null,t.finishedExpirationTime=0,n===t.current)throw Error(a(177));t.callbackNode=null,t.callbackExpirationTime=0,t.callbackPriority=90,t.nextKnownPendingLevel=0;var i=xs(n);if(t.firstPendingTime=i,r<=t.lastSuspendedTime?t.firstSuspendedTime=t.lastSuspendedTime=t.nextKnownPendingLevel=0:r<=t.firstSuspendedTime&&(t.firstSuspendedTime=r-1),r<=t.lastPingedTime&&(t.lastPingedTime=0),r<=t.lastExpiredTime&&(t.lastExpiredTime=0),t===Pu&&(Mu=Pu=null,Fu=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){var o=Nu;Nu|=Su,ku.current=null,gn=qe;var u=fn();if(hn(u)){if("selectionStart"in u)var s={start:u.selectionStart,end:u.selectionEnd};else t:{var c=(s=(s=u.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(c&&0!==c.rangeCount){s=c.anchorNode;var l=c.anchorOffset,f=c.focusNode;c=c.focusOffset;try{s.nodeType,f.nodeType}catch(S){s=null;break t}var h=0,d=-1,p=-1,v=0,m=0,g=u,y=null;e:for(;;){for(var b;g!==s||0!==l&&3!==g.nodeType||(d=h+l),g!==f||0!==c&&3!==g.nodeType||(p=h+c),3===g.nodeType&&(h+=g.nodeValue.length),null!==(b=g.firstChild);)y=g,g=b;for(;;){if(g===u)break e;if(y===s&&++v===l&&(d=h),y===f&&++m===c&&(p=h),null!==(b=g.nextSibling))break;y=(g=y).parentNode}g=b}s=-1===d||-1===p?null:{start:d,end:p}}else s=null}s=s||{start:0,end:0}}else s=null;yn={activeElementDetached:null,focusedElem:u,selectionRange:s},qe=!1,qu=i;do{try{Es()}catch(S){if(null===qu)throw Error(a(330));Ts(qu,S),qu=qu.nextEffect}}while(null!==qu);qu=i;do{try{for(u=t,s=e;null!==qu;){var w=qu.effectTag;if(16&w&&Vt(qu.stateNode,""),128&w){var x=qu.alternate;if(null!==x){var k=x.ref;null!==k&&("function"===typeof k?k(null):k.current=null)}}switch(1038&w){case 2:hu(qu),qu.effectTag&=-3;break;case 6:hu(qu),qu.effectTag&=-3,pu(qu.alternate,qu);break;case 1024:qu.effectTag&=-1025;break;case 1028:qu.effectTag&=-1025,pu(qu.alternate,qu);break;case 4:pu(qu.alternate,qu);break;case 8:du(u,l=qu,s),lu(l)}qu=qu.nextEffect}}catch(S){if(null===qu)throw Error(a(330));Ts(qu,S),qu=qu.nextEffect}}while(null!==qu);if(k=yn,x=fn(),w=k.focusedElem,s=k.selectionRange,x!==w&&w&&w.ownerDocument&&function t(e,n){return!(!e||!n)&&(e===n||(!e||3!==e.nodeType)&&(n&&3===n.nodeType?t(e,n.parentNode):"contains"in e?e.contains(n):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(n))))}(w.ownerDocument.documentElement,w)){null!==s&&hn(w)&&(x=s.start,void 0===(k=s.end)&&(k=x),"selectionStart"in w?(w.selectionStart=x,w.selectionEnd=Math.min(k,w.value.length)):(k=(x=w.ownerDocument||document)&&x.defaultView||window).getSelection&&(k=k.getSelection(),l=w.textContent.length,u=Math.min(s.start,l),s=void 0===s.end?u:Math.min(s.end,l),!k.extend&&u>s&&(l=s,s=u,u=l),l=ln(w,u),f=ln(w,s),l&&f&&(1!==k.rangeCount||k.anchorNode!==l.node||k.anchorOffset!==l.offset||k.focusNode!==f.node||k.focusOffset!==f.offset)&&((x=x.createRange()).setStart(l.node,l.offset),k.removeAllRanges(),u>s?(k.addRange(x),k.extend(f.node,f.offset)):(x.setEnd(f.node,f.offset),k.addRange(x))))),x=[];for(k=w;k=k.parentNode;)1===k.nodeType&&x.push({element:k,left:k.scrollLeft,top:k.scrollTop});for("function"===typeof w.focus&&w.focus(),w=0;w<x.length;w++)(k=x[w]).element.scrollLeft=k.left,k.element.scrollTop=k.top}qe=!!gn,yn=gn=null,t.current=n,qu=i;do{try{for(w=t;null!==qu;){var E=qu.effectTag;if(36&E&&su(w,qu.alternate,qu),128&E){x=void 0;var C=qu.ref;if(null!==C){var _=qu.stateNode;switch(qu.tag){case 5:x=_;break;default:x=_}"function"===typeof C?C(x):C.current=x}}qu=qu.nextEffect}}catch(S){if(null===qu)throw Error(a(330));Ts(qu,S),qu=qu.nextEffect}}while(null!==qu);qu=null,Fi(),Nu=o}else t.current=n;if(Qu)Qu=!1,$u=t,Ju=e;else for(qu=i;null!==qu;)e=qu.nextEffect,qu.nextEffect=null,qu=e;if(0===(e=t.firstPendingTime)&&(Yu=null),1073741823===e?t===es?ts++:(ts=0,es=t):ts=0,"function"===typeof Is&&Is(n.stateNode,r),ss(t),Ku)throw Ku=!1,t=Xu,Xu=null,t;return(Nu&Cu)!==Eu?null:(Ki(),null)}.bind(null,t,e)),null}function Es(){for(;null!==qu;){var t=qu.effectTag;0!==(256&t)&&ou(qu.alternate,qu),0===(512&t)||Qu||(Qu=!0,Hi(97,function(){return Cs(),null})),qu=qu.nextEffect}}function Cs(){if(90!==Ju){var t=97<Ju?97:Ju;return Ju=90,Gi(t,_s)}}function _s(){if(null===$u)return!1;var t=$u;if($u=null,(Nu&(_u|Su))!==Eu)throw Error(a(331));var e=Nu;for(Nu|=Su,t=t.current.firstEffect;null!==t;){try{var n=t;if(0!==(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:au(5,n),uu(5,n)}}catch(r){if(null===t)throw Error(a(330));Ts(t,r)}n=t.nextEffect,t.nextEffect=null,t=n}return Nu=e,Ki(),!0}function Ss(t,e,n){lo(t,e=gu(t,e=eu(n,e),1073741823)),null!==(t=as(t,1073741823))&&ss(t)}function Ts(t,e){if(3===t.tag)Ss(t,t,e);else for(var n=t.return;null!==n;){if(3===n.tag){Ss(n,t,e);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Yu||!Yu.has(r))){lo(n,t=yu(n,t=eu(e,t),1073741823)),null!==(n=as(n,1073741823))&&ss(n);break}}n=n.return}}function Os(t,e,n){var r=t.pingCache;null!==r&&r.delete(e),Pu===t&&Fu===n?Lu===Au||Lu===Ru&&1073741823===Bu&&Ui()-Gu<Hu?hs(t,Fu):Wu=!0:Vs(t,n)&&(0!==(e=t.lastPingedTime)&&e<n||(t.lastPingedTime=n,ss(t)))}bu=function(t,e,n){var r=e.expirationTime;if(null!==t){var i=e.pendingProps;if(t.memoizedProps!==i||pi.current)Da=!0;else{if(r<n){switch(Da=!1,e.tag){case 3:Ua(e),Ra();break;case 5:if(Fo(e),4&e.mode&&1!==n&&i.hidden)return e.expirationTime=e.childExpirationTime=1,null;break;case 1:gi(e.type)&&xi(e);break;case 4:Po(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value,i=e.type._context,fi($i,i._currentValue),i._currentValue=r;break;case 13:if(null!==e.memoizedState)return 0!==(r=e.child.childExpirationTime)&&r>=n?Ka(t,e,n):(fi(jo,1&jo.current),null!==(e=$a(t,e,n))?e.sibling:null);fi(jo,1&jo.current);break;case 19:if(r=e.childExpirationTime>=n,0!==(64&t.effectTag)){if(r)return Qa(t,e,n);e.effectTag|=64}if(null!==(i=e.memoizedState)&&(i.rendering=null,i.tail=null),fi(jo,jo.current),!r)return null}return $a(t,e,n)}Da=!1}}else Da=!1;switch(e.expirationTime=0,e.tag){case 2:if(r=e.type,null!==t&&(t.alternate=null,e.alternate=null,e.effectTag|=2),t=e.pendingProps,i=mi(e,di.current),io(e,n),i=Qo(null,e,r,t,i,n),e.effectTag|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,gi(r)){var o=!0;xi(e)}else o=!1;e.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,uo(e);var u=r.getDerivedStateFromProps;"function"===typeof u&&go(e,r,u,t),i.updater=yo,e.stateNode=i,i._reactInternalFiber=e,ko(e,r,t,n),e=Va(null,e,r,!0,o,n)}else e.tag=0,Na(null,e,i,n),e=e.child;return e;case 16:t:{if(i=e.elementType,null!==t&&(t.alternate=null,e.alternate=null,e.effectTag|=2),t=e.pendingProps,function(t){if(-1===t._status){t._status=0;var e=t._ctor;e=e(),t._result=e,e.then(function(e){0===t._status&&(e=e.default,t._status=1,t._result=e)},function(e){0===t._status&&(t._status=2,t._result=e)})}}(i),1!==i._status)throw i._result;switch(i=i._result,e.type=i,o=e.tag=function(t){if("function"===typeof t)return Ns(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===ut)return 11;if(t===lt)return 14}return 2}(i),t=Qi(i,t),o){case 0:e=ja(null,e,i,t,n);break t;case 1:e=Ba(null,e,i,t,n);break t;case 11:e=Pa(null,e,i,t,n);break t;case 14:e=Ma(null,e,i,Qi(i.type,t),r,n);break t}throw Error(a(306,i,""))}return e;case 0:return r=e.type,i=e.pendingProps,ja(t,e,r,i=e.elementType===r?i:Qi(r,i),n);case 1:return r=e.type,i=e.pendingProps,Ba(t,e,r,i=e.elementType===r?i:Qi(r,i),n);case 3:if(Ua(e),r=e.updateQueue,null===t||null===r)throw Error(a(282));if(r=e.pendingProps,i=null!==(i=e.memoizedState)?i.element:null,so(t,e),ho(e,r,null,n),(r=e.memoizedState.element)===i)Ra(),e=$a(t,e,n);else{if((i=e.stateNode.hydrate)&&(Ea=En(e.stateNode.containerInfo.firstChild),ka=e,i=Ca=!0),i)for(n=Oo(e,null,r,n),e.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Na(t,e,r,n),Ra();e=e.child}return e;case 5:return Fo(e),null===t&&Ta(e),r=e.type,i=e.pendingProps,o=null!==t?t.memoizedProps:null,u=i.children,wn(r,i)?u=null:null!==o&&wn(r,o)&&(e.effectTag|=16),La(t,e),4&e.mode&&1!==n&&i.hidden?(e.expirationTime=e.childExpirationTime=1,e=null):(Na(t,e,u,n),e=e.child),e;case 6:return null===t&&Ta(e),null;case 13:return Ka(t,e,n);case 4:return Po(e,e.stateNode.containerInfo),r=e.pendingProps,null===t?e.child=To(e,null,r,n):Na(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,Pa(t,e,r,i=e.elementType===r?i:Qi(r,i),n);case 7:return Na(t,e,e.pendingProps,n),e.child;case 8:case 12:return Na(t,e,e.pendingProps.children,n),e.child;case 10:t:{r=e.type._context,i=e.pendingProps,u=e.memoizedProps,o=i.value;var s=e.type._context;if(fi($i,s._currentValue),s._currentValue=o,null!==u)if(s=u.value,0===(o=Br(s,o)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(s,o):1073741823))){if(u.children===i.children&&!pi.current){e=$a(t,e,n);break t}}else for(null!==(s=e.child)&&(s.return=e);null!==s;){var c=s.dependencies;if(null!==c){u=s.child;for(var l=c.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&o)){1===s.tag&&((l=co(n,null)).tag=2,lo(s,l)),s.expirationTime<n&&(s.expirationTime=n),null!==(l=s.alternate)&&l.expirationTime<n&&(l.expirationTime=n),ro(s.return,n),c.expirationTime<n&&(c.expirationTime=n);break}l=l.next}}else u=10===s.tag&&s.type===e.type?null:s.child;if(null!==u)u.return=s;else for(u=s;null!==u;){if(u===e){u=null;break}if(null!==(s=u.sibling)){s.return=u.return,u=s;break}u=u.return}s=u}Na(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=(o=e.pendingProps).children,io(e,n),r=r(i=oo(i,o.unstable_observedBits)),e.effectTag|=1,Na(t,e,r,n),e.child;case 14:return o=Qi(i=e.type,e.pendingProps),Ma(t,e,i,o=Qi(i.type,o),r,n);case 15:return Fa(t,e,e.type,e.pendingProps,r,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Qi(r,i),null!==t&&(t.alternate=null,e.alternate=null,e.effectTag|=2),e.tag=1,gi(r)?(t=!0,xi(e)):t=!1,io(e,n),wo(e,r,i),ko(e,r,i,n),Va(null,e,r,!0,t,n);case 19:return Qa(t,e,n)}throw Error(a(156,e.tag))};var Is=null,Rs=null;function As(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Ds(t,e,n,r){return new As(t,e,n,r)}function Ns(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Ps(t,e){var n=t.alternate;return null===n?((n=Ds(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=t.childExpirationTime,n.expirationTime=t.expirationTime,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{expirationTime:e.expirationTime,firstContext:e.firstContext,responders:e.responders},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ms(t,e,n,r,i,o){var u=2;if(r=t,"function"===typeof t)Ns(t)&&(u=1);else if("string"===typeof t)u=5;else t:switch(t){case et:return Fs(n.children,i,o,e);case at:u=8,i|=7;break;case nt:u=8,i|=1;break;case rt:return(t=Ds(12,n,e,8|i)).elementType=rt,t.type=rt,t.expirationTime=o,t;case st:return(t=Ds(13,n,e,i)).type=st,t.elementType=st,t.expirationTime=o,t;case ct:return(t=Ds(19,n,e,i)).elementType=ct,t.expirationTime=o,t;default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case it:u=10;break t;case ot:u=9;break t;case ut:u=11;break t;case lt:u=14;break t;case ft:u=16,r=null;break t;case ht:u=22;break t}throw Error(a(130,null==t?t:typeof t,""))}return(e=Ds(u,n,e,i)).elementType=t,e.type=r,e.expirationTime=o,e}function Fs(t,e,n,r){return(t=Ds(7,t,r,e)).expirationTime=n,t}function Ls(t,e,n){return(t=Ds(6,t,null,e)).expirationTime=n,t}function js(t,e,n){return(e=Ds(4,null!==t.children?t.children:[],t.key,e)).expirationTime=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Bs(t,e,n){this.tag=e,this.current=null,this.containerInfo=t,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Vs(t,e){var n=t.firstSuspendedTime;return t=t.lastSuspendedTime,0!==n&&n>=e&&t<=e}function Us(t,e){var n=t.firstSuspendedTime,r=t.lastSuspendedTime;n<e&&(t.firstSuspendedTime=e),(r>e||0===n)&&(t.lastSuspendedTime=e),e<=t.lastPingedTime&&(t.lastPingedTime=0),e<=t.lastExpiredTime&&(t.lastExpiredTime=0)}function zs(t,e){e>t.firstPendingTime&&(t.firstPendingTime=e);var n=t.firstSuspendedTime;0!==n&&(e>=n?t.firstSuspendedTime=t.lastSuspendedTime=t.nextKnownPendingLevel=0:e>=t.lastSuspendedTime&&(t.lastSuspendedTime=e+1),e>t.nextKnownPendingLevel&&(t.nextKnownPendingLevel=e))}function Ws(t,e){var n=t.lastExpiredTime;(0===n||n>e)&&(t.lastExpiredTime=e)}function Gs(t,e,n,r){var i=e.current,o=rs(),u=vo.suspense;o=is(o,i,u);t:if(n){e:{if(Zt(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(a(170));var s=n;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(gi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(null!==s);throw Error(a(171))}if(1===n.tag){var c=n.type;if(gi(c)){n=wi(n,c,s);break t}}n=s}else n=hi;return null===e.context?e.context=n:e.pendingContext=n,(e=co(o,u)).payload={element:t},null!==(r=void 0===r?null:r)&&(e.callback=r),lo(i,e),os(i,o),o}function Hs(t){if(!(t=t.current).child)return null;switch(t.child.tag){case 5:default:return t.child.stateNode}}function qs(t,e){null!==(t=t.memoizedState)&&null!==t.dehydrated&&t.retryTime<e&&(t.retryTime=e)}function Ks(t,e){qs(t,e),(t=t.alternate)&&qs(t,e)}function Xs(t,e,n){var r=new Bs(t,e,n=null!=n&&!0===n.hydrate),i=Ds(3,null,null,2===e?7:1===e?3:0);r.current=i,i.stateNode=r,uo(i),t[On]=r.current,n&&0!==e&&function(t,e){var n=Jt(e);Se.forEach(function(t){pe(t,e,n)}),Te.forEach(function(t){pe(t,e,n)})}(0,9===t.nodeType?t:t.ownerDocument),this._internalRoot=r}function Ys(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function Qs(t,e,n,r,i){var o=n._reactRootContainer;if(o){var a=o._internalRoot;if("function"===typeof i){var u=i;i=function(){var t=Hs(a);u.call(t)}}Gs(e,a,t,i)}else{if(o=n._reactRootContainer=function(t,e){if(e||(e=!(!(e=t?9===t.nodeType?t.documentElement:t.firstChild:null)||1!==e.nodeType||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new Xs(t,0,e?{hydrate:!0}:void 0)}(n,r),a=o._internalRoot,"function"===typeof i){var s=i;i=function(){var t=Hs(a);s.call(t)}}fs(function(){Gs(e,a,t,i)})}return Hs(a)}function $s(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ys(e))throw Error(a(200));return function(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:tt,key:null==r?null:""+r,children:t,containerInfo:e,implementation:n}}(t,e,null,n)}Xs.prototype.render=function(t){Gs(t,this._internalRoot,null,null)},Xs.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;Gs(null,t,null,function(){e[On]=null})},ve=function(t){if(13===t.tag){var e=Yi(rs(),150,100);os(t,e),Ks(t,e)}},me=function(t){13===t.tag&&(os(t,3),Ks(t,3))},ge=function(t){if(13===t.tag){var e=rs();os(t,e=is(e,t,null)),Ks(t,e)}},T=function(t,e,n){switch(e){case"input":if(Ct(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Dn(r);if(!i)throw Error(a(90));wt(r),Ct(r,i)}}}break;case"textarea":At(t,n);break;case"select":null!=(e=n.value)&&Ot(t,!!n.multiple,e,!1)}},N=ls,P=function(t,e,n,r,i){var o=Nu;Nu|=4;try{return Gi(98,t.bind(null,e,n,r,i))}finally{(Nu=o)===Eu&&Ki()}},M=function(){(Nu&(1|_u|Su))===Eu&&(function(){if(null!==Zu){var t=Zu;Zu=null,t.forEach(function(t,e){Ws(e,t),ss(e)}),Ki()}}(),Cs())},F=function(t,e){var n=Nu;Nu|=2;try{return t(e)}finally{(Nu=n)===Eu&&Ki()}};var Js={Events:[Rn,An,Dn,_,k,Bn,function(t){ie(t,jn)},A,D,Ye,ue,Cs,{current:!1}]};!function(t){var e=t.findFiberByHostInstance;(function(t){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var e=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(e.isDisabled||!e.supportsFiber)return!0;try{var n=e.inject(t);Is=function(t){try{e.onCommitFiberRoot(n,t,void 0,64===(64&t.current.effectTag))}catch(r){}},Rs=function(t){try{e.onCommitFiberUnmount(n,t)}catch(r){}}}catch(r){}})(i({},t,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Y.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=ne(t))?null:t.stateNode},findFiberByHostInstance:function(t){return e?e(t):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:In,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Js,e.createPortal=$s,e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternalFiber;if(void 0===e){if("function"===typeof t.render)throw Error(a(188));throw Error(a(268,Object.keys(t)))}return t=null===(t=ne(e))?null:t.stateNode},e.flushSync=function(t,e){if((Nu&(_u|Su))!==Eu)throw Error(a(187));var n=Nu;Nu|=1;try{return Gi(99,t.bind(null,e))}finally{Nu=n,Ki()}},e.hydrate=function(t,e,n){if(!Ys(e))throw Error(a(200));return Qs(null,t,e,!0,n)},e.render=function(t,e,n){if(!Ys(e))throw Error(a(200));return Qs(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!Ys(t))throw Error(a(40));return!!t._reactRootContainer&&(fs(function(){Qs(null,null,t,!1,function(){t._reactRootContainer=null,t[On]=null})}),!0)},e.unstable_batchedUpdates=ls,e.unstable_createPortal=function(t,e){return $s(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},e.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Ys(n))throw Error(a(200));if(null==t||void 0===t._reactInternalFiber)throw Error(a(38));return Qs(t,e,n,!1,r)},e.version="16.14.0"},function(t,e,n){"use strict";t.exports=n(40)},function(t,e,n){"use strict";var r,i,o,a,u;if("undefined"===typeof window||"function"!==typeof MessageChannel){var s=null,c=null,l=function t(){if(null!==s)try{var n=e.unstable_now();s(!0,n),s=null}catch(r){throw setTimeout(t,0),r}},f=Date.now();e.unstable_now=function(){return Date.now()-f},r=function(t){null!==s?setTimeout(r,0,t):(s=t,setTimeout(l,0))},i=function(t,e){c=setTimeout(t,e)},o=function(){clearTimeout(c)},a=function(){return!1},u=e.unstable_forceFrameRate=function(){}}else{var h=window.performance,d=window.Date,p=window.setTimeout,v=window.clearTimeout;if("undefined"!==typeof console){var m=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"===typeof h&&"function"===typeof h.now)e.unstable_now=function(){return h.now()};else{var g=d.now();e.unstable_now=function(){return d.now()-g}}var y=!1,b=null,w=-1,x=5,k=0;a=function(){return e.unstable_now()>=k},u=function(){},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):x=0<t?Math.floor(1e3/t):5};var E=new MessageChannel,C=E.port2;E.port1.onmessage=function(){if(null!==b){var t=e.unstable_now();k=t+x;try{b(!0,t)?C.postMessage(null):(y=!1,b=null)}catch(n){throw C.postMessage(null),n}}else y=!1},r=function(t){b=t,y||(y=!0,C.postMessage(null))},i=function(t,n){w=p(function(){t(e.unstable_now())},n)},o=function(){v(w),w=-1}}function _(t,e){var n=t.length;t.push(e);t:for(;;){var r=n-1>>>1,i=t[r];if(!(void 0!==i&&0<O(i,e)))break t;t[r]=e,t[n]=i,n=r}}function S(t){return void 0===(t=t[0])?null:t}function T(t){var e=t[0];if(void 0!==e){var n=t.pop();if(n!==e){t[0]=n;t:for(var r=0,i=t.length;r<i;){var o=2*(r+1)-1,a=t[o],u=o+1,s=t[u];if(void 0!==a&&0>O(a,n))void 0!==s&&0>O(s,a)?(t[r]=s,t[u]=n,r=u):(t[r]=a,t[o]=n,r=o);else{if(!(void 0!==s&&0>O(s,n)))break t;t[r]=s,t[u]=n,r=u}}}return e}return null}function O(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}var I=[],R=[],A=1,D=null,N=3,P=!1,M=!1,F=!1;function L(t){for(var e=S(R);null!==e;){if(null===e.callback)T(R);else{if(!(e.startTime<=t))break;T(R),e.sortIndex=e.expirationTime,_(I,e)}e=S(R)}}function j(t){if(F=!1,L(t),!M)if(null!==S(I))M=!0,r(B);else{var e=S(R);null!==e&&i(j,e.startTime-t)}}function B(t,n){M=!1,F&&(F=!1,o()),P=!0;var r=N;try{for(L(n),D=S(I);null!==D&&(!(D.expirationTime>n)||t&&!a());){var u=D.callback;if(null!==u){D.callback=null,N=D.priorityLevel;var s=u(D.expirationTime<=n);n=e.unstable_now(),"function"===typeof s?D.callback=s:D===S(I)&&T(I),L(n)}else T(I);D=S(I)}if(null!==D)var c=!0;else{var l=S(R);null!==l&&i(j,l.startTime-n),c=!1}return c}finally{D=null,N=r,P=!1}}function V(t){switch(t){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var U=u;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){M||P||(M=!0,r(B))},e.unstable_getCurrentPriorityLevel=function(){return N},e.unstable_getFirstCallbackNode=function(){return S(I)},e.unstable_next=function(t){switch(N){case 1:case 2:case 3:var e=3;break;default:e=N}var n=N;N=e;try{return t()}finally{N=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=U,e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=N;N=t;try{return e()}finally{N=n}},e.unstable_scheduleCallback=function(t,n,a){var u=e.unstable_now();if("object"===typeof a&&null!==a){var s=a.delay;s="number"===typeof s&&0<s?u+s:u,a="number"===typeof a.timeout?a.timeout:V(t)}else a=V(t),s=u;return t={id:A++,callback:n,priorityLevel:t,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>u?(t.sortIndex=s,_(R,t),null===S(I)&&t===S(R)&&(F?o():F=!0,i(j,s-u))):(t.sortIndex=a,_(I,t),M||P||(M=!0,r(B))),t},e.unstable_shouldYield=function(){var t=e.unstable_now();L(t);var n=S(I);return n!==D&&null!==D&&null!==n&&null!==n.callback&&n.startTime<=t&&n.expirationTime<D.expirationTime||a()},e.unstable_wrapCallback=function(t){var e=N;return function(){var n=N;N=e;try{return t.apply(this,arguments)}finally{N=n}}}},,,,function(t,e,n){"use strict";(function(t){var r=n(45),i=n(46),o=n(47);function a(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=s.prototype:(null===t&&(t=new s(e)),t.length=e),t}function s(t,e,n){if(!s.TYPED_ARRAY_SUPPORT&&!(this instanceof s))return new s(t,e,n);if("number"===typeof t){if("string"===typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return c(this,t,e,n)}function c(t,e,n,r){if("number"===typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);s.TYPED_ARRAY_SUPPORT?(t=e).__proto__=s.prototype:t=h(t,e);return t}(t,e,n,r):"string"===typeof e?function(t,e,n){"string"===typeof n&&""!==n||(n="utf8");if(!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(e,n),i=(t=u(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(s.isBuffer(e)){var n=0|d(e.length);return 0===(t=u(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!==typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!==typeof e.length||(r=e.length)!==r?u(t,0):h(t,e);if("Buffer"===e.type&&o(e.data))return h(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!==typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,e){if(l(e),t=u(t,e<0?0:0|d(e)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function h(t,e){var n=e.length<0?0:0|d(e.length);t=u(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function d(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(s.isBuffer(t))return t.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!==typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(t).length;default:if(r)return V(t).length;e=(""+e).toLowerCase(),r=!0}}function v(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function m(t,e,n,r,i){if(0===t.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof e&&(e=s.from(e,r)),s.isBuffer(e))return 0===e.length?-1:g(t,e,n,r,i);if("number"===typeof e)return e&=255,s.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):g(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(t,e,n,r,i){var o,a=1,u=t.length,s=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,u/=2,s/=2,n/=2}function c(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var l=-1;for(o=n;o<u;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===s)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+s>u&&(n=u-s),o=n;o>=0;o--){for(var f=!0,h=0;h<s;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function y(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var u=parseInt(e.substr(2*a,2),16);if(isNaN(u))return a;t[n+a]=u}return a}function b(t,e,n,r){return z(V(e,t.length-n),t,n,r)}function w(t,e,n,r){return z(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function x(t,e,n,r){return w(t,e,n,r)}function k(t,e,n,r){return z(U(e),t,n,r)}function E(t,e,n,r){return z(function(t,e){for(var n,r,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)n=t.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function C(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function _(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,a,u,s,c=t[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128===(192&(o=t[i+1]))&&(s=(31&c)<<6|63&o)>127&&(l=s);break;case 3:o=t[i+1],a=t[i+2],128===(192&o)&&128===(192&a)&&(s=(15&c)<<12|(63&o)<<6|63&a)>2047&&(s<55296||s>57343)&&(l=s);break;case 4:o=t[i+1],a=t[i+2],u=t[i+3],128===(192&o)&&128===(192&a)&&128===(192&u)&&(s=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&u)>65535&&s<1114112&&(l=s)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=S));return n}(r)}e.Buffer=s,e.SlowBuffer=function(t){+t!=t&&(t=0);return s.alloc(+t)},e.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"===typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}(),e.kMaxLength=a(),s.poolSize=8192,s._augment=function(t){return t.__proto__=s.prototype,t},s.from=function(t,e,n){return c(null,t,e,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(t,e,n){return function(t,e,n,r){return l(e),e<=0?u(t,e):void 0!==n?"string"===typeof r?u(t,e).fill(n,r):u(t,e).fill(n):u(t,e)}(null,t,e,n)},s.allocUnsafe=function(t){return f(null,t)},s.allocUnsafeSlow=function(t){return f(null,t)},s.isBuffer=function(t){return!(null==t||!t._isBuffer)},s.compare=function(t,e){if(!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=s.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var a=t[n];if(!s.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},s.byteLength=p,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},s.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?_(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,e,n);case"utf8":case"utf-8":return _(this,e,n);case"ascii":return T(this,e,n);case"latin1":case"binary":return O(this,e,n);case"base64":return C(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},s.prototype.compare=function(t,e,n,r,i){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(e>>>=0),u=Math.min(o,a),c=this.slice(r,i),l=t.slice(e,n),f=0;f<u;++f)if(c[f]!==l[f]){o=c[f],a=l[f];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},s.prototype.indexOf=function(t,e,n){return m(this,t,e,n,!0)},s.prototype.lastIndexOf=function(t,e,n){return m(this,t,e,n,!1)},s.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"===typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return y(this,t,e,n);case"utf8":case"utf-8":return b(this,t,e,n);case"ascii":return w(this,t,e,n);case"latin1":case"binary":return x(this,t,e,n);case"base64":return k(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function T(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function O(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function I(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=B(t[o]);return i}function R(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function A(t,e,n){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,n,r,i,o){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function N(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function P(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function M(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(t,e,n,r,o){return o||M(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function L(t,e,n,r,o){return o||M(t,0,n,8),i.write(t,e,n,r,52,8),n+8}s.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),s.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=s.prototype;else{var i=e-t;n=new s(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},s.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},s.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},s.prototype.readUInt8=function(t,e){return e||A(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return e||A(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return e||A(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return e||A(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return e||A(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},s.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},s.prototype.readInt8=function(t,e){return e||A(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){e||A(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(t,e){e||A(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(t,e){return e||A(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return e||A(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return e||A(t,4,this.length),i.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return e||A(t,4,this.length),i.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return e||A(t,8,this.length),i.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return e||A(t,8,this.length),i.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||D(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},s.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||D(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},s.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,1,255,0),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},s.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},s.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):P(this,t,e,!0),e+4},s.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):P(this,t,e,!1),e+4},s.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);D(this,t,e,n,i-1,-i)}var o=0,a=1,u=0;for(this[e]=255&t;++o<n&&(a*=256);)t<0&&0===u&&0!==this[e+o-1]&&(u=1),this[e+o]=(t/a>>0)-u&255;return e+n},s.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);D(this,t,e,n,i-1,-i)}var o=n-1,a=1,u=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===u&&0!==this[e+o+1]&&(u=1),this[e+o]=(t/a>>0)-u&255;return e+n},s.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,1,127,-128),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},s.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},s.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):P(this,t,e,!0),e+4},s.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):P(this,t,e,!1),e+4},s.prototype.writeFloatLE=function(t,e,n){return F(this,t,e,!0,n)},s.prototype.writeFloatBE=function(t,e,n){return F(this,t,e,!1,n)},s.prototype.writeDoubleLE=function(t,e,n){return L(this,t,e,!0,n)},s.prototype.writeDoubleBE=function(t,e,n){return L(this,t,e,!1,n)},s.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!s.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},s.prototype.fill=function(t,e,n,r){if("string"===typeof t){if("string"===typeof e?(r=e,e=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"===typeof t)for(o=e;o<n;++o)this[o]=t;else{var a=s.isBuffer(t)?t:V(new s(t,r).toString()),u=a.length;for(o=0;o<n-e;++o)this[o+e]=a[o%u]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function B(t){return t<16?"0"+t.toString(16):t.toString(16)}function V(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function U(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(j,"")).length<2)return"";for(;t.length%4!==0;)t+="=";return t}(t))}function z(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(23))},function(t,e,n){"use strict";e.byteLength=function(t){var e=c(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,r=c(t),a=r[0],u=r[1],s=new o(function(t,e,n){return 3*(e+n)/4-n}(0,a,u)),l=0,f=u>0?a-4:a;for(n=0;n<f;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],s[l++]=e>>16&255,s[l++]=e>>8&255,s[l++]=255&e;2===u&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,s[l++]=255&e);1===u&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,s[l++]=e>>8&255,s[l++]=255&e);return s},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,o=[],a=0,u=n-i;a<u;a+=16383)o.push(l(t,a,a+16383>u?u:a+16383));1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!==typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,s=a.length;u<s;++u)r[u]=a[u],i[a.charCodeAt(u)]=u;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function l(t,e,n){for(var i,o,a=[],u=e;u<n;u+=3)i=(t[u]<<16&16711680)+(t[u+1]<<8&65280)+(255&t[u+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var o,a,u=8*i-r-1,s=(1<<u)-1,c=s>>1,l=-7,f=n?i-1:0,h=n?-1:1,d=t[e+f];for(f+=h,o=d&(1<<-l)-1,d>>=-l,l+=u;l>0;o=256*o+t[e+f],f+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===s)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),o-=c}return(d?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,u,s,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(s=Math.pow(2,-a))<1&&(a--,s*=2),(e+=a+f>=1?h/s:h*Math.pow(2,1-f))*s>=2&&(a++,s/=2),a+f>=l?(u=0,a=l):a+f>=1?(u=(e*s-1)*Math.pow(2,i),a+=f):(u=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;t[n+d]=255&u,d+=p,u/=256,i-=8);for(a=a<<i|u,c+=i;c>0;t[n+d]=255&a,d+=p,a/=256,c-=8);t[n+d-p]|=128*v}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){(function(t){var r="undefined"!==typeof t&&t||"undefined"!==typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(49),e.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(23))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i=1,o={},a=!1,u=t.document,s=Object.getPrototypeOf&&Object.getPrototypeOf(t);s=s&&s.setTimeout?s:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){l(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"===typeof n.data&&0===n.data.indexOf(e)&&l(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),r=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){l(t.data)},r=function(e){t.port2.postMessage(e)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var t=u.documentElement;r=function(e){var n=u.createElement("script");n.onreadystatechange=function(){l(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():r=function(t){setTimeout(l,0,t)},s.setImmediate=function(t){"function"!==typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var a={callback:t,args:e};return o[i]=a,r(i),i++},s.clearImmediate=c}function c(t){delete o[t]}function l(t){if(a)setTimeout(l,0,t);else{var e=o[t];if(e){a=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{c(t),a=!1}}}}}("undefined"===typeof self?"undefined"===typeof t?this:t:self)}).call(this,n(23),n(26))},,,,function(t,e){},,function(t,e,n){"use strict";n.r(e);var r=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|inert|itemProp|itemScope|itemType|itemID|itemRef|on|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,i=function(t){var e={};return function(n){return void 0===e[n]&&(e[n]=t(n)),e[n]}}(function(t){return r.test(t)||111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&t.charCodeAt(2)<91});e.default=i},,function(t,e,n){"use strict";var r,i=new Uint8Array(16);var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(t){return"string"===typeof t&&o.test(t)},u=[],s=0;s<256;++s)u.push((s+256).toString(16).substr(1));var c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n};e.a=function(t,e,n){var o=(t=t||{}).random||(t.rng||function(){if(!r&&!(r="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(var a=0;a<16;++a)e[n+a]=o[a];return e}return c(o)}}]]);
//# sourceMappingURL=1.c069e7a1.chunk.js.map