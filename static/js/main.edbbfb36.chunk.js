(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{36:function(e,t,n){e.exports=n(54)},41:function(e,t,n){},50:function(e,t){},51:function(e,t){},52:function(e,t){},54:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n.n(r),c=n(33),o=n.n(c),i=(n(41),n(11)),u=function(){return a.a.createElement("div",{className:"title"},a.a.createElement("h1",null,"Bild Klassifizierung"),a.a.createElement("h2",null,"Ihre Blider"),a.a.createElement("p",null,"Tag die Leute!"))},s=n(19),l=n(5),f=n(34),h=n(12),d=n(18),p=Object(f.a)({apiKey:"AIzaSyC2D-DvAAG88M3OkcAfsBTVOEgf0CVqD4E",authDomain:"image-gallery-90dd1.firebaseapp.com",projectId:"image-gallery-90dd1",storageBucket:"image-gallery-90dd1.appspot.com",messagingSenderId:"555600352265",appId:"1:555600352265:web:beff715bc3ba9bd334d4d8",measurementId:"G-H4D3Q2PQVM"}),m=Object(h.d)(p),g=(Object(d.b)(p),n(16)),b=n(57);function v(){v=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",c=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function i(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(N){i=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof f?t:f,c=Object.create(a.prototype),o=new x(r||[]);return c._invoke=function(e,t,n){var r="suspendedStart";return function(a,c){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw c;return L()}for(n.method=a,n.arg=c;;){var o=n.delegate;if(o){var i=j(o,n);if(i){if(i===l)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),c}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(N){return{type:"throw",arg:N}}}e.wrap=u;var l={};function f(){}function h(){}function d(){}var p={};i(p,a,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(k([])));g&&g!==t&&n.call(g,a)&&(p=g);var b=d.prototype=f.prototype=Object.create(p);function y(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(e,t){var r;this._invoke=function(a,c){function o(){return new t(function(r,o){!function r(a,c,o,i){var u=s(e[a],e,c);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then(function(e){r("next",e,o,i)},function(e){r("throw",e,o,i)}):t.resolve(f).then(function(e){l.value=e,o(l)},function(e){return r("throw",e,o,i)})}i(u.arg)}(a,c,r,o)})}return r=r?r.then(o,o):o()}}function j(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,j(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function k(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,c=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return c.next=c}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=d,i(b,"constructor",d),i(d,"constructor",h),h.displayName=i(d,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,i(e,o,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},y(w.prototype),i(w.prototype,c,function(){return this}),e.AsyncIterator=w,e.async=function(t,n,r,a,c){void 0===c&&(c=Promise);var o=new w(u(t,n,r,a),c);return e.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},y(b),i(b,o,"Generator"),i(b,a,function(){return this}),i(b,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],o=c.completion;if("root"===c.tryLoc)return r("end");if(c.tryLoc<=this.prev){var i=n.call(c,"catchLoc"),u=n.call(c,"finallyLoc");if(i&&u){if(this.prev<c.catchLoc)return r(c.catchLoc,!0);if(this.prev<c.finallyLoc)return r(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return r(c.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return r(c.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var c=a;break}}c&&("break"===e||"continue"===e)&&c.tryLoc<=t&&t<=c.finallyLoc&&(c=null);var o=c?c.completion:{};return o.type=e,o.arg=t,c?(this.method="next",this.next=c.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}var y=function(e){var t=Object(r.useState)(0),n=Object(i.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(null),u=Object(i.a)(o,2),f=u[0],p=u[1],y=Object(r.useState)(null),w=Object(i.a)(y,1)[0];function j(e){return Promise.all(e.map(function(){var e=Object(l.a)(v().mark(function e(t){var n,r,a,c;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.faceUrl,r=[],e.next=4,g.i(n);case 4:return a=e.sent,e.next=7,g.g(a).withFaceLandmarks().withFaceDescriptor();case 7:return c=e.sent,console.log("Result",c),r.push(c.descriptor),e.abrupt("return",new g.b(t.personId.concat("$",t.name),r));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()))}function O(e,t){return E.apply(this,arguments)}function E(){return(E=Object(l.a)(v().mark(function e(t,n){var r,a,c,o,i,u,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[new g.c(n[0],n[1],n[2],n[3])],e.next=3,g.h(t,r);case 3:if(0!==(a=e.sent).length){e.next=9;break}return console.log("No face found"),e.abrupt("return","");case 9:for(c=new Image,o=0;o<a.length;o++)c.src=a[o].toDataURL();return i=Object(d.b)(),u=Object(b.a)(),s=Object(d.c)(i,u),e.next=16,Object(d.e)(s,c.src,"data_url");case 16:return e.next=18,Object(d.a)(Object(d.c)(i,u));case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}var x=function(){var t=Object(l.a)(v().mark(function t(n){var r,a,c,o,i,u,s,l,f;return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.k.faceLandmark68Net.loadFromUri("/models");case 2:return t.next=4,g.k.faceRecognitionNet.loadFromUri("/models");case 4:return t.next=6,g.k.ssdMobilenetv1.loadFromUri("/models");case 6:return(r=new Image).src=URL.createObjectURL(e.file),t.next=10,g.f(r).withFaceLandmarks().withFaceDescriptors();case 10:if(t.sent.length){t.next=13;break}return t.abrupt("return");case 13:if(0===n.length){t.next=19;break}return t.next=16,j(n);case 16:c=t.sent,console.log("Labeled Faces ",c),a=new g.a(c,.6);case 19:return o=document.createElement("div"),t.next=22,g.d(e.file);case 22:return i=t.sent,o.append(i),u=g.e(i),o.append(u),s={width:i.width,height:i.height},g.j(u,s),t.next=30,g.f(i).withFaceLandmarks().withFaceDescriptors();case 30:return l=t.sent,f=g.l(l,s),t.abrupt("return",f.map(function(e){return{match:a?a.findBestMatch(e.descriptor):{label:"$unknown"},shape:Object.values(e.detection.box),personId:""}}));case 33:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),k=function(){var e=Object(l.a)(v().mark(function e(){var t;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,Object(h.c)(Object(h.a)(m,"persons"));case 3:return e.sent.forEach(function(e){t.push(Object(s.a)({},e.data(),{id:e.id}))}),e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)(function(){var t=Object(d.b)(),n=Object(d.c)(t,e.file.name),r=Object(d.d)(n,e.file);r.on("state_changed",function(e){var t=e.bytesTransferred/e.totalBytes*100;c(t)},function(e){p(e)},Object(l.a)(v().mark(function t(){var n,a,c,o,i,u,s,l,f,p,g,y;return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(d.a)(r.snapshot.ref);case 2:return n=t.sent,a=(new Date).getTime(),c=e.width,o=e.height,t.next=8,Object(h.h)(Object(h.b)(m,"images",e.file.name),{name:e.file.name,url:n,createdAt:a,width:c,height:o});case 8:return t.next=10,k();case 10:return i=t.sent,t.next=13,x(i);case 13:u=t.sent,console.log("Det",u),u||(u=[]),(s=new Image).src=URL.createObjectURL(e.file),l=0;case 19:if(!(l<u.length)){t.next=37;break}if(f=u[l].match.label,u[l].fullName="","unknown"!==f&&"unknown"!==f.split("$")[1]){t.next=32;break}return t.next=25,O(s,u[l].shape);case 25:return p=t.sent,g=Object(b.a)(),u[l].personId=g,t.next=30,Object(h.h)(Object(h.b)(m,"persons",g),{faceUrl:p,personId:g,name:""});case 30:t.next=34;break;case 32:u[l].personId=f.split("$")[0],u[l].fullName=f.split("$")[1];case 34:l++,t.next=19;break;case 37:y=0;case 38:if(!(y<u.length)){t.next=45;break}return console.log("detloop",u[y]),t.next=42,Object(h.h)(Object(h.b)(m,"facePositions",e.file.name+"-"+y),{distanceLeft:u[y].shape[0],distanceTop:u[y].shape[1],length:u[y].shape[2],width:u[y].shape[3],createdAt:a,imageId:e.file.name,personId:u[y].personId,fullName:u[y].fullName});case 42:y++,t.next=38;break;case 45:case"end":return t.stop()}},t)})))},[e]),{progress:a,url:w,error:f}},w=n(24),j=function(e){var t=e.image,n=e.setFile,c=y(t),o=c.progress,i=c.url;return console.log(o,i),Object(r.useEffect)(function(){i&&n(null)},[i,n]),a.a.createElement(w.a.div,{className:"progress-bar",initial:{width:0},animate:{width:o+"%"}})},O=function(){var e=Object(r.useState)(null),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(null),u=Object(i.a)(o,2),s=u[0],l=u[1],f=Object(r.useState)(),h=Object(i.a)(f,2),d=h[0],p=h[1],m=["image/png","image/jpeg"];return Object(r.useEffect)(function(){n&&function(){var e=new Image;e.src=URL.createObjectURL(n),n&&m.includes(n.type)?(e.onload=function(){p({file:n,width:e.width,height:e.height})},l("")):(c(null),l("Please select an image file (png or jpg)"))}()},[n]),a.a.createElement("form",null,a.a.createElement("label",null,a.a.createElement("input",{type:"file",onChange:function(e){return c(e.target.files[0])}}),a.a.createElement("span",null,"+")),a.a.createElement("div",{className:"output"},s&&a.a.createElement("div",{className:"error"},s),n&&a.a.createElement("div",null,n.name),d&&n&&a.a.createElement(j,{image:d,setFile:c})))},E=function(e){var t=Object(r.useState)([]),n=Object(i.a)(t,2),a=n[0],c=n[1];return Object(r.useEffect)(function(){var t=Object(h.g)(Object(h.a)(m,e),Object(h.f)("createdAt","desc")),n=Object(h.e)(t,function(e){var t=[];e.forEach(function(e){t.push(Object(s.a)({},e.data(),{id:e.id}))}),c(t)});return function(){return n()}},[e]),{docs:a}},x=function(e){var t=e.setSelectedImg,n=E("images").docs;return a.a.createElement("ul",{className:"img-container"},n&&n.map(function(e){return a.a.createElement(w.a.li,{className:"img-item",key:e.id,layout:!0,whileHover:{opacity:1},s:!0,onClick:function(){return t(e)}},a.a.createElement(w.a.img,{className:"mot-img",src:e.url,width:e.width/2,height:e.height/2,alt:"uploaded pic",crossOrigin:"anonymous",initial:{opacity:0},animate:{opacity:1},transition:{delay:1}}),a.a.createElement("canvas",{width:e.width/2,height:e.height/2}))}))},k=function(e){var t=Object(r.useState)([]),n=Object(i.a)(t,2),a=n[0],c=n[1];return Object(r.useEffect)(function(){var t=Object(h.g)(Object(h.a)(m,"facePositions"),Object(h.j)("imageId","==",e)),n=Object(h.e)(t,function(e){var t=[];e.forEach(function(e){t.push(Object(s.a)({},e.data(),{id:e.id}))}),c(t)});return function(){return n()}},[e]),{faces:a}},L=function(e){var t=Object(r.useState)([]),n=Object(i.a)(t,2),a=n[0],c=n[1];return Object(r.useEffect)(function(){var e=Object(h.g)(Object(h.a)(m,"facePositions")),t=Object(h.e)(e,function(e){var t=[];e.forEach(function(e){t.push(Object(s.a)({},e.data(),{id:e.id}))}),console.log("Doc",t),c(t)});return function(){return t()}},[e]),{pos:a}},N=function(e){var t=e.selectedImg,n=e.setSelectedImg,c=Object(r.useState)([]),o=Object(i.a)(c,2),u=o[0],s=o[1],l=Object(r.useRef)(),f=Object(r.useRef)(),d=k(t.id).faces,p=L(t.id).pos;function g(e,t){console.log("Update face ",e),"Enter"===t.key&&""!==t.target.value&&(console.log("Update name to ",t.target.value),s({id:e.personId,faceUrl:e.faceUrl,newName:t.target.value}))}return Object(r.useEffect)(function(){u&&p&&u.id&&u.newName&&function(){Object(h.i)(Object(h.b)(m,"persons",u.id),{name:u.newName}),console.log("Pos:",p);for(var e=p.filter(function(e){return e.personId===u.id}),t=0;t<e.length;t++)Object(h.i)(Object(h.b)(m,"facePositions",e[t].id),{fullName:u.newName})}()},[u]),a.a.createElement(w.a.div,{className:"backdrop",onClick:function(e){e.target.classList.contains("backdrop")&&(n(null),s(null))},initial:{opacity:0},animate:{opacity:1}},a.a.createElement(w.a.img,{ref:l,className:"backdrop",crossOrigin:"anonymous",src:t.url,alt:"enlarged pic",initial:{y:"-100vh"},animate:{y:0}}),a.a.createElement("canvas",{className:"backdrop",onMouseEnter:function(){var e=f.current.getContext("2d");e.lineWidth=5,e.strokeStyle="blue",d.map(function(t){return e.strokeRect(t.distanceLeft,t.distanceTop,t.length,t.width)})},ref:f,width:t.width,height:t.height}),d&&d.map(function(e,t){return a.a.createElement("input",{name:"input".concat(t),style:{left:e.distanceLeft,top:e.distanceTop+e.width+5},placeholder:""===e.fullName?"Add name":e.fullName,key:t,className:"friendInput",onKeyPress:g.bind(void 0,e)})}))};var I=function(){var e=Object(r.useState)(null),t=Object(i.a)(e,2),n=t[0],c=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement(u,null),a.a.createElement(O,null),a.a.createElement(x,{setSelectedImg:c}),n&&a.a.createElement(N,{selectedImg:n,setSelectedImg:c}))};o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(I,null)),document.getElementById("root"))}},[[36,2,1]]]);
//# sourceMappingURL=main.edbbfb36.chunk.js.map